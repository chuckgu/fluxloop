{"id": "ae2e5300-aa2a-4d54-b8bf-1e45c35ed28a", "content": "# FluxLoop Deep Agent Architecture: Core, Workflow, and Expansion\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 0, "total_chunks": null}}
{"id": "b679f357-a86d-4475-beee-c110a1cb28f4", "content": "## 1. 개요 (Overview)\n\nFluxLoop Deep Agent는 복잡한 소프트웨어 엔지니어링 작업을 자율적으로 수행하기 위한 **LLM 기반 에이전트 시스템**입니다.  \n초기의 단순한 단일 에이전트 모델에서 벗어나, **LangGraph 기반의 상태 머신**, **Agent 내부 Supervisor 피드백 루프**, 그리고 **Config-driven Builder 패턴**을 통해 높은 확장성과 안정성을 확보했습니다.\n\n이 문서는 현재 구축된 시스템의 핵심 아키텍처, 실행 흐름, 데이터/상태 관리, 그리고 향후 다중 에이전트로의 확장 방안을 총망라합니다.\n\n---\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 1, "total_chunks": null}}
{"id": "6fd0d32b-902f-47d7-979c-738c532e0b7e", "content": "## 2. 핵심 아키텍처 (Core Architecture)\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 2, "total_chunks": null}}
{"id": "dc9d8bdc-2cdf-4097-a375-70ad8f968723", "content": "### 2.1 단일 통합 그래프 (Single Deep Agent Graph)\nDeep Agent는 **단일 LangGraph (`StateGraph`)** 내에 Worker와 Supervisor가 공존하는 구조입니다. 외부에서 Supervisor가 Worker를 호출하는 계층형 구조가 아니라, **Worker의 실행 루프 내부에 Supervisor가 피드백 노드로 참여**하는 형태입니다.\n\n- **Agent Node (Worker)**:\n  - 그래프의 진입점(Entry Point)이자 주 실행자입니다.\n  - `LangChain AgentExecutor`를 래핑하여 실제 도구(Tool) 실행과 코딩 작업을 수행합니다.\n  - 작업 결과를 `DeepAgentState`에 기록하고, 다음 단계(계속/검토/종료)를 결정하기 위해 Router를 호출합니다.\n  - LLM: `gpt-5.1-codex` (코딩 및 추론 최적화 모델)\n\n- **Supervisor Node (Reviewer)**:\n  - 그래프 내부의 특수 노드(Special Node)입니다.", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 3, "total_chunks": null}}
{"id": "c614dd97-307e-4adb-b168-a073f887556b", "content": "  - Agent Node가 \"검토 필요\" 또는 \"완료 대기\" 상태일 때 조건부 엣지(Conditional Edge)를 통해 호출됩니다.\n  - Worker의 상태(`plan`, `messages`)를 분석하여 피드백을 생성하거나, 최종 종료(`__end__`)를 승인합니다.\n  - LLM: `gpt-5.1` (기본 모델)\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 4, "total_chunks": null}}
{"id": "f52aa5d2-2085-4844-a687-16a0a6952fe0", "content": "### 2.2 동적 에이전트 빌더 (Agent Builder)\n`AgentService`는 `AgentGraphConfig`에 따라 이 단일 그래프를 동적으로 조립합니다.\n\n- **구성 요소 조립**:\n  - `build_deep_agent_graph` 함수가 설정에 따라 `Agent Node`와 `Supervisor Node`를 생성하고 연결합니다.\n  - Supervisor가 필요 없는 단순 에이전트의 경우, Supervisor Node를 생략하고 Agent Node만으로 구성된 그래프를 생성할 수도 있습니다.\n\n- **에이전트 레지스트리 (Registry)**:\n  - `Integrator`: 코드 수정, 테스트, Git 작업 수행 (Full Tools).\n  - `Researcher`: 코드 분석, 문서 조회, 웹 검색 수행 (Read-only Tools).\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 5, "total_chunks": null}}
{"id": "89cad1e8-cc31-4733-9edd-6388c51d7278", "content": "### 2.3 상태 및 지속성 (Persistence)\n- **DeepAgentState**: 그래프 내의 모든 노드가 공유하는 상태 객체입니다. (`messages`, `plan`, `todos`, `artifacts`, `supervisor_feedback` 등 포함)\n- **Checkpointer**: LangGraph의 `MemorySaver`가 그래프 수준에서 적용되어, Supervisor와 Agent 간의 전환이나 도구 실행 루프가 중단되어도 상태가 보존됩니다.\n- **AgentSessionStore**: 세션의 생명주기(Status)와 이벤트 로그를 Supabase에 저장합니다.\n- **AgentPersistenceStore**: Memory(장기 기억), Skills(패턴), Plan(TODO 리스트)을 관리합니다.\n\n---\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 6, "total_chunks": null}}
{"id": "1bca8de0-1db1-452c-a1c8-99ffe736e373", "content": "## 3. 실행 흐름 (Execution Flow)\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 7, "total_chunks": null}}
{"id": "f60433fc-3eb4-4aa4-9336-a4eeb69efeb4", "content": "### 3.1 세션 시작 및 초기화\n1. **요청 수신**: 클라이언트가 `run_agent_loop_stream`을 호출합니다.\n2. **그래프 빌드**: `registry`에서 설정을 가져와 `build_deep_agent_graph`를 호출합니다. 이때 `SupervisorNode`가 내부 노드로 주입됩니다.\n3. **제약조건 주입**: 시스템 프롬프트에 `DEFAULT_GIT_CONSTRAINTS`가 포함됩니다.\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 8, "total_chunks": null}}
{"id": "de22a909-49fb-42ad-a900-5ea88a239fcd", "content": "### 3.2 내부 루프 (Inner Loop)\n1. **Agent 실행**: `Agent Node`가 활성화되어 계획 수립 → 도구 실행 → 결과 확인을 수행합니다.\n2. **라우팅 (Router)**:\n   - 할 일이 남았으면 → `Agent` (Self-loop)\n   - 중대한 오류나 완료 신호 발생 시 → `Supervisor`\n3. **Supervisor 개입**:\n   - `Supervisor Node`가 실행되어 진행 상황을 평가합니다.\n   - 피드백 메시지를 `DeepAgentState`에 추가하고 다시 `Agent`로 턴을 넘기거나, 작업이 완벽하면 `__end__`로 라우팅합니다.\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 9, "total_chunks": null}}
{"id": "24a67a10-eb7c-4046-9c0f-0616cbf8257c", "content": "### 3.3 종료 및 완료\n- **Finish**: Supervisor가 종료를 승인하면 그래프 실행이 멈추고 최종 결과가 반환됩니다.\n- **Git Push & DB 갱신**: (기존과 동일)\n\n---\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 10, "total_chunks": null}}
{"id": "a2ceaa1c-f09a-4a28-9333-752f689c24c0", "content": "## 4. Git 워크플로우 및 보안 (Safety Guardrails)\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 11, "total_chunks": null}}
{"id": "7b6578de-541f-4339-b0b0-7550a28cc464", "content": "### 4.1 권한 모델 (GitHub App)\n- **사용자 입력 제로**: 사용자는 OAuth 로그인만 하면 됩니다. 토큰 입력 불필요.\n- **권한 분리**: GitHub App Installation Token을 사용하여 **기존 브랜치(main/dev)는 Read-only**, **새 브랜치는 Write** 권한을 갖습니다.\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 12, "total_chunks": null}}
{"id": "454e9fdf-c8b4-4799-89b4-252e50af960f", "content": "### 4.2 안전 장치 (Constraints)\n에이전트에게는 다음과 같은 **절대적 제약조건**이 주입됩니다.\n1. **\"절대 `main` 브랜치에 직접 커밋하지 말 것.\"** (항상 `create_branch` 선행)\n2. **\"작업 전 반드시 브랜치를 생성하고 Checkout 할 것.\"**\n3. **\"종료 전 반드시 커밋하고 푸시할 것.\"**\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 13, "total_chunks": null}}
{"id": "92f975ab-1e5d-4af0-a8bd-b2f76b78b0ae", "content": "### 4.3 연속성 (Resumability)\n- 작업을 하다가 멈추더라도, `active_branch` 정보를 DB에 저장해둡니다.\n- 나중에 다시 들어오면 **\"이전 실험 브랜치에서 이어서 작업\"**할 수 있습니다.\n\n---\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 14, "total_chunks": null}}
{"id": "29aca174-30eb-415b-9608-e9fe37d7b13b", "content": "## 5. 향후 확장 방안 (Future Roadmap)\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 15, "total_chunks": null}}
{"id": "d94c2ab1-8a78-4a04-a5c7-75577f401f7c", "content": "### 5.1 Multi-Agent Pipeline (Orchestration)\n현재는 단일 에이전트(Integrator 또는 Researcher)만 실행하지만, 향후에는 여러 에이전트를 연쇄적으로 실행하는 파이프라인을 구성합니다.\n\n- **시나리오**:\n  1. `Researcher`가 이슈를 분석하고 원인을 파악하여 리포트 생성.\n  2. `Integrator`가 리포트를 받아 코드를 수정하고 PR 생성.\n  3. `Tester`가 PR 브랜치에서 통합 테스트 수행 및 리포트.\n- **구현 방안**:\n  - `PipelineHandler`가 각 단계의 실행을 조율.\n  - `Context Handoff`: 앞 단계의 산출물(Artifacts/Memory)을 다음 단계의 입력으로 전달.\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 16, "total_chunks": null}}
{"id": "a35529d0-26d5-459c-98da-14f68ac1e84b", "content": "### 5.2 특화 에이전트 추가 (Sub-Agent Catalog)\n`AgentGraphConfig`만 추가하면 새로운 역할의 에이전트를 즉시 만들 수 있습니다.\n- **QA Bot**: 테스트 코드 작성 및 버그 헌팅 전용.\n- **Reviewer**: 코드 스타일 가이드 준수 여부 및 보안 취약점 점검.\n- **Writer**: 기술 문서 및 릴리즈 노트 작성.\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 17, "total_chunks": null}}
{"id": "c89583d1-50c9-4262-a898-84fb295366fd", "content": "### 5.3 자가 진화 (Self-Improvement)\n- 성공한 작업 패턴을 **Skill**로 저장하여 다음 작업에 활용합니다.\n- 실패한 케이스는 **Anti-Pattern Memory**에 기록하여 반복 실수를 방지합니다.\n\n---\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 18, "total_chunks": null}}
{"id": "f39571bb-3019-425a-9536-39d5535dcf4f", "content": "## 6. 결론\n\nFluxLoop의 새로운 Deep Agent 아키텍처는 **유연성(Flexibility)**과 **안정성(Stability)**이라는 두 마리 토끼를 잡았습니다.\n- **Builder 패턴** 덕분에 코드를 건드리지 않고도 새로운 에이전트를 창조할 수 있습니다.\n- **강력한 Git 가드레일** 덕분에 자율 에이전트가 사고를 칠 위험을 원천 봉쇄했습니다.\n- **상태 영속성** 덕분에 언제든 멈추고 다시 시작할 수 있는 사용자 경험을 제공합니다.\n\n이 견고한 기반 위에서, FluxLoop는 단순 코딩 도구를 넘어 **진정한 자율 소프트웨어 엔지니어링 플랫폼**으로 진화할 것입니다.\n", "metadata": {"source": "docs/architecture/deep_agent_overview_v4.md", "chunk_index": 19, "total_chunks": null}}
{"id": "1adf95de-3cbf-4635-bbf3-6b6b3f1a6a95", "content": "## 코드베이스 구성 계획 (간소화 버전)\n\n- **Phase 1: 기초 SDK 구축 (1주)**\n  - 리포지토리 구조 설정 (`packages/sdk/`, `packages/cli/`, `services/collector/`)\n- `packages/sdk/fluxloop/schemas/` - Trace/Observation/Score Pydantic 모델 정의\n  - `packages/sdk/` - 데코레이터, 컨텍스트 매니저, 이벤트 버퍼링, HTTP 전송\n  - pytest 단위 테스트 및 예제 에이전트 코드\n\n- **Phase 2: VSCode 확장 & CLI 기초 (1주)**\n  - `packages/cli/` - Typer 기반 CLI (`fluxloop init`, `fluxloop run`)\n  - `packages/vscode/` - 확장 프로젝트, 사이드바 패널, Quick Pick UI\n  - CLI-확장 연동, 터미널 실행, 로그 스트리밍\n\n- **Phase 3: 최소 Collector & 통합 (1주)**", "metadata": {"source": "docs/done/codebase.md", "chunk_index": 0, "total_chunks": null}}
{"id": "cfb0d6c6-476b-4b4c-9a91-7f4dce4445a2", "content": "  - `services/collector/` - FastAPI, in-memory 저장, 기본 API\n  - Orchestrator 핵심 로직 - 에이전트 실행, 변주 생성, 반복 루프\n  - 통합 테스트 및 기본 평가 로직 (성공률, 평균 시간)\n\n- **Phase 4: 영속성 & 실용성 개선 (2주)**\n  - PostgreSQL 통합 (SQLModel, Alembic 마이그레이션)\n  - FastAPI BackgroundTasks로 비동기 평가 (LLM judge, 규칙 기반)\n  - Docker 지원 (Dockerfile, docker-compose.yml)\n  - VSCode 확장 개선 (설정 UI, 결과 뷰어)\n\n- **Phase 5: 배포 준비 (1주)**\n  - PyPI 패키지 빌드 설정 (sdk, cli)\n  - 문서화 (README, 시작 가이드, API 문서)\n  - CI/CD (GitHub Actions, Docker 이미지 빌드)\n  - 운영 도구 (로그, 모니터링, 백업)\n\n- **Phase 6: 확장 기능 (선택적)**", "metadata": {"source": "docs/done/codebase.md", "chunk_index": 1, "total_chunks": null}}
{"id": "272872a9-a8ae-4a7c-85ef-81684adf2f4c", "content": "  - 스케일링: Redis 캐시, Celery 워커 (필요시)\n  - 고급 기능: 웹 대시보드, 실시간 모니터링 (요구사항 발생시)", "metadata": {"source": "docs/done/codebase.md", "chunk_index": 2, "total_chunks": null}}
{"id": "18a43ff0-11f6-48bc-bef6-a0965ded9656", "content": "## Simulation Core Concept\n\n- 목표는 에이전트의 실제 실행 플로우를 `Trace → Observation` 계층으로 수집하고 반복 시뮬레이션에서 통계적으로 평가하는 것. 이는 Langfuse가 제안한 트레이싱 데이터 모델(Trace + Observation + Score)을 그대로 차용하면 구조와 확장성이 검증된다.[^1]  \n- 반복 시뮬레이션은 Maxim Cookbook이 소개한 “Simulation Workflow” 개념을 참조해, 입력 변주 생성 → 실행 → 평가가 하나의 파이프라인으로 자동 순환되도록 설계한다.[^3]  \n- UX의 핵심은 “사용자의 기존 에이전트 코드에 최소한의 라인만 추가”하는 것. Langfuse SDK가 강조하는 자동 계측·오픈텔레메트리 기반 추적 구조를 본떠, Trace Hook만 붙이면 나머지는 플랫폼이 담당하도록 한다.[^2]\n", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 0, "total_chunks": null}}
{"id": "ba545f9b-d211-4c79-b4a2-8f56cc22b959", "content": "## 실행 구조(High-Level)\n\n- **Orchestrator (CLI 기반)**  \n  - 실험 설정(JSON/GUI)에서 iterations, persona, variation 전략을 받아 Docker 컨테이너 또는 로컬 실행 환경에서 시뮬레이션을 진행한다.  \n  - 각 iteration마다 LLM에 variation prompt 생성을 요청하고, 생성된 입력을 에이전트에 주입한다.  \n  - 실행 중 발생하는 모든 단계(Thought/Action/Tool Call/Result)를 trace-hooks가 Observation으로 기록하고 Langfuse 호환 형식으로 백엔드에 전송한다.\n\n- **Trace Collector & Storage**  \n  - Trace: 실험 run 전체를 대표하는 단위. metadata에는 persona, variation seed, 코드 버전 등 포함.  \n  - Observation: 입력 생성, LLM 호출, 툴 콜, evaluator 결과 등을 계층적으로 구성. Langfuse의 observation 타입(event/span/tool/generation/evaluator)을 그대로 매핑한다.[^1]  ", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 1, "total_chunks": null}}
{"id": "feb7492d-7136-49ef-952d-002e9b19f5e6", "content": "  - Score: Maxim이 제공하는 자동 평가 방식처럼 iteration 완료 후 LLM judge 또는 규칙 기반 evaluator가 점수를 계산하여 trace 혹은 observation에 첨부한다.[^3]\n\n- **Evaluation Pipeline**  \n  - 성공/실패, latency, tool usage success 등 정량 지표는 trace 메타데이터에서 계산.  \n  - LLM-as-a-Judge 평가, persona 만족도 등 정성 지표는 별도 evaluator observation과 score로 저장.  \n  - 전체 run 결과는 통계적으로 집계되어 Success rate, outlier 비율, cost 추정 등 pivot 데이터를 생성한다.\n", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 2, "total_chunks": null}}
{"id": "9aea7b5e-7d82-4076-bdb2-44ddee90931c", "content": "## SDK 계층 설계\n\n- **Decorators & Contexts (`@fluxloop.agent`, `@fluxloop.prompt`, `with fluxloop.instrument():`)**  \n  - 사용자는 실행 진입점 함수·메서드에 데코레이터 한 줄만 추가하면 Trace Hook이 자동 연결된다.  \n  - 상위 흐름은 컨텍스트 매니저로 감싸 run_id·persona 등 메타데이터를 주입하고, 내부 호출은 Observation 트리로 자동 기록된다.  \n  - 다중 에이전트 시나리오에서는 각 에이전트를 개별 데코레이터로 감싸 계층적으로 추적하거나, 상위 오케스트레이터만 감싸 전체 흐름을 기록할 수 있다.\n\n- **Prompt Wrapper (`fluxloop.prompts.*`)**  \n  - LangChain/LangGraph/LCEL 등 다양한 프레임워크의 프롬프트 빌더·체인을 SDK 래퍼로 감싸 템플릿, 변수, LLM 호출을 자동 수집한다.  \n  - 커스텀 프롬프트 빌더는 `@fluxloop.prompt` 데코레이터나 `fluxloop.prompts.wrap()` 헬퍼로 쉽게 계측한다.  ", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 3, "total_chunks": null}}
{"id": "6448ce98-be53-4980-91ec-59ffa39d57df", "content": "  - Variation 생성은 `fluxloop.prompts.generate_variations()` 같은 헬퍼로 수행해, 원본 프롬프트와 변주 입력을 함께 Observation에 기록한다.\n\n- **Adapters & Autodiscovery**  \n  - 주요 에이전트 프레임워크용 어댑터 패키지를 제공하여 `fluxloop.adapters.langchain.instrument_chain(chain)` 처럼 한 줄로 계측 가능하다.  \n  - CLI의 `fluxloop init` 명령이 프로젝트를 스캔해 진입점 후보를 제안하거나 템플릿을 자동 생성한다.\n", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 4, "total_chunks": null}}
{"id": "888b0b2a-8f35-42b2-9ba4-34f3f834a4f7", "content": "## 사용자 UX 설계\n\n- **Step 1. 최소 침습 설정**  \n  - 사용자는 에이전트 진입점에 `@fluxloop.agent`, 프롬프트 생성 함수에 `@fluxloop.prompt` 정도만 추가하면 된다.  \n  - 프레임워크 기반 프로젝트는 어댑터 패키지를 설치하고 체인/런너를 래핑하면 끝난다.\n\n- **Step 2. CLI 실행(로컬 IDE 통합)**  \n  - VSCode 확장에서 `FluxLoop: Run Simulation` 명령을 실행하면 CLI가 현재 워크스페이스를 마운트해 Docker 컨테이너에서 오케스트레이터를 실행한다.  \n  - UI에서는 iteration 진행 상황, 실시간 로그(Observation 스트림), 성공률 등을 확인한다.\n\n- **Step 3. 결과 분석**  \n  - 시뮬레이션 종료 후 Web Dashboard에서 Trace/Observation 트리를 탐색하고, Score 분포와 variation별 성능을 시각화한다.  \n  - 사용자는 실패 iteration을 클릭해 persona 입력문, 에이전트 응답, evaluator 코멘트를 즉시 확인한다.", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 5, "total_chunks": null}}
{"id": "bd5b2ec4-f656-4a94-83cd-96570ff7be01", "content": "\n- **Step 4. 재사용·자동화**  \n  - 실험 설정은 공유 가능한 JSON/GUI 폼으로 저장한다.  \n  - GitHub Action 등 CI 환경에서도 동일 CLI를 호출해 회귀 테스트에 활용 가능하다.\n", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 6, "total_chunks": null}}
{"id": "dbed3111-081b-4c48-8dd0-c5ad55742908", "content": "## 구현 로드맵\n\n- **Phase 1. Trace & Collector 안정화**  \n  - Langfuse 데이터 모델을 참조해 Trace/Observation/Score 스키마 확정.[^1]  \n  - trace-hooks 패키지를 Langfuse SDK 스타일로 정비(비동기, 에러 보호, OpenTelemetry context 전파 등).[^^2]\n\n- **Phase 2. Orchestrator MVP**  \n  - CLI 프로토타입: 실험 설정 읽기 → variation prompt 생성 → agent entry 호출 → trace 전송.  \n  - Docker 기반 실행과 로컬 서브프로세스 실행 옵션을 둘 다 지원(보안 vs. 속도 트레이드오프).\n\n- **Phase 3. Evaluator & Reporting**  \n  - Maxim Simulation Workflow 사례처럼 반복 실행 후 자동 평가·요약 리포트를 생성.[^3]  \n  - LLM judge, 규칙 기반 evaluator, 사용자 정의 evaluator plug-in 구조 제공.", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 7, "total_chunks": null}}
{"id": "678b65ef-e009-4c64-ab9f-e890fc2cd492", "content": "\n- **Phase 4. UX 강화**  \n  - VSCode 확장과 Web Dashboard에서 실험 생성·실행·결과 확인을 일관된 플로우로 연결.  \n  - “엔트리포인트 파일만 추가하면 끝”이라는 메시지를 강조한 온보딩/문서 제공.\n", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 8, "total_chunks": null}}
{"id": "9a47faf6-8d71-49fb-a28c-fccf89aae831", "content": "## 현실성 및 확장성\n\n- OpenTelemetry/Langfuse 기반 트레이싱 구조는 이미 시장에서 검증되었고, Trace Hook → Collector → Storage로 이어지는 파이프라인은 기술적으로 안정적이다.[^1]  \n- Prompt variation과 평가 모듈은 Maxim Cookbook의 시뮬레이션 워크플로우 개념을 로컬 환경에 적용한 것으로, 반복 실행과 자동 평가가 현실적으로 가능하다.[^3]  \n- CLI + VSCode 연동은 사용자에게 “코드 수정 최소화, 버튼 한 번으로 시뮬레이션”이라는 UX를 제공하며, 이는 Langfuse SDK가 강조하는 “자동 계측” 경험과 일맥상통한다.[^2]  \n- 장기적으로는 동일 실행 구조를 CI/CD(GitHub Actions 등)에도 적용해 회귀 테스트·품질 게이지를 자동화할 수 있다.\n\n---\n\n[^1]: [Langfuse Observability Data Model](https://langfuse.com/docs/observability/data-model)  ", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 9, "total_chunks": null}}
{"id": "6d99c42f-cc7f-43f2-99f9-8394aee03b59", "content": "[^2]: [Langfuse SDK Overview](https://langfuse.com/docs/observability/sdk/overview)  \n[^3]: [Maxim Cookbooks README](https://github.com/maximhq/maxim-cookbooks/blob/main/README.md)", "metadata": {"source": "docs/done/core_flow.md", "chunk_index": 10, "total_chunks": null}}
{"id": "62271fc0-d46d-4219-af71-8870dc17c017", "content": "# FluxLoop 구현 계획 (수정판)\n\nMVP 우선, 복잡도 최소화를 원칙으로 재구성한 구현 계획입니다.\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "6f5cee51-5a28-4ba1-81cf-8cbeace9dff8", "content": "## Phase 1: 기초 SDK 구축 (1주)\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "fb827164-8376-4fef-9473-755149d53280", "content": "### 목표\n사용자 에이전트 코드를 계측할 수 있는 최소한의 SDK 구현\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "68c21438-566f-4164-9803-93f2f660b64a", "content": "### 구현 순서\n1. **리포지토리 구조 설정**\n   - `packages/sdk/`, `packages/cli/`, `services/collector/` 기본 구조\n   - Python 프로젝트 설정 (pyproject.toml, poetry/pip)\n\n2. **공통 스키마 정의** (`packages/sdk/fluxloop/schemas/`)\n   - Trace, Observation, Score Pydantic 모델\n   - 실험 설정 스키마\n   - Langfuse 호환 데이터 구조\n\n3. **SDK 핵심 기능** (`packages/sdk/`)\n   - `@fluxloop.agent`, `@fluxloop.prompt` 데코레이터\n   - `with fluxloop.instrument()` 컨텍스트 매니저\n   - 이벤트 버퍼링 (메모리 큐)\n   - 비동기 HTTP 전송 (requests/httpx)\n\n4. **SDK 테스트**\n   - pytest 단위 테스트\n   - 모의 collector 연동 테스트\n   - 예제 에이전트 코드", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "913107ad-e119-483a-b961-bed8b0966049", "content": "## Phase 2: VSCode 확장 & CLI 기초 (1주)\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "6f270b1f-0c59-4af5-a739-8ab8ba2bc6ed", "content": "### 목표\n개발자가 쉽게 시작할 수 있는 진입점 제공\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "e2e3c623-3ee3-4acd-932f-b1efd435924d", "content": "### 구현 순서\n1. **CLI 기본 구조** (`packages/cli/`)\n   - Typer 기반 명령어 체계\n   - `fluxloop init` - 프로젝트 초기화\n   - `fluxloop run` - 실험 실행 (단순 버전)\n   - 설정 파일 파싱 (YAML/JSON)\n\n2. **VSCode 확장 초기 버전** (`packages/vscode/`)\n   - 확장 프로젝트 생성 (TypeScript)\n   - FluxLoop 사이드바 패널\n   - 실행 환경 선택 UI (Quick Pick)\n   - CLI 존재 확인 및 설치 안내\n\n3. **CLI-확장 연동**\n   - 터미널에서 CLI 실행\n   - 실행 로그 캡처 및 표시\n   - 간단한 진행 상황 표시\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "e95caacf-34ee-44a4-bba6-6f6c39e7be30", "content": "## Phase 3: 최소 Collector & 통합 (1주)\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "8aa9bbd7-f97d-4de0-a36c-1e9eb5435a01", "content": "### 목표\nend-to-end 실행 가능한 첫 버전 완성\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "77f0970f-a035-4b3d-b9a6-47b6dbeed581", "content": "### 구현 순서\n1. **Collector API** (`services/collector/`)\n   - FastAPI 앱 구조\n   - `/traces`, `/observations` 엔드포인트\n   - In-memory 저장 (dict/list)\n   - 간단한 조회 API\n\n2. **Orchestrator 핵심 로직** (`packages/cli/`)\n   - 에이전트 엔트리포인트 실행\n   - SDK trace 수집 연동\n   - 프롬프트 변주 생성 (OpenAI API)\n   - 반복 실행 루프\n\n3. **통합 테스트**\n   - 샘플 LangChain 에이전트\n   - SDK → Collector 데이터 흐름 검증\n   - CLI 실행 → 결과 수집 시나리오\n\n4. **기본 평가 로직**\n   - Collector 내 간단한 평가 함수\n   - 성공/실패 판정\n   - 기본 통계 계산 (성공률, 평균 시간)\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "e6ffb5fb-c514-4762-960c-a7fade4bae7b", "content": "## Phase 4: 영속성 & 실용성 개선 (2주)\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "277dec96-c1d4-40d1-9e1f-d744160fc786", "content": "### 목표\n실제 사용 가능한 수준으로 안정화\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "8315cb49-0a10-43d1-8e44-06277af16911", "content": "### 구현 순서\n1. **PostgreSQL 통합**\n   - SQLModel/SQLAlchemy 모델\n   - 마이그레이션 스크립트 (Alembic)\n   - 데이터 영속성 구현\n\n2. **평가 시스템 강화**\n   - FastAPI BackgroundTasks로 비동기 평가\n   - LLM-as-a-Judge 템플릿\n   - 규칙 기반 평가기\n   - Score 저장 및 집계\n\n3. **Docker 지원**\n   - Collector Dockerfile\n   - docker-compose.yml (postgres 포함)\n   - 개발 환경 설정 스크립트\n\n4. **VSCode 확장 개선**\n   - 실험 설정 UI\n   - 결과 뷰어 (트리 형태)\n   - Docker Compose 자동 실행 옵션\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "cdbe4054-51d1-4075-8950-d3aa65f21910", "content": "## Phase 5: 배포 준비 (1주)\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "9f127684-e2c2-4128-9725-5690e39f2d6b", "content": "### 목표\n사용자가 쉽게 설치하고 시작할 수 있도록 패키징\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "a52a9646-cf2d-42fc-87cd-d848cbb3b511", "content": "### 구현 순서\n1. **패키지 배포 설정**\n   - PyPI 패키지 빌드 (sdk, cli)\n   - GitHub Releases 자동화\n   - 버전 관리 정책\n\n2. **문서화**\n   - README 작성\n   - 시작 가이드\n   - API 문서 (자동 생성)\n   - 예제 프로젝트\n\n3. **CI/CD**\n   - GitHub Actions 테스트 파이프라인\n   - Docker 이미지 자동 빌드\n   - VSCode 확장 패키징\n\n4. **운영 도구**\n   - 로그 수집 설정\n   - 모니터링 기본 설정\n   - 백업/복구 스크립트\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "8bf10aeb-9a02-42cd-ba78-800126738b75", "content": "## Phase 6: 확장 기능 (선택적)\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "9529f58a-c5db-43fd-9d3f-11e5d38846e7", "content": "### 필요시 추가할 기능들\n- **스케일링** (사용자가 많아지면)\n  - Redis 캐시 레이어\n  - Celery 워커 분리\n  - 로드 밸런서\n\n- **고급 기능** (요구사항 발생시)\n  - 웹 대시보드\n  - 실시간 모니터링\n  - 다중 에이전트 협업 시뮬레이션\n  - CI/CD 통합 플러그인\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "e42ee82c-9920-4f73-ba91-5e466bc567e0", "content": "## 주요 변경사항\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "8251c97b-0aff-41db-ba7f-5b86c01d42db", "content": "### 단순화한 부분\n- ❌ Redis/Celery → ✅ FastAPI BackgroundTasks\n- ❌ 별도 Evaluator 서비스 → ✅ Collector 내장 평가\n- ❌ 복잡한 메시지 큐 → ✅ HTTP API + 메모리 버퍼\n- ❌ Kubernetes/Helm → ✅ Docker Compose\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "52dacbd7-c003-42ce-acc2-c7ef29564a2a", "content": "### 우선순위 조정\n- VSCode 확장을 Phase 2로 앞당김\n- 복잡한 인프라는 Phase 6으로 미룸\n- 사용자 경험 중심으로 재편성\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 21, "total_chunks": null}}
{"id": "2df6365a-ff9f-46c4-9d13-d6056a8dcbf1", "content": "### 핵심 원칙\n1. **작동하는 MVP 우선** - 완벽하지 않아도 end-to-end 실행 가능\n2. **점진적 개선** - 필요할 때 복잡도 추가\n3. **사용자 피드백 중심** - 실제 사용하면서 개선점 파악\n4. **배포 가능성** - 각 Phase 끝에 배포 가능한 상태 유지\n", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 22, "total_chunks": null}}
{"id": "14f36ba4-8ec7-48d7-bde8-905cb8a5cd6f", "content": "## 예상 일정\n- **Week 1**: Phase 1 (SDK)\n- **Week 2**: Phase 2 (VSCode + CLI)\n- **Week 3**: Phase 3 (통합)\n- **Week 4-5**: Phase 4 (안정화)\n- **Week 6**: Phase 5 (배포)\n\n총 6주 내 사용 가능한 MVP 완성, 이후 피드백 기반 개선", "metadata": {"source": "docs/done/implementation-plan.md", "chunk_index": 23, "total_chunks": null}}
{"id": "451714f1-54c1-4519-aae9-f87b868ae93b", "content": "`core_flow.md` 문서를 바탕으로 더 쉽게 설명해줄게.\n\n**결론부터 말하면, “어렵다”기보다는 지금은 “수동”이고 앞으로 “자동”으로 만들겠다는 계획이야.**\n\n1.  **현재 상태 (수동 계측):**\n    지금 가진 `@fluxloop.agent` 같은 데코레이터들은 범용 파이썬 도구야. 어떤 라이브러리를 쓰든, **개발자가 직접 “여기가 중요해!”라고 생각하는 함수에 데코레이터를 붙여주면** 그 함수의 시작과 끝, 입출력 등을 기록할 수 있어.\n\n    *   **장점:** LangChain, LangGraph 등 어떤 프레임워크로 만든 에이전트든 상관없이 일단은 추적할 수 있어.\n    *   **단점:** 프레임워크 내부의 복잡한 호출(LLM 호출, 툴 호출 등)을 세세하게 보려면, 개발자가 그 내부 구조를 어느 정도 알고 여러 함수에 데코레이터를 직접 붙여줘야 해. 조금 번거로울 수 있지.\n\n2.  **미래 계획 (자동 계측 - Adapters):**\n    `core_flow.md`의 “Adapters & Autodiscovery”(36행) 부분이 바로 이 문제를 해결하기 위한 계획이야.", "metadata": {"source": "docs/done/plan_manual_auto_trace.md", "chunk_index": 0, "total_chunks": null}}
{"id": "935a24a7-f569-45c2-970f-f6e6bc6007f3", "content": "\n    > 37: - 주요 에이전트 프레임워크용 어댑터 패키지를 제공하여 `fluxloop.adapters.langchain.instrument_chain(chain)` 처럼 한 줄로 계측 가능하다.\n\n    이건 LangChain 같은 특정 프레임워크 전용 ‘자동 설치기’를 만들겠다는 뜻이야. 예를 들어 LangChain 어댑터가 완성되면, 개발자는 복잡한 내부 함수에 일일이 데코레이터를 붙일 필요 없이 그냥 `instrument_chain(내_체인)` 이렇게 한 번만 감싸주면 돼. 그러면 어댑터가 알아서 그 체인 안의 LLM 호출, 툴 호출 같은 중요한 부분들을 전부 찾아서 자동으로 추적 코드를 심어주는 거지.\n\n**요약:**\n\n*   **지금:** 범용 데코레이터가 있어서 **어떤 에이전트든 수동으로 추적은 가능**하다.\n*   **앞으로:** LangChain 같은 유명 라이브러리는 **어댑터를 통해 단 한 줄로 모든 내부 동작을 자동으로 추적**할 수 있게 만들어서 훨씬 편하게 만들겠다.\n\n따라서 현재 다양한 에이전트 구현에 대응이 ‘불가능’하거나 ‘어려운’ 게 아니라, ‘조금 더 수고가 필요한’ 단계라고 이해하면 정확해.", "metadata": {"source": "docs/done/plan_manual_auto_trace.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a040e4cd-77bb-4d9d-a569-3c6507f2a3df", "content": "FluxLoop 세부 기획서 (개발 가능 버전)\n\n1. 서비스 개요\n\nFluxLoop는 에이전트 기반 서비스의 불확실성과 변동성을 관리하기 위한 시뮬레이션 및 로그 기반 품질 관리 플랫폼입니다.\n\t•\t문제: Agentic AI는 실행 결과가 매번 달라지고, 사용자 반응도 예측이 어렵다. QA/운영 과정에서 기존 소프트웨어처럼 결정론적 테스팅이 불가능하다.\n\t•\t해결: FluxLoop는 실험(시뮬레이션) + 로그 수집 + 데이터 분석 루프를 통해 불확실성을 정량화하고 개선 가이드를 제공한다.\n\n⸻\n\n2. 주요 타겟\n\t•\t개발자: 코드/프롬프트 단위 QA 자동화\n\t•\tPM: 사용자 페르소나 기반 시뮬레이션 및 프로덕트 품질 예측\n\t•\t운영자: 실서비스 로그 기반 안정성/신뢰성 관리\n\n⸻\n\n3. 주요 기능\n\n3.1 에이전트 시뮬레이션 실험 도구 (MVP 핵심)\n\t•\tVSCODE Add-on\n\t•\t실험 생성: 목표, 사용자 페르소나, 파라미터(temperature, 반복 횟수 등)\n\t•\t실행 환경: Docker 기반 local 실행 / 클라우드 샌드박스", "metadata": {"source": "docs/done/prd.md", "chunk_index": 0, "total_chunks": null}}
{"id": "54f05b37-1650-443c-9aae-246773d97dff", "content": "\t•\t결과 집계: 성공률, 실패율, 변동성 통계 제공\n\t•\t배치 실행: QA/Regression 용 실험 세트 일괄 실행\n\t•\tTrace Hooking\n\t•\tLangGraph, Langfuse SDK hooking\n\t•\tTool calling/에이전트 플로우 단위 trace 삽입\n\n3.2 로그 기반 프로덕트 품질 관리\n\t•\tWeb Dashboard\n\t•\t실험 결과 시각화 (성공률, latency, outlier 분석)\n\t•\tAd-hoc 분석: 특정 조건/페르소나 기준 로그 조회\n\t•\t개선 제안: prompt 수정/워크플로우 개선안 자동 추천 (GPT 활용)\n\n⸻\n\n⸻\n\n7. 차별화 포인트\n\t•\tIDE 통합 (VSCODE Native): 개발 워크플로우 속에서 바로 QA 가능\n\t•\t자동 Trace 삽입: SDK hooking으로 로깅 부담 최소화\n\t•\tData Loop: 시뮬레이션 → 로그 → 분석 → 개선 제안까지 완결형 루프 제공\n\n⸻\n\n8. 확장 로드맵\n\t•\tPhase 2: Prompt 개선 자동화 추천, 다중 에이전트 협력 시뮬레이션 지원", "metadata": {"source": "docs/done/prd.md", "chunk_index": 1, "total_chunks": null}}
{"id": "bbfa9826-ab1c-41d8-be72-22a067d9ef64", "content": "\t•\tPhase 3: 실서비스 사용자 로그 통합, 엔터프라이즈 기능 (Slack/Teams/Jira 연동)", "metadata": {"source": "docs/done/prd.md", "chunk_index": 2, "total_chunks": null}}
{"id": "775043e2-5bae-4bdf-8c7d-6bb9a06729b1", "content": "# FluxLoop 리포지토리 구조 (간소화 버전)\n\n배포 타겟별로 명확히 분리된 구조로 설계하되, MVP 단계에서는 최소한의 컴포넌트만 구현합니다.\nRedis/Celery 같은 복잡한 인프라는 Phase 6 이후 필요시 추가합니다.\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 0, "total_chunks": null}}
{"id": "b6b066eb-720a-482c-9c90-ad4ae2789ec0", "content": "## 전체 구조\n\n**굵은 글씨**: MVP 단계 (Phase 1-5)에서 구현\n*이탤릭*: 향후 확장 (Phase 6+)에서 추가\n\n```\nfluxloop/\n├── packages/           # 사용자 설치 컴포넌트 (로컬)\n│   ├── sdk/           # Python SDK (PyPI 배포) [Phase 1]\n│   │   ├── fluxloop/\n│   │   │   ├── trace/\n│   │   │   ├── prompts/\n│   │   │   └── adapters/\n│   │   ├── tests/\n│   │   └── pyproject.toml\n│   │\n│   ├── cli/           # Orchestrator CLI (PyPI 배포) [Phase 2-3]\n│   │   ├── fluxloop_cli/\n│   │   │   ├── commands/\n│   │   │   ├── runner/\n│   │   │   └── config/\n│   │   ├── tests/\n│   │   └── pyproject.toml", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 1, "total_chunks": null}}
{"id": "bfc9b01e-69a3-4561-a3c6-bf379b976d3f", "content": "│   │\n│   └── vscode/        # VSCode Extension (Marketplace) [Phase 2]\n│       ├── src/\n│       ├── package.json\n│       └── tsconfig.json\n│\n├── services/          # 서버 컴포넌트 (클라우드 배포)\n│   └── collector/     # FastAPI 백엔드 [Phase 3-4]\n│       ├── app/\n│       │   ├── api/      # REST endpoints\n│       │   ├── models/   # SQLModel schemas\n│       │   ├── tasks/    # Background tasks (평가 로직)\n│       │   └── storage/  # In-memory → PostgreSQL\n│       ├── tests/\n│       ├── Dockerfile\n│       └── pyproject.toml\n│\n├── shared/            # (Phase 6+) 필요 시 공통 라이브러리", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 2, "total_chunks": null}}
{"id": "ea139569-8328-4886-bb49-19f731645f6e", "content": "│\n├── infrastructure/    # 배포 설정 [Phase 4-5]\n│   ├── docker/\n│   │   ├── docker-compose.yml     # PostgreSQL 포함\n│   │   └── docker-compose.dev.yml # 개발용 설정\n│   └── scripts/       # 설치/운영 스크립트\n│\n├── examples/          # 샘플 에이전트 [Phase 3]\n│   ├── simple-agent/\n│   ├── langchain-agent/\n│   └── langgraph-agent/\n│\n├── tests/            # 통합 테스트 [Phase 3-4]\n│   ├── integration/\n│   └── e2e/\n│\n└── docs/             # 문서 [Phase 1-5]\n    ├── getting-started/\n    └── api/\n```\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 3, "total_chunks": null}}
{"id": "d4519c39-846a-4254-b493-37025e25e128", "content": "## 분리 전략\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 4, "total_chunks": null}}
{"id": "23ace0b3-9e54-4998-b172-bee221e970c6", "content": "### 1. 독립 패키지 구조\n- `packages/sdk/`: 독립된 Python 패키지로 PyPI 배포 가능\n- `packages/cli/`: SDK와 별도로 설치 가능한 CLI 도구\n- `packages/vscode/`: npm 패키지로 VSCode Marketplace 배포\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 5, "total_chunks": null}}
{"id": "61638cdf-6164-4d3f-9d10-e82538798e9f", "content": "### 2. 서비스 간소화 (MVP)\n- `services/collector/`: FastAPI 단일 서비스로 모든 백엔드 기능 처리\n  - In-memory 저장 → PostgreSQL 마이그레이션 (Phase 4)\n  - BackgroundTasks로 평가 처리 (별도 워커 없음)\n- 향후 확장: dashboard, 별도 evaluator 워커 (Phase 6+)\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 6, "total_chunks": null}}
{"id": "9e0e2f9b-b310-4ebb-abec-034101b3de9e", "content": "### 3. 공유 코드 최소화\n- `packages/sdk/fluxloop/schemas/`: JSON 계약과 공통 데이터 모델의 단일 소스\n- 다른 패키지나 서비스는 SDK를 의존성으로 추가해 스키마를 재사용\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 7, "total_chunks": null}}
{"id": "7aaabb74-a1ea-4b28-9ce2-73602813d5eb", "content": "### 4. 오픈소스/클로즈드 경계\n- **JSON 계약 정리**: `packages/sdk/fluxloop/schemas/trace.py`, `packages/sdk/fluxloop/schemas/config.py`를 공용 규격으로 삼고, CLI 실행 산출물은 `artifacts/*.json` 형태로 명시합니다. 공개 문서에 JSON 구조 및 버전 규칙을 기록합니다.\n- **공개 레포지토리**: `packages/` 전체(예: SDK, CLI, VSCode 템플릿)는 GitHub 공개 저장소 [`chuckgu/fluxloop`](https://github.com/chuckgu/fluxloop.git)에 유지합니다. OSS 배포 시 `shared/schemas/`도 함께 포함해 계약을 동기화합니다.\n- **클로즈드 서비스**: `services/` 이하(Collector, evaluator, 고객 데이터 연동 로직)는 사내 비공개 저장소로 관리합니다. JSON 계약을 입력으로 받아 평가·리포트·제안 기능을 제공하도록 설계합니다.", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 8, "total_chunks": null}}
{"id": "0d74808d-ea73-4722-b277-4f1596a80a6e", "content": "- **릴리스 파이프라인**: monorepo에서 개발 → JSON 계약 변경 시 버전 문서화 → `git subtree split`으로 `packages/`를 공개 저장소에 배포 → 서비스 코드는 별도 파이프라인으로 배포합니다.\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 9, "total_chunks": null}}
{"id": "b0075fa2-703b-41c8-a276-e4597c5315af", "content": "### 5. 샘플 아티팩트 & 문서 관리를 위한 스크립트\n- `docs/api/sample-artifacts/contract-example/`에 계약 기준 샘플(`summary.json`, `traces.jsonl`, `errors.json`, `metadata.json`)을 유지합니다.\n- CLI 실행(`fluxloop run experiment --config examples/simple-agent/config.yaml --no-collector`)으로 최신 결과를 생성하고, `scripts/extract_latest_artifacts.py`로 문서용 디렉터리로 복사합니다.\n- `metadata.json`에는 `schema_version`, `source_run`, `generated_at`를 기록하여 추적성을 확보합니다.\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 10, "total_chunks": null}}
{"id": "0152cfd3-3323-4886-be03-c0029e1500e3", "content": "## 배포 시나리오\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 11, "total_chunks": null}}
{"id": "39729c08-4465-4076-b2b2-6868f77b85e2", "content": "### 로컬 개발자용\n```bash", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 12, "total_chunks": null}}
{"id": "9d2fb4e2-3d47-4775-ba64-066f0e6b370d", "content": "# SDK 설치\npip install fluxloop-sdk\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 13, "total_chunks": null}}
{"id": "08caceaa-edc0-445b-8422-9935eb294fe6", "content": "# CLI 설치 (선택)\npip install fluxloop-cli\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 14, "total_chunks": null}}
{"id": "a592532a-d929-410a-bd6c-93a2365acfad", "content": "# VSCode Extension 설치\ncode --install-extension fluxloop.fluxloop\n```\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 15, "total_chunks": null}}
{"id": "36b38ab3-487c-43c6-98d5-7b020efe0722", "content": "### 클라우드 운영자용\n```bash", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 16, "total_chunks": null}}
{"id": "786d03d0-da72-4cf2-b3e1-c736f04e88eb", "content": "# 서비스 배포 (Docker Compose)\ncd infrastructure/docker\ndocker-compose up -d collector postgres\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 17, "total_chunks": null}}
{"id": "54314217-12d2-4c47-8dd0-038d3e50a1d1", "content": "# 개발 환경 (로컬)\ndocker-compose -f docker-compose.dev.yml up\n```\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 18, "total_chunks": null}}
{"id": "fb52cb0c-f577-4af7-913e-c1bbf789eecc", "content": "## MVP 구현 우선순위\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 19, "total_chunks": null}}
{"id": "a28cbddd-c66c-4dab-b310-580785f41f78", "content": "### Phase 1-2: 핵심 도구 (2주)\n- `packages/sdk/fluxloop/schemas/` + `packages/sdk/` 구현\n- `packages/vscode/` + `packages/cli/` 기초 버전\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 20, "total_chunks": null}}
{"id": "ee932676-077d-4f03-857d-b710b9c1923f", "content": "### Phase 3-4: 통합 및 영속성 (3주)\n- `services/collector/` 구현 (in-memory → PostgreSQL)\n- `examples/` 샘플 에이전트 작성\n- `tests/integration/` 통합 테스트\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 21, "total_chunks": null}}
{"id": "78acfd14-fd3b-491e-981d-f955c4faf445", "content": "### Phase 5: 배포 준비 (1주)\n- `infrastructure/docker/` 설정\n- PyPI/Marketplace 배포 준비\n- 문서화 완성\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 22, "total_chunks": null}}
{"id": "4dcb24ed-7f8e-4066-bec0-bdabee498c35", "content": "### Phase 6+: 선택적 확장\n- Redis/Celery 추가 (스케일링 필요시)\n- Web Dashboard 구현\n- K8s/Helm 차트 작성\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 23, "total_chunks": null}}
{"id": "0c553e27-192f-435d-8a74-2bdcc2bd7cb0", "content": "## 향후 리포지토리 분리 시\n\n필요시 각 디렉토리를 독립 리포지토리로 쉽게 분리:\n- `packages/` 전체 → **github.com/chuckgu/fluxloop** (공개 OSS \n  - SDK/CLI/VSCode, schemas 포함)\n- `services/` → **github.com/chuckgu/fluxloop-service** (비공개, Collector·Evaluator 등 서비스 코드)\n- `infrastructure/` → 필요시 별도 사내 레포지토리로 분리\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 24, "total_chunks": null}}
{"id": "5b0bdd3f-2ca0-4fda-9ab3-b0f16ef1cc48", "content": "### git subtree split 작업 순서\n1. **JSON 계약 확정**: `packages/sdk/fluxloop/schemas/`와 결과 JSON 샘플을 검토·문서화 후 버전 태그를 부여합니다.\n2. **공개 저장소 준비**: `git remote add oss https://github.com/chuckgu/fluxloop.git`로 원격을 등록하고 라이선스(예: Apache-2.0)와 README를 공개용으로 정리합니다.\n3. **서비스 저장소 준비**: `git remote add svc https://github.com/chuckgu/fluxloop-service.git`로 비공개 원격을 등록하고, 운영용 README/보안 정책을 정리합니다.\n4. **subtree export (OSS)**: `git subtree split --prefix packages -b oss-release`로 브랜치를 생성한 뒤, `git push oss oss-release:main`으로 공개 저장소에 반영합니다.", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 25, "total_chunks": null}}
{"id": "5322f18e-73cc-4b9d-ad5f-db5eae3b49e7", "content": "5. **subtree export (Service)**: `git subtree split --prefix services -b svc-release` 후 `git push svc svc-release:main`으로 클로즈드 저장소에 반영합니다.\n6. **자동화**: GitHub Actions나 사내 CI에서 위 과정을 워크플로로 구성하여 JSON 계약 변경과 함께 공개 패키지를 자동 릴리스하고, 서비스 코드도 동기화되도록 합니다.\n", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 26, "total_chunks": null}}
{"id": "2013a3e1-324b-4ee9-b868-52ddd4868931", "content": "### 7. CI 파이프라인 개요\n- **OSS repo (`chuckgu/fluxloop`)**\n  - 워크플로: `lint → unit tests → package build → PyPI 배포`\n  - 리포지토리 루트의 `.github/workflows/ci.yml`를 활용하고, npm/VSCode 패키지 배포 시 별도 job 추가\n- **Service repo (`chuckgu/fluxloop-service`)**\n  - 워크플로: `lint → unit tests → integration tests → Docker image build → Registry push`\n  - 배포 후 `infrastructure/docker/` 또는 미래 K8s 매니페스트를 트리거하도록 구성\n- **문서/샘플 동기화**\n  - `scripts/extract_latest_artifacts.py` 호출을 CI에 포함해 문서 샘플 업데이트 자동화\n  - JSON 계약 버전 변경 시 `docs/api/json-contract.md` 및 샘플 디렉터리 동시 갱신", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 27, "total_chunks": null}}
{"id": "dfeca3ca-c770-45ca-8722-018cf81f24da", "content": "\n이 구조는 초기에는 monorepo로 관리하되, MVP 우선으로 빠르게 구현하고 성장하면서 자연스럽게 확장할 수 있도록 설계되었습니다.", "metadata": {"source": "docs/done/repository-structure.md", "chunk_index": 28, "total_chunks": null}}
{"id": "79e909d2-f907-46fe-a96a-aa8ccdafefab", "content": "# GitHub App 생성 및 설정 가이드\n\nFluxLoop의 Deep Agent가 사용자 개입 없이 안전하게 Git 작업을 수행하려면 **GitHub App**이 필수적입니다.\nOAuth App은 단순 로그인용이며, 리포지토리별 세밀한 권한 제어(Installation Token)와 봇 행세(Bot Actor)가 불가능합니다.\n\n이 문서는 FluxLoop용 GitHub App을 생성하고 Supabase Auth와 연동하는 절차를 안내합니다.\n\n---\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 0, "total_chunks": null}}
{"id": "885ce211-eaf5-4a19-a7af-3195347397e6", "content": "## 1. GitHub App 생성 절차\n\n1. **GitHub 개발자 설정 접속**\n   - GitHub > Settings > Developer settings > **GitHub Apps** > **New GitHub App** 클릭.\n\n2. **기본 정보 입력 (Register new GitHub App)**\n   - **GitHub App name**: `FluxLoop` (또는 `FluxLoop Dev` 등 유니크한 이름)\n   - **Homepage URL**: `https://fluxloop.ai` (또는 개발용 `http://localhost:3000`)\n   - **Callback URL**: `https://<YOUR_SUPABASE_PROJECT_ID>.supabase.co/auth/v1/callback`\n     - *중요: Supabase Auth를 사용하므로 Supabase의 콜백 주소를 입력합니다.*\n   - **Webhook URL**: (선택) 웹훅을 안 쓴다면 `Active` 체크 해제. (추후 필요시 설정)", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 1, "total_chunks": null}}
{"id": "19762a84-300a-4a5c-bdb9-f3e9ba0a6713", "content": "\n3. **사용자 인증 설정 (Identifying and authorizing users)**\n   - Supabase Auth로 이미 GitHub 로그인을 처리하므로, **Request user authorization (OAuth) during installation** 옵션은 꺼 둡니다.\n   - 이 옵션을 켜면 GitHub가 설치 완료 후 Supabase 콜백 URL로 OAuth 응답을 보내는데, `state` 토큰이 없어 `bad_oauth_callback` 오류가 발생합니다.\n\n4. **권한 설정 (Permissions)**\n   Agent가 수행할 작업에 맞춰 최소 권한을 부여합니다.\n\n   **Repository permissions:**\n   - **Contents**: `Read-only` (코드 읽기용. *쓰기는 새 브랜치에만 하므로 기본은 Read*)\n   - **Pull requests**: `Read and write` (PR 생성 및 코멘트용)\n   - **Metadata**: `Read-only` (기본값)", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 2, "total_chunks": null}}
{"id": "4de2a3ce-1e49-4d30-9c79-1da239e4c9db", "content": "   - **Administration**: `Read-only` (브랜치 보호 규칙 확인용 - 선택 사항)\n\n   **Organization permissions:**\n   - (설정 없음)\n\n   **User permissions:**\n   - **Email addresses**: `Read-only` (사용자 이메일 확인용)\n\n5. **설치 범위 (Where can this GitHub App be installed?)**\n   - **Any account**: 다른 사용자나 조직도 이 앱을 설치할 수 있게 하려면 선택. (SaaS 형태라면 필수)\n   - **Setup URL**: 설치 후 돌아올 페이지를 `https://app.fluxloop.ai/projects/new` (또는 개발용 URL)로 설정하면 UX가 자연스럽습니다.\n\n6. **생성 완료 (Create GitHub App)**\n   - 생성 후 `App ID`와 `Client ID`가 표시됩니다.\n   - **Client secrets** 섹션에서 `Generate a new client secret`를 클릭해 Secret을 발급받아 안전한 곳에 저장합니다.", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 3, "total_chunks": null}}
{"id": "ac727a28-d2a2-486f-9efe-fb8ded152c43", "content": "   - **Private keys** 섹션에서 `Generate a private key`를 클릭해 `.pem` 파일을 다운로드합니다. (서버에서 토큰 발급용으로 사용)\n\n---\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 4, "total_chunks": null}}
{"id": "cf0d71b8-17a6-490f-8056-9675119bb1f7", "content": "## 2. Supabase Auth 연동 (방법 1 적용)\n\n기존 OAuth App 대신 새로 만든 GitHub App을 Supabase의 로그인 제공자로 설정합니다.\n\n1. **Supabase 대시보드 접속**\n   - Project > Authentication > Providers > **GitHub**\n\n2. **GitHub App 정보 입력**\n   - **Client ID**: 위에서 생성한 GitHub App의 `Client ID`\n   - **Client Secret**: 위에서 생성한 GitHub App의 `Client Secret`\n   - *참고: GitHub App도 OAuth Client 역할을 완벽하게 수행합니다.*\n\n3. **설정 저장**\n   - 이제 사용자가 \"GitHub 로그인\"을 클릭하면, OAuth App이 아닌 GitHub App을 통해 인증하게 됩니다.\n\n---\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 5, "total_chunks": null}}
{"id": "3b713037-54b0-45b7-9f08-4f7fcb8e81d8", "content": "## 3. FluxLoop 백엔드 설정\n\n백엔드가 Installation Token을 발급받기 위해 다음 환경 변수가 필요합니다.\n\n```bash", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 6, "total_chunks": null}}
{"id": "9b553235-5eaf-42de-8312-14f9e7495415", "content": "# .env 파일 또는 배포 환경 변수\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 7, "total_chunks": null}}
{"id": "09edf7e8-b695-4aea-ad2a-bae53dc4f8ed", "content": "# GitHub App ID (숫자가 아닌 App ID, 예: 892341)\nGITHUB_APP_ID=123456\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 8, "total_chunks": null}}
{"id": "701791c0-1def-4144-bf33-f49450e01ce5", "content": "# Private Key (다운로드 받은 .pem 파일 내용 전체)", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 9, "total_chunks": null}}
{"id": "1257c9cb-a49c-4536-8a46-ff4a5bcdfc50", "content": "# 줄바꿈(\\n) 처리에 유의하거나, Base64 인코딩해서 넣는 것을 권장\nGITHUB_APP_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\\nMIIEpAIBAAKCAQEA...\"\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 10, "total_chunks": null}}
{"id": "7133bfdf-8457-4aa5-a791-b61028080860", "content": "# GitHub API Base URL (Enterprise가 아니면 기본값 사용)\nGITHUB_APP_BASE_URL=https://api.github.com\n```\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 11, "total_chunks": null}}
{"id": "92614f1c-fa05-4de5-99c1-d99e3df0cad5", "content": "### 3.1 프론트엔드 Install 버튼 환경 변수\n\n프로젝트 생성 마법사의 \"Install / Manage App\" 버튼이 정확한 설치 URL로 이동하도록, 프론트엔드 환경 변수에 아래 값을 추가하세요.\n\n```bash", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 12, "total_chunks": null}}
{"id": "0dc86898-05cb-46b7-8894-09b6c24ac0fe", "content": "# apps/fluxloop-web-git 이 현재 등록된 GitHub App slug\nNEXT_PUBLIC_GITHUB_APP_INSTALL_URL=https://github.com/apps/fluxloop-web-git/installations/new\n```\n\nGitHub App의 슬러그를 변경하면 이 값도 함께 업데이트해 주세요. 지정하지 않으면 기본값으로 `https://github.com/apps/fluxloop-web-git/installations/new` 가 사용됩니다.\n\n---\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 13, "total_chunks": null}}
{"id": "03fc2299-d089-4a81-94ac-721b91701841", "content": "## 4. 사용자 온보딩 플로우 (최종)\n\n1. **로그인**: 사용자가 Supabase를 통해 로그인 (GitHub App으로 인증).\n2. **프로젝트 생성**:\n   - 사용자가 \"GitHub 연결\"을 누름.\n   - 앱이 설치되지 않은 레포라면, `https://github.com/apps/fluxloop/installations/new`로 이동.\n   - **\"Request user authorization...\"** 옵션 덕분에 설치 후 바로 FluxLoop로 리다이렉트됨.\n3. **작업 시작**:\n   - 백엔드는 `GITHUB_APP_ID`와 `PRIVATE_KEY`로 **Installation Token**을 발급.\n   - Agent에게 이 토큰을 주입하여 `git push` 등 작업 수행.\n", "metadata": {"source": "docs/guides/github_app_setup.md", "chunk_index": 14, "total_chunks": null}}
{"id": "f9da7918-f524-4f89-bbba-88287222e99c", "content": "# FluxLoop Pytest Bridge 가이드\n\nFluxLoop 0.2.29부터는 Pytest에 익숙한 개발자가 기존 러너/멀티턴 엔진을 그대로 활용하면서도, `pytest -k fluxloop_smoke` 같은 명령으로 실험을 돌릴 수 있는 하이브리드 브리지를 제공합니다.\n", "metadata": {"source": "docs/guides/pytest_bridge.md", "chunk_index": 0, "total_chunks": null}}
{"id": "e97baab4-596c-4d74-855c-391d225b8e64", "content": "## 1. 준비\n1. `.venv` 등 프로젝트 가상환경을 활성화합니다.\n2. FluxLoop CLI를 개발 모드로 설치합니다.\n   ```bash\n   pip install -e packages/cli[dev]\n   ```\n3. 퍼블릭 프로젝트에서는 `PYTHONPATH`에 프로젝트 루트를 추가해 러너 모듈을 찾을 수 있게 합니다.\n", "metadata": {"source": "docs/guides/pytest_bridge.md", "chunk_index": 1, "total_chunks": null}}
{"id": "fe1f9a31-5cf2-4d29-91df-8468e9d3dd10", "content": "## 2. 템플릿 생성\n새로운 명령으로 바로 테스트 골격을 만들 수 있습니다.\n\n```bash\nfluxloop init pytest-template .\n```\n\n- 기본적으로 `tests/test_fluxloop_smoke.py`가 생성되며, `configs/simulation.yaml` 혹은 `setting.yaml` 중 존재하는 파일을 자동으로 참조합니다.\n- 옵션\n  - `--tests-dir qa` : 템플릿을 다른 디렉터리에 생성\n  - `--filename test_agents.py` : 파일명 변경\n  - `--force` : 기존 파일 덮어쓰기\n\n생성된 테스트는 `fluxloop_runner` fixture를 사용하여 `ExperimentRunner`를 실행하고 `FluxLoopTestResult.require_success()`로 실패 시 바로 Pytest에서 빨간 불을 낼 수 있습니다.\n", "metadata": {"source": "docs/guides/pytest_bridge.md", "chunk_index": 2, "total_chunks": null}}
{"id": "ca26e8fa-ce1d-4a63-9114-d02e074ecbcf", "content": "## 3. Fixture 사용법\n두 개의 fixture가 자동 등록됩니다 (`tests/conftest.py`가 `pytest_plugins = [\"fluxloop_cli.testing.pytest_plugin\"]`를 선언).\n\n```python\ndef test_custom(fluxloop_runner):\n    result = fluxloop_runner(\n        project_root=PROJECT_ROOT,\n        simulation_config=PROJECT_ROOT / \"configs\" / \"simulation.yaml\",\n        overrides={\"iterations\": 2},\n        env={\"PYTHONPATH\": str(PROJECT_ROOT)},\n    )\n    assert result.total_runs == 2\n    result.require_success()\n```\n\n- `fluxloop_runner`: SDK 경로(ExperimentRunner)를 직접 호출.\n- `fluxloop_cli`: 실제 `fluxloop run experiment`/`fluxloop parse experiment` 명령을 서브프로세스로 실행하고, stdout/stderr 로그 파일 경로(`result.stdout_path`, `result.stderr_path`)와 CLI 커맨드 문자열(`result.cli_command`)까지 돌려줍니다. 실패 시 어느 로그를 봐야 하는지 Pytest 메시지 없이도 바로 확인할 수 있어요.", "metadata": {"source": "docs/guides/pytest_bridge.md", "chunk_index": 3, "total_chunks": null}}
{"id": "19eadbf2-2df5-4c12-8853-4674b83348f4", "content": "\n둘 다 `FluxLoopTestResult`를 반환하므로 `trace_summary_path`, `per_trace_path` 등을 바로 활용할 수 있습니다.\n\n> CLI 모드에서는 내부적으로 `fluxloop run experiment --yes --no-display --no-collector`를 사용합니다. 직접 명령을 실행할 때도 `--yes` 플래그를 붙이면 확인 프롬프트 없이 바로 실행돼요.\n", "metadata": {"source": "docs/guides/pytest_bridge.md", "chunk_index": 4, "total_chunks": null}}
{"id": "be55f3d4-6ae3-4922-97a5-c3adf2516190", "content": "## 4. GitHub Actions 예시\n예제 워크플로는 `examples/ci/fluxloop_pytest.yml`에 포함되어 있습니다. 필요한 부분만 복사해서 사용하면 됩니다.\n\n```yaml\nname: fluxloop-pytest\non:\n  workflow_dispatch:\n  workflow_call:\n\njobs:\n  smoke:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-python@v5\n        with:\n          python-version: \"3.11\"\n      - name: Install deps\n        run: |\n          python -m venv .venv\n          source .venv/bin/activate\n          pip install -U pip\n          pip install -e packages/cli[dev]\n      - name: Run FluxLoop Pytest suite", "metadata": {"source": "docs/guides/pytest_bridge.md", "chunk_index": 5, "total_chunks": null}}
{"id": "a6185184-a422-4183-84f6-7e0cc8e835f5", "content": "        env:\n          PYTHONPATH: ${{ github.workspace }}\n        run: |\n          source .venv/bin/activate\n          pytest -k fluxloop_smoke --maxfail=1 --disable-warnings\n```\n", "metadata": {"source": "docs/guides/pytest_bridge.md", "chunk_index": 6, "total_chunks": null}}
{"id": "3618d00e-6595-4df7-84c9-7f26c8e8e24a", "content": "## 5. 로컬/CI 실행 팁\n- 긴 멀티턴 테스트는 `--maxfail=1`과 `pytest-timeout`을 함께 사용하는 것이 좋습니다. fixture에는 `timeout` 파라미터도 있으니 필요 시 `fluxloop_runner(..., timeout=900)` 식으로 조정합니다.\n- `per_trace_path`를 반환하므로 deepeval, 사내 평가기 등에 즉시 연결할 수 있습니다.\n- CLI 사용자에게 템플릿과 명령을 안내하고 싶다면 `fluxloop init pytest-template`만 추가로 소개하면 됩니다. 복잡한 Runner/Guard 설정은 기존 YAML이 관리하므로 Pytest는 단순 진입점 역할을 합니다.\n\n이 가이드에 따라 기본 템플릿을 생성한 뒤 필요에 맞게 fixture 호출을 확장하면, FluxLoop 엔진이 제공하는 다양한 러너/멀티턴 기능을 Pytest/CI 파이프라인에서도 그대로 재사용할 수 있습니다.\n", "metadata": {"source": "docs/guides/pytest_bridge.md", "chunk_index": 7, "total_chunks": null}}
{"id": "f723f0ed-413d-42b3-82d7-1df1bd02cd25", "content": "# Icebox: Future Roadmap Items\n\n이 문서는 현재 개발 범위에서 제외되었으나, 향후 확장을 위해 고려해야 할 기능들을 정리합니다.\n\n---\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 0, "total_chunks": null}}
{"id": "a590c30a-e4c5-4de2-aea7-48863a5cec1a", "content": "## 1. Sandbox Infrastructure Expansion\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 1, "total_chunks": null}}
{"id": "0f030e71-cd5b-40b4-b320-63fa46061055", "content": "### Kubernetes Executor (K8s Cluster)\n- **목표**: 대규모 병렬 실험 실행 및 비용 최적화.\n- **구조**: `K8sExecutor`가 `kubectl` 또는 K8s API를 통해 Pod를 생성하고 작업을 위임.\n- **핵심 전략**:\n  - **Spot Instances**: AWS Spot / GCP Preemptible VM을 활용하여 비용 절감.\n  - **Auto-scaling**: 실험 요청량에 따라 노드 수를 동적으로 조절.\n  - **Volume Management**: Persistent Volume Claim(PVC)을 사용하여 워크스페이스 데이터 영속성 확보.\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 2, "total_chunks": null}}
{"id": "19fe04e6-cef3-4116-b44d-308fe36f8d79", "content": "### Remote Sandbox Service (Managed)\n- **목표**: 보안 격리가 중요한 시나리오(Untrusted Code) 지원.\n- **대상**: Vercel Sandbox, E2B, Firecracker microVM.\n- **구조**: `RemoteSandboxExecutor`가 외부 API를 통해 VM을 할당받고 명령 실행.\n- **고려사항**:\n  - **비용**: 실행 시간당 과금 구조이므로 장기 실행 실험에는 부적합할 수 있음.\n  - **네트워크**: 외부망에서의 DB 접근 보안(Tunneling, VPC Peering).\n\n---\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 3, "total_chunks": null}}
{"id": "d03bd2b0-4988-47d3-9f18-e5fec2dc387f", "content": "## 2. Coding Agent Advanced Features\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 4, "total_chunks": null}}
{"id": "f9808075-18e6-4b70-8eaf-7ce807c7dd8e", "content": "### Multi-Agent Pipeline Orchestration (Runner Level)\n- **목표**: Runner 서비스 레벨에서 여러 Deep Agent를 순차적/병렬적으로 실행하는 파이프라인 구성.\n- **예시**: `Researcher(분석)` → `Integrator(구현)` → `Tester(검증)`\n- **구조**: `PipelineHandler`를 도입하여 각 단계의 에이전트 실행 결과를 다음 단계의 입력(Context/Handoff)으로 전달.\n- **현재 상태**: 개별 에이전트 빌더(`AgentGraphConfig`)와 Context 공유(`get_context_handoff`)는 구현되었으나, 이를 엮는 상위 오케스트레이터는 미구현.\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 5, "total_chunks": null}}
{"id": "10cfd0d7-5200-4095-b4d9-34d54260a974", "content": "### Multi-Agent Collaboration (Hierarchical)\n- **목표**: 복잡한 작업을 여러 전문 에이전트가 분담.\n- **구조**:\n  - **Architect Agent**: 전체 구조 설계 및 파일 생성.\n  - **Coder Agent**: 개별 함수/클래스 구현.\n  - **Tester Agent**: 테스트 케이스 작성 및 검증.\n  - **Reviewer Agent**: 코드 스타일 및 보안 점검.\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 6, "total_chunks": null}}
{"id": "79a191ba-4856-4b65-a3fe-4b3f28393c21", "content": "### Persistent Memory & Learning\n- **목표**: 에이전트가 과거의 실수나 프로젝트 컨텍스트를 기억.\n- **기술**: Vector DB(RAG)를 활용하여 프로젝트 문서, 이전 PR, 이슈 기록을 검색.\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 7, "total_chunks": null}}
{"id": "27d0ee5a-f95d-4f0f-85d1-638e947f0f82", "content": "### Extended Tooling & Subagents (DeepAgent Parity)\n- **CLI Parity Tools**: `web_search`, `http_request`, `fetch_url` 등을 MCP 또는 Runner proxy로 노출해 DeepAgents CLI와 기능을 통일.\n- **Subagent Catalog**: `general-purpose`, `researcher`, `batch-runner` 등 역할별 서브에이전트를 정식 카탈로그로 정의하고, `task` 프롬프트에 Progressive Disclosure 규칙을 명시.\n- **Handoff Protocols**: 서브에이전트 간 입력/출력 파일 경로, 히스토리 공유 방식 등을 표준화해 병렬 실행과 복구를 쉽게 함.\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 8, "total_chunks": null}}
{"id": "0375a09a-73c5-405f-9d26-27a8447b91f9", "content": "## 3. Documentation & DevEx (Phase 4 Moved)\n- **공용 컴포넌트 문서화**: PlanTracker, HITL, Persistence 등 Deep Agent Core 컴포넌트의 API 문서화.\n- **Agent DevEx 개선**: 새로운 Deep Agent 유형(예: QA Agent) 추가 시 필요한 `AgentGraphConfig` 설정 가이드 및 보일러플레이트 제공.\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 9, "total_chunks": null}}
{"id": "97978b4d-7f26-4d6a-b231-0c5a5f52c774", "content": "### VS Code Result Upload Automation\n- **목표**: 로컬/VSCode 실행이 끝난 뒤 웹 백엔드로 실험 결과(`traces.jsonl`, `observations.jsonl`, `trace_summary.jsonl`)를 자동 업로드.\n- **구성**:\n  - Runner 확장에 후처리 훅 추가 → 성공/실패 여부와 관계없이 `upload_results` API 호출.\n  - 오류/재시도 UX 및 업로드 진행 상황 표시.\n- **의존성**: Backend Phase 2 `upload_results` API (완료), VS Code extension 업데이트 (Icebox).\n\n---\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 10, "total_chunks": null}}
{"id": "fd6db938-170b-4afc-bfb2-4e75086fc4ba", "content": "## 3. UI/UX Improvements\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 11, "total_chunks": null}}
{"id": "86b3a6aa-d323-43d8-8478-7012438464a7", "content": "### Structured CLI Output Protocol (Magic Prefix)\n- **목표**: CLI 실행 로그(stdout)를 활용하여 웹 UI에서 Rich Display(상태 카드, Tool Call 트리 등) 제공.\n- **방식**: `FLUXLOOP_EVENT::{json_payload}` 형태의 매직 프리픽스 출력.\n- **구현**:\n  - **CLI**: 에이전트/툴 실행 시점에 구조화된 로그 출력.\n  - **Runner**: Stdout 파싱 후 SSE 이벤트(`agent_action`, `tool_call`)로 변환하여 브로드캐스트.\n  - **Frontend**: 단순 텍스트 로그 뷰어 대신 구조화된 컴포넌트로 렌더링.\n", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 12, "total_chunks": null}}
{"id": "15846bf9-16ea-43d0-adac-98a7e6a5aac3", "content": "### HITL Loop Detection & Guidance\n- **목표**: MCP 실패나 반복 탐색으로 실질적 진행이 멈춘 경우를 자동 감지해 사용자에게 알리고, HITL 승인 후 재진입 시 맥락을 유지.\n- **핵심 전략**:\n  - **Progress Signal Tracking**: LangGraph 상태에 `turns_without_progress`, `recent_tool_pattern` 등을 저장하여 파일 변경·TODO 업데이트 같은 “진행 이벤트”가 N턴 동안 없으면 플래그 설정.\n  - **Supervisor Guardrail**: 진행 플래그가 켜지면 Supervisor가 HITL 알림을 띄우고, Coder에게 “변화 없음” 요약을 작성하게 해 사용자 판단을 돕도록 지시.\n  - **HITL UI 강화**: 최근 N회의 도구 호출/로그 요약, 반복 패턴 짚어보기, 승인/종료/지시 입력을 한 화면에서 처리할 수 있는 패널 제공.\n  - **재개 정책**: HITL 승인으로 재개할 때 이전 플랜/TODO 스냅샷을 자동 주입하고, 동일 패턴이 다시 나타나면 경고 수준을 단계적으로 높임.", "metadata": {"source": "docs/icebox/future_roadmap.md", "chunk_index": 13, "total_chunks": null}}
{"id": "38d2e8c4-c095-4ab8-abc4-4c89b37a8d54", "content": "## FluxLoop Dynamic Agent Integration PRD\n\n> **Status & Target Release**  \n> - **Open Source Edition**: Keeps the current “static” Flux Agent (read-only guidance + manual application).  \n> - **Membership Edition (Future)**: This document describes the roadmap for the next-tier Flux Agent that performs dynamic code operations and orchestrates additional workflows. Development will begin after the OSS version is stabilized.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 0, "total_chunks": null}}
{"id": "b75ebb2e-cdd4-4905-a0d4-86293afa4194", "content": "### 1. Background / Problem Statement\n\n- **Current state (OSS)**: We delivered the initial Flux Agent milestone (Integration Assistant). It combines MCP repository analysis with OpenAI suggestions for code integration, but it doesn’t perform direct code modifications or orchestrate other agent-centric tasks (input generation, evaluation, adapter scaffolding). All operations are read-only and manual.\n- **Gap**: CLI commands such as `fluxloop generate inputs` or evaluation routines still rely on direct API calls/manual scripts. Adapter scaffolding (to run “off-the-shelf” experiments) remains a manual effort. Membership-tier users need a more automated experience, including dynamic code edits, setup, and validation.", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 1, "total_chunks": null}}
{"id": "55897797-9278-479a-a2e5-e8bdef2c8b3b", "content": "- **Goal (Membership Edition)**: Move from a *guided assistant* to a *dynamic coding agent runtime* that can automatically create/update project artifacts, run tests, and orchestrate end-to-end workflows (setup → generation → evaluation) on the **local environment** (no sandbox) using the existing Node backend in CLI/VSCode. This requires integrating code-editing capabilities reminiscent of `coding-agent-template`, but tailored for FluxLoop’s ecosystem.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 2, "total_chunks": null}}
{"id": "67d1d74b-926d-4285-b5c5-4977fff5c5e2", "content": "### 2. Scope\n\n| Area | Current Capability | Target Capability |\n|------|--------------------|-------------------|\n| Integration Assistant | MCP analysis + LLM guidance (read-only) | Add adapter scaffolding + optional code edits |\n| Input Generation | CLI command with manual OpenAI call | Agent-run pipeline (MCP + LLM + validation) |\n| Evaluation | Manual or CLI-based scripts | Agent-generated evaluation plan + execution |\n| Adapter Scaffold | Manual implementation | Agent-generated base class + framework-specific adapter |", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 3, "total_chunks": null}}
{"id": "7622b3b5-f09a-41de-8eba-ea8c019fcc6e", "content": "### 3. Objectives\n\n1. **Dynamic Coding Agent Runtime**  \n   - Embed a lightweight version of `coding-agent-template` to enable safe file edits inside FluxLoop repositories (guardrails, auditing).\n2. **Agent-Orchestrated Workflows**  \n   - Build a unified agent entrypoint that can execute “jobs” (input-gen, evaluation, adapter creation) via MCP + LLM + CLI/SDK helpers.\n3. **Adapter Scaffold Automation**  \n   - Generate experiment adapters that satisfy a common interface, enabling off-the-shelf experiments without manual boilerplate.", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 5, "total_chunks": null}}
{"id": "2f4fd137-a602-4537-b701-f97de80f3ace", "content": "4. **Integration Across Surfaces**  \n   - Provide consistent agent workflows in CLI, VSCode, and (eventual) web UI with shared logic & config.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 6, "total_chunks": null}}
{"id": "7dc09d83-7ddd-438a-94fb-026b4bd95604", "content": "### 4. Non-Goals\n\n- Full natural language IDE replacement; dynamic agent will remain scoped to defined workflows.\n- Replacing human review: code edits remain opt-in with diff review.\n- Shipping evaluation metrics beyond the initial plan (focus on orchestration, not new metrics).\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 7, "total_chunks": null}}
{"id": "0a639579-11c2-41f1-a82a-f14a13d8b94c", "content": "### 5. Architecture Overview (Local Runtime)\n\n```\nCLI / VSCode Commands\n        |\n        v\n  Agent Orchestrator (Node.js)\n        |\n   +----+----------------------+\n   | MCP Client (analysis)     |\n   | LLM Client (OpenAI etc.)  |\n   | File System Operator      |\n   | Command Runner (child_process)\n   +----+----------------------+\n        |\n        v\n Project Workspace (local)\n   ├── adapters/\n   ├── configs/\n   ├── inputs/\n   └── experiments/\n```\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 8, "total_chunks": null}}
{"id": "17d3d560-07c8-4bbd-ae5f-41706f5a575b", "content": "### 6. Components\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 9, "total_chunks": null}}
{"id": "45798ae2-da64-43fd-a0d7-9827922a8999", "content": "#### 6.1 Agent Orchestrator\n- Entry point for agent tasks (CLI command `fluxloop agent run --task ...` or VSCode command).\n- Reads a “Job Spec” (JSON/YAML) containing context (goal, target files, constraints).\n- Uses MCP + LLM + file operations to fulfill the task.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 10, "total_chunks": null}}
{"id": "6197798c-a22a-4319-b8cd-435d546efe98", "content": "#### 6.2 MCP Integration\n- Reuse existing `fluxloop-mcp` tools. Enhance with:\n  - `generate_adapter_plan` (new MCP tool) → suggest adapter skeleton structure.\n  - `generate_evaluation_plan` (new MCP tool) → define metrics & steps.\n  - `generate_input_variations` (optional MCP tool) → standardized input strategies.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 11, "total_chunks": null}}
{"id": "9e9a8cf3-0826-404f-9d72-e1074a4205dc", "content": "#### 6.3 Dynamic Code Editing\n- Derived from `coding-agent-template-main` but trimmed and run **locally**:\n  - Diff preview vs actual file modifications (user approval required).\n  - Tests/commands run via Node’s `child_process` (e.g., `pytest`, `fluxloop parse`, `pnpm test`).\n  - Guardrails: workspace-level config to restrict editable directories and log actions.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 12, "total_chunks": null}}
{"id": "6b149a83-676c-48b9-a767-8cab8336ceab", "content": "#### 6.4 Workflow Jobs (Membership Edition)\n\n| Job | MCP Tools | LLM Role | File Ops | Output |\n|-----|-----------|----------|----------|--------|\n| Adapter Scaffold | `generate_adapter_plan` | Generate class implementation | Create/modify `experiments/adapters/*.py` | Adapter file + smoke test |\n| Input Generation | `generate_input_plan` (reuse or new) | Create variations w/ validation | Write to `inputs/generated/*.json` | Input files + summary |\n| Evaluation Setup | `generate_evaluation_plan` | Compose report & checks | Optional config updates | Evaluation plan + results |", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 13, "total_chunks": null}}
{"id": "83b2562e-1b41-4e21-b3ae-a536bd5dcdc6", "content": "| Integration Fix | `run_integration_workflow` | Edit source files (opt-in) | Modify project code | Commit-ready diff |\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 14, "total_chunks": null}}
{"id": "a621a8d9-bbcc-4c3e-a201-41150728610a", "content": "### 7. User Experience (Membership)\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 15, "total_chunks": null}}
{"id": "81588aef-d38b-49bb-894f-2c9f2565433c", "content": "#### CLI\n```\nfluxloop agent run --task adapter-scaffold --framework express --entry src/server.ts:createServer\n```\n- Collects context (target file, framework).\n- Agent creates adapter file `experiments/adapters/express_adapter.py`.\n- Runs smoke test (optional) and prints diff summary.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 16, "total_chunks": null}}
{"id": "5845b5eb-d2be-4ec8-8ec5-d98ae1b2a2cf", "content": "#### VSCode\n- New command “FluxLoop: Run Dynamic Agent”.\n- Workflow selection: Adapter / Inputs / Evaluation / Integration Fix.\n- Diff viewer for file changes (user approves).\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 17, "total_chunks": null}}
{"id": "8c5f444f-7e44-4c98-ab27-8c405e2d08a1", "content": "### 8. Phases & Milestones (Membership Roadmap)\n\n| Phase | Timeline | Focus | Deliverables |\n|-------|----------|-------|--------------|\n| P0 (Design Spike) | Week 1 | Orchestrator skeleton, job spec format, security guardrails | Design docs, risk assessment |\n| P1 (Adapter Scaffold MVP) | Week 2-3 | Base agent runtime + `adapter-scaffold` job | CLI command + tests + sample adapter |\n| P2 (Input Generation Agent) | Week 4-5 | Replace existing input gen with agent job | `fluxloop agent run --task input-generation` + docs |", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 18, "total_chunks": null}}
{"id": "1d473689-b73e-4856-8809-51335df51c0e", "content": "| P3 (Evaluation Plan Agent) | Week 6-7 | Compose evaluation plans + run metrics | `evaluate` job + reporting |\n| P4 (VSCode Integration) | Week 8 | UI for selecting jobs, reviewing diffs | VSCode commands + diff panel |\n| P5 (Stability & Docs) | Week 9 | Logging, telemetry opt-in, tutorials | Docs, samples, recorded demos |\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 19, "total_chunks": null}}
{"id": "2f2f51b7-2a09-442b-95f2-f3b123d1ace8", "content": "### 9. Risks & Mitigations\n\n| Risk | Mitigation |\n|------|------------|\n| Unintended code edits | Require user approval, diff review, guard allowed paths |\n| LLM hallucination | Use MCP plans as structured grounding, integrate validation |\n| Tooling performance | Cache MCP results, use streaming for large files |\n| Security (API keys) | Continue using VSCode Secret Storage / env vars |\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 20, "total_chunks": null}}
{"id": "cd29bbfc-3990-45aa-8c72-c89f253b5496", "content": "### 10. Open Questions\n\n1. Should adapter scaffold include automated tests by default (pytest templates)?\n2. How to support non-Python adapters (e.g., TypeScript)? Need cross-language story or specify scope.\n3. Should agent jobs commit changes automatically or produce patch files?\n4. How to track agent actions for audit (logging, metadata in project)?\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 21, "total_chunks": null}}
{"id": "102bc244-0754-4bdc-968a-08c71f49fea1", "content": "### 11. Next Steps\n\n1. Finalize job spec schema and orchestrator interface.\n2. Define adapter base class + sample implementations.\n3. Extend MCP tools (`generate_adapter_plan`, `generate_evaluation_plan`).\n4. Implement P0/P1 (orchestrator + adapter scaffold) prototype.\n5. Draft next-phase plan for **Advanced Online Runtime** (Git-integrated, sandbox execution) targeting membership+ tiers.\n\n---\n\n**Document Owner**: Platform Team / FluxLoop  \n**Status**: Draft v0.1 (2025-11-10)\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_integration_prd.md", "chunk_index": 22, "total_chunks": null}}
{"id": "f374ac32-4c7e-4051-b4aa-1b2a50f82b96", "content": "## FluxLoop Advanced Online Agent PRD\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 0, "total_chunks": null}}
{"id": "f195e9ca-a0b2-49ee-be31-9556eac69531", "content": "### 1. Background / Motivation\n- **Membership Roadmap**: Following the Membership Edition (local dynamic agent) we plan to offer an optional *Advanced Online* workflow.\n- **Goal**: Allow users to run FluxLoop integrations, simulations, and evaluations directly from the web without local tooling. Users will connect their Git repositories, trigger agent jobs, and review results entirely in-browser.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 1, "total_chunks": null}}
{"id": "fd768e4b-79c0-41a6-a746-4fd99cee9f8d", "content": "### 2. Vision\n> “Click → Analyze → Review → Merge.”  \nUsers connect a repo, select a workflow (adapter scaffold, input generation, evaluation, integration fix), and the FluxLoop cloud agent handles the rest—cloning, editing, testing, and opening PRs—while the user reviews results in a web UI.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 2, "total_chunks": null}}
{"id": "c036285b-cebf-4757-89a2-7a3a07d55ba3", "content": "### 3. Core Capabilities\n| Area | Description |\n|------|-------------|\n| Repo Connection | OAuth-based GitHub/GitLab integration; select repo & branch |\n| Remote Runtime | Managed containers (sandbox) with FluxLoop CLI/SDK preinstalled |\n| Dynamic Agent | Reuse Membership agent runtime (MCP + LLM + code editor) inside sandbox |\n| Workflow Catalog | Adapter scaffold, input generation, evaluation, code fixes |\n| Review & Merge | Diff viewer, log explorer, “Apply changes” → PR creation |\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 3, "total_chunks": null}}
{"id": "9064a4ff-3b87-4b26-9705-a754244f8771", "content": "### 4. Architecture Overview\n```\nWeb UI ──> Backend (API + Queue)\n           ├─ Git OAuth / Repo Metadata\n           ├─ Job Orchestrator\n           └─ Container Manager\n                  └─ FluxLoop Agent Runtime (MCP + LLM + code runner)\n                       ├─ Clone repo branch\n                       ├─ Run workflows\n                       ├─ Commit/log results\n                       └─ Push branch / create PR\n```\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 4, "total_chunks": null}}
{"id": "f3ab9328-c934-4b6b-80ee-fc1b94df8363", "content": "#### Components\n1. **Web UI**\n   - Repo onboarding, workflow configuration, live status/log streaming, diff viewer.\n2. **Backend API**\n   - Stores user projects, job specs, agent logs, audit trail. Provides webhook triggers (PR updates).\n3. **Container Manager**\n   - Spins up ephemeral containers (e.g., AWS ECS, GCP Cloud Run, Vercel sandbox) with limited lifetime.\n4. **Agent Runtime (in container)**\n   - Same Node-based orchestrator used in Membership edition (MCP + LLM + fs operations).\n   - Executes tasks, runs tests, records logs/artifacts.", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 5, "total_chunks": null}}
{"id": "6cd9d3db-ab58-4776-8eec-0977771debeb", "content": "5. **Git Integrator**\n   - After successful run: commit changes to branch, open/update PR, comment with summary.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 6, "total_chunks": null}}
{"id": "b73c960f-2b7e-425d-b1b3-596571c29e5d", "content": "### 5. User Experience Flow (Web)\n1. **Connect Repository**\n   - Sign in → authorize Git provider → select repo + target branch.\n2. **Select Workflow**\n   - Choose from catalog (adapter scaffold, input generation, evaluation, integration fix).\n   - Provide parameters (framework, entry function, test commands, etc.).\n3. **Run Agent**\n   - Backend enqueues job → container spins up → agent executes workflow.\n   - UI shows live logs, progress, diff updates.\n4. **Review**\n   - Diff viewer inside web UI (approve / reject).", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 7, "total_chunks": null}}
{"id": "c1841bc1-66f0-4ae9-b15e-0adbf78ad0ad", "content": "   - Option to download patch or inspect artifacts (input files, evaluation reports).\n5. **Apply**\n   - User clicks “Create PR” → changes pushed to repo with summary comment.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 8, "total_chunks": null}}
{"id": "9660d1c4-3e36-44dd-b395-cc1e2711948d", "content": "### 6. Phases & Milestones (Proposed)\n| Phase | Focus | Deliverables |\n|-------|-------|--------------|\n| P0 | Design & Infra Spike | Security model, container orchestration design, repo auth flow |\n| P1 | Prototype (Adapter Scaffold) | Web flow to run adapter job on sandbox + diff preview |\n| P2 | Workflow Expansion | Add input-generation & evaluation jobs, artifact downloads |\n| P3 | PR/Branch Automation | Push branches, create/update PRs with summaries |\n| P4 | UX & Stability | Live logs, retry/rollback, audit trail, billing hooks |", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 9, "total_chunks": null}}
{"id": "d8ee52dd-88a9-462d-b700-9cb0cc485410", "content": "| P5 | Launch Prep | Documentation, onboarding wizard, pricing plan |\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 10, "total_chunks": null}}
{"id": "b6975aa8-fca5-4904-ab7c-d43018768521", "content": "### 7. Security & Compliance Considerations\n- Scoped OAuth tokens (least privilege).\n- Ephemeral containers with timeouts & resource limits.\n- Secrets management (OpenAI keys per tenant, stored securely).\n- Audit logs for all git operations & file changes.\n- Legal/compliance review for code hosting (data residency options).\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 11, "total_chunks": null}}
{"id": "2e9260dd-b791-40e0-a20d-cfb28db8e178", "content": "### 8. Dependencies\n- Membership agent runtime (local) complete and battle-tested.\n- MCP extensions (adapter/evaluation plans) finalized.\n- Container orchestration stack (decision: Vercel sandbox vs custom infra).\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 12, "total_chunks": null}}
{"id": "6adb17de-9524-4f6e-bc27-3d8afae08481", "content": "### 9. Open Questions\n1. Which git providers to support initially (GitHub only vs GitLab/Bitbucket)?\n2. Pricing model: per-execution cost vs subscription tier.\n3. Do we support organization-wide repositories (SAML, SCIM)?\n4. How to store large artifacts (logs, test reports)? Need S3/GCS support?\n5. Feature gating: differentiate “Membership” vs “Advanced Membership” tiers.\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 13, "total_chunks": null}}
{"id": "36174117-e595-4a3f-bc4a-749c86ceff7b", "content": "### 10. Next Steps\n1. Finalize infra choice (sandbox vs Kubernetes vs serverless containers).\n2. Design detailed repo onboarding + job spec JSON schema.\n3. Extend agent runtime to publish artifacts/logs suitable for web display.\n4. Create prototype UI (Figma + minimal React app) showcasing run + diff review.\n\n---\n**Document Owner**: Platform Team / FluxLoop  \n**Status**: Draft v0.1 (2025-11-10)\n", "metadata": {"source": "docs/prd/agents/dynamic_agent_online_prd.md", "chunk_index": 14, "total_chunks": null}}
{"id": "a6a74afe-f461-484a-8266-11769e9db94d", "content": "# FluxLoop Multi-Mode Agents PRD\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 0, "total_chunks": null}}
{"id": "517359bc-4f4a-4ca6-8364-8f8a8013b89c", "content": "## 1. 배경\n- Flux Agent는 현재 `integration` 용도 위주로 설계되어 있어, 다양한 사용자 시나리오(베이스 인풋 설계, 실험 세팅, 분석)에서 반복적으로 다운스트림 작업이 요구된다.\n- MCP 기반 지식 검색과 저장소 분석은 이미 구축되어 있으나, LLM이 활용할 컨텍스트의 범위가 제한되어 있어 결과 품질이 들쭉날쭉하다.\n- 사용자 여정은 “문서 탐색 → 구성/코드 작업 → 실험 → 평가”로 이어지며, 각 단계에서 보조가 필요하다.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 1, "total_chunks": null}}
{"id": "39cb8b57-341b-4b06-895e-fe4b2dfc80e3", "content": "## 2. 목표\n- 사용자 목적에 맞춘 네 가지 Flux Agent 메뉴(Integration / Base Input / Experiment / Insight Analysis)를 제공한다.\n- 각 메뉴는 실행 전에 필요한 컨텍스트(예: 선택한 파일, 실험 설정)를 명시적으로 수집하고 MCP가 생성한 구조화 데이터를 포함해 LLM에 전달한다.\n- 통합된 UX를 통해 “어떤 목적의 도움을 요청하는지”를 명확히 하고, 결과물 유형(코드 편집안, 인풋 후보, 시뮬레이션 설정, 분석 리포트)을 분리한다.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 2, "total_chunks": null}}
{"id": "adacd592-fea1-4b3f-98d7-3b6fc251697d", "content": "## 3. 사용자 시나리오", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 3, "total_chunks": null}}
{"id": "af0150d5-fb36-43bb-9703-48ab773b0ab5", "content": "### 3.1 Flux Agent for Integration\n- **문제**: 현재 워크플로는 전체 저장소를 분석하지만, 선택된 파일/폴더 중심의 구체적 가이드가 부족하다.\n- **개선 방향**\n  - 실행 시 VS Code에서 대상 파일/폴더를 강제 선택하도록 UX 유도.\n  - RunIntegrationWorkflowTool을 선택된 경로에 초점을 맞춰 확장하고, 필요 시 추가 코드 스니펫을 LLM 컨텍스트에 포함.\n  - 결과물: 선택된 컴포넌트에 대한 통합 계획(파일별 코드 스텁 + 적용 순서 + 검증 체크리스트).\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 4, "total_chunks": null}}
{"id": "6d8b476b-32ad-4e7c-8eea-fd245d5d3150", "content": "### 3.2 Flux Agent for Base Input\n- **문제**: 실험에 투입할 `base input` 후보를 작성할 때 문서, 기존 코드 맥락이 분절되어 있어 사용자 수작업이 많음.\n- **개선 방향**\n  - 프로젝트 컨텍스트(서비스 설명, 주요 엔드포인트, 기존 input 샘플)을 읽어 MCP 요약과 함께 LLM에 제공합니다.\n  - LLM이 목적, 시나리오, assignment 템플릿을 포함한 `base input` 안건 N개를 제안.\n  - 결과물: 사용자가 선택/편집 가능한 Markdown or YAML 초안.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 5, "total_chunks": null}}
{"id": "c4dd2a4a-f48f-499d-954d-e9097e0713f5", "content": "### 3.3 Flux Agent for Experiment\n- **문제**: simulation.yaml 작성 및 멀티턴 입력 구성이 복잡하고 일관된 템플릿이 없다.\n- **개선 방향**\n  - 기존 실험 기록, 문서의 runner별 요구사항, Base Input 제안 내용을 컨텍스트로 연결.\n  - LLM이 simulation.yaml 변경 diff, 멀티턴 후속 인풋 샘플, 실행 시 주의사항을 생성.\n  - 결과물: YAML diff, 실행 명령, 체크리스트 세트.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 6, "total_chunks": null}}
{"id": "c8ee3989-c630-4889-b464-95337f011b4f", "content": "### 3.4 Flux Agent for Insight Analysis\n- **문제**: Evaluate 이후에 deeper insight를 도출하려면 사용자가 결과 파일을 일일이 검토해야 한다.\n- **개선 방향**\n  - Evaluate 결과(`summary.json`, `per_trace.jsonl`, `report.md`)를 MCP 워크플로로 요약하고, LLM이 추가 분석/조언을 작성.\n  - 결과물: HTML `Deep Analysis` 탭에 렌더 가능한 Markdown/HTML 스니펫.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 7, "total_chunks": null}}
{"id": "093a0268-722b-4f00-8717-9df488144f2d", "content": "## 4. 정보 수집 & MCP 개선 요구\n- **프레임워크 감지 고도화**: Python 기반 프로젝트 감지를 위해 AST 분석, requirements 파싱을 강화하고 Flask/Django 등으로 확장.\n- **선택 영역 중심 분석**: Integration 모드에서 선택 파일/폴더만 대상으로 RunIntegrationWorkflowTool을 실행하거나 추가 옵션 제공.\n- **Runner 레시피 확장**: Base Input/Experiment 모드를 위해 runner 타입별 문서 요약과 구성 스키마를 MCP에서 제공.\n- **결과 구조화**: 각 모드별 JSON 스키마 정의(예: IntegrationPlan, InputCandidates, ExperimentPlan, InsightReport) 후 프롬프트에 주입.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 8, "total_chunks": null}}
{"id": "882e6e3a-5430-429f-b29c-c8fce898041e", "content": "## 5. UX 플로우 제안\n1. 사용자가 Flux Agent 뷰/명령 팔레트에서 모드를 선택.\n2. 모드별로 필수 컨텍스트(선택 폴더, base input 파일, simulation.yaml 등)를 선택 또는 확인.\n3. 필요한 경우 MCP 워크플로 또는 검색을 실행하여 구조화 데이터 수집.\n4. LLM 호출 → 결과 저장(Recent Suggestions) + 관련 뷰/파일 자동 오픈.\n5. 사용자 액션:\n   - Integration: 제안 코드 미리보기/삽입.\n   - Base Input/Experiment: 생성된 템플릿을 파일로 저장하거나 편집.\n   - Insight: 분석 리포트 탭에 반영.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 9, "total_chunks": null}}
{"id": "3bf49db6-9599-47f1-9d33-e9965524d0da", "content": "## 6. 기술 고려 사항\n- 확장된 MCP 워크플로: 모드별 파라미터 지원, 선택 경로 기반 실행.\n- 프롬프트 설계: 각 모드 JSON 스키마를 포함한 가이드라인 정의.\n- UI/명령: `FluxLoop: Run Flux Agent (Integration/Base Input/Experiment/Insight)` 등 명령 추가 및 뷰 탭 필터링.\n- 결과 저장: 모드별 히스토리 태깅, 재실행 시 컨텍스트 복구.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 10, "total_chunks": null}}
{"id": "e52e4fcd-db72-4fc7-a2cf-7a052601e2a5", "content": "## 7. 리스크 및 완화\n- **감지 실패**: 프레임워크 감지가 실패할 경우 fallback 메시지와 코딩 어시스턴트 사용 권장 안내 제공.\n- **컨텍스트 크기**: 선택된 파일·결과 JSON이 클 경우 프롬프트 축약 로직 필요.\n- **결과 신뢰도**: MCP 레시피가 최신 문서와 불일치할 위험 → 문서 업데이트 주기, lint 스크립트 도입.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 11, "total_chunks": null}}
{"id": "7b671051-9369-42bc-b0d3-6512f4a51258", "content": "## 8. 로드맵 제안\n1. **Phase 1 (일반 수준)**: Integration 모드 UX 개선 + Python 프레임워크 감지 강화 + 모드별 명령 추가.\n2. **Phase 2 (고도화)**: Base Input/Experiment 모드 구현, MCP 구조 확장, 프롬프트 고도화.\n3. **Phase 3**: Insight Analysis 모드 및 HTML 탭 통합, 자동 리포트 생성 배포.\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 12, "total_chunks": null}}
{"id": "0ef8f5a1-c8c0-4089-95f7-49f36591e4d4", "content": "## 9. 오픈 이슈\n- Runner별 문서와 MCP 레시피 자동 동기화 방식?\n- Insight Analysis에서 비정형 로그를 어떻게 요약/필터링할지?\n- 사용자 비밀키(API Key 등)를 여러 모드에서 재사용하는 UX?\n\n", "metadata": {"source": "docs/prd/agents/fluxloop_agents_multi_mode_prd.md", "chunk_index": 13, "total_chunks": null}}
{"id": "54d4e526-5648-4172-ba81-55423024c084", "content": "## FluxLoop VSCode Integration Agent PRD (MCP 기반 지식 + LLM 제안)\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 0, "total_chunks": null}}
{"id": "17cc5f38-78da-481a-945d-7abbcb938951", "content": "### 1. 배경 / 문제 정의\n- FluxLoop VSCode 확장은 프로젝트/입력/실험 결과 중심으로 설계되어 있어, 사용자가 복잡한 통합 작업을 수행할 때 문서 탐색과 코드 변경 판단을 수동으로 해야 함.\n- 기존 Codex/CLI 통합은 코드 자동 수정에 초점을 맞췄으나, 실제 사용자 다수는 “수정 제안만 받고 직접 적용”하기를 선호하거나 정책상 자동 쓰기를 허용하지 않음.\n- 조직 지식(MCP 서버)과 실 레포 컨텍스트(현재 파일, 프로젝트 설정)를 결합해 **로컬에서 안전하게 수정 제안**을 제공하는 워크플로가 필요.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 1, "total_chunks": null}}
{"id": "6e999124-6b1a-4482-89d6-988f09dea00f", "content": "### 2. 목표(Goals)\n1. VSCode 확장 내 `Integration` 섹션을 신설하여 MCP 연결 상태, 지식 검색, Flux Agent 실행을 한 곳에서 제어할 수 있도록 한다.\n2. Flux Agent가 MCP 지식을 활용해 현재 프로젝트/파일에 맞는 **설명 + 수정 제안**을 Markdown으로 반환하도록 하고, 자동 코드 변경은 수행하지 않는다.\n3. 사용자 흐름을 “FluxLoop 확장 메뉴에서 버튼을 누르는 것”만으로 완결할 수 있게 구성한다 (명령 팔레트 최소화).\n4. 제안/검색 결과는 `Results` 히스토리에 축적되고, 쉽게 복사·검토·체크할 수 있는 UI를 제공한다.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 2, "total_chunks": null}}
{"id": "e760043f-5d5c-4624-bb9c-68779367fb2b", "content": "### 3. 비목표(Non-Goals)\n- 자동 코드 편집, git commit/push, 테스트 실행 등 수정 적용 이후 단계는 범위 밖 (추후 옵션 고려).\n- 외부 백엔드 구축이나 Python 런타임 추가. 모든 로직은 VSCode 확장과 로컬 Node 런타임으로 해결.\n- MCP 서버 자체 기능 확장(신규 툴, 데이터 인덱싱)은 본 PRD 범위에 포함되지 않음. 기존 PRD(`mcp_server_plan.md`)를 따른다.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 3, "total_chunks": null}}
{"id": "8387d351-cb4d-40cd-a208-ca001d294a5b", "content": "### 4. 참조 문서\n- `docs/prd/mcp_server_plan.md`\n- `docs/prd/codex_vscode_extention.md`\n- `docs/prd/runner_integration_extensions_prd.md`\n- FluxLoop VSCode 확장 리드미 `packages/vscode/README.md`\n\n---\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 4, "total_chunks": null}}
{"id": "eaebffee-86d1-424f-a905-2b645fec1366", "content": "## 5. 기능적 요구사항(Functional Requirements)\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 5, "total_chunks": null}}
{"id": "db1bf810-acad-444a-a1f2-4ec5ac77edf0", "content": "### 5.1 Integration 트리 뷰\n- Activity Bar `FluxLoop` 컨테이너에 `Integration` 뷰 추가 (`id: fluxloop.integration`). 기존 `Status` 뷰는 `Integration` 안의 하위 섹션으로 통합한다.\n- 기본 노드 구조:\n  - `MCP 연결` (상태 표시, 클릭 시 연결/재연결)\n  - `Flux Agent` (실행 액션)\n  - `시스템 상태` (기존 Status 항목: CLI 설치, Python 환경, MCP 인덱스 등)\n  - `최근 제안` (최신 5개 제안 항목)\n- 뷰 상단 명령 버튼: `Connect MCP`, `Run Flux Agent`.\n- MCP 상태 표시 요소: 실행 여부, 마지막 에러 요약, 설치 경로 툴팁.\n- 시스템 상태 노드는 각 항목별 상태 아이콘(✅/⚠️)과 설명, 필요 시 관련 명령(예: CLI 재설치, 인덱스 갱신)을 연결한다.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 6, "total_chunks": null}}
{"id": "fc97e452-119f-4b55-b85a-6f4edb5f8a36", "content": "### 5.2 MCP 제어/지식 검색\n- 명령 `fluxloop.integration.connectMcp`\n  - MCP 서버 stdio 프로세스를 실행/중지, 상태 워처 등록.\n  - 실패 시 사용자에게 가이드(설치 경로, 로그)를 표시.\n  - **최초 사용 시나리오**: MCP 서버가 감지되지 않으면, 사용자에게 서버 자동 다운로드 및 설치 옵션을 제안하는 Notification을 표시.\n- 명령 `fluxloop.integration.openKnowledgeSearch`\n  - QuickPick 또는 Webview로 RAG 질의 UI 제공.\n  - MCP `faq`, `generate_integration_steps`, `propose_edit_plan`, `validate_edit_plan` 호출을 지원.\n  - 검색 결과/레시피는 `Results` 뷰에 카드 형태로 저장.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 7, "total_chunks": null}}
{"id": "fa90e513-ee2f-4b02-9065-6952bcbc7746", "content": "### 5.3 Flux Agent 실행 흐름\n- 명령 `fluxloop.integration.runAgent`\n  1. 활성 프로젝트(`ProjectManager.getActiveProject`)와 활성 에디터(`window.activeTextEditor`)의 컨텍스트 추출. **사용자가 특정 코드 블록을 선택한 경우, 전체 파일이 아닌 해당 블록을 우선 컨텍스트로 사용.**\n  2. MCP `analyze_repository`와(필요시) `generate_integration_steps` 호출하여 문제 맥락 데이터 수집.\n  3. LLM 호출을 통해 “설명, 제안, 적용 위치, 후속 체크, 참고 문서”가 포함된 Markdown 생성.\n  4. 결과를 전용 Webview(또는 `Results` 뷰 상세 패널)에 렌더링.\n- 반환 포맷 예시:\n  ```markdown\n  # Flux Agent Suggestion\n  ## Summary\n  - ...\n  ## Suggested Changes\n  1. 파일 `src/server.ts`", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 8, "total_chunks": null}}
{"id": "4c7a67f7-8e5e-41d9-8705-0efc6a65e1d6", "content": "     - 앵커: `app.use(` 이후\n     - 제안 코드:\n       ```ts\n       app.use(fluxloop({ projectKey: \"...\" }))\n       ```\n  ## Validation Checklist\n  - `pnpm lint`\n  - `/health` 엔드포인트 체크\n  ## References\n  - docs/... (MCP citation)\n  ```\n- 자동 파일 수정 금지, 복사 버튼/파일 열기/체크박스 등 수동 적용 어시스트만 제공.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 9, "total_chunks": null}}
{"id": "21c23791-75df-4293-a1be-858876d991db", "content": "### 5.4 히스토리 & 결과 관리\n- 각 MCP 검색 및 Flux Agent 제안을 `workspaceState`에 저장 (프로젝트별 구분).\n- `Integration` 뷰의 `최근 제안` 노드를 통해 빠른 접근 제공.\n- `Results` 뷰에는 카드/아이템 형태로 축적, 클릭 시 Webview 열기.\n- 항목별 메타데이터: `id`, `projectId`, `file`, `timestamp`, `summary`, `source`(MCP/LLM).\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 10, "total_chunks": null}}
{"id": "554f07f8-a629-4c38-9f82-11d93e912ebd", "content": "### 5.5 UI/UX 가드레일\n- **비동기 작업 피드백**: `Run Flux Agent` 등 시간이 소요되는 작업 실행 시, `Integration` 뷰의 관련 노드에 스피너(spinner)나 `분석 중...` 텍스트를 표시하여 사용자에게 진행 상황을 명확히 알림.\n- 모든 로그는 정적 문자열 사용(`logger.info('Flux Agent started')`).\n- LLM 응답에서 민감 정보가 감지되면 마스킹(`redactSensitiveInfo`).\n- 네트워크/API 에러는 Notification + `Integration` 뷰의 `시스템 상태` 노드에 기록.\n- 사용자가 결과를 닫은 후에도 히스토리에서 재조회 가능.\n\n---\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 11, "total_chunks": null}}
{"id": "9bb1913b-75a0-4b4a-9239-9d41e9eb72e0", "content": "## 6. 비기능 요구사항(Non-Functional)\n- **보안**: LLM 호출에 필요한 API 키(예: OpenAI API Key)는 **사용자가 VSCode 설정 또는 SecretStorage를 통해 직접 입력하며,** 확장 프로그램은 이 키를 안전하게 저장하고 요청 시에만 사용. 로그에는 절대 노출 금지.\n- **오프라인 동작**: MCP 연결 실패 시에도 LLM 제안은 실행 가능(다만 citation 없음)하도록 degrade.\n- **성능**: Flux Agent 실행 단일 시나리오 ≤ 5초(평균) 응답을 목표.\n- **사용성**: 모든 주요 액션은 Activity Bar UI로 노출, 명령 팔레트 의존 최소화.\n- **감사 로그**: MCP 호출 파라미터 요약(민감정보 제거), LLM 호출 시간/결과 크기 기록.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 12, "total_chunks": null}}
{"id": "d7665f02-5550-4bdf-b93e-76cdad1da1a2", "content": "## 7. 기술 구성 / 아키텍처\n- **IntegrationProvider**: `TreeDataProvider` 구현, MCP 상태/제안 히스토리/시스템 상태(기존 Status 항목) 관리.\n- **MCPClient**: stdio 프로세스 래퍼, 상태 이벤트(연결/종료/에러) 발행.\n- **AgentRunner**: 프로젝트/파일 컨텍스트 수집 → MCP 호출 → LLM 프롬프트 구성 → 결과 Markdown 생성. **LLM 호출 시 VSCode 설정에 저장된 사용자의 API 키를 사용.**\n  - **프롬프트 구성 전략**: LLM 프롬프트는 `[사용자 목표]`, `[현재 파일 컨텍스트(선택 영역 우선)]`, `[MCP 분석 결과]`, `[관련 레시피]`, `[출력 형식]` 등 구조화된 섹션으로 구성하여 일관성 있는 고품질 제안을 유도.\n- **SuggestionStore**: `workspaceState` 기반 스토리지, `Results` 뷰와 연동.\n- **Webview Templates**: 기존 `wireframe` 구성요소 재활용해 제안/검색 패널 구현.", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 13, "total_chunks": null}}
{"id": "c5ab3358-2d46-469e-aad0-03ca0568310b", "content": "## 8. 구현 단계(Implementation Plan)\n1. **M0 – Integration 뷰 스켈레톤**\n   - `fluxloop.integration` 뷰 추가, MCP 상태/시스템 상태 더미 표시, 명령 버튼 배치.\n2. **M1 – MCP 연결/지식 검색**\n   - `connectMcp`, `openKnowledgeSearch` 구현, 결과를 `Results`에 저장. 시스템 상태 노드에서 MCP/CLI/Python 상태가 갱신되도록 구현.\n3. **M2 – Flux Agent 베타**\n   - LLM 호출 + MCP 연동으로 Markdown 제안 생성, Webview 템플릿 완성.\n4. **M3 – 히스토리/UX 다듬기**\n   - 최근 제안 리스트, 복사/체크 기능, 오류 처리 및 로깅 정비. 시스템 상태 알림/재시도 UX 개선.\n5. **M4 – 안정화/문서화**\n   - 사용자 가이드 업데이트, 텔레메트리(옵트인) 훅, 테스트 시나리오 정리.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 15, "total_chunks": null}}
{"id": "4fb72460-46f6-4ecc-9cbc-fe4ff31778ca", "content": "## 9. 테스트 전략\n- 단위 테스트: MCP 클라이언트 연결/에러, IntegrationProvider 상태 전파.\n- 통합 테스트: 샘플 프로젝트에 대해 Flux Agent 실행 → Webview 출력 스냅샷 비교.\n- 사용성 검증: 내부 베타(3인) 대상 워크스루, 제안만으로 수정 완료까지 소요 시간 측정.\n- 회귀: 기존 Projects/Experiments/Results 뷰가 영향받지 않는지 확인.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 16, "total_chunks": null}}
{"id": "41d45459-758b-4296-bc0b-5a99a8f4f0bf", "content": "## 10. 마일스톤 / 일정(초안)\n- **Week 1 (M0~M1)**: Integration 뷰, MCP 연결 & 검색 UI.\n- **Week 2 (M2)**: Flux Agent 기본 동작, LLM 통합(사용자 제공 OpenAI 키 기반).\n- **Week 3 (M3)**: 히스토리 UX, 오류 처리, 로깅/마스킹.\n- **Week 4 (M4)**: 문서/가이드, 베타 피드백 반영, 안정화.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 17, "total_chunks": null}}
{"id": "061e1cb6-34cd-41e9-9114-24c62724a629", "content": "## 11. 오픈 이슈\n- LLM 모델(예: gpt-5-turbo, claude-3-opus)을 사용자가 선택할 수 있도록 설정 옵션 추가.\n- 오프라인/프록시 환경에서 MCP 실행 경로 자동 탐지 방법.\n- 제안 Markdown 포맷을 git diff 형태로 확장할 필요가 있는지 여부.\n- 장기적으로 “제안 적용 도우미(코드 액션)”를 제공할지 결정 필요.\n\n---\n문서 소유: Platform 팀 / FluxLoop<br>\n최초 작성: 2025-11-07<br>\n상태: Draft v0.1\n\n\n\n\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 18, "total_chunks": null}}
{"id": "0be3ecfe-a10f-40f6-b467-6c9e0f81feb1", "content": "## 다음 단계 계획 (정리본)\n\n`fluxloop-mcp`가 PyPI에 배포된 현재, VSCode 통합 에이전트 구현은 아래 단계로 진행하면 됩니다. PRD(`docs/prd/fluxloop_vscode_integration_agent_prd.md`)의 M0~M4 마일스톤을 그대로 따라가되, 최근 변경 사항(Integration 뷰에 Status 통합 등)을 반영해 순서를 세분화했습니다.\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 19, "total_chunks": null}}
{"id": "d90aceec-df76-4b33-854f-966e3e7880c3", "content": "### 1. M0 — Integration 뷰 스켈레톤\n- `packages/vscode` 확장에 `IntegrationProvider` 추가 (`id: fluxloop.integration`)\n- 노드 구성: `MCP 연결`, `Flux Agent`, `시스템 상태(기존 Status)`, `최근 제안`\n- 뷰 상단 명령 버튼(`Connect MCP`, `Run Flux Agent`) 등록\n- 상태/히스토리 로직은 더미 데이터로 우선 표시\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 20, "total_chunks": null}}
{"id": "853c1aca-10fb-408b-bc67-01f86bbc46ff", "content": "### 2. M1 — MCP 연결 & 지식 검색\n- `fluxloop-mcp` 설치 여부 확인 → 필요 시 안내/자동 설치\n- 인덱스 빌드 워크플로 (`rebuild_index.sh`) 실행 유도\n- MCP 프로세스 실행/종료를 담당하는 `MCPClient` 구현 (stdio JSON I/O)\n- `Integration` 뷰의 `MCP 연결`/`시스템 상태` 노드에서 상태 변화를 보여주고,\n  `openKnowledgeSearch` 명령으로 `faq` 등 툴을 호출해 결과를 `Results`/`최근 제안`에 적재\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 21, "total_chunks": null}}
{"id": "c1384c36-2883-403d-8be5-feea5bb94e93", "content": "### 3. M2 — Flux Agent 베타 기능\n- `Flux Agent` 노드/버튼 → `run_integration_workflow` 호출\n- 활성 에디터/선택 영역 등 컨텍스트 수집, MCP 분석 결과와 합쳐 LLM 프롬프트 구성\n- 사용자 제공 OpenAI API 키(SecretStorage)로 LLM 호출 후 Markdown 제안 생성\n- 제안을 전용 Webview로 렌더링(앵커/코드 스니펫/체크리스트 포함)\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 22, "total_chunks": null}}
{"id": "db47176d-fa85-4fa4-9bd3-920acc6269cd", "content": "### 4. M3 — 히스토리 & UX 다듬기\n- `최근 제안` 리스트 정비, 복사/체크 박스 등 후속 액션 제공\n- `시스템 상태` 노드에 오류 메시지, 재시도 명령 연결\n- 로깅/마스킹, 비동기 작업 스피너, 알림 노출 패턴 점검\n", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 23, "total_chunks": null}}
{"id": "ad251b23-1646-4308-b3cd-b86b0680c3b1", "content": "### 5. M4 — 안정화 및 문서화\n- 사용자 가이드, 텔레메트리(옵트인) 후크, 테스트 시나리오 추가\n- 내부 베타 피드백 반영 후 안정화\n\n이 순서대로 진행하면 MCP 엔진을 활용한 VSCode 통합 에이전트를 무리 없이 구축할 수 있습니다.", "metadata": {"source": "docs/prd/agents/fluxloop_vscode_integration_agent_prd.md", "chunk_index": 24, "total_chunks": null}}
{"id": "9b34b642-825f-4a13-b273-4bb9937e1f9d", "content": "# FluxLoop Agent Service Implementation Plan\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 0, "total_chunks": null}}
{"id": "1238b685-113b-4efe-b27d-a6f06b895754", "content": "## 1. 개요\n`Runner V2`로 구축된 견고한 샌드박스 위에서 동작하는 **지능형 코딩 에이전트(Agent Service)**를 구현합니다.\n`langchain-ai/open-swe` 아키텍처를 참조하여 **LangGraph** 기반의 상태 관리와 **Multi-LLM(OpenAI, Anthropic, Gemini)** 지원을 목표로 합니다.\n\n---\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 1, "total_chunks": null}}
{"id": "69f2d94a-96a8-4065-a168-e8fb96146751", "content": "## 2. 아키텍처\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 2, "total_chunks": null}}
{"id": "ced835ec-051c-4267-88ed-36b5ec3ebe38", "content": "### 2.1 핵심 컴포넌트\n- **AgentService**: 에이전트 세션 관리 및 실행 진입점.\n- **SandboxExecutor (기존)**: 실제 파일 시스템/셸 조작을 담당하는 하위 레이어.\n- **Tool Adapter**: `SandboxExecutor` 메서드를 LangChain `Tool` 인터페이스로 변환.\n- **Agent Graph**: LangGraph로 정의된 에이전트의 사고/행동 루프.\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 3, "total_chunks": null}}
{"id": "4dc8743a-c77f-46b3-b7d3-785e98e15fb7", "content": "### 2.2 데이터 흐름\n```mermaid\ngraph TD\n    User[User / API] -->|Goal & Repo| AgentService\n    AgentService -->|Init| SandboxExecutor\n    AgentService -->|State| LangGraph\n    LangGraph -->|Reasoning| LLM[OpenAI/Claude/Gemini]\n    LLM -->|Tool Call| ToolAdapter\n    ToolAdapter -->|Action| SandboxExecutor\n    SandboxExecutor -->|Result| ToolAdapter\n    ToolAdapter -->|Observation| LangGraph\n```\n\n---\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 4, "total_chunks": null}}
{"id": "57ee3a5b-cc51-4ee7-ae9f-012fcb94a2cd", "content": "## 3. 상세 구현 계획\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 5, "total_chunks": null}}
{"id": "9c558146-46ed-467e-bc00-63304fe8fd4b", "content": "### 3.1 Dependencies 추가\n`services/web/backend/pyproject.toml`에 다음 패키지 추가:\n- `langgraph`\n- `langchain-core`\n- `langchain-openai`\n- `langchain-anthropic`\n- `langchain-google-genai` (Gemini 지원)\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 6, "total_chunks": null}}
{"id": "fdd32a07-dce4-4f84-ab5f-efed32ae4919", "content": "### 3.2 Tool Adapter (`app/services/agent/tools.py`)\n`SandboxExecutor`의 기능을 LangChain Tool로 래핑합니다.\n에이전트는 로컬 파일시스템인지 컨테이너인지 몰라도 됩니다.\n\n```python\nclass SandboxTools:\n    def __init__(self, executor: SandboxExecutor, context: WorkspaceContext):\n        self.executor = executor\n        self.context = context\n\n    @tool\n    def read_file(self, path: str):\n        \"\"\"Read file content from the sandbox.\"\"\"\n        return self.executor.read_file(self.context, path)\n        \n    @tool\n    def run_cmd(self, command: str):\n        \"\"\"Execute shell command.\"\"\"", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 7, "total_chunks": null}}
{"id": "0597bf3d-bda4-4892-9739-5462c90a499a", "content": "        return self.executor.run_command(self.context, command, ...)\n```\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 8, "total_chunks": null}}
{"id": "a7917757-d0f2-45f1-8900-10bc2457cd1c", "content": "### 3.3 Multi-LLM Router (`app/services/agent/llm.py`)\n사용자 설정이나 작업 특성에 따라 모델을 선택하는 팩토리입니다.\n\n```python\ndef get_llm(provider: str, model_name: str = None):\n    if provider == \"openai\":\n        return ChatOpenAI(model=model_name or \"gpt-4o\")\n    elif provider == \"anthropic\":\n        return ChatAnthropic(model=model_name or \"claude-3-5-sonnet-20240620\")\n    elif provider == \"gemini\":\n        return ChatGoogleGenerativeAI(model=model_name or \"gemini-1.5-pro\")\n```\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 9, "total_chunks": null}}
{"id": "a63ac417-ec93-49f8-bc98-7df9117eb622", "content": "### 3.4 ReAct Agent Graph (`app/services/agent/graph.py`)\n`langchain-code`의 `react.py`를 단순화하여 이식합니다.\n\n- **State**: `messages` (대화 기록)\n- **Nodes**:\n    - `agent`: LLM 호출 (Thought)\n    - `tools`: 도구 실행 (Action)\n- **Edges**: 도구 호출 여부에 따라 순환.\n\n---\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 10, "total_chunks": null}}
{"id": "dd4b8183-9d7f-4ab3-840b-78eafae2b741", "content": "## 4. 마일스톤\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 11, "total_chunks": null}}
{"id": "a3d6a919-4360-4981-b015-260cb60cea5d", "content": "### Phase 1: Interactive Workbench (단기) - 완료 ✅\n- [x] LLM 연동 및 Tool Adapter 구현.\n- [x] 단순 ReAct 루프: \"파일 읽어줘\" -> 읽어서 답변.\n- [x] `SandboxExecutor`를 `AgentService`에 연결.\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 12, "total_chunks": null}}
{"id": "8c44e923-55a0-42da-a42d-a57388fe5b1b", "content": "### Phase 2: Coding Workflow (중기) - 완료 ✅\n- [x] `search_replace` 도구 추가.\n- [x] **Planning Tools**: `write_todos`, `update_todo`, `list_todos` 도구 추가. (에이전트가 스스로 계획 관리)\n- [x] `Deep Agent` 아키텍처 고도화:\n  - Planner가 `plan` 상태 대신 `write_todos` 도구를 사용하여 명시적으로 계획을 파일/메모리에 기록.\n  - Executor가 `update_todo`를 호출하며 진행 상황 추적.\n- [x] 테스트 실행 결과 파싱 및 피드백 루프 (Prompt 강화).\n- [x] **Async Streaming**: `astream` 지원 및 SSE 엔드포인트 구현. (실시간 상호작용)\n", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 13, "total_chunks": null}}
{"id": "47f0765c-69df-430f-bb59-869767112dea", "content": "### Phase 3: Git Integration (장기 🚧)\n- [ ] 브랜치 생성 및 PR 자동화.\n- [ ] GitHub App 연동.", "metadata": {"source": "docs/prd/agents/implementation_plan_agent_service.md", "chunk_index": 14, "total_chunks": null}}
{"id": "7ec66b15-4b90-4dff-a347-27911a017c4e", "content": "---\ntitle: FluxLoop CLI Multi-Turn Simulation Plan\n---\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "a6621839-7b4a-43bf-bd20-5acbe69376c9", "content": "## 1. Objectives\n\n- Drive multi-turn conversational experiments purely from the CLI, without changing agent code.\n- Decide continuation vs termination by delegating to a “conversation supervisor” LLM that reviews the full transcript.\n- Keep FluxLoop tracing intact so every turn, tool call, and delegate action remains analyzable.\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "680b8519-e95a-430a-96d8-09f361100c62", "content": "## 2. Key Challenges\n\n1. **Termination detection**: agent modules do not emit explicit “end” signals. Completion must be inferred from dialogue history.\n2. **Next-input generation**: when continuation is required, the CLI needs to craft the next user utterance consistent with persona and scenario.\n3. **Experiment continuity**: all turns must execute within a single runner invocation, not as separate experiments.\n4. **Trace integrity**: multi-turn conversations cannot break the FluxLoop observation chain.\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "79583161-0d44-4f23-ac98-e7185c635bd5", "content": "## 3. High-Level Flow\n\n```\ninputs/*.yaml → ExperimentRunner → agent/tool execution (FluxLoop tracing)\n                             ↘ conversation supervisor LLM\n                                (continue? terminate?)\n```\n\n- Inputs provide initial user message, persona, and scenario metadata.\n- Runner manages the conversational loop, calling the agent on each turn.\n- After each assistant response, the runner asks the supervisor whether to continue and, if needed, for the next user message.\n- The entire conversation stays inside one `fluxloop.instrument` context.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "76f8adb0-2f23-4877-8b9c-2d1a80077e5e", "content": "## 4. Component Design\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "0e478f10-ade9-4d5a-9c0d-844aa3e69f64", "content": "### 4.1 Configuration Schema (SDK)\n\n- Extend `ExperimentConfig` with a `multi_turn` block:\n  ```yaml\n  multi_turn:\n    enabled: true\n    max_turns: 12\n    auto_approve_tools: true\n    supervisor:\n      provider: openai\n      model: gpt-5-mini\n      temperature: 0.2\n      system_prompt: |\n        You supervise an AI assistant conversation...\n  ```\n- Persona/service context continues to live in `inputs/*.yaml`; no new project-level persona registry required.\n  - Project-level `project.yaml` should include `metadata.service_context` so the supervisor has a default description of the service domain.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "ae1c2929-c64d-45b2-bfba-b44300b29131", "content": "### 4.2 Conversation Supervisor Module (CLI)\n\n- Add `fluxloop_cli/conversation_supervisor.py` that:\n  - Builds prompts from the accumulated transcript + persona metadata.\n  - Calls the configured LLM provider.\n  - Returns structured decisions:\n    ```json\n    {\n      \"decision\": \"continue\" | \"terminate\",\n      \"next_user_message\": \"...\",\n      \"termination_reason\": \"...\",\n      \"closing_user_message\": \"...\"  // optional\n    }\n    ```\n- Supervisor prompt responsibilities:\n  - Assess whether the user goal is satisfied.\n  - Produce a follow-up user message when continuation is appropriate.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "8dff64a3-f067-4abd-a654-5efc710f20c5", "content": "  - Provide closing remarks or escalation guidance when terminating.\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "103ac8ed-c5e9-436a-8bc4-e542b9ae81fa", "content": "### 4.3 ExperimentRunner Loop\n\n- Modify `_run_single` to branch on `multi_turn.enabled`.\n  - **Single-turn**: retain existing implementation.\n  - **Multi-turn**:\n    1. Initialize `conversation_state` from input metadata (initial user message, persona).\n    2. Repeat up to `max_turns`:\n       - Bind `conversation_state` + current user message into the agent call (ArgBinder enhancements).\n       - Capture assistant output, tool call metadata, and append to transcript.\n       - Flush FluxLoop buffer to persist observations.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "b0e49ab2-26d7-4126-b829-075eba0b4f8a", "content": "       - Invoke supervisor. If decision is `terminate`, exit loop (optionally append supervisor’s closing user message).\n       - Otherwise append `next_user_message` to transcript and continue.\n    3. Save the final transcript and metadata as the experiment result.\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "91b485d1-54df-4ff3-b2e7-13a7ed932633", "content": "### 4.4 Conversation State Structure\n\n```python\nconversation_state = {\n    \"turns\": [  # chronological order\n        {\"role\": \"user\", \"content\": \"...\"},\n        {\"role\": \"assistant\", \"content\": \"...\", \"tool_calls\": [...]},\n        ...\n    ],\n    \"metadata\": {\"persona\": \"...\", \"scenario\": \"...\", ...},\n    \"context\": {...}  # agent-specific scratch space\n}\n```\n\n- Shared between runner, agent, and supervisor.\n- Agents can update `context` to maintain internal state (optional).\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "b3ff8add-3154-4f0f-8734-9d1ffc45f394", "content": "### 4.5 ArgBinder Enhancements\n\n- Extend `bind_call_args` to supply:\n  - `conversation_state`\n  - `next_user_input` (string, for backward compatibility)\n  - `persona` metadata (dict)\n  - `auto_approve` flag\n- Replay mode should still function; fall back gracefully if recordings lack the new fields.\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4219601b-8db2-4ed8-98ca-7d1b1c73e941", "content": "### 4.6 Supervisor Prompt Template\n\n- Default prompt (configurable via `multi_turn.supervisor.system_prompt`):\n  ```\n  You supervise an AI assistant that helps customers with <service context>.\n  Persona: <persona description>\n  Transcript so far:\n  1. User: ...\n  2. Assistant: ...\n  ...\n\n  Decide if the conversation is complete. Respond with JSON:\n  {\n    \"decision\": \"...\",\n    \"next_user_message\": \"...\",\n    \"termination_reason\": \"...\",\n    \"closing_user_message\": \"...\"\n  }\n  ```\n- Support provider-specific message formatting (OpenAI chat, etc.).", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "6b053dff-a37e-4301-b047-b1cbae66c5f3", "content": "- `<persona description>` should come from the current input entry (e.g., `input.metadata.persona_description` or the persona object).\n- `<service context>` should first use project-level `project.metadata.service_context`. Inputs may override it via `input.metadata.service_context` if needed.\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "aab02d59-7c2b-4b82-bf94-e1997f110aaf", "content": "### 4.7 Trace Handling\n\n- Keep a single `fluxloop.instrument` context for the entire multi-turn run.\n- Add per-turn metadata (turn index, summary) for easier trace navigation.\n- Instrument supervisor LLM calls using `@fluxloop.prompt` to capture decisions.\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "fb5d7513-a2f5-4e3b-9184-c46d4bab8bcc", "content": "## 5. Implementation Steps\n\n1. **Schema & Templates**\n   - Update `packages/sdk/fluxloop/schemas/config.py` with `MultiTurnConfig`.\n   - Adjust CLI configuration templates (`simulation.yaml`) and validation.\n\n2. **Conversation Supervisor Module**\n   - Implement supervisor wrapper with pluggable LLM providers and mock mode.\n\n3. **Runner Refactor**\n   - Introduce multi-turn loop, supervisor integration, and conversation state persistence.\n   - Keep single-turn path untouched when disabled.\n\n4. **ArgBinder Update**\n   - Bind structured kwargs while maintaining compatibility with legacy signatures.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "e41551da-47fc-40b9-846f-0bdeb665b3b8", "content": "\n5. **Input Loader Update**\n   - Extract persona/service metadata from `inputs/*.yaml` and seed `conversation_state`.\n\n6. **Tracing Integration**\n   - Verify multi-turn traces show all turns/tool calls under one trace ID.\n   - Ensure supervisor prompts are recorded.\n\n7. **CLI UX**\n   - Provide CLI flags (`--multi-turn`, `--max-turns`, `--auto-approve`, `--supervisor-model`, etc.).\n   - Document required environment variables for LLM providers.\n\n8. **Testing**\n   - Unit tests for supervisor decision parsing.\n   - Integration tests using deterministic supervisor outputs to cover continue/terminate paths.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "4eac4033-7988-4f18-8d7a-aa20c597b975", "content": "   - Regression tests to confirm single-turn behavior is unchanged.\n", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "f8da1bfc-df52-444e-bfd4-a39d477673d6", "content": "## 6. Risks & Mitigations\n\n- **Incorrect termination**: Supervisor might end too early or loop indefinitely.  \n  Mitigation: prompt tuning, hard `max_turns`, logging supervisor rationale.\n\n- **Cost/latency**: Supervisor calls add overhead.  \n  Mitigation: allow scripted supervisor, caching, lightweight models.\n\n- **Agent compatibility**: Some agents may not accept structured kwargs.  \n  Mitigation: feature flag per project; provide shims.\n\n- **Trace size**: Long transcripts increase metadata volume.  \n  Mitigation: store compact summaries or truncate stored history.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "3fb34f17-2950-4183-9aad-5dea0e12c3c1", "content": "## 7. Deliverables\n\n- Updated SDK config schema + CLI templates for multi-turn configuration.\n- Conversation supervisor module with default prompts and provider integration.\n- Refactored runner capable of multi-turn loops.\n- Enhanced ArgBinder and input loaders.\n- Documentation + sample configs.\n- Automated tests verifying multi-turn flows and trace integrity.\n\n---\n\nThis document supersedes previous drafts and reflects the insight that the CLI owns conversation termination decisions by consulting an external supervisor LLM, while agents remain unchanged.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 22, "total_chunks": null}}
{"id": "fb8939f7-8135-4c61-ae79-0c72670e106f", "content": "\n가능한 수준입니다. 이미 존재하는 구성들을 확장하면 되기 때문에 “새로운 시스템”을 뜯어고치는 일은 아니에요. 다만 구현 범위가 넓으니 몇 가지 기술 포인트를 기억하면 좋겠습니다.\n\n- **구성 스키마 확장**: `ExperimentConfig`에 `multi_turn` 블록을 추가하고, `project.yaml`과 `simulation.yaml` 템플릿을 업데이트하는 일은 SDK/CLI 양쪽에서 즉시 진행할 수 있습니다. Pydantic 모델 확장과 템플릿 수정 정도라 복잡도는 낮습니다.\n\n- **대화 감독자 LLM 모듈**: 이미 `llm_generator.py`에서 외부 LLM 호출을 다루고 있으니, 비슷한 래퍼를 만들어 transcript를 넣고 JSON 응답을 파싱하게 하면 됩니다. 프롬프트 설계와 응답 validation만 신경 쓰면 되고, mock 모드도 쉽게 붙일 수 있습니다.\n\n- **Runner 리팩터링**: 여기가 주된 작업입니다. `_run_single`에 “턴 루프”를 추가하고, 기존 단일 턴 흐름과 feature flag로 분기하면 됩니다. 구성 요소가 많으니 테스트를 잘 쌓아야 하지만 구조적으로 막히는 부분은 없습니다.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 23, "total_chunks": null}}
{"id": "374249c8-6d6b-419e-b053-b20998a62708", "content": "\n- **ArgBinder 개선**: 새 kwarg(`conversation_state`, `auto_approve` 등)를 허용하도록 확장하고 기존 경로와 호환을 유지하면 됩니다. replay 모드만 주의하면 구현 난이도는 중간 정도입니다.\n\n- **Input 로더/메타데이터**: `inputs/*.yaml`에서 persona/서비스 정보를 읽어 초기 state를 만드는 정도라 구현 부담이 크지 않습니다.\n\n- **Tracing**: 이미 FluxLoop가 컨텍스트 기반으로 동작하고 있으니, 동일 컨텍스트를 유지한 채 턴 반복만 해도 도구/하위 에이전트 trace가 그대로 붙습니다. 필요하면 supervisor 호출도 `@fluxloop.prompt`로 감싸면 됩니다.\n\n- **테스트/UX**: 옵션 추가, 문서, 회귀 테스트까지 포함하면 다소 시간이 들지만 전부 기존 코드 패턴을 따라가면 되는 작업입니다.\n\n즉, 전체적인 난이도는 “대규모 리팩터링”이라기보단 “여러 파트를 고쳐야 하는 중간 난이도 과제”에 가깝습니다. 모듈별로 잘게 나눠서 진행하면 현실적으로 구현 가능합니다.", "metadata": {"source": "docs/prd/agents/multi_turn_simulation_cli_plan.md", "chunk_index": 24, "total_chunks": null}}
{"id": "bad7a01d-7a53-431d-9492-540afa96e168", "content": "## FluxLoop VSCode Extension 기획서 (Full Draft)\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 0, "total_chunks": null}}
{"id": "682347c8-2e3f-4602-bd79-a2f3a441e941", "content": "### 1. 목표와 범위\n- **핵심 목표**: FluxLoop CLI 기반 실험 워크플로우를 VSCode 환경에서 GUI로 완결성 있게 지원\n- **범위**: Init → Record → Input Generation → Experiment → Parse → Evaluate 전체 플로우와 관련 설정, 결과 분석, 상태 모니터링 UX\n- **성공 지표**  \n  - 프로젝트/실험 생성에 CLI 대비 걸리는 시간 50% 감소  \n  - 입력 변주 생성 시 재실행 없이 Wizard 완료율 90% 이상  \n  - 실험 실행/결과 파이프라인을 VSCode 내에서만 완료하는 사용자 비율 80% 이상  \n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 1, "total_chunks": null}}
{"id": "d8ff9959-ea18-4b68-a1f5-a6a081f2a144", "content": "### 2. 사용자 및 환경 가정\n- **주 사용자**: AI 에이전트 실험을 반복 수행하는 ML 엔지니어, 프로덕트 매니저, QA 리서처\n- **환경**: VSCode Desktop/Dev Container, MacOS/Linux/Windows; FluxLoop CLI/SDK 설치 가능\n- **UX 원칙**: 단계별 가이드, 상태 투명성, 신속한 반복, CLI 명령과의 대응성 유지, 백업(실패 시 CLI 안내)\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 2, "total_chunks": null}}
{"id": "8f64fcb0-a27d-40cc-ac01-8ac91207e0fb", "content": "### 3. 전체 워크플로우\n0. **Project Discovery**: 기존 FluxLoop 프로젝트 선택 또는 신규 생성 경로 진입\n1. **Init**: 프로젝트 초기화, 설정 파일 생성 (`fluxloop init project`)\n2. **Record**: 에이전트 로직 단일 실행 및 입력/출력 기록\n3. **Input Generation**: Base Inputs + Personas + Variation strategies 기반 변주 입력 생성 (`fluxloop generate inputs`)\n4. **Experiment**: 실험 실행 및 진행 모니터링 (`fluxloop run experiment/single`)\n5. **Parse**: 결과 Markdown 변환 (`fluxloop parse experiment`)\n6. **Evaluate**: 성능 지표/비교(향후 추가)\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 3, "total_chunks": null}}
{"id": "533214d7-6768-4988-a980-3b5f097a9fe6", "content": "### 4. 정보 구조 및 주요 화면\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 4, "total_chunks": null}}
{"id": "8935bada-dddd-4232-9bcf-065da868a0b5", "content": "#### 4.1 상위 탐색 구조\n```\nFluxLoop\n├── 📁 Projects (프로젝트 선택/생성 중심)\n│   ├── Create New Project…\n│   ├── Add Existing Project…\n│   └── <project-name> (Active)\n│       ├── Open in VSCode (current/new window)\n│       ├── Configure Project\n│       ├── Run Experiment\n│       └── Remove from List\n├── 📝 Inputs (Base, Generated)\n│   ├── Base Inputs\n│   ├── Generated Inputs\n│   └── Generate New Inputs\n├── 🧪 Experiments (활성 프로젝트 기준)\n│   ├── Current Experiment (configs/simulation.yaml)\n│   │   ├── Configuration\n│   │   ├── Personas (2)\n│   │   ├── Variation Strategies", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 5, "total_chunks": null}}
{"id": "1dcf6677-9e32-40b4-ad94-88c84d26792e", "content": "│   │   └── Run Experiment\n│   └── Results (최근 실행 기록)\n│       ├── experiment_20241201_143022\n│       │   ├── summary.json\n│       │   ├── traces.jsonl\n│       │   └── Parse Results\n│       └── ...\n├── 📊 Results (실험별 결과 분석)\n└── ℹ️ Status (시스템 상태)\n    ├── Active Project\n    ├── CLI 상태\n    ├── SDK 상태\n    ├── Collector 상태\n    └── 기타 진단 정보\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 6, "total_chunks": null}}
{"id": "5c5ceafa-df4d-4151-a875-aad3c72fb957", "content": "#### 4.2 탐색 경로\n- Projects 패널에서 프로젝트 생성/추가 → 활성 프로젝트 설정 → Inputs 패널에서 입력 데이터 준비 → Experiments 패널에서 실험/Record Mode 제어 → Results 뷰 분석\n- Explorer context menu: 프로젝트/설정 파일(simulation.yaml 등) → Run/Generate/Parse 명령\n- Command Palette: `FluxLoop: Switch Project`, `FluxLoop: Create Project` 등 모든 핵심 명령 노출\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 7, "total_chunks": null}}
{"id": "d309ed60-d09a-4764-9391-d441f534384c", "content": "### 5. 주요 UX 플로우 상세\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 8, "total_chunks": null}}
{"id": "3a4d1d4e-56e1-4127-9a3d-01f006c9da70", "content": "#### 5.1 Project Lifecycle Flow\n- **Entry**: `Projects` 패널 “Create Project” / “Add Existing Project” 또는 Command Palette `FluxLoop: Create Project`\n- **UI 단계 (신규 생성)**\n  1. 프로젝트 루트 폴더 선택 (기본 제안: 현재 Workspace 또는 신규 경로)\n  2. 프로젝트명 입력 (기본: 폴더명)\n  3. 예제 에이전트 포함 여부 선택\n  4. `fluxloop init project` 실행 (진행률/로그 표시)\n  5. 초기 구성 요약 표시 (`configs/project.yaml`, `configs/input.yaml`, `configs/simulation.yaml`, `configs/evaluation.yaml` 위치 안내)\n  6. 프로젝트 목록에 등록 → 활성 프로젝트로 설정 → “Open in VSCode” 옵션 제공 (현재 창 / 새 창)\n- **UI 단계 (기존 프로젝트 추가)**", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 9, "total_chunks": null}}
{"id": "aae4917b-fe68-49f3-b7fb-660611307b41", "content": "  1. FluxLoop 프로젝트 루트 선택 (`configs/` 디렉터리 검증)\n  2. 메타데이터 요약 및 활성화 여부 선택\n  3. 프로젝트 목록에 등록\n- **예외 처리**: CLI 미설치 시 설치 가이드 prompt, `configs/` 구조 누락 시 오류 안내 및 해결 가이드 링크\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 10, "total_chunks": null}}
{"id": "f8085785-4a7e-49f8-8eb9-71ee67d9afce", "content": "#### 5.1.1 Project Selection & Context\n```\n1. Projects 패널에서 프로젝트 생성 또는 기존 프로젝트 추가\n   ↓\n2. 프로젝트 항목에서 “Set Active Project” 실행 → Status Bar에 표시\n   ↓\n3. Experiments/Inputs/Results/Status 패널이 활성 프로젝트 기준으로 데이터 표시\n   ↓\n4. Command Palette, Explorer context menu가 선택된 프로젝트 컨텍스트에 맞게 동작\n```", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 11, "total_chunks": null}}
{"id": "a55ba0e3-356d-4d53-9826-31c914fb101d", "content": "#### 5.2 Configuration Overview\n- 설정 파일을 역할별로 분리하여 관리 (v0.2.0)\n  - `configs/project.yaml`: 프로젝트 메타데이터, Collector URL, 공용 환경 변수\n  - `configs/input.yaml`: 페르소나, 베이스 인풋, 변주 전략, LLM 설정\n  - `configs/simulation.yaml`: 반복 횟수, runner.module_path/function_name, 실행 환경, 레코딩 토글\n  - `configs/evaluation.yaml`: 평가 지표 및 LLM Judge 설정\n- VSCode 각 패널에서 해당 설정 파일을 열 수 있는 CTA 제공 (Inputs → `configs/input.yaml`, Experiments → `configs/simulation.yaml`)\n- 신규 프로젝트는 자동으로 위 구조를 생성하며, 기존 프로젝트 마이그레이션 기능은 추후 제공 예정\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 12, "total_chunks": null}}
{"id": "541f32c5-7266-4852-b3ee-8c41564a4520", "content": "#### 5.3 Input Generation Wizard\n- **Entry**: `Inputs` 패널 \"Generate\" CTA / Explorer context menu\n- **단계 구성**\n  1. **모드 선택**: Deterministic / LLM (LLM Provider/Model/API Key 설정)\n  2. **Personas 선택**: `configs/input.yaml`의 정의를 기반으로 전체/부분 선택\n  3. **Variation Strategies**: 체크박스 + 설명 툴팁, 커스텀 전략 입력\n  4. **제한/출력 설정**: Limit, Output file, Overwrite 여부\n  5. **요약/미리보기**: CLI 명령 프리뷰, 예상 결과 목록 브리프\n- **실행**: `fluxloop generate inputs` 호출 (Progress + Output). 성공 시 `Generated Inputs` 트리 갱신, 결과 파일 자동 오픈\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 13, "total_chunks": null}}
{"id": "71649877-eed7-4a2b-8598-242bdfab95a6", "content": "#### 5.3.1 입력 데이터 준비 플로우\n```\n1. Inputs 패널에서 \"Base Inputs\" 확인/편집 (configs/input.yaml 열기)\n   ↓\n2. \"Generate New Inputs\" 클릭\n   ↓\n3. 입력 생성 다이얼로그:\n   - Mode: Deterministic / LLM\n   - Strategies: rephrase, verbose, error_prone (체크박스)\n   - Limit: 숫자 입력\n   ↓\n4. 생성된 입력 미리보기 및 확인\n   ↓\n5. configs/input.yaml의 기본 경로에 맞춰 inputs/generated.yaml 저장\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 14, "total_chunks": null}}
{"id": "33976e8d-d9db-4e97-9e07-d70435bab1ed", "content": "#### 5.4 Experiment Execution\n- **Entry**: `Experiments` 패널 \"Run Experiment\" / `Run Single` / context menu\n- **옵션 다이얼로그**\n  - Iterations, Personas 선택(멀티), Dry Run, No Collector\n  - Config/Project/Root 경로 지정\n  - Output 디렉터리\n  - 실행 환경(Local/Docker/Dev Container) → Docker 미구현 시 안내\n- **실행 UX**\n  - 진행률 Notification (`withProgress`), 취소 가능\n  - 실시간 로그 Output Channel, 주요 상태 카드(총 runs, 완료율, 예상 시간)\n  - 완료 후 `Results` 패널 자동 리프레시, summary 카드 띄우기\n- **실패 시**: 오류 메시지 + 해결 가이드, CLI 명령 토스트\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 15, "total_chunks": null}}
{"id": "970e504a-9eef-4c9f-a2b2-5fec0ebd287d", "content": "#### 5.4.1 Record Mode (선택적)\n- **Entry**: `Experiments` 패널 상단 CTA 또는 Command Palette `FluxLoop: Enable Recording`\n- **활성화 절차**\n  1. `.env`와 `configs/simulation.yaml`에 `FLUXLOOP_RECORD_ARGS=true`, `replay_args.recording_file` 등 설정 자동 반영\n  2. 실험 실행 관련 CTA 비활성화 및 “이제 서비스/에이전트를 직접 실행해 인자를 기록하세요” 안내 배너 노출\n  3. 사용자 서비스 동작 중 레코딩 파일이 생성되면 알림 표시, 최신 파일을 Experiments 패널에서 미리 확인 가능\n- **비활성화 절차**\n  1. 토글 OFF 또는 `FluxLoop: Disable Recording` 실행 시 `.env`/`configs/simulation.yaml` 원복\n  2. 레코딩 파일 열기/삭제/재생성 옵션 제공, `replay_args` 설정으로 연결 안내", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 16, "total_chunks": null}}
{"id": "2bd27619-0444-4b2b-ba7c-2fd75d89c174", "content": "- **주의**: 복잡한 인자 재사용이 필요한 시나리오에서만 사용하도록 가이드 언어 유지\n\n- **CLI 연계**: `fluxloop record enable/disable/status`가 동일 기능 제공, VSCode 명령은 CLI를 래핑하여 실행\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 17, "total_chunks": null}}
{"id": "b692c4af-891e-4a06-9669-54354d811137", "content": "#### 5.4.2 실험 실행 플로우\n```\n1. Experiments 패널에서 \"Run Experiment\" 클릭\n   ↓\n2. 실행 옵션 다이얼로그:\n   - Iterations: 숫자 입력\n   - Personas: 선택 (기본값: 모두)\n   - Dry Run: 체크박스\n   - No Collector: 체크박스\n   - Output Directory: 폴더 선택\n   ↓\n3. 실행 확인 다이얼로그 (총 실행 횟수 표시)\n   ↓\n4. 진행률 표시 및 실시간 로그\n   ↓\n5. 완료 후 Results 패널 자동 갱신\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 18, "total_chunks": null}}
{"id": "68322210-200d-4155-ad71-8842fdfe87b7", "content": "#### 5.5 Parse Results\n- **Entry**: `Results` 패널 실험 노드 → \"Parse to Markdown\"\n- **설정**: Output 디렉터리, Overwrite 선택\n- **CLI 실행**: `fluxloop parse experiment`\n- **결과**: Markdown 파일 생성 후 첫 파일 자동 오픈, 결과 요약 카드 제공\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 19, "total_chunks": null}}
{"id": "a1f468a1-1140-417a-b029-f42eb475a9d3", "content": "#### 5.5.1 결과 분석 플로우\n```\n1. Results 패널에서 완료된 실험 선택\n   ↓\n2. \"Parse Results\" 클릭\n   ↓\n3. 파싱 옵션:\n   - Output Directory: per_trace_analysis\n   - Overwrite: Yes/No\n   ↓\n4. 생성된 Markdown 파일들 자동 열기\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 20, "total_chunks": null}}
{"id": "81028f6d-4a0f-4314-a3c9-8b7a4c67d789", "content": "#### 5.6 Evaluate (TBD)\n- **단계**: 차트/메트릭 계획 수립, CLI/SDK 제공 기능 확장 시 연계\n- **현재**: \"Coming soon\" 안내와 피드백 수집 링크\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 21, "total_chunks": null}}
{"id": "b76272c2-29e4-4447-ba96-0e86e406e466", "content": "### 5.7 GUI 기반 설정 편집기 (Webview)\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 22, "total_chunks": null}}
{"id": "e88960ed-5002-4691-b8fe-c3d469c1a384", "content": "#### 5.7.1 설정 편집기 구조\n```typescript\ninterface ExperimentConfigEditor {\n  // 기본 정보\n  name: string;\n  description: string;\n  version: string;\n  \n  // 시뮬레이션 설정\n  iterations: number;\n  parallelRuns: number;\n  seed?: number;\n  \n  // Personas 관리\n  personas: PersonaConfig[];\n  \n  // Base Inputs 관리\n  baseInputs: BaseInput[];\n  \n  // Variation 설정\n  variationStrategies: VariationStrategy[];\n  variationCount: number;\n  \n  // Runner 설정\n  runner: RunnerConfig;\n  \n  // Evaluators\n  evaluators: EvaluatorConfig[];\n}\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 23, "total_chunks": null}}
{"id": "b6eb3fab-0af5-469a-bb49-79dcb942ec37", "content": "#### 5.7.2 Persona 편집기\n```typescript\ninterface PersonaEditor {\n  name: string;\n  description: string;\n  characteristics: string[];\n  language: string;\n  expertiseLevel: 'novice' | 'intermediate' | 'expert';\n  goals: string[];\n}\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 24, "total_chunks": null}}
{"id": "203fdc15-e3c0-4587-889c-b371ee53e00c", "content": "#### 5.7.3 Base Input 편집기\n```typescript\ninterface BaseInputEditor {\n  input: string;\n  expectedIntent?: string;\n  metadata?: Record<string, any>;\n}\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 25, "total_chunks": null}}
{"id": "a4f22503-87ac-42a2-9d92-135b39d9193e", "content": "### 6. 상세 기능 사양\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 26, "total_chunks": null}}
{"id": "d2aa068a-9f95-4e44-b775-c1b949c828b2", "content": "#### 6.1 Tree Providers\n- `ProjectsProvider`: 프로젝트 목록 관리, 생성/추가/선택/삭제 액션 지원 (configs/ 존재 여부 포함)\n- `ExperimentsProvider`: `configs/simulation.yaml` 요약, 최근 실행 히스토리, Record Mode 상태/토글 관리\n- `InputsProvider`: Base Inputs(`configs/input.yaml`)와 Generated Inputs 목록, `.env`/recordings 연동\n- `ResultsProvider`: experiments 디렉터리 감시, summary.json/trace files, parse 버튼\n- `StatusProvider`: CLI/SDK/Collector 상태 체크, 문제 시 해결 링크\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 27, "total_chunks": null}}
{"id": "e07e1baa-33fa-40e3-b703-d5f79a9f745a", "content": "#### 6.2 Webview/패널\n- Config Editor Webview: setting.yaml GUI 편집(Phase 2)\n- Input Previewer: Generated inputs 결과 리스트, 필터링/다운로드\n- Results Viewer: Trace timeline, metrics 시각화(Phase 3)\n- Evaluate Dashboard: 메트릭/히트맵/비교 그래프(Phase 3+)\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 28, "total_chunks": null}}
{"id": "9b77ffc7-eba6-4cbf-a625-a37588ae00bb", "content": "#### 6.3 명령어/CLI 매핑\n- `fluxloop.createProject` → `init project`\n- `fluxloop.addProject` → 기존 프로젝트 등록\n- `fluxloop.runExperiment` → `run experiment` (옵션 매핑)\n- `fluxloop.runSingle` → `run single`\n- `fluxloop.enableRecording` / `fluxloop.disableRecording`(신규) → `.env` 기반 Record Mode 토글 (CLI `record enable/disable` 연계)\n- `fluxloop.switchProject` → 활성 프로젝트 변경\n- `fluxloop.generateInputs`(신규) → `generate inputs`\n- `fluxloop.parseExperiment`(신규) → `parse experiment`\n- `fluxloop.openConfig` → simulation.yaml (실험 설정) 열기/편집기\n- `fluxloop.selectEnvironment` → config `defaultEnvironment` 업데이트", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 29, "total_chunks": null}}
{"id": "67ac51ba-49e5-4174-a3b0-99b7da62a311", "content": "- 향후: `fluxloop.evaluate` → TBD CLI/SDK\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 30, "total_chunks": null}}
{"id": "3ef7580f-f214-4ba6-809f-5275dbab5e59", "content": "### 7. 상태/피드백 디자인\n- **Empty States**: 각 패널에서 단계별 온보딩 메시지 + CTA + 문서 링크\n- **Success**: Toast + 패널 이동/콘텐츠 하이라이트\n- **Error**: 원인 요약 + 조치 방안 + CLI 로그 링크\n- **Progress**: Notification + Output Channel + 패널 내 상태 배지\n- **Language**: 영어 only UX\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 31, "total_chunks": null}}
{"id": "34dc0b55-8e43-4c98-90ed-b3bd0b9457f8", "content": "### 8. 기술 고려 사항\n- CLI 설치 확인 → CLIManager.checkInstallation, 필요 시 pip/pipx 설치 가이드\n- Docker 실행 지원 → 컨테이너 이미지/볼륨 설계 후 `runInDocker` 구현\n- Dev Container 환경 → REMOTE_CONTAINERS 변수 체크 후 일반 실행\n- File watcher: `configs/**`, `.env`, `inputs/**`, `recordings/**`, `experiments/**` 감시 (Record Mode/결과 반영)\n- Telemetry: 명령 사용 현황, 실패율, 입력 생성 건수(Privacy 고려)\n- 성능: Webview 자산 lazy load, 파일 파싱 캐싱\n- 접근성: 키보드 탐색, 스크린리더 호환, 색 대비\n- 보안: API Key 입력 시 SecretStorage 활용, 출력 로그 마스킹\n- `.env` 편집/동기화 정책 (CLI/VSCode Record Mode 명령 간 상태 일관성 유지)\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 32, "total_chunks": null}}
{"id": "e6f3469a-883a-4776-80e0-68cbc8a54155", "content": "### 9. 개발 로드맵 (Phase 기반)\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 33, "total_chunks": null}}
{"id": "b97ad97e-59ca-49f1-bad1-5bc06ee34624", "content": "#### Phase 0: Project 기반 구조 구축 (1-2주)\n1. **Project Manager 도입**\n   - 프로젝트 메타데이터(경로, 이름, 최근 실행 등) 저장/관리\n   - 활성 프로젝트 컨텍스트 제공 (상태바, providers, CLI 명령과 연동)\n\n2. **Projects View 구현**\n   - 프로젝트 생성/추가/선택/삭제 UI\n   - 초기 상태에서 프로젝트 온보딩 카드 제공\n   - 프로젝트별 Quick Actions (Open, Configure, Run 등)\n\n3. **기존 Providers 연계**\n   - `Experiments/Inputs/Results/Status`가 활성 프로젝트 기준으로 동작하도록 리팩터링\n   - 활성 프로젝트 없을 때 CTA 표시\n\n4. **문서/가이드 업데이트**\n   - 프로젝트 기반 워크플로우 명시 (README, guides, Status 패널 안내)\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 34, "total_chunks": null}}
{"id": "bdbedd10-0410-4461-abf0-0542aedb47b6", "content": "#### Phase 1: 핵심 실험 플로우 확장 (1-2주)\n1. **명령어 추가/확장**\n   - `fluxloop.generateInputs`: 입력 생성 다이얼로그\n   - `fluxloop.parseExperiment`: 결과 파싱\n   - `fluxloop.runExperiment`: 고급 옵션 확장\n\n2. **Tree Provider 고도화**\n   - `ExperimentsProvider`: 실험 상세 정보/히스토리\n   - `InputsProvider`: Base/Generated/Recording 구조화\n   - `StatusProvider`: CLI/SDK 상태 + 문제 해결 가이드\n\n3. **메뉴 컨텍스트 추가**\n   - Explorer: 프로젝트/setting.yaml 우클릭 → Create/Run/Parse/Generate\n   - Command Palette: Projects/Switch/Record 관련 명령 정비\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 35, "total_chunks": null}}
{"id": "99943234-6eef-4408-b243-bd325696df03", "content": "#### Phase 2: GUI 기반 설정 편집 (2-3주)\n1. **Webview 기반 설정 편집기**\n   - `setting.yaml` 시각적 편집\n   - Persona 추가/편집/삭제\n   - Base Input 추가/편집/삭제\n   - Variation Strategy 설정\n\n2. **입력 생성 마법사**\n   - 단계별 입력 생성 가이드\n   - 생성된 입력 미리보기\n   - 설정 저장 및 적용\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 36, "total_chunks": null}}
{"id": "b1755c6c-c40e-46a5-ba62-f1ecc4e95e7a", "content": "#### Phase 3: 고급 기능 (3-4주)\n1. **실시간 모니터링**\n   - 실험 진행률 표시\n   - 실시간 로그 스트리밍\n   - 취소 기능\n\n2. **결과 분석 도구**\n   - Trace 분석 뷰어\n   - 성능 메트릭 차트\n   - 비교 분석 기능\n\n3. **Docker/Dev Container 지원**\n   - 환경별 실행 옵션\n   - 컨테이너 설정 관리\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 37, "total_chunks": null}}
{"id": "1503bb90-f918-4cd9-a3ab-b93ff5d01044", "content": "#### Phase 4: 후속 개선 (후속)\n- 템플릿/자동화, 단축키, 협업 기능\n- 사용자 피드백 기반 UX 개선\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 38, "total_chunks": null}}
{"id": "7663cf87-0e95-4940-bf13-f5f0e6fec4c4", "content": "### 10. 기술적 구현 세부사항\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 39, "total_chunks": null}}
{"id": "fa050ee3-ca03-459e-838e-a12844c5a47f", "content": "#### 10.1 Webview 기반 설정 편집기\n```typescript\n// extension.ts\nexport class ConfigEditorProvider {\n  private _panel: vscode.WebviewPanel | undefined;\n  \n  createOrShow() {\n    if (this._panel) {\n      this._panel.reveal(vscode.ViewColumn.One);\n    } else {\n      this._panel = vscode.window.createWebviewPanel(\n        'fluxloopConfigEditor',\n        'FluxLoop Configuration',\n        vscode.ViewColumn.One,\n        {\n          enableScripts: true,\n          localResourceRoots: [vscode.Uri.joinPath(this.context.extensionUri, 'media')]", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 40, "total_chunks": null}}
{"id": "4effc846-949e-49d2-bfed-4b1fcc10538f", "content": "        }\n      );\n      \n      this._panel.webview.html = this.getHtmlForWebview();\n      this._panel.onDidDispose(() => this._panel = undefined);\n    }\n  }\n}\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 41, "total_chunks": null}}
{"id": "2f6b4e59-f627-4b9f-9ee8-2c2c4f2c76a7", "content": "#### 10.2 실시간 진행률 표시\n```typescript\n// commandManager.ts\nprivate async runExperimentWithProgress() {\n  return vscode.window.withProgress({\n    location: vscode.ProgressLocation.Notification,\n    title: \"Running FluxLoop Experiment\",\n    cancellable: true\n  }, async (progress, token) => {\n    // CLI 실행 및 진행률 업데이트\n    const process = spawn('fluxloop', args, { cwd: workspaceFolder });\n    \n    process.stdout.on('data', (data) => {\n      // 진행률 파싱 및 업데이트\n      const progressMatch = data.toString().match(/(\\d+)%/);\n      if (progressMatch) {", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 42, "total_chunks": null}}
{"id": "f8ca5240-b92a-479d-ab9d-fb3e931a3220", "content": "        progress.report({ increment: parseInt(progressMatch[1]) });\n      }\n    });\n    \n    token.onCancellationRequested(() => {\n      process.kill();\n    });\n  });\n}\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 43, "total_chunks": null}}
{"id": "c4b7c088-74c8-417b-bf35-b3bc99ad7892", "content": "#### 10.3 결과 분석 뷰어\n```typescript\n// resultsViewer.ts\nexport class ResultsViewer {\n  private _panel: vscode.WebviewPanel;\n  \n  showTraceAnalysis(traceId: string) {\n    // Trace 상세 정보 표시\n    // Timeline 시각화\n    // Input/Output 비교\n  }\n  \n  showPerformanceMetrics(experimentDir: string) {\n    // 성공률 차트\n    // 응답시간 분포\n    // 에러 분석\n  }\n}\n```\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 44, "total_chunks": null}}
{"id": "7fc2531a-35c2-4e79-8fe3-e61f559295e6", "content": "### 11. 사용자 경험 개선 포인트\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 45, "total_chunks": null}}
{"id": "cefaf6e6-ed00-4d81-a5b6-45b569ad4cbf", "content": "#### 11.1 직관적인 워크플로우\n- **단계별 가이드**: 각 단계에서 다음 단계 안내\n- **상태 표시**: 현재 진행 상황 명확히 표시\n- **오류 처리**: 친화적인 오류 메시지 및 해결 방법 제시\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 46, "total_chunks": null}}
{"id": "b064de1b-bd8f-40c0-abcd-d421653683b8", "content": "#### 11.2 시각적 피드백\n- **아이콘 및 색상**: 상태별 시각적 구분\n- **진행률 표시**: 실시간 진행 상황 표시\n- **결과 시각화**: 차트 및 그래프로 결과 표현\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 47, "total_chunks": null}}
{"id": "31fc13d4-1968-4e08-a594-5daed24e6f2b", "content": "#### 11.3 효율성 향상\n- **단축키**: 자주 사용하는 기능에 단축키 제공\n- **템플릿**: 자주 사용하는 설정 템플릿 제공\n- **자동화**: 반복 작업 자동화\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 48, "total_chunks": null}}
{"id": "605feb13-ee8d-4d8c-acf1-3673c73f917d", "content": "### 12. 테스트/검증 전략\n- 유닛 테스트: Command/Provider, CLI 매핑, Webview message 핸들러\n- 통합 테스트: VSCode Test Runner로 흐름별 시나리오\n- 사용자 검증: ML 엔지니어 대상 워크스루, Wizard 사용성 테스트\n- 회귀: CLI 버전 업데이트 시 호환성 점검\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 49, "total_chunks": null}}
{"id": "6d581f8d-fe80-4038-a1b9-48672aab5fb6", "content": "### 13. 리스크 및 대응\n- **CLI 변경**: 명령/옵션 스키마 변경 시 UI 영향 → 버전 체크, 호환성 레이어\n- **LLM 의존 옵션**: API Key 미보유 사용자 → 안내 및 문서 링크\n- **대용량 결과**: Markdown/Trace 파일 다수 → 리스트 가상화, lazy load\n- **Docker 권한 문제**: 에러 핸들링 및 Troubleshooting 문서 제공\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 50, "total_chunks": null}}
{"id": "6a4b1fd5-5092-4b98-98f4-571f39a3e5e1", "content": "### 14. 오픈 이슈\n- Evaluate 단계 구체 요구사항 (메트릭 정의, 비교 기준)\n- Recording 플로우에 필요한 SDK 변경 여부\n- Config GUI 편집기와 YAML 직접 편집 간 충돌 해결 전략\n- 멀티 워크스페이스(Workspace Folder 여러 개) 지원 범위\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 51, "total_chunks": null}}
{"id": "e628e364-dacf-4877-8e32-11d2d537e07f", "content": "### 15. 와이어프레임 작업 계획\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 52, "total_chunks": null}}
{"id": "582587d4-aece-4c03-9cd2-ad845f6e4360", "content": "#### 15.1 와이어프레임 범위\n- **Activity Bar 패널들**: Projects, Experiments, Inputs, Personas, Results, Status의 트리 구조 및 카드 레이아웃\n- **주요 다이얼로그**: Init Project, Generate Inputs Wizard, Run Experiment Options, Parse Results\n- **Webview 패널들**: Config Editor, Input Previewer, Results Viewer의 기본 레이아웃\n- **상태별 UI**: Empty States, Loading States, Error States, Success States\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 53, "total_chunks": null}}
{"id": "3e9fcc93-928e-464b-a2aa-2e44a07aa3f3", "content": "#### 15.2 와이어프레임 제작 도구\n- **Figma**: 주요 와이어프레임 및 프로토타입 제작\n- **Whimsical**: 플로우 다이어그램 및 사용자 여정 맵\n- **VSCode Extension UI Kit**: VSCode 네이티브 컴포넌트 활용\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 54, "total_chunks": null}}
{"id": "c59c24ef-e81e-480d-a51c-b439238cfaeb", "content": "#### 15.3 와이어프레임 우선순위\n1. **Phase 1**: Experiments, Inputs, Results 패널 기본 구조\n2. **Phase 2**: Generate Inputs Wizard, Config Editor Webview\n3. **Phase 3**: Results Viewer, Trace Analysis, Performance Metrics\n", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 55, "total_chunks": null}}
{"id": "e70bcc75-d6c5-4310-805f-37ed5cf44a2e", "content": "#### 15.4 검증 방법\n- **내부 리뷰**: 개발팀 내 UX/UI 검토\n- **사용자 테스트**: ML 엔지니어 대상 프로토타입 테스트\n- **반복 개선**: 피드백 기반 와이어프레임 수정\n\n---\n\n이 기획서는 CLI 기능을 GUI로 확장하면서도 FluxLoop의 핵심인 Input Variation 기반 시뮬레이션 워크플로우를 유지합니다. 단계별 구현으로 점진적으로 기능을 확장할 수 있으며, 와이어프레임 작업을 통해 구체적인 UI/UX 설계를 진행할 수 있습니다.", "metadata": {"source": "docs/prd/codex_vscode_extention.md", "chunk_index": 56, "total_chunks": null}}
{"id": "76d2bb41-2c21-4de8-8912-0b8c92541c35", "content": "# FluxLoop 환경 구성 전략 PRD\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 0, "total_chunks": null}}
{"id": "1ea23827-9654-4346-b7d4-a99aba5e92f0", "content": "## 배경\n- FluxLoop CLI·MCP·VSCode 확장은 Python 실행 환경에 강하게 의존한다.\n- 현재는 `fluxloop`/`fluxloop-mcp`가 PATH에 노출되어 있어야 정상 동작하지만, 사용자마다 `pip`, `pipx`, `uv`, `conda`, 가상환경 구조가 다양해 설치 경로가 통일되지 않는다.\n- 실험(Experiment run) 및 MCP 워크플로는 **프로젝트별 의존성**을 그대로 사용해야 일관된 결과를 보장할 수 있다.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 1, "total_chunks": null}}
{"id": "70e0abd5-c238-4406-906b-2f73cfe02b0a", "content": "## 목표\n1. FluxLoop 도구가 **프로젝트 환경에 맞춰 자동으로** 설치·실행되도록 가이드라인과 제품 기능을 확립한다.\n2. VSCode 확장/CLI가 **현재 사용 중인 Python 환경을 인식**하고, 사용자에게 명확하게 보여준다.\n3. 글로벌 설치와 프로젝트 전용 설치를 명확히 구분하여, 사용자가 왜 동작하지 않는지 혼동하지 않도록 한다.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 2, "total_chunks": null}}
{"id": "618e73dd-4d90-4776-895c-1dbb93b2dc9f", "content": "## 성공 지표\n- FluxLoop Output 채널에서 현재 Python·CLI·MCP 경로를 확인할 수 있고, 향후 `fluxloop doctor` 명령으로 동일 정보를 제공한다.\n- VSCode에서 FluxLoop 명령을 실행했을 때 프로젝트 가상환경이 자동 선택되거나, 사용자 설정으로 경로 지정이 가능하다.\n- 신규 사용자 온보딩 문서를 따라 했을 때 `fluxloop-mcp` 인식 오류를 재현하기 어려울 정도로 가이드가 단순해진다.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 3, "total_chunks": null}}
{"id": "4d554055-aa7a-4d2a-a95e-6d4603c415b0", "content": "## 페르소나 & 시나리오\n- **프로덕션 개발자**: 회사 레포지토리에서 conda 환경을 사용. FluxLoop를 추가로 설치했을 때 별도 PATH 조정 없이 바로 동작하길 기대.\n- **오픈소스 기여자**: pipx/uv 등으로 여러 버전을 관리. 프로젝트별로 FluxLoop 버전을 고정하고 싶어 함.\n- **VSCode 사용자**: IDE에서만 작업하며 CLI를 거의 사용하지 않음. FluxLoop 명령을 실행하면 자동으로 올바른 환경이 선택되길 원함.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 4, "total_chunks": null}}
{"id": "5fab7c77-c290-46c9-8ea1-8d2b78ca4cfe", "content": "## 요구 사항\n1. **환경 감지**\n   - VSCode 확장 초기화 시 워크스페이스의 가상환경(venv, conda, uv 등)을 탐지.\n   - Python 확장 API가 있으면 선택된 인터프리터 정보를 활용.\n   - 감지 실패 시 Output 채널과 알림으로 가이드 제공.\n   - 사용자가 `targetSourceRoot`(FluxLoop 프로젝트 루트)를 설정하면 해당 경로를 기준으로 환경 탐지를 재실행한다.\n\n2. **수동 설정**\n   - `fluxloop.pythonPath`, `fluxloop.mcpCommandPath`, `fluxloop.executionMode` 등의 설정을 추가.\n   - Command Palette (`FluxLoop: Select Environment`) 실행 시 `.vscode/settings.json`이 자동 업데이트.\n\n3. **실행 로직 공통화**\n   - CLI/VSCode 모두 `python -m fluxloop_mcp` / `<venv>/bin/fluxloop` 형태로 프로젝트 환경을 우선 사용.", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 5, "total_chunks": null}}
{"id": "99b2c338-2f1a-4fb3-be7b-4643b5928d71", "content": "   - 환경을 찾지 못할 경우 명확한 경고 메시지와 문서 링크 제공.\n\n4. **상태 노출**\n   - FluxLoop Output 채널에 실행 시점마다 `PYTHON`, `FLUXLOOP`, `MCP INDEX` 경로 출력.\n   - `fluxloop doctor` 명령(추가)에서 프로젝트 내 설치 상태, PATH, 인덱스, 버전을 한 번에 표시.\n   - 워크스페이스에 복수의 FluxLoop 프로젝트가 있는 경우, `targetSourceRoot`마다 감지된 환경/상태를 캐싱하고 전환 시 즉시 반영한다.\n\n5. **문서 & 템플릿**\n   - 온보딩 문서에 “프로젝트 가상환경 설치 → FluxLoop 설치 → VSCode 환경 선택” 흐름을 명확히 기술.\n   - `scripts/setup_fluxloop_env.sh`(가칭) 등 자동화 스크립트 제공.\n   - CI 템플릿은 항상 venv 생성 후 FluxLoop 패키지를 설치하도록 수정.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 6, "total_chunks": null}}
{"id": "8cdea8f9-f88f-4002-9c1c-8fd90c7cd8d7", "content": "## 사용자 여정 요약\n1. 사용자가 FluxLoop 템플릿 또는 기존 프로젝트에 FluxLoop를 도입한다.\n2. 스크립트/문서 안내에 따라 가상환경을 만들고 FluxLoop 패키지를 설치한다.\n3. VSCode에서 workspace를 열면 FluxLoop 확장이 가상환경을 자동 인식하거나, 설정 선택 UI를 제공한다.\n4. Output 채널에서 현재 환경 정보를 확인하며 명령을 실행한다.\n5. Experiment run 또는 MCP FAQ 실행 시 프로젝트 환경 내 라이브러리만 사용하여 재현성이 확보된다.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 7, "total_chunks": null}}
{"id": "4774f621-0356-4da6-8658-6d3a252a7f19", "content": "## 기능 세부 설계\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 8, "total_chunks": null}}
{"id": "d85dcfca-831f-4fe7-8b6d-35312f23fd96", "content": "### VSCode 확장\n- `integrationService.refreshStatus()`에서 환경 감지 로직 추가:\n  - Python 확장 API 활용 (`python.environments.getEnvironmentVariables`, `getActiveEnvironmentPath`).\n  - 폴더 내 `.venv`, `.conda`, `.python-version` 등을 탐지하여 후보 리스트를 구성.\n- 설정 항목 추가:\n  ```json\n  {\n    \"fluxloop.executionMode\": \"auto\", // auto | workspace | global | custom\n    \"fluxloop.pythonPath\": \"\",\n    \"fluxloop.mcpCommandPath\": \"\"\n  }\n  ```\n- Output 채널 문구 예시:\n  ```\n  [FluxLoop Env] Python: /Users/user/project/.venv/bin/python\n  [FluxLoop Env] fluxloop: /Users/user/project/.venv/bin/fluxloop", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 9, "total_chunks": null}}
{"id": "8ed3601e-44b9-4c46-a7cf-f6a654e7dda7", "content": "  [FluxLoop Env] MCP: /Users/user/project/.venv/bin/fluxloop-mcp\n  ```\n- `FluxLoop: Select Environment` 명령 구현:\n  - 감지된 경로 + 수동 입력 옵션 제공\n  - 선택 결과를 `.vscode/settings.json`에 기록\n- `Target Source Root…` 액션과 연동:\n  - 프로젝트 뷰에서 소스 루트를 선택/변경하면 즉시 환경 감지를 재실행\n  - 필요 시 퀵픽으로 `FluxLoop: Select Environment`를 자동 호출하거나 성공 알림을 띄워 흐름을 단축\n- `FluxLoop: Show Environment Info` / `FluxLoop: Run Doctor` 명령 제공:\n  - 현재 선택된 실행 환경 정보를 출력하거나\n  - CLI `fluxloop doctor`를 호출해 진단 결과를 Output 창에 표시\n- `targetSourceRoot` 설정 변경 시:\n  - 지정된 경로를 기준으로 가상환경 스캔을 수행하고 후보 리스트를 갱신", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 10, "total_chunks": null}}
{"id": "b426fe7c-59bf-436e-a653-208d0a14e624", "content": "  - 자동으로 `fluxloop.pythonPath`/`fluxloop.mcpCommandPath`를 업데이트하거나 사용자 선택 UI를 띄움\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 11, "total_chunks": null}}
{"id": "a899b709-7b4c-41d5-b808-061c7bcc59a2", "content": "### CLI 개선\n- `fluxloop doctor` 명령 추가:\n  - `sys.executable`, `fluxloop` 경로, `fluxloop-mcp` 경로, 인덱스 유무, 패키지 버전 출력\n  - 프로젝트 루트 기준 `.venv` 존재 여부와 활성화 가이드를 함께 제공\n- VSCode 확장에서 `FluxLoop: Run Doctor` 명령을 통해 손쉽게 실행할 수 있도록 연동\n- 각 서브커맨드 실행 전:\n  - venv 감지 → 있다면 해당 경로로 재실행 (`execv`) 또는 `python -m fluxloop_cli` 패턴 활용\n  - 없으면 “전역 환경 사용 중” 로그 출력\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 12, "total_chunks": null}}
{"id": "b61e268e-3053-454e-b59c-7920c83ff1ff", "content": "### 자동화 스크립트 & 템플릿\n- `scripts/setup_fluxloop_env.sh`\n  - `python -m venv .venv`\n  - `.venv/bin/pip install -r requirements.txt` (FluxLoop 포함)\n  - VSCode용 `.vscode/settings.json` 기본 템플릿 생성\n- CI용 `Makefile`/`justfile`:\n  ```bash\n  python -m venv .venv\n  . .venv/bin/activate\n  pip install -r requirements.txt\n  fluxloop doctor\n  pytest ...\n  ```\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 13, "total_chunks": null}}
{"id": "ccb4b854-7990-4896-9001-cf96961c3e98", "content": "## 일정 (예시)\n1. **주 1-2**: 환경 감지 로직 & Output 채널 확장, doctor 명령 MVP.\n2. **주 3**: VSCode 설정 UI, Command Palette 플로우, 설정 파일 업데이트.\n3. **주 4**: CLI/VSCode 실행 로직 공통화, 자동화 스크립트/문서 초안.\n4. **주 5**: CI 템플릿/README 업데이트, 내부 테스트.\n5. **주 6 이후**: 다양한 설치 매니저(uv, pipx, conda) 테스트 케이스 확보, 피드백 수렴.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 14, "total_chunks": null}}
{"id": "36503ba9-bbc3-407d-9b9c-8f29b4eebd3d", "content": "## 리스크 & 대응\n- **설치 매니저 다양성**: uv/conda/pipx마다 경로가 다름 → 기본 경로 리스트를 유지하고, 실패 시 사용자가 직접 추가할 수 있도록 옵션 제공.\n- **사용자 환경 제한**: 일부 OS에서 자동 탐지가 실패할 수 있음 → 명시적 설정 + 로그를 통해 대응.\n- **레거시 사용자**: 기존 글로벌 설치 이용자에게 경고만 뜨고 기능이 막히지 않도록 “auto” 모드에서 백워드 호환성 유지.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 15, "total_chunks": null}}
{"id": "7ab5a319-a46a-4761-9e06-a5dc3422ea6a", "content": "## 오픈 이슈\n- Python 확장 미설치 시 플로우: 자체적으로 `which python` 등으로 대체 탐지할지 여부.\n- Windows PowerShell/WSL 환경에서 PATH 주입 테스트 필요.\n- FluxLoop CLI를 Node 기반에서도 호출할 계획이 있는지 검토 필요.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 16, "total_chunks": null}}
{"id": "3fa872a2-0a9b-4b8b-8e93-915cfa7163c5", "content": "## 결론\n프로젝트 환경에 맞춰 FluxLoop를 설치·실행하는 전략을 제품 기능(환경 감지, 설정 옵션, 로그 노출, 자동화 스크립트)과 문서로 함께 제공한다. 이를 통해 실험 실행의 재현성을 확보하고, 사용자 혼란을 제로에 가깝게 줄이는 것이 본 PRD의 핵심이다.\n", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 17, "total_chunks": null}}
{"id": "76bd35af-feb2-4477-9bb4-4bc849e52614", "content": "## 구현 계획\n\n- **1주차: 환경 감지 인프라 구축**\n  - VSCode 확장에서 `targetSourceRoot` 설정 변화를 감지하고, 해당 경로를 기준으로 `.venv`, `.conda`, `.python-version`, `uv.lock` 등을 탐색하는 유틸 작성.\n  - Python 확장 API가 설치된 경우 `environments.getActiveEnvironmentPath()`를 호출해 후보 목록에 병합.\n  - 감지 결과를 캐싱(루트별)하고 FluxLoop Output 채널에 디버그 로그(`PYTHON`, `fluxloop`, `fluxloop-mcp` 경로) 출력.\n  - 실패 시 안내 메시지와 문서 링크 제공.\n\n- **2주차: 설정 & UI 연동**\n  - `fluxloop.executionMode`, `fluxloop.pythonPath`, `fluxloop.mcpCommandPath` 설정 항목 추가 (`configurationDefaults` 반영).\n  - Command Palette에 `FluxLoop: Select Environment`, `FluxLoop: Show Environment Info` 명령 추가.", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 18, "total_chunks": null}}
{"id": "fe66f0be-d56d-4c8b-971a-3e0869eddbe0", "content": "  - 감지된 환경 후보 리스트 → QuickPick → 선택 시 `.vscode/settings.json` 업데이트, Output 로그 즉시 갱신.\n  - 다중 `targetSourceRoot` 시나리오: 활성 루트에 따른 설정 전환, 상태 갱신 로직 정리.\n\n- **3주차: 실행 로직 공통화**\n  - IntegrationService/CLIManager가 명령 실행 시 감지된 인터프리터 경로를 우선 사용 (`python -m fluxloop_mcp`, `<venv>/bin/fluxloop`).\n  - 터미널 실행(`createTerminal`)에서도 `env.PATH`, `VIRTUAL_ENV`를 주입해 동일 환경을 사용하도록 개선.\n  - 루트 전환/설정 변경 시 `refreshStatus()` 자동 재실행 및 캐시 갱신.\n\n- **4주차: CLI 개선 & 진단 도구**\n  - `fluxloop doctor` 명령 도입: `sys.executable`, CLI/MCP 경로, 인덱스 위치, 버전, 활성화된 가상환경 여부 출력.", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 19, "total_chunks": null}}
{"id": "56849653-5371-4c71-a903-cb62518224a1", "content": "  - CLI 실행 전 venv 감지 → 있으면 해당 환경에서 재실행(`execve`), 없으면 “전역 환경” 경고와 설치 가이드 제공.\n  - Output/doctor 메시지에 문서 링크 포함.\n\n- **5주차: 자동화 & 문서화**\n  - `scripts/setup_fluxloop_env.sh`(or PowerShell) 작성: venv 생성 → FluxLoop 패키지 설치 → `.vscode/settings.json` 기본값 생성.\n  - CI 템플릿 수정: venv 기반 설치·테스트 플로우로 통일, OSS 서브트리 워크플로도 동일 구조 반영.\n  - README/온보딩 문서에 “프로젝트 환경에 맞춰 FluxLoop 설치” 섹션 추가, `targetSourceRoot` 설정 가이드 포함.\n\n- **6주차 이후: 테스트 & 피드백**\n  - macOS/Python(venv, pipx, uv), Windows(venv, conda), Linux 환경별 설치 테스트 시나리오 작성.\n  - 조기 adopters 대상 피드백 수집 → 설정 UX/로그 문구 조정.", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 20, "total_chunks": null}}
{"id": "8b074238-34ad-4eee-8e76-5b1a0eba44a0", "content": "  - 다중 루트 워크스페이스, WSL, remote SSH 등 엣지 케이스 검증.\n\n추가로 원하시면 각 단계별 상세 작업 항목/이슈 트래킹 구조도 만들어 드릴 수 있습니다.\n\n\n네, 지금은 VS Code 커맨드 팔레트에서 실행하는 명령으로만 제공합니다. 즉:\n\n- `⇧⌘P` (`Ctrl+Shift+P`) → `FluxLoop: Select Environment`\n- `FluxLoop: Show Environment Info`\n\n이렇게 워크스페이스 수준에서만 호출할 수 있고, 별도의 UI 버튼이나 프로젝트 트리 메뉴에는 아직 연결하지 않았습니다. 필요하면 이후에 프로젝트 뷰 컨텍스트 메뉴 등으로도 확장할 수 있어요.", "metadata": {"source": "docs/prd/environment_configuration_prd.md", "chunk_index": 21, "total_chunks": null}}
{"id": "0c5c5ce3-b918-4370-884b-2a3381beea59", "content": "## 구현 계획\n\n- **단계 정렬**  \n  - 기본 흐름을 `parse → evaluate`로 고정한다.  \n  - `evaluate`는 기본적으로 `per_trace_analysis/per_trace.jsonl`을 요구하고, 미존재 시 즉시 종료하며 `fluxloop parse` 실행을 안내한다.  \n  - 필요 시 다른 경로를 사용할 수 있도록 `--per-trace` 옵션을 제공한다.\n\n- **`parse` 확장** (`fluxloop_cli/commands/parse.py`)  \n  - 기존 마크다운 생성은 유지하되, 멀티턴 컨텍스트를 포함한 구조화 결과물을 새 파일로 저장한다(예: `per_trace_analysis/per_trace.jsonl`).  \n  - 항목 스키마: 최종 요약(`trace_id`,`iteration`,`persona`,`duration_ms`,`success`,`final_output`), 전체 대화 턴 배열, supervisor 결정, callback/observation 요약 등 평가에 필요한 필드.  ", "metadata": {"source": "docs/prd/evals/parse_to_eval_multi_turn.md", "chunk_index": 0, "total_chunks": null}}
{"id": "a7d370a0-99c8-4a5a-bba7-409ddd4070fc", "content": "  - 필요 시 중첩 JSON 구조를 정의하고, CLI 옵션으로 저장 경로를 커스터마이즈할 수 있도록 확장한다.\n\n- **`evaluate` 파이프라인 개편** (`fluxloop_cli/commands/evaluate.py` 또는 `evaluation/engine/core.py`)  \n  - 입력 데이터를 `trace_summary.jsonl` 대신 `per_trace_analysis/per_trace.jsonl`에서 로드하도록 변경한다.  \n  - 단일 턴용 필드를 참조하던 규칙/LLM 평가로직을 멀티턴 구조에 맞게 수정한다. 예: LLM 프로프트에 `conversation.turns`를 포함하거나, 규칙 평가자가 특정 턴 속성(예: 첫 턴 답변)만 검사하도록 옵션화.  \n  - `EvaluationOptions`에 `per_trace_path` 속성을 추가해 구조화 산출물의 경로를 주입한다.\n\n- **구조 공유 유틸리티** (`fluxloop_cli/evaluation/artifacts.py` 등)  \n  - `parse`와 `evaluate`가 동일 JSON 스키마를 재사용할 수 있도록 데이터 클래스를 분리해 둔다.  ", "metadata": {"source": "docs/prd/evals/parse_to_eval_multi_turn.md", "chunk_index": 1, "total_chunks": null}}
{"id": "46ad84c4-567d-4508-9172-abe93a909da0", "content": "  - I/O 도우미(`load_per_trace_records`)를 만들어 읽기/검증을 한 곳에서 처리한다.\n\n- **테스트**  \n  - `tests/test_parse_command.py`: JSONL 스키마 검증, 멀티턴 시나리오 fixture 활용.  \n  - `tests/test_evaluate_command.py`: `parse` 산출물 기준으로 평가가 동작하는지, 미존재 시 경고가 출력되는지 확인.  \n  - 통합 테스트에서 `parse → evaluate` 순서를 실행해 엔드투엔드 보장.\n\n- **문서 및 템플릿 업데이트**  \n  - CLI 가이드(`packages/website/docs-cli/...`)에 새 프로세스와 예시 명령어를 반영.  \n  - `templates.py`의 평가 설정 샘플이 멀티턴 필드를 활용하도록 조정.\n\n- **향후 `analyze` 단계 대비**  \n  - `per_trace_analysis` JSON이 분석 단계에서도 그대로 활용될 수 있도록 통계에 필요한 필드(예: 각 턴의 latency, 툴 호출 결과)를 포함한다.  ", "metadata": {"source": "docs/prd/evals/parse_to_eval_multi_turn.md", "chunk_index": 2, "total_chunks": null}}
{"id": "38a25888-2899-4670-897c-ce043b7936fe", "content": "  - `evaluate` 요약(`summary.json`)에 분석 단계가 재사용할 수 있는 지표를 구조화된 형태로 기록하여 `analyze` 명령에서 빠르게 로드하도록 설계한다.\n\n- **향후 작업 여지 (`analyze`)**  \n  - `analyze`는 `evaluate` 산출물(`summary.json`, 추천 목록 등)과 `per_trace_analysis`를 결합해 고급 시각화/보고서를 생성하도록 계획한다.  \n  - 현재 단계에서 파일과 디렉터리 구조를 확정해 두면 `analyze` 도입 시 추가 마이그레이션을 줄일 수 있다.\n\n이 순서대로 진행하면 멀티턴 정보를 평가에 일관되게 반영할 수 있고, 다음 단계(`analyze`) 확장도 수월해집니다.", "metadata": {"source": "docs/prd/evals/parse_to_eval_multi_turn.md", "chunk_index": 3, "total_chunks": null}}
{"id": "b53a6fb6-7a0c-4f73-be48-7f702d83ea02", "content": "## 1단계 평가 기획 (MVP)\n\n본 문서는 FluxLoop 실험 결과에 대한 최소 기능의 “현실적인” 1단계 평가(MVP)를 정의합니다. LLM 활용은 옵션이며, 정해진 템플릿을 기반으로 정성·정량 평가를 모두 제공합니다.\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "b2b63bc2-3066-46ff-9829-8eea1d7333eb", "content": "## 목표\n- 최소 구현으로도 신뢰 가능한 평가 파이프라인 제공\n- 규칙 기반(정량) + LLM 재판관(정성, 옵션) 병행\n- 설정 파일 템플릿(`configs/evaluation.yaml`)에 기반한 일관된 실행\n- 출력은 `experiments/<id>/evaluation/` 디렉터리에 저장\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "fcaf90a5-f995-4c5c-a0ce-725058e91805", "content": "## 입력 데이터\n- 필수: `experiments/<id>/trace_summary.jsonl`\n  - 필드 예시: `trace_id`, `iteration`, `persona`, `input`, `output`, `duration_ms`, `success`\n- 선택: `experiments/<id>/observations.jsonl` (추후 타임라인/세부 로깅 활용)\n- 선택: 입력 데이터 메타(`inputs.yaml`)의 기대값(예: `metadata.expected`)\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "d2184970-68a4-471b-a392-35b451ebbe44", "content": "## 출력 산출물\n- 디렉터리: `experiments/<id>/evaluation/`\n  - `per_trace.jsonl`: trace별 평가 상세(개별 evaluator 점수, 최종 점수, pass 여부, 사유)\n  - `summary.json`: 전체/퍼소나별 통계(평균, 분산, 분포, pass rate, 실패 규칙 Top-N)\n  - `report.md`: 사람이 읽기 쉬운 요약 리포트\n\nper-trace 레코드 예시:\n```json\n{\"trace_id\":\"abc\",\"iteration\":0,\"persona\":\"helpful\",\"scores\":{\"not_empty\":1.0,\"keyword_quality\":0.5,\"similarity_to_expected\":0.82,\"latency_budget\":1.0,\"llm_response_quality\":0.8},\"final_score\":0.824,\"pass\":true,\"reasons\":{\"keyword_quality\":\"missing 'assist'\"}}\n```\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "b4ac0619-9b8a-4620-a5ec-54af30de63c4", "content": "## 평가 구성요소\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "ba7eacaf-1e07-40e4-8329-d3d3eb1705fe", "content": "### 1) 규칙 기반 평가기 (정량)\n아래 평가지표는 0~1 범위 점수를 반환하며, 간단 명료하게 구현 가능합니다.\n- output_not_empty: 출력이 비어있지 않으면 1, 아니면 0\n- contains / not_contains: 특정 키워드 포함/미포함 검사(1/0)\n- matches_regex: 정규식 매칭 검사(1/0)\n- latency_under: 지연 시간이 예산(budget_ms) 이하이면 1, 아니면 0\n- similarity: 기대값과 유사도(예: `difflib.SequenceMatcher`로 0~1)\n\n추가 규칙은 동일한 인터페이스로 확장 가능.\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "04d48e28-6655-4daa-bc5a-de564015b28e", "content": "### 2) LLM 재판관 평가기 (정성, 옵션)\n- 템플릿 프롬프트로 1~10 점수와 간단한 근거(Reason) 생성\n- 점수 파싱 규칙: `first_number_1_10` 등 간단한 파서\n- 점수 정규화: 1~10 → 0~1\n- 비용 통제(필수): 샘플링 비율, 최대 호출 수, 레이트리밋, 캐시\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "9b798e34-19b9-46aa-a567-c9a793a938dc", "content": "### 3) 집계 방식\n- 가중합: \\( S = \\frac{\\sum_i w_i \\cdot s_i}{\\sum_i w_i} \\)\n- 기준선: `threshold` 이상이면 pass\n- 요약 뷰: 전체/퍼소나별 평균, 분산, 분포, pass rate\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "5a2dcd33-99f3-460b-a4cb-e855377e8843", "content": "## 설정 템플릿 (evaluation.yaml, 1단계)\n\n```yaml\nevaluators:\n  - name: not_empty\n    type: rule_based\n    enabled: true\n    weight: 0.2\n    rules:\n      - check: output_not_empty\n\n  - name: keyword_quality\n    type: rule_based\n    enabled: true\n    weight: 0.2\n    rules:\n      - check: contains\n        target: output\n        keywords: [\"help\", \"assist\"]\n      - check: not_contains\n        target: output\n        keywords: [\"sorry\", \"cannot\"]\n\n  - name: similarity_to_expected\n    type: rule_based\n    enabled: true\n    weight: 0.2\n    rules:", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "81314936-a5d2-4458-8229-1a7432578513", "content": "      - check: similarity\n        target: output\n        expected_path: metadata.expected     # inputs의 기대값 경로\n        method: difflib\n\n  - name: latency_budget\n    type: rule_based\n    enabled: true\n    weight: 0.2\n    rules:\n      - check: latency_under\n        budget_ms: 1000\n\n  - name: llm_response_quality\n    type: llm_judge\n    enabled: false          # 기본 off, 필요 시 on\n    weight: 0.2\n    model: gpt-5-mini\n    max_score: 10\n    parser: first_number_1_10\n    prompt_template: |\n      You are an expert judge. Score the assistant's response from 1-10.", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "4f17f6ee-e716-4a23-8c68-cbcbbe18fcca", "content": "      Input: {input}\n      Output: {output}\n      Consider relevance, completeness, clarity.\n      Answer with: \"Score: <number>\" and a one-line reason.\n\naggregate:\n  method: weighted_sum\n  threshold: 0.7\n  by_persona: true\n\nlimits:\n  sample_rate: 0.3          # 30%만 LLM 평가 수행\n  max_llm_calls: 50         # 상한\n  timeout_seconds: 60\n  cache: evaluation_cache.jsonl\n```\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "21fb4575-1bf5-4726-9f31-82c432aa0763", "content": "## 실행 사양 (CLI, 계획)\n- 커맨드(초안):  \n  `fluxloop evaluate experiment <experiment_dir> --config configs/evaluation.yaml --output evaluation --overwrite --llm-api-key <key> --max-llm <N> --sample-rate <0~1>`\n- 처리 흐름:\n  1) `trace_summary.jsonl` 로드\n  2) 각 evaluator 실행(규칙 → 즉시, LLM → 옵션·샘플링·캐시)\n  3) 가중합/threshold 계산, pass 여부 결정\n  4) per-trace/summary/report 산출물 저장\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "cff8e75c-216b-4ba4-9707-4f5ca2047979", "content": "## 비용·성능·리스크 통제\n- LLM 호출 기본 비활성화(명시적으로 on)\n- `sample_rate`, `max_llm_calls`, `timeout_seconds`, `cache`로 비용 제어\n- 실패/예외는 per-trace에 사유 기록하고 해당 evaluator 점수는 미집계 또는 0 처리 정책 정의\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "a4eead24-4d3f-49be-a5eb-06f8d7866ddc", "content": "## VS Code 연동 (경량 1단계)\n- `Results` 트리: 실험 폴더에 `Evaluate Results` 액션 추가(현 `Parse Results`와 대칭)\n- 실행 완료 시 `evaluation/summary.json` 또는 `report.md` 열기\n- 대시보드 배지: pass rate / 평균 점수 간단 표기(후속)\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "ee20cb0e-4024-4bcf-b2e5-61c0731ecd6e", "content": "## 로드맵 (차기 단계 아이디어)\n- LLM pairwise 비교, 기준 답안 대비 편향/불일치 탐지\n- 금칙어/PII/안전성 규칙 강화\n- 멀티모달 입력·출력 평가\n- 프로필/시나리오별 커스텀 템플릿 지원 강화\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "a18db1ca-723d-48c6-94ec-27f1e4379586", "content": "## 부록", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "eba6b20d-de2f-404c-826c-a5fdb4820106", "content": "### per-trace JSON 필드 권장\n- `scores`: evaluator별 0~1 점수\n- `final_score`: 가중합 결과\n- `pass`: threshold 통과 여부\n- `reasons`: 규칙 위반/감점 사유 요약\n- `meta`: iteration, persona, duration_ms 등 요약 메타\n\n", "metadata": {"source": "docs/prd/evals/phase-1-evaluation-plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "b33f1536-a1b6-4204-b41f-527f06de0baf", "content": "## 2단계 평가 고도화 기획\n\n본 문서는 1단계 평가(파싱 기반 정량·정성 지표)에 이어, 고급 평가 설정과 HTML 리포트 템플릿을 포함한 2단계 확장 방향을 정의한다. 목표는 보다 풍부한 설정을 수용하면서도 기본 템플릿과 커스텀 템플릿을 병행 지원하는 것이다.\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "74f62534-8aa5-4a95-bff5-0b6d23def070", "content": "## 개요\n- 확장된 평가 설정(`evaluation_goal`, `success_criteria`, `additional_analysis`, `report`, `advanced`)을 YAML 스키마에 반영\n- 평가 엔진에서 성공 기준 판정/추가 분석/시각화용 데이터까지 생성\n- 기본 HTML 리포트 템플릿 내장 + CLI 옵션으로 커스텀 템플릿 적용\n- 템플릿에는 LLM 결과·통계·분석 요약을 `[[PLACEHOLDER]]` 방식으로 삽입\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a2ce4401-cbac-438e-928d-a041b0e92251", "content": "## 설정 스키마 확장 제안\n`EvaluationConfig` 구조에 다음 필드를 추가한다. (모두 optional, 미지정 시 기본값 사용)\n\n```\nevaluation_goal:\n  text: \"\"                # 평가 목적 서술\n\nsuccess_criteria:\n  performance:\n    all_traces_successful: bool\n    avg_response_time:\n      enabled: bool\n      threshold_ms: int\n    max_response_time:\n      enabled: bool\n      threshold_ms: int\n    error_rate:\n      enabled: bool\n      threshold_percent: float\n  quality:\n    intent_recognition: bool\n    response_consistency: bool\n    response_clarity: bool\n    information_completeness: bool", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "41d0daf9-8ed4-4325-9f46-5aeaacf7f954", "content": "  functionality:\n    tool_calling:\n      enabled: bool\n      all_calls_successful: bool\n      appropriate_selection: bool\n      correct_parameters: bool\n      proper_timing: bool\n      handles_failures: bool\n\nadditional_analysis:\n  persona:\n    enabled: bool\n    focus_personas: []\n  performance:\n    detect_outliers: bool\n    trend_analysis: bool\n  failures:\n    enabled: bool\n    categorize_causes: bool\n  comparison:\n    enabled: bool\n    baseline_path: \"\"     # summary.json 등 비교 대상\n\nreport:\n  style: quick|standard|detailed\n  sections:", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "bc27c49f-5feb-4cc1-ae2f-f16529fa5c7f", "content": "    executive_summary: bool\n    key_metrics: bool\n    detailed_results: bool\n    statistical_analysis: bool\n    failure_cases: bool\n    success_examples: bool\n    recommendations: bool\n    action_items: bool\n  visualizations:\n    charts_and_graphs: bool\n    tables: bool\n    interactive: bool\n  tone: technical|executive|balanced\n  template_path: optional path\n\nadvanced:\n  statistical_tests:\n    enabled: bool\n    significance_level: float\n    confidence_interval: float\n  outliers:\n    detection: bool\n    handling: remove|analyze_separately|include", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c4f4f3e8-372b-4a47-b87a-dffe316ae892", "content": "  alerts:\n    enabled: bool\n    conditions:\n      - metric: string\n        threshold: float\n        operator: \">\"|\"<\"|\">=\"|\"<=\"\n```\n\n기존 `evaluators/aggregate/limits` 필드는 1단계와 동일하게 유지하며, 상단 필드 추가만으로 확장한다.\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "0a0b95e9-373d-486b-888d-3241825e36f0", "content": "## CLI 및 엔진 변경 계획\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "1c51c45a-166f-4bc2-af71-bacfbaf63eee", "content": "### 설정 로딩\n- `load_evaluation_config`에서 새 섹션 파서를 추가하고, 유효성 검증 시 오류 메시지를 명확히 제공한다.\n- 모든 필드가 optional이므로 default dataclass 값을 사용해 하위호환 보장.\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "617a65ef-e8b8-49b6-9eaf-80be16ab7643", "content": "### 평가 엔진 계산 단계\n1. **기본 evaluator 계산** – 현재와 동일하게 rule-based/LLM evaluator 점수 및 가중합(`final_score`) 계산\n2. **성공 기준 체크** – `success_criteria`에 따라 성능/품질/기능 조건을 판정하고 boolean 맵 생성\n   - 성능: 평균/최대 응답시간, 성공률, 오류율 등\n   - 품질·기능: evaluator 결과(예: intent_recognition은 별도 evaluator 또는 raw trace 분석)와 매핑\n3. **추가 분석** – 설정에 따라 다음을 수행\n   - Persona 분석: `persona_breakdown`를 생성하고 focus persona가 있으면 필터링\n   - 성능 추세: iteration별 평균을 계산하고 추세(증가/감소/안정) 분석\n   - 아웃라이어: duration, final_score 등에서 z-score/IQR 기반 outlier 목록 도출\n   - 비교: `baseline_path`가 지정되면 summary.json(또는 per_trace.jsonl)과 현재 결과를 비교", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "192740b5-4ac8-46bf-9efd-9baee4ae098f", "content": "4. **결과 요약** – `summary`에 `success_criteria_results`, `overall_success`(모든 활성 기준 충족 여부), `analysis` 정보(예: outlier 리스트, 트렌드 설명)를 포함\n5. **리포트 생성** – `report` 설정을 참고하여 HTML 또는 Markdown 출력\n   - 기본 HTML 템플릿(use CDN) vs 커스텀 템플릿 경로(`--report-template` / config)\n   - 기본 템플릿은 패키지에 내장된 문자열 또는 리소스 파일로 유지\n   - 커스텀 템플릿이 제공되면 우선순위는 CLI 옵션 > config > 내장 템플릿\n   - 템플릿에는 `[[TITLE]]`, `[[DATE]]`, `[[SUMMARY_JSON]]`, `[[PER_TRACE_JSON]]`, `[[CRITERIA_JSON]]`, `[[ANALYSIS_JSON]]` 등을 삽입\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "3daea334-4e07-4b56-8356-4249a8a5199e", "content": "### CLI 옵션 확장\n- `fluxloop evaluate experiment` 명령에 다음 옵션을 추가:\n  - `--report {md,html,both}` (기본: config 또는 html+md)\n  - `--report-template PATH` – config의 `report.template_path`보다 우선\n  - `--baseline PATH` – 비교용 baseline summary 전달(없으면 config 사용)\n- 옵션과 config가 충돌할 경우 CLI > config > default 순서로 merge.\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "9fd1fde2-9efa-46c2-9434-4566bc88f732", "content": "## HTML 템플릿 정책\n- 기본 템플릿: `agent_evaluation_report_default.html` (내장)\n  - Tailwind/Chart.js CDN 사용, 단일 파일\n  - placeholder 형식: `[[PLACEHOLDER_NAME]]`\n  - JS에서 JSON 파싱 뒤 차트/테이블 렌더\n- 커스텀 템플릿:\n  - 사용자가 template 경로 지정 시 해당 파일 로드\n  - 최소 요구 placeholder 목록을 문서화 (예: `[[SUMMARY_JSON]]` 반드시 포함)\n  - 포함되지 않은 섹션은 gracefully degrade (conditional JS 작성)\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "597f59c8-18a8-4522-a849-03c3a73a3c1a", "content": "## 엔진 리팩토링 계획\n- 목적: `evaluation/engine.py`에 집중된 실행·판정·분석·리포트 로직을 모듈로 분리해 가독성과 테스트 용이성을 확보한다.\n- 모듈 분리 전략:\n  - `evaluation/engine/core.py` – `run_evaluation`, `TraceOutcome`, `_evaluate_trace` 등 실행 오케스트레이션\n  - `evaluation/engine/success.py` – 성공 기준 판정 유틸리티와 툴 콜링 지표 수집\n  - `evaluation/engine/analysis.py` – 퍼포먼스/트렌드/베이스라인 비교 분석\n  - `evaluation/engine/reporting/markdown.py`, `evaluation/engine/reporting/html.py` – 리포트 렌더링 및 템플릿 처리\n- 함수 배치 초안:\n  - core: `_load_trace_summaries`, `_prepare_output_directory`, `_evaluate_trace`, `_aggregate_scores`, `_extract_reasons`, `_write_per_trace`", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "c25da0ee-8d9a-4ed0-a5d2-f65075a84966", "content": "  - success: `_has_active_success_criteria`, `_collect_tool_calling_metrics`, `_evaluate_success_criteria`\n  - analysis: `_iqr_outliers`, `_metric_series`, `_compute_trend`, `_analyze_trends`, `_categorize_reason`, `_analyze_failures`, `_load_baseline_summary`, `_compare_to_baseline`, `_compute_additional_analysis`\n  - reporting: `_write_summary`, `_write_markdown_report`, `_serialize_trace_outcome`, `_load_template_from_path`, `_select_html_template`, `_prepare_report_plan`, `_write_html_report`, `_write_reports`", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "e9402fde-87f0-4699-a111-4574af9a4105", "content": "- 공통 데이터 구조(`EvaluationOptions`, `EvaluatorOutcome` 등)는 공유 모듈에 정의하고 서브모듈이 import\n- CLI와 외부 API 호환성을 위해 `evaluation/__init__.py`에서 핵심 함수 재노출\n- 리팩토링 이후에는 모듈 단위 유닛 테스트를 보강하고, Phase 1 설정으로 회귀 검증을 수행한다.\n- 문서 및 개발 가이드에 새 구조와 사용법을 업데이트한다.\n- 진행 현황: core/success/analysis/reporting 모듈 분리 완료, CLI/테스트를 통한 회귀 확인 진행 중\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "0cab36a4-536c-46cf-b7c8-ef678e75301a", "content": "## 예시: 확장된 evaluation.yaml\n```\nevaluation_goal:\n  text: |\n    Verify that the customer support agent provides accurate, persona-aware responses\n    in refund scenarios and that average response time stays below 2s.\n\nsuccess_criteria:\n  performance:\n    all_traces_successful: true\n    avg_response_time:\n      enabled: true\n      threshold_ms: 2000\n    error_rate:\n      enabled: true\n      threshold_percent: 5\n  quality:\n    intent_recognition: true\n    response_consistency: true\n    response_clarity: true\n  functionality:\n    tool_calling:", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "e694dfd1-364d-40be-9969-29040de44970", "content": "      enabled: false\n\nadditional_analysis:\n  persona:\n    enabled: true\n    focus_personas: [\"expert_user\", \"novice_user\"]\n  performance:\n    detect_outliers: true\n    trend_analysis: true\n  failures:\n    enabled: true\n    categorize_causes: true\n  comparison:\n    enabled: true\n    baseline_path: \"experiments/baseline_run/summary.json\"\n\nreport:\n  style: detailed\n  sections:\n    executive_summary: true\n    key_metrics: true\n    detailed_results: true\n    statistical_analysis: false\n    failure_cases: true\n    success_examples: false", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "61eeacfc-62fe-41d1-b257-515239fde3b1", "content": "    recommendations: true\n    action_items: true\n  visualizations:\n    charts_and_graphs: true\n    tables: true\n    interactive: true\n  tone: balanced\n  template_path: \"templates/custom_agent_report.html\"\n\nadvanced:\n  statistical_tests:\n    enabled: false\n  outliers:\n    detection: true\n    handling: analyze_separately\n  alerts:\n    enabled: true\n    conditions:\n      - metric: \"error_rate\"\n        threshold: 10\n        operator: \">\"\n```\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "708592ee-57c2-4eef-979f-fb2a8400d7da", "content": "## 리포트 생성 흐름\n1. `run_evaluation`이 summary/per_trace/performance/criteria/analysis 데이터를 dictionary로 반환\n2. `write_reports(summary, per_trace, cfg, options)`\n   - HTML: `write_html_report(...)`\n   - Markdown(optional): `write_markdown_report(...)`\n3. HTML 템플릿은 기본→커스텀 순으로 선택되고, placeholder 치환 후 `evaluation/report.html` 저장\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "15df1062-71ed-4ae1-89dd-e0f4564c73e3", "content": "## 향후 고려사항\n- **LLM 응답 분석 강화**: 품질 관련 기준(intent_recognition 등)을 위한 evaluator/analysis 기능 강화 (예: 임베딩 기반 일관성 측정)\n- **통계적 유의성**: advanced.statistical_tests 활성화 시 t-test, proportion test 등 자동 계산\n- **알림(Alerts)**: 조건 충족 시 Slack/Webhook 통지 지원 (후속 단계)\n- **리포트 버전 관리**: `report.html`에 schema version, 실행 환경 정보 삽입\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "b216887f-db63-4fd3-859f-d27ec8db1778", "content": "## 일정 제안\n1. **1주차** – 스키마 확장, 파서 구현, 평가 엔진 계산 로직 설계\n2. **2주차** – HTML 템플릿/placeholder 시스템 구현, 기본 템플릿 적용\n3. **3주차** – 성공 기준/추가 분석/보고서 생성 통합 테스트, CLI 옵션 정비\n4. **4주차** – 문서화, 샘플 config, 기본 템플릿 미리보기, 사용자 피드백 수집\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "371c0396-4aef-4470-b12d-ba0858b57e2d", "content": "## 문서/샘플 제공 계획\n- `docs/prd/evals/phase-2-evaluation-plan.md` – 본 문서\n- 참고: `docs/prd/evals/eval_config.yaml` – 확장 설정 예시\n- 참고: `docs/prd/evals/agent_evaluation_report_2.html` – HTML 리포트 템플릿 샘플\n- `examples/evaluation_configs/phase2_sample.yaml` – 확장 스키마 샘플\n- `templates/report_default.html` – 내장 기본 템플릿 (또는 문자열 상수)\n- 리포트 placeholder 사용 가이드 (`docs/evals/report-template-guide.md`) 작성\n\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-plan.md", "chunk_index": 21, "total_chunks": null}}
{"id": "9ce270ef-14c7-4aa7-83f9-b5dad014f5d5", "content": "---\ntitle: \"Phase 2 Evaluation Quality Roadmap\"\ndescription: \"Beefing up evaluators, analysis, and reporting to match Phase 2 goals\"\n---\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 0, "total_chunks": null}}
{"id": "94851b8b-2d46-4828-a2a4-165ec58f870a", "content": "# Phase 2 Evaluation Quality Roadmap\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 1, "total_chunks": null}}
{"id": "7b66b9f2-adbc-48f1-811d-afbdc5a6f9fd", "content": "## 배경\n- Phase 2 스키마/엔진/CLI 골격은 도입했지만, 기본 evaluator 템플릿(`templates.py`)과 내장 HTML 리포트가 Phase 1 수준에 머물러 있음\n- 품질 지표(intent_recognition, response_consistency 등)를 계산할 evaluator, 프롬프트, 메트릭 매핑이 준비되지 않아 success criteria가 빈 껍데기 상태\n- 내장 HTML 보고서(`report.html`)는 간단한 테이블/텍스트 수준으로, `agent_evaluation_report_2.html` 수준의 인터랙티브 UX와 비교하면 격차가 큼\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 2, "total_chunks": null}}
{"id": "c5c4e5a6-ae3e-4eff-b7e7-407b8a5b505c", "content": "## 목표\n1. **Evaluator Coverage 강화**\n   - Phase 2 success criteria 항목별로 동작하는 evaluator(룰/LLM)를 준비\n   - 품질/기능 지표와 evaluator 이름 및 메트릭을 일대일 매핑\n   - 템플릿 config가 의미 있는 기본값을 제공하도록 개선\n2. **LLM 프롬프트 전략 수립**\n   - intent/consistency/clarity 등 각 품질 지표를 평가할 LLM 프롬프트, 스코어링 파서 정의\n   - 모델 파라미터(지원되는 샘플링 옵션) 전략 문서화 및 템플릿에 반영\n   - persona 별 tone/style 차별화를 측정하는 prompt 가이드 작성\n3. **엔진 분석 로직 고도화**\n   - 추가 분석(트렌드, 아웃라이어, baseline 비교) 결과를 더 풍부하게 산출 (예: 오프라인 통계 지표, 분포/퍼센타일, 임계값 추천)\n   - 실패 분석 카테고리 세분화(예: intent, latency, tool 호출, 프롬프트 오류 등)\n   - success criteria 결과에 근거한 action item 자동 생성 초안", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 3, "total_chunks": null}}
{"id": "0a38bdf4-5cc5-41c2-ab1d-120b9c45a8c7", "content": "4. **HTML 리포트 리디자인**\n   - 기본 템플릿에 Tailwind/Chart.js 기반 인터랙티브 컴포넌트 도입 (executive summary, key metrics, persona breakdown, 실패 사례 하이라이트 등)\n   - `agent_evaluation_report_2.html` 수준의 UX/차트/탭을 내장 템플릿으로 흡수하거나 경량화된 버전을 제공\n   - Markdown 보고서도 Phase 2 요약을 포함하도록 개선 (성공 기준, 분석 요약, 추천 액션)\n5. **자동화/문서화**\n   - Phase 2 evaluator/analysis/report가 반영된 샘플 프로젝트 + 테스트 케이스 추가\n   - CLI 도입 템플릿(`templates.py`)을 Phase 2 기본 세팅으로 업데이트하고 문서화 강화\n   - 사용자 가이드를 `docs-cli`, `docs-vscode`, `eval_config.yaml`에 일관되게 반영\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 4, "total_chunks": null}}
{"id": "612f5ca9-f3f2-42aa-baa2-cef781aaaf79", "content": "## 작업 항목\n1. Evaluator/Pipeline\n   - [ ] 품질 지표용 rule/LLM evaluator 구현 (intent, consistency, clarity 등)\n   - [ ] tool_calling 지표 계산을 위한 trace 메타데이터 표준 정의\n   - [ ] evaluator ↔ success_criteria 필드 매핑 로직 검증 및 테스트\n2. LLM 프롬프트 패키지\n   - [ ] 프롬프트 템플릿 + 예제 응답 + 파서 묶음을 `evaluation/prompts/`에 정의\n   - [ ] gpt-5-mini에서 권장하는 파라미터(reasoning.effort, text.verbosity 등)를 템플릿에 반영\n3. Analysis\n   - [ ] baseline 비교에서 지표별 delta/증감 추세 자동 해석\n   - [ ] persona performance에서 분포/백분위수 제공\n   - [ ] 실패 분석 카테고리 확장 및 자동 분류 로직 추가\n4. 보고서\n   - [ ] 내장 HTML 템플릿을 인터랙티브 구조로 전환 (탭, 그래프, 열람 필터 등)", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 5, "total_chunks": null}}
{"id": "79777652-3f5e-4e3b-a90a-fec5504cc48e", "content": "   - [ ] Markdown 보고서에 성공 기준/분석 요약/추천 액션 포함\n   - [ ] `agent_evaluation_report_default.html` → `agent_evaluation_report_2.html` 스타일 참고해 기본화\n   - [ ] 템플릿 placeholder 가이드 작성 (`docs/evals/report-template-guide.md`)\n5. 템플릿/문서화\n   - [x] `create_evaluation_config()` Phase 2 스키마 반영 (완료)\n   - [ ] Phase 2 evaluator/analysis/report 사용법을 `docs-cli`, `docs-vscode`에 반영 (추가 상세)\n   - [ ] `examples/evaluation_configs/`에 Phase 2 예시 config/결과 저장\n   - [ ] Phase 2 기능을 커버하는 end-to-end 테스트 추가 (CLI + 엔진 + 보고서 생성)\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 6, "total_chunks": null}}
{"id": "fd6d8c4d-ab24-416a-ad36-449d44a63f9a", "content": "## 향후 고려\n- LLM 모델 실험 확대 및 프롬프트 A/B 테스트\n- Alerts 기능 고도화(Slack/webhook 실사용 연동)\n\n> 참고: gpt-5 계열은 `temperature` 파라미터를 지원하지 않으므로 관련 옵션은 문서/템플릿에서 제외한다. (ref. [OpenAI platform guide](https://platform.openai.com/docs/guides/latest-model#gpt-5-parameter-compatibility))\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 7, "total_chunks": null}}
{"id": "6f97e383-9f0f-4556-a0c8-4d670d63f63d", "content": "## 산출물\n- Phase 2 evaluator/analysis/report가 연동된 기본 프로젝트 템플릿\n- 고급 HTML/Markdown 리포트 템플릿 (+ placeholder 가이드)\n- 품질/기능 지표별 evaluator/LLM 프롬프트 레퍼런스\n- 확장된 문서/가이드 (`docs-cli`, `docs-vscode`, `README`, `eval_config.yaml`)\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 8, "total_chunks": null}}
{"id": "4ea63f75-7561-4e9e-86be-47502564ebd4", "content": "## 일정(제안)\n| 주차 | 작업 |\n|------|------|\n| 1주차 | evaluator/LLM 프롬프트 설계, success_criteria 매핑, 테스트 데이터 정비 |\n| 2주차 | 추가 분석 고도화, baseline/트렌드 계산 강화, 보고서 구조 설계 |\n| 3주차 | HTML/Markdown 리포트 리디자인, 템플릿 & CLI 옵션 통합 테스트 |\n| 4주차 | 문서화 업데이트, 샘플 프로젝트/테스트 보강, 사용자 피드백 수집 |\n", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 9, "total_chunks": null}}
{"id": "6644b376-90ae-4652-975f-3166f171a2e1", "content": "## 참고 자료\n- `docs/prd/evals/phase-2-evaluation-plan.md`\n- `docs/prd/evals/agent_evaluation_report_2.html`\n- `docs/prd/evals/eval_config.yaml`\n- CLI/엔진 소스 (`packages/cli/fluxloop_cli/evaluation/engine/`)\n- `packages/cli/templates.py` updated Phase 2 config 템플릿", "metadata": {"source": "docs/prd/evals/phase-2-evaluation-roadmap.md", "chunk_index": 10, "total_chunks": null}}
{"id": "2044d68c-3f1f-4462-aaef-2bd39510a92f", "content": "## FluxLoop v0.2.0 설정 · 레코딩 개편 PRD\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 0, "total_chunks": null}}
{"id": "c4a5f07e-d43a-4420-9b6f-0beeb361949d", "content": "### 1. 배경 및 목적\n- v0.1.x에서는 `setting.yaml` 한 파일에 프로젝트/입력/실험/평가 설정이 혼합되어 있어 유지보수와 멘탈 모델 정렬이 어려움.\n- 레코딩(Argument Replay) 플로우가 “입력 생성 전에 수행”되는 것으로 비쳐져, 사실상 optional 기능임에도 불필요한 선행 단계처럼 인식됨.\n- v0.2.0에서는 설정 파일을 역할별로 분리하고, 레코딩을 실험 단계의 선택 기능으로 재정의해 UX와 CLI 구조를 정비한다.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 1, "total_chunks": null}}
{"id": "be1278f3-3fc4-45c1-b73a-2b646afc28e0", "content": "### 2. 목표\n1. 설정 파일을 Project / Input / Simulation / Evaluation 네 갈래로 분리하고, CLI·VSCode 모두에서 일관되게 사용.\n2. 레코딩을 “실험 실행을 위한 고급 옵션”으로 위치시켜 기본 인풋 생성 플로우에서 제거.\n3. 기존 `setting.yaml` 사용자도 무리 없이 마이그레이션할 수 있는 호환 레이어 제공.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 2, "total_chunks": null}}
{"id": "3c87396c-15b9-4691-b4d8-c0bb56b56163", "content": "### 3. 사용자 플로우 (갱신)\n1. **프로젝트 생성**: `fluxloop init project` → 기본 디렉터리/설정 파일 생성.\n2. **프로젝트 설정 정리**: `project.yaml`에서 공통 정보와 Collector/API 설정 점검.\n3. **인풋 설정 정리**: `input.yaml`에서 페르소나, 베이스 인풋, 변주 전략, LLM 키 등 구성.\n4. **인풋 생성**: `fluxloop generate inputs` 또는 VSCode Inputs 뷰 → LLM/Deterministic 선택.\n5. **실험 설정 정리**: `simulation.yaml`에서 iterations, runner(module_path/function_name), 실행 환경 설정.\n6. **실험 실행**: `fluxloop run experiment` 또는 VSCode Experiments 뷰.\n   - 복잡한 인자 재사용이 필요하면 **선택적으로** `fluxloop run single`로 레코딩을 남기고, `simulation.yaml`의 `replay_args`나 CLI 옵션에서 사용.", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 3, "total_chunks": null}}
{"id": "e3ef7286-1584-470c-9b70-415814054ba1", "content": "7. **평가/분석**: `evaluation.yaml` 기반 Evaluator 동작, 결과는 VSCode Results/CLI에서 확인.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 4, "total_chunks": null}}
{"id": "cda190d7-da5e-45c6-862d-26636d3a4b27", "content": "### 4. 설정 파일 구조 (v0.2.0)\n| 파일 | 주요 항목 | 설명 | VSCode 진입점 |\n| --- | --- | --- | --- |\n| `project.yaml` | 프로젝트 이름, Collector URL, 공용 env, 기본 실행 환경 | 프로젝트 전역 설정 | Projects 뷰 `Configure Project`, Status 패널 |\n| `input.yaml` | personas, base inputs, variation strategies, LLM 설정 | 인풋 관련 설정 | Inputs 뷰 `Configure Inputs`, Generate Wizard |\n| `simulation.yaml` | iterations, runner.module_path, runner.function_name, output, 환경 | 실험 실행 조건 | Experiments 뷰 `Configuration` |\n| `evaluation.yaml` | evaluator 목록, LLM judge 모델, 규칙 기반 옵션 | 결과 평가 방식 | Results 뷰 `Evaluation Settings` (추가 예정) |", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 5, "total_chunks": null}}
{"id": "43685a9a-052d-4e90-914a-9acd2a94f970", "content": "\n- 기본 위치 예시: `configs/project.yaml`, `configs/input.yaml`, `configs/simulation.yaml`, `configs/evaluation.yaml` (최종 확정 필요).\n- CLI는 `--config` 인자 없이 프로젝트 루트를 전달받으면 위 4개 파일을 순차적으로 읽고 합성하여 `ExperimentConfig`로 변환.\n- 기존 `setting.yaml`이 있을 경우 우선 불러오고, 새 구조가 있으면 마이그레이션 가이드를 안내.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 6, "total_chunks": null}}
{"id": "8f321bc5-0f20-43f2-a1c7-b163dc469c81", "content": "### 5. 레코딩 플로우 재정의\n- 레코딩은 **실험 실행을 위한 선택 기능**으로 한정.\n- Inputs 단계(Generate, Personas 등)에선 레코딩 언급/옵션 제거.\n- Experiments 뷰와 CLI에 “Record Mode” 토글/명령을 제공해, 필요할 때만 레코딩을 활성화.\n- 레코딩 활성화 시 UX 흐름(예시):\n  1. 사용자가 VSCode `Experiments > Record` 토글을 ON 또는 CLI `fluxloop record enable` 실행.\n  2. 시스템은 `.env`(또는 추후 `simulation.yaml`)에 `FLUXLOOP_RECORD_ARGS=true`, `FLUXLOOP_RECORDING_FILE` 값을 설정하고 안내 메시지를 노출.\n  3. 프로젝트의 실제 코드를 실행/조작하여 인자를 기록(`recordings/*.jsonl`). Extension은 파일 watcher로 새 레코딩 감지 시 알림.\n  4. 사용자가 토글을 OFF(`fluxloop record disable`)하면 `.env`를 원상 복구하고, 기록된 파일을 열어보거나 `replay_args` 설정과 연결하도록 유도.", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 7, "total_chunks": null}}
{"id": "b103811b-3862-4ad8-b5df-2e555e8fb679", "content": "- 문서/UX 전반에서 “복잡한 시나리오 실행 인자 재사용 시에만 사용”임을 명확히 명시.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 8, "total_chunks": null}}
{"id": "f85abe83-2f0c-40ec-bdbe-1048f1b8925c", "content": "### 6. CLI 영향 범위\n1. **템플릿 분리**\n   - `templates.py`: `create_project_config`, `create_input_config`, `create_simulation_config`, `create_evaluation_config` 추가.\n   - `init.py`: 신규 템플릿 생성 및 디렉터리 구조 반영.\n2. **로더 재작성**\n   - `config_loader.py`: 다중 설정 파일을 병합하는 로직 추가. 기존 `setting.yaml` 지원을 위한 fallback 유지.\n3. **명령어 수정**\n   - `generate.py`, `run.py`, `status.py` 등: 새로운 설정 구조를 기본으로 사용.\n   - `generate.py`: 레코딩 관련 옵션 제거(또는 비활성화) 및 도움말 업데이트.\n   - 신규 `record` 서브커맨드 도입(`fluxloop record enable/disable/status`)을 통해 레코딩 토글 UX 제공.\n4. **파일 경로 유틸리티 확장**", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 9, "total_chunks": null}}
{"id": "c3892256-6302-4182-bb60-e71493422753", "content": "   - `project_paths.py`: 각 설정 파일 위치 반환 함수 추가.\n5. **레코딩 관련 UX**\n   - `record` 커맨드: `.env` 업데이트, 안내 메시지 출력, 레코딩 파일 경로 요약 등 제공.\n   - `run` 커맨드: `replay_args` 설정과 연동(예: `--use-latest-recording` 옵션) 강화.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 10, "total_chunks": null}}
{"id": "71ed0e3b-067e-49fb-ad4f-1403b535ec21", "content": "### 7. VSCode Extension 영향\n- Projects/Inputs/Experiments/Results 뷰에서 각 설정 파일을 직접 열 수 있는 액션 추가.\n- Inputs 뷰 Wizard에서 레코딩 옵션 제거.\n- Experiments 뷰에 `Record Mode` 토글/패널 추가, 토글 상태에 따라 다른 실행 버튼 비활성화 및 안내 표시.\n- Command Palette에 `FluxLoop: Enable Recording`, `FluxLoop: Disable Recording` 명령 추가 검토.\n- Status 패널에 각 설정 파일 존재 여부/검증 상태 표시.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 11, "total_chunks": null}}
{"id": "86fc12be-24f0-4459-8b04-c39d1a8680a2", "content": "### 8. 마이그레이션 전략\n1. 기존 `setting.yaml` → `project.yaml` 등으로 분해하는 CLI 명령(`fluxloop migrate config`) 제공 검토.\n2. VSCode Extension 최초 실행 시 새 구조가 없으면 마이그레이션 가이드 토스트/링크 제공.\n3. 문서/릴리즈 노트에 수동 분리 방법 단계별 안내.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 12, "total_chunks": null}}
{"id": "437302cf-bff9-4215-ac1f-6ab84c106fcc", "content": "### 9. 타임라인 및 마일스톤 (초안)\n| 단계 | 기간 | 주요 산출물 |\n| --- | --- | --- |\n| 설계 확정 | 1주 | 설정 파일 스키마/경로, 레코딩 UX 명세 |\n| CLI 구현 | 2주 | 템플릿/로더/명령어 개편, 마이그레이션 도구 초안 |\n| VSCode 연동 | 2주 | UI 업데이트, 명령어/상태 연동 |\n| QA & 문서 | 1주 | 테스트 케이스, 문서/가이드, 릴리즈 노트 |\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 13, "total_chunks": null}}
{"id": "cfa6e2f8-a816-4339-8f1a-ec2b84e39900", "content": "### 10. 오픈 이슈\n- 설정 파일 경로 표준화 (`configs/` vs 루트) 확정 필요.\n- 기존 프로젝트 자동 마이그레이션 여부 결정.\n- 다중 실행 환경(Docker/Dev Container)에서 설정 파일 로딩 경로 보장.\n- `.env` 편집 접근 권한/경합 처리(Extension & CLI) 고려.\n- 레코딩 파일 포맷 확장(메타데이터 보강) 필요성 검토.\n\n---\n본 문서는 FluxLoop v0.2.0의 “설정 파일 분리 & 레코딩 플로우 재정의”를 위해 CLI, VSCode, 문서 전반에 적용해야 할 변경사항을 정리한 것이다.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 14, "total_chunks": null}}
{"id": "3a822d6f-1786-4d4b-bf42-08afd1d56b45", "content": "### 구현 현황 (2025-11)\n- CLI는 `configs/` 구조, `fluxloop record enable/disable/status` 토글, 레코딩 옵션 제거 등 주요 항목을 반영 완료.\n- VSCode Extension은 Activity Bar 재구성, Record Mode 토글 UX 등 주요 흐름을 업데이트.\n- 문서(본 PRD 및 codex_vscode_extention.md)는 v0.2.0 설계를 반영해 갱신됨.\n- 마이그레이션 도구(`migrate config`)는 추후 검토 항목으로 남아 있음.\n", "metadata": {"source": "docs/prd/fluxloop_v0.2.0_settings_recording.md", "chunk_index": 15, "total_chunks": null}}
{"id": "a79c9abd-abcc-43b9-8afd-889bac62f492", "content": "## Fluxloop MCP 서버 구축 계획(PRD)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "595e13f6-2e73-4000-8cc6-ad3ce82b6a1f", "content": "### 배경 / 문제 정의\n- **문제**: 프로젝트별 SDK 설치·설정·코드 삽입 패턴이 매우 다양해 초기 온보딩/통합 난이도와 시간이 크게 변동.\n- **가설**: 조직 지식(문서/FAQ/레시피)을 표준 인터페이스(MCP)로 노출하고, 레포 분석 기반의 “에디트 플랜”을 생성하면, 통합 성공률과 속도를 안정화/상향할 수 있음.\n- **접근**: 우선 MCP 서버를 구축해 지식/규칙을 표준화하고, 클라이언트(IDE/에이전트/CLI)는 MCP 툴을 호출해 플랜과 답변을 획득. 코드 쓰기는 후속 단계에서 별도 승인형 적용기로 처리.\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a4d63431-c767-4b60-9ce0-28138eb8cdde", "content": "### 목표(Goals)\n- Fluxloop 전용 MCP 서버 제공: 조직 지식/레시피/분석기를 단일 인터페이스로.\n- 레포 스캔 → 프레임워크/언어 감지 → 통합 절차 제안까지의 최소 파이프라인 완성.\n- Q&A(FAQ/문서 질의) 품질을 실사용 가능한 수준으로 제공.\n- 결과물은 “에디트 플랜(JSON)”과 “체크리스트” 형태로 표준화.\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "b77190d8-5103-48ef-a059-c7b044a909e8", "content": "### 비목표(Non-Goals)\n- IDE 확장/자동 코드 수정 기능 자체 제공(본 PRD 범위 밖). 단, 적용을 고려한 플랜 출력은 포함.\n- 모든 언어/프레임워크 완전 커버리지. 1차는 Python/TypeScript의 대표 프레임워크 우선.\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "73c55d12-1c53-4a87-a791-f7ed37155021", "content": "### 타깃 사용자/클라이언트\n- AI 코딩 에이전트(예: VS Code 확장, 외부 MCP 클라이언트, CLI) \n- 내부 개발자: 통합 가이드/레시피 최신화와 검증\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "98aa70d8-1701-413d-95ba-48413862a156", "content": "### 성공 지표(KPIs)\n- 첫 통합 시나리오(Express/FastAPI)에 대해 에디트 플랜 승인 후 무오류 빌드율 ≥ 80%\n- RAG 기반 FAQ 응답의 사용자 만족도(4점/5점 이상) ≥ 75%\n- 통합 작업 평균 소요시간 30% 이상 단축(기준선 대비)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "85e44190-3ae1-40b6-a2e2-555a7fa0bd04", "content": "## 범위(Scope)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "f8b6f809-8600-42a5-ae1e-ac85b4e1dac4", "content": "### 기능적 요구사항(Functional Requirements)\n1) 문서/레시피/FAQ RAG\n   - `faq` 툴: 조직 문서/가이드/샘플을 근거로 답변 반환(출처 citation 포함)\n2) 레포 분석\n   - `analyze_repository` 툴: 언어/패키지 매니저/엔트리포인트/구조 요약\n   - `detect_frameworks` 툴: 프레임워크 및 삽입 포인트 후보 식별\n3) 통합 절차 생성\n   - `generate_integration_steps` 툴: 프레임워크별 단계적 통합 절차 생성\n   - `propose_edit_plan` 툴: 승인형 에디트 플랜(JSON) 생성(앵커/전략/사후점검 포함)\n4) 유효성/검증\n   - `validate_edit_plan` 툴: 플랜 정합성 점검(앵커 존재, 충돌 감지, 후속 체크 정의)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "4451e93b-3f85-4c5f-9d6d-125805f518e7", "content": "### 비기능 요구사항(Non-Functional Requirements)\n- 신뢰성: 툴 호출 1초 내 응답(캐시/요약 활용), 대형 문서는 스트리밍 or 페이징\n- 품질: 소스·버전 기반 citation 필수, 환각 최소화 가드레일(스키마/루브릭)\n- 보안/프라이버시: 기본 read-only, 민감정보 마스킹, 원본 경로/라인 최소 노출\n- 유지보수성: 레시피/스키마를 데이터화하여 빠른 갱신 가능\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "d3ec1485-e6a3-4f82-b9f5-6b71ae0bfa7b", "content": "## 아키텍처 개요\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "e89ddaa9-138d-4e10-a432-8bb8b13c88a4", "content": "### 구성요소\n- MCP 서버 코어: Tool Router, Schema Validator, Audit Logger\n- Knowledge Ingestor: `docs/`, `packages/README.md`, `packages/website/docs-cli/**`, `packages/website/docs-sdk/**`, `samples/` 문서 인덱싱\n- Retriever/Ranker: 임베딩/키워드 혼합 검색(초기: 단순 BM25 + 경량 임베딩)\n- Analyzers: 레포 스캔기(언어/프레임워크/엔트리포인트 탐지)\n- Recipe Engine: 언어/프레임워크별 삽입 규칙/전략을 데이터로 정의\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "020feb75-dcdd-4eb8-a50d-9cc364ec0e9a", "content": "### 상호작용 흐름(요약)\n1. 클라이언트 → MCP 툴 호출(예: `analyze_repository`)\n2. 서버: 레포 스캔/지식 검색 → 스키마화된 응답(프로파일/플랜)\n3. 클라이언트: 결과를 UI로 노출, 필요 시 다음 툴 호출 연결\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "600730f2-691c-4289-bfa5-9021ddc0b7d9", "content": "## 디렉터리 구조(제안)\n\n```\npackages/mcp/\n  pyproject.toml (or setup.cfg)\n  README.md\n  fluxloop_mcp/\n    __init__.py\n    server.py               # MCP 서버 엔트리포인트(stdio)\n    tools/\n      __init__.py\n      faq.py\n      analyze_repository.py\n      detect_frameworks.py\n      generate_integration_steps.py\n      propose_edit_plan.py\n      validate_edit_plan.py\n    index/\n      __init__.py\n      ingestor.py           # 문서/레시피 수집\n      retriever.py          # 검색/랭킹(BM25 + 임베딩 혼합)\n      embedder.py           # 임베딩 생성\n      validator.py          # 인덱스 검증", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "67046b49-d764-406a-a09e-cddd1fcc5633", "content": "      store.py              # 인덱스/메타 저장(sqlite/jsonl)\n    recipes/\n      express.json         # TS/Express 통합 레시피\n      nextjs.json          # TS/Next.js 통합 레시피\n      fastapi.json         # Py/FastAPI 통합 레시피\n    schemas/\n      repository_profile.json\n      integration_step.json\n      edit_plan.json\n      runner_pattern_metadata.json\n    tests/\n      test_tools_faq.py\n      test_repo_analyzer.py\n      fixtures/\n        sample_express/\n        sample_fastapi/\n  scripts/\n    rebuild_index.sh\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "0ef6565e-fb97-4b3b-a69f-450a99a354cc", "content": "## MCP 툴 사양(초안)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "c98ed6b2-bbc6-482c-9909-2f121d08119c", "content": "### 공통\n- 포맷: JSON(JSON Schema 기반 검증)\n- 에러: `code`, `message`, `details`를 포함\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "5c0b0286-6807-4566-a4c6-0956010331af", "content": "### 1) faq\n- 입력\n\n```json\n{\n  \"query\": \"Next.js에서 SDK 초기화 위치는?\",\n  \"topK\": 5\n}\n```\n\n- 출력\n\n```json\n{\n  \"answer\": \"App Router 사용 시 app/layout.tsx에서 ...\",\n  \"citations\": [\n    { \"source\": \"docs/README.md\", \"lines\": [120, 150] },\n    { \"source\": \"packages/docs/guides/next.md\", \"lines\": [30, 58] }\n  ]\n}\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "2d42be9b-a249-4389-84b0-f5b859d86b24", "content": "### 2) analyze_repository\n- 입력\n\n```json\n{ \"root\": \".\", \"globs\": [\"**/*.py\", \"**/*.{ts,tsx}\"] }\n```\n\n- 출력(요약)\n\n```json\n{\n  \"languages\": [\"python\", \"typescript\"],\n  \"packageManagers\": [\"pip\", \"npm\"],\n  \"frameworkCandidates\": [\"fastapi\", \"express\"],\n  \"entryPoints\": [\"src/server.ts\", \"app/main.py\"],\n  \"riskFlags\": [\"multiple_entrypoints\"],\n  \"stats\": {\"files\": 324, \"loc\": 27453}\n}\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "d820fb6a-f5e2-4eb3-9c4d-57cd1306d3f4", "content": "### 3) detect_frameworks\n- 입력: `{\"entryPoints\": [\"...\"]}`\n- 출력: 프레임워크, 버전 추정, 삽입 포인트 후보\n\n```json\n{\n  \"frameworks\": [\n    {\n      \"name\": \"express\",\n      \"confidence\": 0.92,\n      \"insertAnchors\": [\n        {\"filepath\": \"src/server.ts\", \"pattern\": \"app.use(\"}\n      ]\n    }\n  ],\n  \"recommended_patterns\": [\n    {\n      \"framework\": \"express\",\n      \"runner_pattern\": \"http-rest\",\n      \"doc_url\": \"packages/website/docs-cli/configuration/runners/http-rest.md\",\n      \"confidence\": 0.9\n    }\n  ]\n}\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "f263b2a5-0ab1-4c3a-b9b7-ffabe752823b", "content": "### 4) generate_integration_steps\n- 입력: `{\"framework\": \"express\", \"goals\": [\"request tracing\", \"error capture\"]}`\n- 출력: 체크리스트형 단계\n\n```json\n{\n  \"steps\": [\n    {\"id\": \"pkg_install\", \"title\": \"패키지 설치\", \"details\": \"npm i @fluxloop/sdk\"},\n    {\"id\": \"init_sdk\", \"title\": \"SDK 초기화\", \"details\": \"src/server.ts 상단에서 ...\"}\n  ]\n}\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "8dbbc4c7-1947-412b-8051-4fd54d23bc48", "content": "### 5) propose_edit_plan\n- 입력: `RepositoryProfile`, 선택된 `framework`, `steps`\n- 출력: 승인형 에디트 플랜\n\n```json\n{\n  \"summary\": \"Express 진입점에 Fluxloop 미들웨어 추가\",\n  \"edits\": [\n    {\n      \"filepath\": \"src/server.ts\",\n      \"strategy\": \"insert_middleware\",\n      \"anchors\": [\n        {\"type\": \"after_match\", \"pattern\": \"const app = express()\"}\n      ],\n      \"payload\": {\n        \"import\": \"import { fluxloop } from '@fluxloop/sdk';\",\n        \"code\": \"app.use(fluxloop({ projectKey: '...' }));\"\n      }\n    }\n  ],\n  \"postChecks\": [\"npm run build\", \"curl http://localhost:3000/health\"],", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "be41ff37-121d-4bec-bf7a-d69e1063d587", "content": "  \"rollback\": {\"instruction\": \"git restore -SW :/\"}\n}\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 21, "total_chunks": null}}
{"id": "2a4f7ff6-0d61-40af-9654-550fee81302e", "content": "### 6) validate_edit_plan\n- 입력: `{\"plan\": EditPlan}`\n- 출력: 정합성 보고서(앵커 유효, 충돌 가능성, 후속 체크 적정성)\n\n```json\n{ \"valid\": true, \"issues\": [], \"warnings\": [\"multiple_entrypoints\"] }\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 22, "total_chunks": null}}
{"id": "6198a292-ffc7-4b2b-8361-87333e53630c", "content": "## 레시피 설계(데이터 우선)\n- JSON 기반 규칙: 언어/프레임워크별 삽입 전략을 데이터로 정의(패턴, 앵커, 코드 조각 템플릿)\n- 예: `recipes/express.json`\n\n```json\n{\n  \"framework\": \"express\",\n  \"pkgManager\": \"npm\",\n  \"packages\": [\"@fluxloop/sdk\"],\n  \"anchors\": [\n    {\"name\": \"app_init\", \"pattern\": \"const app = express()\"}\n  ],\n  \"edits\": [\n    {\n      \"strategy\": \"insert_middleware\",\n      \"anchor\": \"app_init\",\n      \"import\": \"import { fluxloop } from '@fluxloop/sdk';\",\n      \"snippet\": \"app.use(fluxloop({ projectKey: '${projectKey}' }));\"\n    }\n  ]\n}\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 23, "total_chunks": null}}
{"id": "72e49465-7cca-4605-bd22-545b06917786", "content": "## 인덱싱/검색 전략\n- 수집 대상: `docs/`, `packages/website/docs-cli/**`, `packages/website/docs-sdk/**`, `packages/sdk/` 내 주석/README, `samples/`\n- 전처리: 마크다운/코드블록 분리, 헤딩 단위 chunking, 문서 메타(버전/출처) 유지\n- 검색: BM25(초기) + 경량 임베딩 혼합(추후 교체 가능), topK 5~8, rerank 시 citation 보존\n- 캐시: 쿼리/결과 캐시, 서버 재시작 간 단기 지속성(sqlite/jsonl)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 24, "total_chunks": null}}
{"id": "3b949748-ca3b-4865-b1a9-1075820e3044", "content": "### 스토리지 백엔드 선택(벡터 DB 검토)\n- 기본(P0): 로컬 하이브리드 백엔드\n  - 메타데이터: SQLite(`store.db`)\n  - 벡터: 인프로세스 FAISS 인덱스 파일(`faiss.index`) + 메모리 로드\n  - 장점: 외부 의존성 없음, 빠른 초기화, CI 친화적\n- 확장(P1): 선택적 벡터 DB(Qdrant 권장)\n  - 활성화: 환경변수 `MCP_VECTOR_BACKEND=qdrant`, `MCP_QDRANT_URL`, `MCP_QDRANT_API_KEY`\n  - 사용 시점 가이드: 문서 청크 > 10k, 다중 사용자 동시성, 고급 페이로드 필터 필요\n- 인터페이스: `Retriever`를 백엔드 불문 동일 API로 추상화(`Bm25Retriever`, `HybridFaissRetriever`, `QdrantRetriever`)\n- 결론: 초기는 로컬 하이브리드로 시작, 규모/요구 증가 시 Qdrant로 전환 가능하도록 플러그형 설계\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 25, "total_chunks": null}}
{"id": "a4a45eb4-8aef-4421-9580-e133b23ddc68", "content": "## 보안/프라이버시/감사\n- 기본 read-only, 파일 컨텐츠는 최소 필요 범위만 요약/부분 노출\n- 감사 로깅: 툴 호출, 파라미터 요약, 응답 해시/크기, citation 목록\n- 비식별화: 경로/라인번호 과도 노출 금지, 민감 키/시크릿 마스킹 필수\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 26, "total_chunks": null}}
{"id": "08a3d129-47ad-4b05-8f90-4be1dce39e93", "content": "## 테스트 전략\n- 단위: 각 툴 I/O 스키마 검증, 실패 케이스(앵커 미발견 등)\n- 계약: 샘플 리포/문서로 golden 테스트(출력 안정성)\n- E2E: `examples/simple-agent`와 연동, 시나리오별 통합 테스트\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 27, "total_chunks": null}}
{"id": "5891b108-4653-4d82-a613-764dcc9f04cc", "content": "## 배포/운영\n- 패키징: `packages/mcp` 파이썬 패키지, 엔트리포인트 `fluxloop-mcp`(stdio)\n- 운영: 버전 태깅, 레시피/지식 베이스는 데이터 버전과 함께 관리\n- 모니터링: 호출량/응답시간/정확도 피드백(옵트인 텔레메트리)\n- 구성: 백엔드 선택을 환경변수로 제어(`MCP_VECTOR_BACKEND=none|faiss|qdrant`)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 28, "total_chunks": null}}
{"id": "d12fde6a-79a7-45e2-af9a-cee4c8b70da6", "content": "## 마일스톤/일정(초안)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 29, "total_chunks": null}}
{"id": "8f07e950-9666-4a62-990a-aa0445665d9f", "content": "### M0(주 1): 스켈레톤 + RAG PoC\n- 서버 골격(stdio), `faq` 툴 구현\n- 인덱싱 파이프라인(문서/가이드 최소 집합) 구축\n- 간단한 검색 + citation 제공\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 30, "total_chunks": null}}
{"id": "c1751e83-1609-400d-a7fe-70bfc878e4ea", "content": "### M1(주 2): 레포 분석/탐지\n- `analyze_repository`, `detect_frameworks` 구현(Python/TS)\n- 샘플 리포로 golden 테스트\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 31, "total_chunks": null}}
{"id": "93b0e8f2-da60-4f7d-81e4-f228fb762e5d", "content": "### M2(주 3): 통합 절차/플랜\n- `generate_integration_steps`, `propose_edit_plan`, `validate_edit_plan`\n- 1차 대상: Express, FastAPI\n- 출력 스키마 확정(EditPlan v0)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 32, "total_chunks": null}}
{"id": "84d99040-2347-4539-9d05-b0084250474d", "content": "### M3(주 4): 품질/안정화\n- 성능/캐시, 에러 처리/감사 로깅 정비\n- 문서/가이드 업데이트, 내부 베타 적용\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 33, "total_chunks": null}}
{"id": "f1718394-95bf-48fc-9d37-f87456dbc93e", "content": "## 오픈 이슈\n- 임베딩 모델 선택/라이선스(로컬 vs API) 정책\n- 다언어 레시피 스케일 전략(AST 기반 코드모드 도입 시점)\n- PR 생성/적용기와의 계약(후속 PRD)\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 34, "total_chunks": null}}
{"id": "3dceab5f-486e-4e6a-8a53-23e76353e1b4", "content": "## 부록: 스키마 요약(발췌)\n\n```json\n// schemas/repository_profile.json\n{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"languages\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n    \"packageManagers\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n    \"frameworkCandidates\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n    \"entryPoints\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n    \"riskFlags\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n    \"stats\": {\n      \"type\": \"object\",", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 35, "total_chunks": null}}
{"id": "0c344fb1-119f-4720-904a-c69ce240d8b9", "content": "      \"properties\": {\"files\": {\"type\": \"number\"}, \"loc\": {\"type\": \"number\"}}\n    }\n  },\n  \"required\": [\"languages\", \"packageManagers\"]\n}\n```\n\n```json\n// schemas/edit_plan.json\n{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"summary\": {\"type\": \"string\"},\n    \"edits\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"filepath\": {\"type\": \"string\"},\n          \"strategy\": {\"type\": \"string\"},\n          \"anchors\": {\"type\": \"array\"},", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 36, "total_chunks": null}}
{"id": "190cc6f4-e66a-4de5-a513-eb0d8bf08f74", "content": "          \"payload\": {\"type\": \"object\"}\n        },\n        \"required\": [\"filepath\", \"strategy\"]\n      }\n    },\n    \"postChecks\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n    \"rollback\": {\"type\": \"object\"}\n  },\n  \"required\": [\"summary\", \"edits\"]\n}\n```\n\n---\n\n문서 소유: Platform 팀 / Fluxloop\n최초 작성: 2025-11-07\n상태: Draft v0.1\n\n", "metadata": {"source": "docs/prd/mcp/mcp_server_plan.md", "chunk_index": 37, "total_chunks": null}}
{"id": "b6c1f5e4-a8cb-491e-b4c6-0a48da0d6f2e", "content": "# FluxLoop MCP V2 Implementation Plan: \"Hybrid Agent Orchestration\"\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "524a0804-2066-4cc7-884d-49600f35d330", "content": "## 1. 배경 및 전환 목표\n- **현재 상태**: Flux Agent(`run_flux_agent`)가 MCP 서버 내에서 \"워크플로 + RAG + 결정론적 제안 생성\"을 모두 수행.\n- **문제점**: MCP가 LLM 호출까지 맡을 경우 API 키/비용 제어가 어렵고, 반대로 클라이언트가 모든 프롬프트를 관리하면 로직 파편화가 발생.\n- **V2 목표**: **\"MCP는 실행 계획(Planner)과 컨텍스트를 제공하고, 클라이언트는 실행(Executor)을 담당한다.\"**\n  - MCP: 통합 노하우를 담은 **프롬프트 템플릿**과 **데이터 흐름(Flow)**을 설계해 제공.\n  - Client: 사용자 API 키로 실제 LLM 호출을 수행하며, 모델 선택 및 스트리밍 UX를 제어.\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "3faa54f6-c781-4efb-a263-cd319274d0ea", "content": "## 2. 아키텍처 변화\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "c4730f35-bfca-45b8-b77b-ca5448b877e3", "content": "### AS-IS (V1.5)\n```mermaid\nsequenceDiagram\n    VSCode->>MCP: run_flux_agent(context)\n    MCP->>MCP: All logic (Analysis -> RAG -> Proposal)\n    MCP-->>VSCode: Final Result (JSON/Markdown)\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "82397f52-39bf-4145-93c1-abd5b7f4ee71", "content": "### TO-BE (V2: Hybrid Orchestrator)\n```mermaid\nsequenceDiagram\n    VSCode->>MCP: prepare_agent_execution(context)\n    MCP-->>VSCode: Plan { profile, 1st_prompt_template, rag_topics }\n    \n    VSCode->>LLM: 1st Call (Analyze Structure)\n    Note right of VSCode: Input: Plan.1st_prompt_template filled with profile\n    LLM-->>VSCode: structure_report (framework, keywords)\n\n    VSCode->>MCP: retrieve_rag_docs(topics + keywords)\n    MCP-->>VSCode: rag_documents (snippets + citations)\n\n    VSCode->>LLM: 2nd Call (Generate Suggestion)", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c9649cfd-829a-44a3-bcb8-88b769e8fce3", "content": "    Note right of VSCode: Input: Plan.2nd_prompt_template filled with structure + rag_docs\n    LLM-->>VSCode: Final Integration Plan\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "2f9651d8-76ae-489a-9508-b5a2f57239f2", "content": "## 3. MCP 도구 인터페이스 (Public Tools)\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "247c446b-7df0-49bc-8fde-62cc3cc03884", "content": "### 3.1 `prepare_agent_execution` (New)\n- **입력**: `{ \"root\": \"...\", \"context\": { \"scope\": \"...\", \"targets\": [...] } }`\n- **출력**:\n  ```json\n  {\n    \"repo_profile\": { ... },\n    \"rag_topics\": [ ... ],\n    \"prompts\": {\n      \"structure_analysis\": \"System: You are... User: Here is the profile...\",\n      \"integration_suggestion\": \"System: You are... User: Based on structure {structure} and docs {docs}...\"\n    }\n  }\n  ```\n- **역할**: 정적 분석을 수행하고, LLM에게 보낼 **프롬프트 템플릿**과 **1차 컨텍스트**를 조립해 반환.\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "3a22c99c-31c8-4f3e-9e9b-5968937ec8ac", "content": "### 3.2 `retrieve_rag_docs`\n- **입력**: `{ \"topics\": [{ \"query\": \"...\", \"id\": \"...\" }] }`\n- **출력**: `rag_documents` (`[{ \"id\", \"excerpt\", \"citation\", \"score\" }]`)\n- **역할**: 로컬 인덱스에서 RAG 수행. 1차 LLM 결과(키워드)를 반영해 검색어 보정 가능.\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "a537aeaf-6358-4947-98f2-2f133e869edc", "content": "### 3.3 `collect_repo_profile` / `run_integration_workflow`\n- **역할**: 단독 사용 가능한 저수준 분석 도구 (디버깅 또는 타 에이전트용).\n\n---\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "444c5538-5bee-4dd7-839e-c04e8f6a8d68", "content": "## 4. 클라이언트(VS Code) 구현 가이드\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "edf233b4-b87f-428a-9809-8275330f6c8f", "content": "### 4.1 실행 흐름 (Execution Flow)\n1. **Init**: 사용자에게 워크스페이스/범위 선택 UI 제공.\n2. **Plan Request**: `prepare_agent_execution` 호출.\n3. **1st Thinking**:\n   - MCP가 준 `prompts.structure_analysis`를 사용해 1차 LLM 호출.\n   - 모델: `gpt-5-turbo` (빠르고 저렴).\n4. **Fact Checking**:\n   - 1차 LLM 결과에서 키워드 추출, MCP가 준 `rag_topics`와 합쳐 `retrieve_rag_docs` 호출.\n5. **Final Proposal**:\n   - MCP가 준 `prompts.integration_suggestion` 템플릿에 1차 결과 + RAG 문서를 채워 2차 LLM 호출.\n   - 모델: `gpt-5.1-mini` / `claude-4.5-sonnet` (고품질).\n   - 응답을 스트리밍으로 패널에 표시.\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "92ac6f26-202e-483b-8d3a-09afc2aa1840", "content": "### 4.2 장점\n- **Standardized Intelligence**: \"어떻게 질문해야 좋은 답이 나오는가\"는 MCP가 관리하므로, 모든 클라이언트가 동일한 고품질 프롬프트를 사용.\n- **Client Control**: 비용, 모델 속도, 키 관리, UI 표시 방식은 클라이언트가 주도.\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "e4324755-e1f3-4618-b713-11119628e105", "content": "## 5. 구현 로드맵\n\n| 단계 | 작업 항목 | 예상 일정 |\n|---|---|---|\n| **Phase 1** | `FluxAgentOrchestrator`를 `ExecutionPlanner`로 리팩터링 (프롬프트 템플릿 반환) | Week 1 |\n| **Phase 2** | VS Code `IntegrationService`에 템플릿 기반 실행 로직 구현 | Week 2 |\n| **Phase 3** | RAG 품질 개선 및 프롬프트 템플릿 고도화 (LangSmith 등 활용) | Week 3 |\n| **Phase 4** | 예제 프로젝트 및 문서 배포 | Week 4 |\n", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "2f8bdf9c-8fee-497c-be7f-c80f758dcace", "content": "## 6. 결론\nMCP는 **\"작전 참모(Planner)\"**로서 최적의 공략법(프롬프트)과 정보(컨텍스트)를 제공하고, 클라이언트는 **\"현장 지휘관(Commander)\"**으로서 자원(LLM, API Key)을 투입해 작전을 실행합니다.", "metadata": {"source": "docs/prd/mcp/mcp_v2_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "38cb7216-4545-4cb4-9c98-230db989759a", "content": "# FluxLoop MCP V3 Plan: Testing & Multi-Mode Expansion\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "69970f60-e58b-4988-ba32-3d866ed5f880", "content": "## 1. 목표 요약\n- V2에서 정립한 **VS Code Orchestrator ↔ MCP Data Service** 분리 구조를 실서비스 수준으로 검증\n- Flux Agent의 **E2E 신뢰도/UX**를 높이고 동일 오케스트레이션을 **Base Input, Experiment, Insight 모드**까지 확장\n- 산출물: 안정적인 integration 모드 + 모드별 데이터 서비스/플래너 스펙, 테스트 레포트, 문서화\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "f57d29bd-d68b-49e7-a3e7-3dc1ef06ee55", "content": "## 2. 주요 단계\n\n| Phase | 기간(예상) | 핵심 작업 |\n| --- | --- | --- |\n| **P0: Readiness Check** | Week 0.5 | 환경 정비(인덱스, API 키), 테스트 Repo 선정, 측정 항목 정의 |\n| **P1: Integration 모드 QA** | Week 1 | VS Code ↔ MCP ↔ LLM E2E QA, 오류 모니터링, 회귀 버그 수정 |\n| **P2: UX & Telemetry** | Week 2 | 패널 개선(스트리밍, citation 표시), 재실행 UX, 결과 로그/메트릭 수집 |\n| **P2.5: Integration Planner 이관** | Week 2-2.5 | `mcp_v2_plan` 기반 Integration 플래너를 VS Code로 이동, MCP API를 데이터 서비스로 축소 |\n| **P3: 멀티 모드 설계** | Week 2-3 | MCP 컨텍스트 수집 API 정의 + VS Code 플래너/UX 스펙 수립 |\n| **P4: 멀티 모드 구현 & QA** | Week 3-4 | MCP 정보 서비스 확장 + VS Code 오케스트레이션/LLM 통합 테스트 |", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "c6b24c9f-3b37-4404-98ba-fc699db2c40e", "content": "| **P5: 문서화 & 릴리즈** | Week 4 | PRD/README/UX 가이드 업데이트, 릴리즈 플랜 수립 |\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "885b1212-d612-4929-84c4-2ce6675241f4", "content": "## 3. 상세 작업\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "862a2525-77d7-445a-b99e-d283f7b6dd2a", "content": "### P0. 준비 (Readiness)\n- **테스트 Repo 풀 구성**: FastAPI, Flask, Django, LangChain 등 최소 5개 샘플\n- **LLM/Index 상태 확인**: RAG index 재빌드, OpenAI/Anthropic 키 유효성 점검\n- **측정 항목 정의**: 응답 시간, 토큰 사용량, 실패율, RAG hit rate/coverage\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "9a963ff1-0c0e-47ee-9f1c-5ef74a255fd1", "content": "### P1. Integration 모드 QA (현재 구현 검증)\n1. **Scenario Runbook**\n   - 각 샘플 repo에서 Flux Agent 실행 → 성공 여부·제안 품질 기록\n   - 에러 케이스(인덱스 미존재, API 실패 등) 강제 테스트\n2. **버그 픽스**\n   - 플래너 템플릿 누락, JSON 파싱 실패 등 V2에서 남은 문제 해결\n3. **결과 로그**\n   - Telemetry 이벤트 설계(선택 스코프, 모델, 성공/실패) → 차후 분석 대비\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "17572d47-61de-4158-a127-d97b7a2a23b4", "content": "### P2. UX & Telemetry 개선\n- **패널 UX**: 구조 보고서, citation 목록, 재실행 버튼, “사용한 컨텍스트” 요약 표시\n- **스트리밍**: 2차 LLM 응답을 패널에 스트리밍해 체감 속도 향상\n- **Telemetry**: VS Code에서 `fluxloop/flux_agent` 이벤트 로깅 → MCP/LLM 성공률 추적\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "11d29f14-6860-438c-981f-d3f0d8c44d79", "content": "### P2.5 Integration Planner 이관 계획 (`mcp_v2_plan.md` 기준 복기)\n- **기존 아키텍처 재검토**: `mcp_v2_plan.md`의 Hybrid Orchestrator 흐름(`prepare_agent_execution`, `retrieve_rag_docs`)을 리마인드하고, 어떤 부분이 VS Code로 옮겨져야 하는지 명세\n- **플래너 모듈 추출 계획**: VS Code `IntegrationService`에서 사용할 `IntegrationPlannerBridge` (프롬프트 템플릿, 단계별 LLM 호출, 에러 처리) 설계안을 작성\n- **MCP API 축소안**: `prepare_agent_execution`을 `fetch_integration_context`로 단순화해 RAG/분석 데이터만 반환하도록 변경 계획 수립, 변경 영향도/타임라인 정의\n- **검증 지표**: 이관 이후에도 `mcp_v2_plan.md`에서 정의한 1st/2nd LLM 호출 품질을 유지하기 위한 비교 테스트 항목 작성", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "fa95d4c5-0c44-4f7e-9a35-24701499ce36", "content": "### P3. 멀티 모드 설계 (VS Code Planner + MCP 컨텍스트)\n- **Base Input 모드**: 실험용 기본 입력 세트 제안; MCP가 입력 스키마/샘플 코드 토픽을 수집하고 VS Code 플래너가 실행 플로우 생성\n- **Experiment 모드**: `simulation.yaml`, 멀티턴 시나리오 초안 생성; MCP가 과거 실험 기록/runner 설정을 모드 컨텍스트로 패키징\n- **Insight 모드**: 평가 로그·리포트 분석; MCP가 결과 파일 경로·메트릭을 자동 수집하고 VS Code가 진단/조언 플랜을 생성\n- **공통 요소**: MCP는 모드별 `fetch_<mode>_context` API/스키마를 제공하고, VS Code는 기존 Integration 플래너를 모드 aware 오케스트레이션으로 일반화하며 UX에서 모드 선택 + 추가 입력을 수집\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "819dda04-f84d-45fa-8f87-f1df3c91a9bc", "content": "### P4. 구현 & QA\n1. **MCP (정보 서비스)**\n   - 모드별 컨텍스트 수집 API(`fetch_base_input_context`, `fetch_experiment_context`, `fetch_insight_context`) 구현 및 RAG 토픽/가중치 전략 정의\n   - 실험 로그, 러너 설정, 메트릭 스토리지 등 외부 자원 커넥터를 모듈화해 VS Code가 요청 시 JSON으로 응답\n2. **VS Code (플래너/오케스트레이터)**\n   - `mcp_v2_plan.md`에서 정의한 Integration 플래너 자산(프롬프트 템플릿, 1st/2nd 호출 순서, RAG 액세스)을 VS Code 확장 내 `PlannerOrchestrator` 모듈로 완전히 이관\n   - 기존 Integration 플래너를 공통 코어로 추출하고, 모드 파라미터 기반으로 LLM 호출·스트리밍·에러 처리를 확장\n   - 모드 선택 UI와 추가 입력 폼, 재실행/telemetry를 단일 오케스트레이션 모듈에서 관리\n3. **QA**", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "496d4bff-992b-4aa6-88a4-973230509313", "content": "   - 모드별 샘플 프로젝트/로그로 VS Code ↔ MCP 왕복 호출과 LLM 응답을 실제 실행\n   - 회귀 테스트: Integration 모드가 기존과 동일하게 동작하는지 자동 체크, 신규 모드는 최소 1개 레퍼런스 시나리오 확보\n   - `python3 -m pytest packages/mcp -k \"multi_mode_regression\"`으로 `packages/mcp/fluxloop_mcp/tests/tools/test_multi_mode_regression.py`를 포함한 컨텍스트 회귀 스위트를 `.venv` 환경에서 주기적으로 실행\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "ed205cb3-95b8-4ee8-b088-47318ea8e58a", "content": "### P5. 문서화 & 릴리즈\n- `mcp_v2_plan.md` 대비 변경 사항을 요약해 공유\n- VS Code README/사용자 가이드에 모드 설명, 설정 옵션, 오류 대처법 추가\n- 릴리즈 플랜: 베타 사용자 → 점진 롤아웃, telemetry 기반 검증 후 정식 배포\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "f39abd21-3fd1-41bb-b0d5-d17fbea7c4ac", "content": "## 4. 리스크 & 대응\n| 리스크 | 대응 |\n| --- | --- |\n| LLM 비용/지연 증가 | 구조 분석은 경량 모델, 제안은 고품질 모델 사용; 캐시/재시도 정책 명확화 |\n| RAG 품질 편차 | 인덱스 자동 재빌드, 검색어 튜닝 로그 수집, topic 가중치 조절 |\n| 모드 복잡도 증가 | VS Code 플래너 공통 모듈 + MCP 데이터 API 재사용으로 유지보수성 확보 |\n| VS Code UX 과부하 | 모드별 Wizard, 최근 선택값 기억, 표준화된 에러 메시지/가이드 제공 |\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "aceeb4b3-58cd-49fd-83b7-7fcec0de30ff", "content": "## 5. 기대 효과\n- Integration 모드 신뢰성 확보 + QA 지표 기반 개선 사이클 확립\n- Base Input/Experiment/Insight 모드 추가로 Flux Agent 활용 범위 확대\n- MCP 데이터 서비스 패턴의 범용화로 IDE/CLI/웹 등 다양한 클라이언트에서 동일 정보 수집을 재사용 가능\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "fc911413-ccdb-406f-a78e-0f73a26202b2", "content": "## 6. 구현 플랜 (Action Items)\n1. **VS Code `IntegrationPlannerBridge` 추출 (Week 2)**  \n   - `IntegrationService` 내 기존 플래너 로직을 모듈화해 1차/2차 LLM 호출, 프롬프트 치환, 스트리밍 출력을 한곳에서 관리\n   - `mcp_v2_plan.md`에서 정의한 템플릿/토픽 구성을 테스트 코드와 함께 이전\n2. **MCP API 축소 및 컨텍스트 전용화 (Week 2-3)**  \n   - `prepare_agent_execution` → `fetch_integration_context` 리네임/리팩터링, 응답 스키마를 RAG 토픽 + 레포 분석 결과만 포함하도록 단순화\n   - 모드별 `fetch_<mode>_context` 초안과 동일한 인증/에러 패턴을 재사용\n3. **Multi-Mode 컨텍스트 커넥터 구현 (Week 3)**  \n   - Base Input: 입력 스키마 스캐너/샘플 코드 RAG, Experiment: 실험 로그/runner 설정 어댑터, Insight: 평가 로그·메트릭 파서", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "10f22d4d-ea59-47e1-99a0-eb38a50967ec", "content": "   - 각 커넥터는 캐시 전략과 실패 폴백을 문서화\n4. **VS Code `PlannerOrchestrator` 범용화 (Week 3-4)**  \n   - 모드 파라미터를 받아 컨텍스트 수집 → 플랜 생성 → 실행을 라우팅하며, UI/telemetry 훅을 통합\n   - 재실행 UX, 스트리밍, 에러 처리 공통 모듈을 모드 간 공유\n5. **통합 QA & 릴리즈 게이팅 (Week 4)**  \n   - 모드별 레퍼런스 리포/로그를 활용해 Regression 스위트를 자동화하고, Integration 모드 대비 품질 비교 지표를 산출\n   - 문서/README/릴리즈 노트를 업데이트하고 베타→GA 단계별 telemetry OKR을 설정\n", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "e57c39e5-c418-4d3e-aa4a-3e59ee229d66", "content": "## 7. QA Runbook & 릴리즈 체크리스트\n- **회귀 실행**: `. .venv/bin/activate && python3 -m pytest packages/mcp -k multi_mode_regression`으로 MCP 단위 테스트, VS Code 쪽은 `npm run lint` + 수동 모드 실행으로 모범 시나리오 검증\n- **테스트 항목**: Integration/Base Input/Experiment/Insight 각각 최소 1개 레퍼런스 프로젝트(샘플 repo + inputs/ + experiments/)를 사용\n- **문서 업데이트**: `docs/prd/mcp/mcp_v3_plan.md`와 VS Code README에 모드별 UX/에러 대처법을 최신 상태로 유지, 릴리즈 노트에 회귀 결과/telemetry 지표 첨부\n- **릴리즈 게이트**: 테스트 패스 + telemetry 기준치 충족 시 베타 → GA 전환, 실패 시 회귀 버그 티켓화 및 재검증", "metadata": {"source": "docs/prd/mcp/mcp_v3_plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "ce7c31e4-67ac-45ce-9424-4bcb6a2cab40", "content": "## 접근 전략 개요\n- **2단 분리**: (A) 백엔드·프레임워크 감지, (B) 에이전트/시뮬레이션 로직 감지. 둘 다 룰 기반만으로는 불안정하므로, 다층 정적 분석 + 선택적 LLM 검증 조합을 목표로 합니다.\n- **MCP 파이프라인**: RunIntegrationWorkflowTool을 `기본 프로파일링 → 후보 추출 → 세부 확증` 단계로 재구성하고, LLM은 “확증용”으로만 제한된 컨텍스트(몇 개 파일)에서 사용하도록 설계합니다.\n\n---\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 0, "total_chunks": null}}
{"id": "ff847b63-bf25-42e2-a57e-ee60c35b7844", "content": "## A. 백엔드/프레임워크 감지 고도화\n\n**1. 종합 스캐너(정적 1차)**\n- `requirements.txt`, `pyproject.toml`, `setup.cfg`, `Pipfile` 등에서 주요 패키지 스캔. (예: `fastapi`, `flask`, `django`, `starlette`, `quart`, `aiohttp`, `tornado`)\n- `uvicorn`, `gunicorn`, `hypercorn` 등 런너 힌트도 수집하여 ASGI/WSGI 분류.\n- `Dockerfile`, `docker-compose`, `Procfile` 분석으로 실행 커맨드 확인 (ex. `uvicorn app.main:app`).\n- `configs/` 내 `simulation.yaml`, `.env`에서 runner 관련 키, 포트, 엔드포인트 추출.\n\n**2. 엔트리포인트 탐색(정적 2차)**\n- 규칙 기반 경로(`app/main.py`, `main.py`, `manage.py`, `wsgi.py`, `asgi.py`, `server.py`) 후보를 넘어서, `if __name__ == \"__main__\":`, `uvicorn.run`, `Flask(__name__)` 등 패턴으로 스캔.", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 1, "total_chunks": null}}
{"id": "808f2c0c-9d77-4fbb-91af-9bafaf46a18b", "content": "- Tree-sitter 같은 경량 파서로 `FastAPI()`, `Flask()`, `Blueprint`, `APIRouter`, `Django settings` import 등을 AST 수준에서 체크.\n\n**3. 구조 파악(정적 3차)**\n- 엔트리포인트 파일에서 `app = FastAPI()` 선언 위치, 등록된 라우터(`@app.get`, `include_router`) 목록 추출.\n- Flask의 `@app.route`, Django의 `urlpatterns`, DRF ViewSet 등을 패턴화.\n- 비동기 여부, 실행 스레드/프로세스 관련 코드(`async def`, `Thread`, `Process`)도 기록.\n\n**4. 확신도 산출 & 다중 프레임워크 처리**\n- 감지 결과를 `confidence`(0~1)+`evidence` 구조로 누적.\n- 다중 프레임워크(예: FastAPI + Celery) 가능성을 고려해 상위 2~3개를 리스트. Integration 모드에서는 사용자에게 선택권 제공.\n\n**5. LLM 활용 지점(선택)**", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 2, "total_chunks": null}}
{"id": "a2ff2b0c-1fe6-4aa7-9917-00362687a056", "content": "- 위 단계를 거친 후에도 확신도가 낮을 때만, 상위 3개 파일을 요약해 “이 코드가 어떤 백엔드 프레임워크인지 판별해줘”라는 형태로 소형 LLM 호출.\n- LLM에 raw 전체를 주는 것이 아니라 `framework_signals.json` 같은 요약을 전달해 비용 절감.\n\n---\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 3, "total_chunks": null}}
{"id": "07fbae7c-9da1-4c69-ad49-33c115640990", "content": "## B. 에이전트/시뮬레이션 로직 감지\n\n**1. 이름 기반 후보**\n- 디렉토리명(`agents`, `agent`, `chat`, `playbooks`, `workflows` 등) & 파일명(`*_agent.py`, `scenario*.py`, `simulation.yaml`) 스캔.\n- `import fluxloop` / `from fluxloop import` / `fluxloop_cli` 사용 여부.\n\n**2. Runner/입력 파악**\n- `configs/simulation.yaml`, `configs/input.yaml`, `examples/` 등에서 `runner.type`, `runner.target`, `inputs` 섹션 추출.\n- `per_trace_analysis`, `recordings/` 등 기존 실행 산출물을 확인해 어떤 시나리오가 돌았는지 파악.\n\n**3. 코드 구조 분석**\n- `fluxloop` decorator, context manager, SDK 함수 사용 위치 추적.\n- 에이전트 클라스(`class MyAgent(FluxAgentBase)`) 패턴, LLM 호출 래퍼(`CompletionClient`, `ChatOpenAI`) 등 탐지.", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c60883a4-4f82-43a5-8517-53a4708f8ab5", "content": "- 입력 생성기(`generate_base_inputs`, `InputTemplate`) 및 평가(`evaluate`, `scorer`) 모듈 매핑.\n\n**4. LLM 활용 포인트**\n- 후보 파일 리스트를 정적 분석으로 뽑아낸 뒤, LLM에 “이 파일이 어떤 역할인지” 요약하도록 요청 → Base Input/Experiment 모드에서 필요한 컨텍스트 설명 생성.\n\n---\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 5, "total_chunks": null}}
{"id": "55646121-5b9f-4e16-82b5-d1dbac45efe0", "content": "## MCP 워크플로 확장 구상\n\n| 단계 | 작업 | 출력 |\n| --- | --- | --- |\n| profile_v2 | 위 스캐너를 통해 `framework_signals`, `agent_signals`, `runner_configs` 수집 | `repo_profile_v2.json` |\n| detect_frameworks_v2 | `confidence` 기반 다중 후보, 증거 리스트, 추천 runner 타입 | `framework_candidates` |\n| collect_context | 선택된 프레임워크/폴더 기반으로 관련 파일 스니펫, 설정 파일 추출 | `integration_context` |\n| propose_edit_plan_v2 | 기존 레시피 + 새 신호를 사용해 파일별 diff 제안 | `edit_plan_v2` |\n| validate_plan_v2 | AST 검증, 설정 key 누락, 중복 코드 확인 | `validation_report` |\n\n- LLM 호출은 `collect_context` 이후, 필요한 파일 2~3개만 전달하도록 제한.", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 6, "total_chunks": null}}
{"id": "cb89d810-bff8-4ff5-92ac-a18ed12987cb", "content": "- Integration UX에서 사용자가 선택한 폴더/파일을 `collect_context`에 전달해 분석 범위를 좁혀 False Positive 감소.\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 7, "total_chunks": null}}
{"id": "13a397a6-b304-4d83-9257-f519156f32d7", "content": "### 구현 현황 (2025-11-21)\n- `CollectRepoProfileTool`, `RunIntegrationWorkflowTool` 개편: profile_v2 단계와 LLM 입력(`structure_context`, `rag_topics`) 골격을 생성하는 로직까지 구현 완료.\n- VS Code Flux Agent: 컨텍스트 선택 UX(워크스페이스/스코프/파일·폴더 선택) 적용, 선택 요약을 MCP 워크플로와 LLM 프롬프트에 주입.\n- 미완성: `collect_context`에서 지정한 경로만 추려서 MCP에 전달하는 최적화, RAG 인덱스 조회/LLM 2단 호출, citation 포함 응답 생성.\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 8, "total_chunks": null}}
{"id": "093607fc-57ba-485e-be6c-bf59d8849787", "content": "### 구현 계획 상세\n| 영역 | 현재 상태 | 다음 단계 | 책임/노트 |\n| --- | --- | --- | --- |\n| MCP `profile_v2` | `CollectRepoProfileTool`이 언어/프레임워크/런너 시그널 수집, `RunIntegrationWorkflowTool`이 `repo_profile`·`llm_inputs`를 반환 | `collect_context` 최적화: 선택 경로만 별도 디렉터리로 압축/전달, runner config 검증 로직 강화 | MCP 팀 |\n| LLM context builder | `structure_context`, `rag_topics` 기본 구조만 생성 | 1차 LLM 호출을 위한 JSON 직렬화/압축 규칙 정의, 토큰 budget 기반 trimming 전략 추가 | MCP 팀 |\n| RAG 파이프라인 | `rag_topics`만 생성된 상태 | 실제 인덱스 호출(문서/코드), citation ID 생성, top-N 제한, fallback 로직 구현 | Docs/Search 팀 |", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 9, "total_chunks": null}}
{"id": "352fb392-4c96-464b-bad1-0eb7b8c4bc8a", "content": "| LLM 두 단계 호출 | 단일 OpenAI 호출만 사용 | 1차 LLM(소형) → RAG → 2차 LLM(대형) orchestration, 실패 시 fallback/재시도 정책 | VS Code + MCP 협업 |\n| VS Code 컨텍스트 UX | 스코프 선택 UI, prompt 반영 완료 | 선택 컨텍스트를 MCP에 전달하기 위한 IPC 포맷 정의, 재실행/최근 컨텍스트 캐시 | VS Code 팀 |\n| Suggestions 패널 | context summary 표시 | RAG citation, LLM confidence/risks 표시, Re-run with same scope 버튼 | VS Code 팀 |\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 10, "total_chunks": null}}
{"id": "c333c2df-3c9d-4d26-a103-07a2ed92a518", "content": "### 향후 단계 (2025-11 ~ 2026-01 예상)\n1. **MCP 컨텍스트 제한(Week 1-2)**  \n   - `collect_context` 구현: 선택된 폴더/파일 목록을 받아 관련 코드 스니펫, 설정 파일만 추출.  \n   - 선택 경로 압축/전달 실험, 성능 측정, 실패 시 fallback.\n2. **RAG 서비스 연동(Week 2-4)**  \n   - `rag_topics`를 Kafka/REST 큐에 전달 → index service에서 문서/코드 snippet + citation 생성.  \n   - `rag_documents` 스키마 확정, 응답 크기 제한, 에러 처리.\n3. **LLM 오케스트레이션(Week 4-6)**  \n   - MCP 서버에 `run_flux_agent`(가칭) 엔드포인트 추가: 1차 LLM 호출 → RAG → 2차 LLM → 결과 JSON.  \n   - OpenAI/Anthropic 등 멀티 백엔드 옵션, 비용 측정.\n4. **VS Code 통합(Week 6-8)**  \n   - Flux Agent 명령이 새 MCP 엔드포인트를 호출하도록 변경.  ", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 11, "total_chunks": null}}
{"id": "c30f17e3-a19c-4967-b820-1a7dff30adcd", "content": "   - 결과에 citation/risks/RAG summary 표시, 재실행 UX 개선.\n5. **QA & 문서화(Week 8-10)**  \n   - 샘플 프로젝트 회귀 테스트, docs.mcp 섹션 업데이트, 사용자 가이드/릴리즈 노트 작성.\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 12, "total_chunks": null}}
{"id": "be1413b6-b608-4486-b791-0f5493718e10", "content": "### `repo_profile_v2.json` 스키마\n\n```json\n{\n  \"generatedAt\": \"2025-11-21T05:32:00Z\",\n  \"workspaceRoot\": \"/path/to/project\",\n  \"framework_signals\": [],\n  \"agent_signals\": [],\n  \"runner_configs\": [],\n  \"errors\": []\n}\n```\n\n- `framework_signals: FrameworkSignal[]`\n  - `name`: 후보 프레임워크 식별자 (`fastapi`, `flask`, `django`, …)\n  - `confidence`: 0.0~1.0 float\n  - `evidence`: `[{ \"type\": \"dependency\" | \"ast\" | \"entrypoint\" | \"runtime\" | \"llm\", \"value\": \"fastapi==0.110\", \"file\": \"requirements.txt\", \"line\": 12 }]`\n  - `entrypoints`: 파일 경로 목록 (우선순위 순 정렬)", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 13, "total_chunks": null}}
{"id": "88b5a132-c1db-4fda-b663-8286202c1944", "content": "  - `hints`: 추가 문자열 메모(예: `uvicorn app.main:app` 감지)\n  - `status`: `confirmed` / `likely` / `ambiguous`\n\n- `agent_signals: AgentSignal[]`\n  - `module`: Python 모듈 경로 또는 파일 경로 (`services/agents/support.py`)\n  - `agent_type`: `base_input_generator` / `integration_agent` / `experiment_runner` / `insight_analyzer` 등\n  - `class_or_function`: 주요 진입점 이름 (예: `SupportAgent`)\n  - `framework_dep`: 사용 중인 SDK/라이브러리 (`fluxloop`, `langchain`, `llama_index`, …)\n  - `evidence`: `[{ \"pattern\": \"@fluxloop.agent\", \"file\": \"services/agents/support.py\", \"line\": 45 }]`", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 14, "total_chunks": null}}
{"id": "85b02466-46c2-403a-92af-31c6193521c5", "content": "  - `confidence`: 0.0~1.0\n  - `notes`: 자연어 요약(정적 분석 또는 1차 LLM 결과)\n\n- `runner_configs: RunnerConfig[]`\n  - `source`: `simulation_yaml` / `input_yaml` / `env` / `cli_flag`\n  - `path`: 파일 경로 + YAML 키 경로 (`configs/simulation.yaml#runner.target`)\n  - `runner_type`: `python-function`, `http-rest`, `ws-stream`, …\n  - `target`: 함수/URL 식별자 (`app.main:app`, `https://.../invoke`)\n  - `parameters`: `{ \"timeout\": 30, \"max_concurrency\": 4 }`\n  - `linked_frameworks`: `[\"fastapi\"]`\n  - `confidence`: 정적 분석 수준 + LLM 검증 반영\n\n- `errors`: 스캐너가 실패한 항목 (예: 권한 문제, 파싱 에러) 기록. 각 항목은 `{ \"stage\": \"framework_scan\", \"message\": \"...\", \"file\": \"configs/simulation.yaml\" }`", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 15, "total_chunks": null}}
{"id": "6cdc6dc9-2e47-46aa-954a-1db18b5327c0", "content": "\n> 모든 배열은 중요도/확신도 순으로 정렬하여 1차 LLM에 전달한다.\n\n---\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 16, "total_chunks": null}}
{"id": "7576656a-db38-4be1-a15c-348dc29f2d24", "content": "## LLM 두 단계 호출 전략\n\n1. **1차 LLM (구조 확정)**\n   - 입력: 정적 1~3차 분석 결과 요약(`framework_signals`, `agent_signals`, 핵심 파일 스니펫).\n   - 목표: “백엔드 프레임워크/엔트리포인트/핵심 에이전트 모듈”을 서술하고, 확신도와 추가 필요 데이터 목록을 제시.\n   - 출력: `llm_structure_report` (JSON + 자연어 요약). 확신도가 낮으면 사용자 또는 2차 분석 플로우 요청.\n\n2. **MCP RAG**\n   - `llm_structure_report`가 언급한 키워드/파일을 기반으로 지식 인덱스에서 관련 문서를 수집.\n   - 검색 범위: runner 문서, SDK 레퍼런스, 기존 실험 기록, FAQ.\n   - 결과: `rag_documents` (정규화된 citation + snippet).\n\n3. **2차 LLM (통합 제안 생성)**\n   - 입력: `llm_structure_report`, `rag_documents`, `edit_plan_v2` 초안.", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 17, "total_chunks": null}}
{"id": "1d832c63-bbef-4ddd-bdde-a9e20979bec0", "content": "   - 목표: 구조 확정 + 문서 근거를 바탕으로 실행 가능한 Integration Suggestion 서식 생성(요약, 단계, 코드 diff, 검증, 참고 링크).\n   - 출력: `integration_suggestion` (최종 프롬프트 결과). Confidence/리스크 태그 포함.\n\n4. **에러 핸들링 & UX**\n   - 1차 LLM이 불확실·모순 시 사용자가 직접 프레임워크 선택하도록 UI 노출.\n   - 2차 LLM이 실패하면 RAG 결과를 그대로 UI에 제공하고 “코딩 어시스턴트 활용” fallback 안내.\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 18, "total_chunks": null}}
{"id": "d2bab74e-2b68-45d5-9ee3-efab80ae08cc", "content": "### 장점\n- 정적 분석과 LLM의 역할을 분리해 LLM 입력 범위를 줄이고, 근거(문서/코드) 기반 답변 품질 향상.\n- 두 번째 LLM 호출은 RAG 문서와 edit_plan 초안을 참고하므로, 템플릿 기반 제안 대비 상황 맞춤형 지침 생성 가능.\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 19, "total_chunks": null}}
{"id": "8be86776-c708-4e7c-930c-048ed9513594", "content": "### 주의 사항\n- LLM 두 번 호출에 따른 비용/지연: 구조 보고서는 소형 모델(gpt-4o-mini) 사용, 최종 제안은 품질이 중요한 만큼 상위 모델 사용.\n- RAG는 정확한 파일 경로·문서 버전을 유지해야 하며, citation 실패 시 사용자에게 근거 부족을 명시.\n- 프롬프트 길이 제한을 고려해 `llm_structure_report`와 `rag_documents`는 요약/압축 포맷으로 제공.\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 20, "total_chunks": null}}
{"id": "95b6df5a-e15a-4e73-b30b-86a8eb17cd92", "content": "### RAG 소스 & Citation 포맷\n\n| 범주 | 소스 | 인덱싱 단위 | 비고 |\n| --- | --- | --- | --- |\n| Runner 문서 | `packages/website/docs-cli/configuration/runners/*.md` | 섹션 헤더 기준 | runner 타입별 요구 사항, 예제 포함 |\n| SDK 참고 | `packages/sdk/fluxloop/**` (docstrings, README) | 파일 + public symbol | 설치/사용법 근거 |\n| VS Code UX | `packages/vscode/README.md`, `docs/prd/vscode_*` | 문서 섹션 | Integration UX 안내 |\n| MCP/CLI | `packages/mcp/README.md`, `packages/cli/docs/**`, `docs/prd/mcp/**` | 문단 | 워크플로 설명, 명령 사용법 |\n| 실험 기록 | `examples/`, `experiments/**/report.md`, `per_trace_analysis/**/*.md` | 파일 | 유사 사례, 성능 참고 |", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 21, "total_chunks": null}}
{"id": "9bf3b7e0-dd6a-4105-82db-1388ca5305a5", "content": "| FAQ/PRD | `docs/prd/**`, `docs/icebox/**` | 문단 | 정책, 베스트 프랙티스 |\n\n- 인덱스 메타데이터: `{ \"path\": \"...\", \"section\": \"## Runner configuration\", \"version\": \"git sha\", \"timestamp\": \"...\"}`\n- Citation 포맷: `[ref:id](/relative/path#Lstart-Lend)` 또는 `[ref:id](doc://path#section)` 형태, Flux Agent 응답에서는 `(ref:id)` 표기 후 하단에 레퍼런스 목록 자동 생성.\n- `rag_documents` 구조:\n```json\n[\n  {\n    \"id\": \"runner-http-rest\",\n    \"title\": \"HTTP REST Runner configuration\",\n    \"path\": \"packages/website/docs-cli/configuration/runners/http-rest.md\",\n    \"excerpt\": \"Set `runner.target` to your FastAPI callable ...\",", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 22, "total_chunks": null}}
{"id": "b46bcb97-44ed-4f00-b237-a0db80ecd0f8", "content": "    \"citation\": \"(ref:runner-http-rest)\"\n  }\n]\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 23, "total_chunks": null}}
{"id": "d167c238-96e5-404f-bf15-ae42dcb7b0e6", "content": "### LLM 프롬프트 & 출력 스키마 초안\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 24, "total_chunks": null}}
{"id": "1697a8db-dd18-40e7-b753-88ea14404e8f", "content": "#### 1차 LLM (구조 확정)\n- **입력**:\n  - `repo_profile_v2.framework_signals` (상위 3개)\n  - `repo_profile_v2.agent_signals`\n  - 선택된 엔트리포인트 파일 스니펫 (최대 2개)\n  - 요청 파라미터: `{ \"mode\": \"integration\", \"maxNotes\": 5 }`\n- **시스템 프롬프트 요약**:\n  - “당신은 FluxLoop 통합 리포지토리의 구조 분석가입니다. 주어진 증거를 토대로 백엔드 프레임워크, 엔트리포인트, 에이전트 구성을 식별하고 확신도/추가 필요 정보를 제시하십시오.”\n- **출력 스키마 (`llm_structure_report`)**:\n```json\n{\n  \"framework\": {\n    \"name\": \"fastapi\",\n    \"confidence\": 0.82,\n    \"entrypoints\": [\"app/main.py\"],\n    \"rationale\": [\n      \"Detected FastAPI import in app/main.py\",", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 25, "total_chunks": null}}
{"id": "71222812-3b7f-4cac-9e94-133606d64fe7", "content": "      \"requirements.txt lists fastapi==0.110\"\n    ],\n    \"uncertainties\": [\"No uvicorn runner command detected\"]\n  },\n  \"agent_components\": [\n    {\n      \"module\": \"services/agents/support.py\",\n      \"role\": \"integration_agent\",\n      \"confidence\": 0.7,\n      \"summary\": \"Extends FluxLoopAgent base class and wraps support endpoints.\"\n    }\n  ],\n  \"missing_context\": [\n    \"Need confirmation of runner.target in configs/simulation.yaml\"\n  ],\n  \"overall_confidence\": 0.78,\n  \"next_actions\": [\n    \"Proceed to RAG if overall_confidence >= 0.6\",", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 26, "total_chunks": null}}
{"id": "ab9de825-c1d6-4bfb-ba0a-daeb3ab22d4f", "content": "    \"Otherwise prompt user to select framework manually\"\n  ],\n  \"notes\": \"If FastAPI is incorrect, fallback to Flask due to similar decorators.\"\n}\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 27, "total_chunks": null}}
{"id": "9d3dda79-3a77-4841-941f-7776f263c9b2", "content": "#### 2차 LLM (Integration Suggestion)\n- **입력**:\n  - `llm_structure_report`\n  - `rag_documents` (최대 5개, citation 포함)\n  - `edit_plan_v2` 초안\n  - 사용자 선택 컨텍스트(파일/폴더, 선택 코드)\n- **시스템 프롬프트 요약**:\n  - “당신은 FluxLoop 통합 어시스턴트입니다. 구조 보고서와 문서 근거를 사용하여 실행 가능한 제안서를 작성하고, 요약 → 단계별 작업 → 코드 변경 → 검증/테스트 → 참고 문서 순으로 구성하십시오.”\n- **출력 스키마 (`integration_suggestion`)**:\n```json\n{\n  \"summary\": \"FastAPI 엔드포인트에 FluxLoop 추적을 추가합니다.\",\n  \"steps\": [\n    {\"title\": \"Install SDK\", \"detail\": \"pip install fluxloop\", \"citations\": [\"ref:runner-http-rest\"]},\n    {\"title\": \"Wrap FastAPI app\", \"detail\": \"Add middleware after app creation.\"}", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 28, "total_chunks": null}}
{"id": "15c3e69a-0a4a-4e5b-a647-ed9e2a5231cc", "content": "  ],\n  \"code_changes\": [\n    {\n      \"filepath\": \"app/main.py\",\n      \"diff\": \"```diff\\n+from fluxloop import fluxloop\\n+app.middleware(...)\\n```\",\n      \"citations\": [\"ref:sdk-fastapi\"]\n    }\n  ],\n  \"validation\": [\n    \"Run pytest\",\n    \"fluxloop-mcp --once --query \\\"Flux Agent\\\"\"\n  ],\n  \"risks\": [\n    {\"description\": \"Existing middleware order may change\", \"severity\": \"medium\"}\n  ],\n  \"references\": [\n    {\"id\": \"ref:runner-http-rest\", \"title\": \"HTTP REST Runner configuration\", \"url\": \"doc://packages/website/...\"}\n  ]\n}\n```\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 29, "total_chunks": null}}
{"id": "98c718eb-bce7-4f63-aefd-bbc4121026d7", "content": "### VS Code 컨텍스트 선택 플로우 설계\n\n1. **엔트리 포인트**\n   - Command Palette에서 `FluxLoop: Run Flux Agent (Integration/Base Input/Experiment/Insight)` 명령 선택 시 모달 팝업.\n   - Integration 모드 기본값, 다른 모드는 드롭다운으로 전환.\n\n2. **컨텍스트 선택 단계**\n   - **Workspace picker**: 다중 루트 지원, 현재 활성 프로젝트 자동 제안.\n   - **Scope selector**:\n     - `Active file`, `Selection only`, `Folder…`, `Custom files…` 옵션 제공.\n     - 최소 하나 선택해야 다음 단계 진행.\n   - **Supplementary inputs**:\n     - Base Input 모드: 기존 `configs/input.yaml` 또는 샘플 파일 선택.\n     - Experiment 모드: `configs/simulation.yaml` 경로와 멀티턴 템플릿 파일 지정.", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 30, "total_chunks": null}}
{"id": "f5f4fee4-6d8f-452f-9fd8-9fbc094c7d8a", "content": "     - Insight 모드: `experiments/<run>/report.md`, `per_trace_analysis` 폴더 지정.\n\n3. **미리보기 & 검증**\n   - 선택된 컨텍스트 요약(파일 수, 경로, 선택 코드 길이) 표시.\n   - MCP 호출 전에 `AnalyzeContextCommand` 실행 → 파일 존재 여부, 크기 제한(예: 200KB) 확인.\n   - 문제 발생 시 인라인 경고 + “선택 다시 하기” 버튼.\n\n4. **MCP 연동**\n   - 선택 스코프를 `collect_context` 단계 입력으로 전달.\n   - 필요 시 선택 파일만 별도 temp 디렉터리로 복사/압축하여 MCP 파이프라인에 제공(권한 제한 대응).\n\n5. **결과 표시 & 재실행**\n   - Suggestion 패널에 “사용한 컨텍스트” 섹션 노출(파일 리스트, 해시).\n   - 동일 컨텍스트로 재실행 가능하도록 “Re-run with same scope” 버튼 제공.\n   - 다른 모드 전환 시 이전 컨텍스트를 draft로 유지하여 사용자 반복 입력 최소화.", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 31, "total_chunks": null}}
{"id": "c1381b4f-3941-48d2-bb0a-3b36826e6aaa", "content": "\n6. **Telemetry / Diagnostics**\n   - 선택 유형(파일/폴더), 크기, MCP 처리 시간, 실패 사유를 이벤트로 기록.\n   - 감지 신뢰도 낮을 때 사용자 선택이 어떻게 보완됐는지 추후 분석 가능.\n\n---\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 32, "total_chunks": null}}
{"id": "383c83df-6fb2-4f6f-be18-9392d437811c", "content": "## 추가 아이디어\n- **샘플 프로젝트 카탈로그**: FastAPI, Flask, Django, LangChain 등 대표 프로젝트를 모아 자동 테스트 → 감지 정확도 리그레이션 가능.\n- **규칙 + ML 하이브리드**: 장기적으로는 LightGBM 같은 경량 모델로 “이 repo는 어떤 runner일 확률이 높은지” 예측하도록 확장 가능 (특징: 패키지, 파일명, import frequency 등).\n- **사용자 피드백 루프**: Flux Agent UI에서 감지 결과가 틀릴 경우 “아니요, Flask입니다” 버튼 제공 → 로그 수집 → 레시피/규칙 강화.\n\n---\n", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 33, "total_chunks": null}}
{"id": "7965ff11-079a-4c82-a8ec-c7b5b500766c", "content": "## 결론\n- **1번(프레임워크 감지)**은 정적 분석 고도화 + 제한적 LLM 확인으로 현실적인 정확도를 확보할 수 있습니다.\n- **2번(백엔드 & 에이전트 구조 파악)**은 파일 스캔과 설정 파싱을 통해 후보를 좁힌 뒤 LLM에게 “요약/의도 분류”를 맡기는 하이브리드 접근이 유효합니다.\n- MCP는 RunIntegrationWorkflow를 다단계 파이프라인으로 나눠 redistributable JSON을 풍부하게 만들고, Flux Agent는 사용자가 지정한 컨텍스트 범위 안에서 신뢰도 높은 제안을 생성하도록 UX를 보완하면 됩니다.\n\n깊이 있는 자동화가 어렵다면, 우선 위 정적 분석 확장을 통한 “프레임워크 & 핵심 파일 탐지”까지 끝내고, Integration 모드에서 그 결과를 UI에 노출하여 사용자가 확인/수정할 수 있게 한 뒤 LLM 호출을 진행하는 방식으로 단계적 도입을 추천합니다.", "metadata": {"source": "docs/prd/mcp/mcp_workflow_expand.md", "chunk_index": 34, "total_chunks": null}}
{"id": "73f42f35-6295-46b7-a361-c8f05a9962ad", "content": "## Runner 문서 구조 – MCP 서버 통합 가이드\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 0, "total_chunks": null}}
{"id": "08d6bb2c-4ac6-45b2-bb48-939df82f42c2", "content": "### 1. 배경\n\n- **문제**: Runner 통합 패턴이 10+ 가지로 확장되면서 단일 문서(`runner-targets.md`)로는 유지보수와 검색성이 저하됨.\n- **목표**: 패턴별 독립 문서로 분리하고, MCP 서버가 이를 \"단일 진실 소스(SSoT)\"로 활용하여 FAQ/통합 플랜 생성에 사용.\n- **효과**: \n  - 개발자: 패턴별 상세 예제/트러블슈팅 점진적 보강\n  - MCP 서버: 레포 분석 → 프레임워크 감지 → 적합한 패턴 문서 추천 → 통합 절차 생성\n  - AI 에이전트: 컨텍스트 기반 문서 검색 정확도 향상\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 1, "total_chunks": null}}
{"id": "8a78f0ce-3371-420f-821b-d35329b779eb", "content": "### 2. 디렉터리 구조 (확정)\n\n```\npackages/website/docs-cli/configuration/\n  runner-targets.md               # 개요 + 인덱스 (P0/P1/P2 분류표)\n  runners/                         # 패턴별 상세 문서\n    _category_.json                # Docusaurus 네비게이션 설정\n    \n    # P0: Production-Ready\n    python-function.md             ✅ 구현 완료\n    python-class.md                🔲 TODO\n    python-factory.md              🔲 TODO\n    python-async-generator.md      🔲 TODO\n    http-rest.md                   🔲 TODO\n    http-sse.md                    ✅ 구현 완료\n    http-websocket.md              🔲 TODO", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 2, "total_chunks": null}}
{"id": "0c56a4c8-cf58-4aaf-bfa9-72afbc9408ec", "content": "    subprocess-jsonl.md            ✅ 구현 완료\n    step-loop.md                   🔲 TODO\n    guards.md                      🔲 TODO\n    \n    # P1: Beta\n    batch-execution.md             🔲 TODO\n    streaming-schema.md            🔲 TODO\n    adapters.md                    🔲 TODO\n    \n    # P2: Experimental\n    container-docker.md            🔲 TODO\n    queue-redis.md                 🔲 TODO\n    queue-sqs.md                   🔲 TODO\n    multi-target.md                🔲 TODO\n```\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 3, "total_chunks": null}}
{"id": "77da74a8-5bf3-4b74-8742-2d3d798c4db8", "content": "### 3. 문서 표준 템플릿\n\n각 패턴 문서는 다음 구조를 따름:\n\n```markdown\n---\ntitle: [패턴명]\nsidebar_position: [순서]\ntags: [python|http|process|container|queue, streaming|sync, p0|p1|p2]\n---\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 4, "total_chunks": null}}
{"id": "40130793-662d-4c9e-a74f-28f76c7d6aba", "content": "## 개요\n- **사용 시점**: [언제 이 패턴을 선택하는가]\n- **난이도**: ⭐/⭐⭐/⭐⭐⭐\n- **우선순위**: P0|P1|P2\n- **의존성**: [필수 패키지/서비스]\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 5, "total_chunks": null}}
{"id": "130f21b2-ab6a-420a-8ea5-71bf318a798f", "content": "## 기본 설정\n[최소 YAML 예시]\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 6, "total_chunks": null}}
{"id": "85b3814f-1b66-4c55-94b6-1d891dded6ef", "content": "## 전체 옵션\n[전체 YAML + 주석]\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 7, "total_chunks": null}}
{"id": "103f29db-00a4-4349-8f3c-a087b782e16d", "content": "## 함수/프로토콜 시그니처 요구사항 (해당 시)\n[Python 시그니처, JSONL 메시지 규약 등]\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 8, "total_chunks": null}}
{"id": "bc897463-b4cf-43b9-b7b6-0a2d3e68844b", "content": "## 예제", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 9, "total_chunks": null}}
{"id": "4fe1a477-e81f-4aa8-adda-9b19c251b123", "content": "### 예제 1: [기본 시나리오]", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 10, "total_chunks": null}}
{"id": "730a7156-f0ed-4df2-b93c-c74ddcf6599d", "content": "### 예제 2: [실전 시나리오]", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 11, "total_chunks": null}}
{"id": "e91da399-cdaf-474f-917f-531d4f1a87a0", "content": "### 예제 3: [고급 시나리오]\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 12, "total_chunks": null}}
{"id": "7658ebcc-183a-423e-86eb-ef6ca7ca922e", "content": "## 트러블슈팅\n| 문제 | 원인 | 해결 |\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 13, "total_chunks": null}}
{"id": "fdaa475b-6090-4ec7-9d48-a0ce76fa07d7", "content": "## 고급 주제 (선택)\n[성능, 보안, 특수 케이스]\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 14, "total_chunks": null}}
{"id": "11e1b82f-b082-4f05-b03e-e3a72174531e", "content": "## 관련 문서\n[다른 패턴/가이드 링크]\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 15, "total_chunks": null}}
{"id": "2f857dbe-d195-427e-acf9-9fb5da5ae332", "content": "## MCP 메타데이터\n```json\n{\n  \"pattern\": \"http-sse\",\n  \"tags\": [\"http\", \"streaming\", \"sse\", \"p0\", \"openai\"],\n  \"examples\": [\"examples/openai-streaming/\"],\n  \"faq\": [\"How to handle reconnection?\", \"...\"],\n  \"related_patterns\": [\"http-rest\", \"...\"],\n  \"dependencies\": [\"httpx\"]\n}\n```\n```\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 16, "total_chunks": null}}
{"id": "a12133ed-91b1-49c7-982e-8a1d808926a1", "content": "### 4. MCP 서버 통합 전략\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 17, "total_chunks": null}}
{"id": "68987242-5f52-413c-a23b-7e15438c55c5", "content": "#### 4.1 인덱싱 파이프라인\n\n**수집 대상**\n```python", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 18, "total_chunks": null}}
{"id": "dcf4f37c-397d-4c0d-9faf-d7446a5222a0", "content": "# packages/mcp/fluxloop_mcp/index/ingestor.py\n\nRUNNER_DOCS_SOURCES = [\n    \"packages/website/docs-cli/configuration/runners/*.md\",\n    \"packages/website/docs-cli/configuration/runner-targets.md\",\n    \"packages/website/docs-sdk/configuration/runner-integration.md\",\n]\n\ndef ingest_runner_docs():\n    for doc_path in glob(RUNNER_DOCS_SOURCES):\n        metadata = extract_frontmatter(doc_path)  # title, tags, sidebar_position\n        mcp_meta = extract_mcp_metadata_block(doc_path)  # JSON 블록\n        \n        # 섹션별 chunking\n        chunks = split_by_heading(doc_path, max_tokens=512)", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 19, "total_chunks": null}}
{"id": "10a34d0f-132e-4cf4-96f4-e096aaf11357", "content": "        \n        for chunk in chunks:\n            store_chunk(\n                content=chunk.text,\n                metadata={\n                    \"source\": doc_path,\n                    \"pattern\": mcp_meta.get(\"pattern\"),\n                    \"tags\": metadata.get(\"tags\", []) + mcp_meta.get(\"tags\", []),\n                    \"section\": chunk.heading,\n                    \"priority\": extract_priority(metadata.get(\"tags\")),  # p0/p1/p2\n                    \"examples\": mcp_meta.get(\"examples\", []),\n                    \"faq_keywords\": mcp_meta.get(\"faq\", []),", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 20, "total_chunks": null}}
{"id": "d8b7dcd1-75d3-43ed-9355-3c8692e85812", "content": "                }\n            )\n```\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 21, "total_chunks": null}}
{"id": "73f523ae-d1e7-45c1-aeb5-f492f2428de5", "content": "#### 4.2 MCP 툴 활용\n\n**1) `faq` 툴 – 패턴별 트러블슈팅 검색**\n\n```python", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 22, "total_chunks": null}}
{"id": "58577262-36e8-46b8-9a6e-83ef8307287f", "content": "# packages/mcp/fluxloop_mcp/tools/faq.py\n\ndef faq(query: str, context: dict = None) -> dict:\n    \"\"\"\n    Args:\n        query: \"How to use OpenAI streaming with FluxLoop?\"\n        context: {\"detected_framework\": \"openai\", \"language\": \"python\"}\n    \"\"\"\n    # 1. 태그 필터링으로 후보 범위 축소\n    filters = []\n    if context and context.get(\"detected_framework\"):\n        filters.append(f\"tags:{context['detected_framework']}\")\n    \n    # 2. BM25 + 임베딩 혼합 검색\n    results = retriever.search(\n        query=query,\n        filters=filters,\n        topK=5", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 23, "total_chunks": null}}
{"id": "9d41dbbd-b59d-43eb-87da-97aea66c661a", "content": "    )\n    \n    # 3. 답변 합성 (RAG)\n    answer = synthesize_answer(query, results)\n    \n    return {\n        \"answer\": answer,\n        \"citations\": [\n            {\n                \"source\": r.metadata[\"source\"],\n                \"section\": r.metadata[\"section\"],\n                \"pattern\": r.metadata[\"pattern\"],\n                \"url\": f\"https://docs.fluxloop.ai/{path_to_url(r.metadata['source'])}\"\n            }\n            for r in results\n        ]\n    }\n```\n\n**2) `detect_frameworks` → 패턴 추천**\n\n```python", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 24, "total_chunks": null}}
{"id": "6587ca58-39e7-4299-be55-736d1a4f1cde", "content": "# packages/mcp/fluxloop_mcp/tools/detect_frameworks.py\n\ndef detect_frameworks(repository_profile: dict) -> dict:\n    \"\"\"\n    Args:\n        repository_profile: {\"languages\": [\"python\"], \"entryPoints\": [\"app/main.py\"]}\n    \"\"\"\n    frameworks = analyze_code(repository_profile)\n    \n    # 각 프레임워크에 적합한 러너 패턴 매핑\n    pattern_recommendations = []\n    for fw in frameworks:\n        if fw[\"name\"] == \"fastapi\":\n            pattern_recommendations.append({\n                \"framework\": \"fastapi\",\n                \"runner_pattern\": \"python-function\",", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 25, "total_chunks": null}}
{"id": "8a382f86-8964-425b-b1f5-3167c69acee2", "content": "                \"doc_url\": \"docs-cli/configuration/runners/python-function\",\n                \"confidence\": fw[\"confidence\"]\n            })\n        elif fw[\"name\"] == \"openai\":\n            pattern_recommendations.append({\n                \"framework\": \"openai\",\n                \"runner_pattern\": \"python-async-generator\",\n                \"doc_url\": \"docs-cli/configuration/runners/python-async-generator\",\n                \"confidence\": 0.95\n            })\n    \n    return {\n        \"frameworks\": frameworks,\n        \"recommended_patterns\": pattern_recommendations", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 26, "total_chunks": null}}
{"id": "83ee66d5-6fdd-4783-b679-66749360a9b7", "content": "    }\n```\n\n**3) `generate_integration_steps` – 패턴 문서 기반 체크리스트**\n\n```python", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 27, "total_chunks": null}}
{"id": "f8669493-a5e2-4f3b-a525-b06058150c77", "content": "# packages/mcp/fluxloop_mcp/tools/generate_integration_steps.py\n\ndef generate_integration_steps(framework: str, pattern: str) -> dict:\n    \"\"\"\n    Args:\n        framework: \"openai\"\n        pattern: \"python-async-generator\"\n    \"\"\"\n    # 1. 패턴 문서에서 \"기본 설정\" 섹션 추출\n    doc_path = f\"packages/website/docs-cli/configuration/runners/{pattern}.md\"\n    basic_config = extract_section(doc_path, \"기본 설정\")\n    \n    # 2. 예제 코드 추출\n    examples = extract_code_blocks(doc_path, section=\"예제\")\n    \n    # 3. 체크리스트 생성\n    steps = [\n        {\n            \"id\": \"install_sdk\",", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 28, "total_chunks": null}}
{"id": "7b94d132-8ccb-4640-83f1-d91068e26f23", "content": "            \"title\": \"FluxLoop SDK 설치\",\n            \"details\": \"pip install fluxloop-sdk\",\n            \"doc_ref\": \"packages/sdk/README.md\"\n        },\n        {\n            \"id\": \"configure_runner\",\n            \"title\": f\"{pattern} 러너 설정\",\n            \"details\": f\"configs/simulation.yaml에 다음 추가:\\n{basic_config}\",\n            \"doc_ref\": doc_path\n        },\n        {\n            \"id\": \"implement_function\",\n            \"title\": \"에이전트 함수 구현\",\n            \"details\": f\"예제 코드:\\n{examples[0].code}\",\n            \"doc_ref\": doc_path", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 29, "total_chunks": null}}
{"id": "9965323b-d16c-488d-b9d5-8d49f790207a", "content": "        },\n        {\n            \"id\": \"test_run\",\n            \"title\": \"테스트 실행\",\n            \"details\": \"fluxloop run experiment\",\n            \"doc_ref\": \"docs-cli/commands/run\"\n        }\n    ]\n    \n    return {\"steps\": steps, \"estimated_time\": \"15 min\"}\n```\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 30, "total_chunks": null}}
{"id": "75f0e6fd-f151-4303-9dee-a1645aaed6e7", "content": "#### 4.3 메타데이터 스키마 확장\n\n**packages/mcp/fluxloop_mcp/schemas/runner_pattern_metadata.json**\n```json\n{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"pattern\": {\n      \"type\": \"string\",\n      \"description\": \"패턴 식별자 (파일명과 동일)\"\n    },\n    \"tags\": {\n      \"type\": \"array\",\n      \"items\": {\"type\": \"string\"},\n      \"description\": \"검색/필터링용 태그 (언어, 프로토콜, 우선순위 등)\"\n    },\n    \"examples\": {\n      \"type\": \"array\",\n      \"items\": {\"type\": \"string\"},\n      \"description\": \"예제 프로젝트/샘플 문서 경로\"\n    },", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 31, "total_chunks": null}}
{"id": "5e6d508a-5e9d-4217-a002-874855e70186", "content": "    \"faq\": {\n      \"type\": \"array\",\n      \"items\": {\"type\": \"string\"},\n      \"description\": \"자주 묻는 질문 키워드 (검색 힌트)\"\n    },\n    \"related_patterns\": {\n      \"type\": \"array\",\n      \"items\": {\"type\": \"string\"},\n      \"description\": \"연관 패턴 목록\"\n    },\n    \"dependencies\": {\n      \"type\": \"array\",\n      \"items\": {\"type\": \"string\"},\n      \"description\": \"필수 라이브러리/서비스\"\n    },\n    \"frameworks\": {\n      \"type\": \"array\",\n      \"items\": {\"type\": \"string\"},\n      \"description\": \"적합한 프레임워크 (openai, anthropic, langchain 등)\"\n    }\n  },\n  \"required\": [\"pattern\", \"tags\"]", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 32, "total_chunks": null}}
{"id": "6d402c00-51f4-4263-87da-51f3c50388f6", "content": "}\n```\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 33, "total_chunks": null}}
{"id": "9461cb3d-10b3-41ad-ad35-c20dc8c6f6e3", "content": "#### 4.4 계약 정합성 메모\n\n- `detect_frameworks` 응답은 다음 필드를 포함해야 함(서버 PRD와 합치):\n  - `frameworks[]`(name, confidence, insertAnchors)\n  - `recommended_patterns[]`(framework, runner_pattern, doc_url, confidence)\n- 인덱싱 소스 경로 동기화:\n  - `packages/website/docs-cli/**`, `packages/website/docs-sdk/**`, `docs/`, `packages/sdk/`, `samples/`\n- 스토리지 백엔드 선택(옵션):\n  - `MCP_VECTOR_BACKEND=none|faiss|qdrant`\n  - `MCP_QDRANT_URL`, `MCP_QDRANT_API_KEY` (qdrant 사용 시)\n- 스크립트 경로: `packages/mcp/scripts/rebuild_index.sh` (서버 PRD와 동일)\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 34, "total_chunks": null}}
{"id": "cc217d2b-bd60-47c4-9899-ac5d61a2d828", "content": "### 5. 문서 작성/유지보수 워크플로우\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 35, "total_chunks": null}}
{"id": "88464701-7926-497c-bfa2-6663e9d211e0", "content": "#### 5.1 신규 패턴 추가\n\n1. **PRD 확정** (`docs/prd/runner_integration_extensions_prd.md`에 스펙 추가)\n2. **문서 생성** (`packages/website/docs-cli/configuration/runners/[pattern].md`)\n   - 템플릿 복사\n   - 기본/전체 설정 YAML 작성\n   - 최소 2개 예제 (기본 + 실전)\n   - 트러블슈팅 표 작성\n   - MCP 메타데이터 블록 추가\n3. **인덱스 업데이트** (`runner-targets.md`에 패턴 추가)\n4. **MCP 인덱스 재빌드** (CI/배포 시 자동 트리거)\n5. **예제 프로젝트 생성** (`examples/[pattern-name]/`)\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 36, "total_chunks": null}}
{"id": "08db39c2-2e60-4537-9b92-0f1f5ddde542", "content": "#### 5.2 문서 품질 검증 (CI)\n\n```bash", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 37, "total_chunks": null}}
{"id": "025ec427-c588-490b-bd6f-adaa9e81f154", "content": "# scripts/validate_runner_docs.py\n\ndef validate():\n    for doc in glob(\"packages/website/docs-cli/configuration/runners/*.md\"):\n        # 1. Frontmatter 필수 필드 확인\n        assert has_fields(doc, [\"title\", \"sidebar_position\", \"tags\"])\n        \n        # 2. MCP 메타데이터 블록 존재 및 스키마 검증\n        mcp_meta = extract_mcp_metadata(doc)\n        validate_json_schema(mcp_meta, \"schemas/runner_pattern_metadata.json\")\n        \n        # 3. 필수 섹션 존재 확인\n        assert has_sections(doc, [\"개요\", \"기본 설정\", \"예제\", \"트러블슈팅\"])\n        \n        # 4. 예제 코드 문법 검증 (YAML/Python)", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 38, "total_chunks": null}}
{"id": "27b48bb2-bac8-4f91-8bc7-445ba19a62ca", "content": "        for code_block in extract_code_blocks(doc):\n            if code_block.lang == \"yaml\":\n                assert is_valid_yaml(code_block.code)\n        \n        # 5. 링크 무결성 (related_patterns 존재 여부)\n        for related in mcp_meta.get(\"related_patterns\", []):\n            assert file_exists(f\"runners/{related}.md\")\n```\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 39, "total_chunks": null}}
{"id": "ec7e7649-00bb-4326-b9a7-e019855d70e4", "content": "#### 5.3 MCP 서버 인덱스 갱신\n\n```bash", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 40, "total_chunks": null}}
{"id": "a30b7e5a-8d71-424b-bd9d-49561f2b6ec5", "content": "# packages/mcp/scripts/rebuild_index.sh\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 41, "total_chunks": null}}
{"id": "f16b2422-a2b7-442e-b51c-c1bc799855d5", "content": "#!/bin/bash\nset -e\n\necho \"Rebuilding MCP knowledge index...\"\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 42, "total_chunks": null}}
{"id": "2d6e2881-e499-4009-88a3-2cfae05bb626", "content": "# 1. 문서 수집\npython -m fluxloop_mcp.index.ingestor \\\n  --source \"../../website/docs-cli/configuration/runners/*.md\" \\\n  --source \"../../website/docs-sdk/**/*.md\" \\\n  --output \"fluxloop_mcp/index/store.db\"\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 43, "total_chunks": null}}
{"id": "b40873d3-2ac9-4d1f-be9c-1d3eee7bde7c", "content": "# 2. 임베딩 생성 (경량 모델)\npython -m fluxloop_mcp.index.embedder \\\n  --model \"all-MiniLM-L6-v2\" \\\n  --store \"fluxloop_mcp/index/store.db\"\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 44, "total_chunks": null}}
{"id": "b898e6fb-537c-4295-ad47-0bfad83a92ab", "content": "# 3. 검증\npython -m fluxloop_mcp.index.validator\n\necho \"Index rebuilt successfully!\"\n```\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 45, "total_chunks": null}}
{"id": "07a165d4-266a-4bf0-aa1a-d783c51dad58", "content": "### 6. 문서 작성 우선순위 (구현 계획)\n\n| 패턴 | 우선순위 | 담당 | 완료 여부 |\n|------|----------|------|-----------|\n| python-function.md | P0 | ✅ | 완료 |\n| http-sse.md | P0 | ✅ | 완료 |\n| subprocess-jsonl.md | P0 | ✅ | 완료 |\n| python-async-generator.md | P0 | 🔲 | TODO |\n| http-rest.md | P0 | 🔲 | TODO |\n| http-websocket.md | P0 | 🔲 | TODO |\n| step-loop.md | P0 | 🔲 | TODO |\n| guards.md | P0 | 🔲 | TODO |\n| python-class.md | P0 | 🔲 | TODO |\n| python-factory.md | P0 | 🔲 | TODO |\n| batch-execution.md | P1 | 🔲 | TODO |\n| streaming-schema.md | P1 | 🔲 | TODO |", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 46, "total_chunks": null}}
{"id": "c80e17a5-3772-4ba5-8f4c-675524e271c2", "content": "| adapters.md | P1 | 🔲 | TODO |\n| container-docker.md | P2 | 🔲 | TODO |\n| queue-redis.md | P2 | 🔲 | TODO |\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 47, "total_chunks": null}}
{"id": "cb948bb1-6f8a-4477-a1f4-68834277fbba", "content": "### 7. 성공 지표\n\n- **문서 품질**: 각 패턴 문서에 최소 3개 예제, 5개 이상 트러블슈팅 항목\n- **MCP 검색 정확도**: 프레임워크 질의 → 올바른 패턴 문서 top-3 포함 ≥ 90%\n- **통합 성공률**: MCP 생성 체크리스트 기반 통합 시 무오류 완료 ≥ 85%\n- **문서 최신성**: 분기별 전체 문서 리뷰, 예제 코드 실행 검증\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 48, "total_chunks": null}}
{"id": "6edfa293-104e-4bd8-a3f7-d2ec6c77c4dd", "content": "### 8. 관련 문서\n\n- [Runner Integration Extensions PRD](./runner_integration_extensions_prd.md) – 패턴 확장 계획\n- [MCP Server Plan](./mcp_server_plan.md) – MCP 서버 전체 아키텍처\n- [Settings Recording v0.2.0](./fluxloop_v0.2.0_settings_recording.md) – 설정 구조\n\n---\n문서 소유: Platform 팀 / FluxLoop  \n최초 작성: 2025-11-07  \n상태: Draft v0.1\n", "metadata": {"source": "docs/prd/mcp/runner_docs_structure_for_mcp.md", "chunk_index": 49, "total_chunks": null}}
{"id": "a357a1a9-e324-41ab-b012-7a852422dbcb", "content": "# FluxLoop Polish #13 – Pytest 하이브리드 러너 브리지\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 0, "total_chunks": null}}
{"id": "b8502889-99c9-4cd0-80cb-7df7ce4eace4", "content": "## 문서 정보\n- **작성일**: 2025-11-22\n- **버전**: v0.1.0\n- **대상**: FluxLoop CLI/Runner ↔ Pytest 하이브리드 실행 경험\n- **관련 문서**\n  - `docs/prd/web/poc_implementation_plan_v2.md`\n  - `docs/prd/web/agent_roadmap.md`\n  - `packages/cli/fluxloop_cli/runner.py`\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 1, "total_chunks": null}}
{"id": "e84dad3c-f615-4ca9-b291-d0a7a8657b8b", "content": "## 1. 배경\n- FluxLoop 엔진은 다양한 러너 패턴(파이썬 함수, HTTP SSE, MCP 등)과 멀티턴/관측 기능을 내장하여 Confident AI 수준의 플랫폼형 기능을 제공한다.\n- 그러나 초기 온보딩 개발자는 “Pytest처럼 익숙한 명령으로 실험을 돌리고 싶다”는 요구가 높고, CI/CD에서도 표준 리포터(junitxml 등)가 필요하다.\n- Deepeval 사례와 같이 Pytest를 단순 러너로 활용하고, 복잡한 실행은 전용 엔진이 담당하는 하이브리드 모델이 시장에서 검증되었다.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 2, "total_chunks": null}}
{"id": "9637e986-3e94-419c-ac02-e85ef43340be", "content": "## 2. 문제 정의\n1. **진입장벽**: `fluxloop run experiment`를 이해하기 전에 configs DSL과 Runner 개념을 모두 학습해야 한다.\n2. **CI/CD 연결성**: 기존 CLI 출력만으로는 테스트 실패가 Pytest/Actions 대시보드에 연결되지 않아 DevX가 끊긴다.\n3. **중복 구현 위험**: Pytest로 엔진을 대체하려 하면 멀티턴, 관측, Supabase 업로드 등 핵심 기능을 사용자 코드가 다시 구현해야 한다.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 3, "total_chunks": null}}
{"id": "694548ff-d785-45dc-b0c1-efebdf70741a", "content": "## 3. 목표\n- Pytest 명령(`pytest -k fluxloop_smoke`)만으로도 FluxLoop 실험이 실행되고 결과가 Pytest 리포트에 반영되도록 한다.\n- 기존 CLI/Runner 파이프라인을 그대로 재사용하여 멀티턴, MCP, Supabase 연동 등 고급 기능은 FluxLoop 엔진이 계속 담당하도록 한다.\n- 로컬/CI 모두 동일한 테스트 코드를 사용하고, CLI 사용자도 간단한 템플릿을 통해 Pytest로 확장할 수 있게 한다.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 4, "total_chunks": null}}
{"id": "b871ee16-d37f-43f5-af56-cbce829b334d", "content": "## 4. 솔루션 개요", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 5, "total_chunks": null}}
{"id": "a3b202ab-5dd7-4486-aa42-2d7a4b1afeb1", "content": "### 4.1 Pytest Fixture 계층\n- `fluxloop.testing.pytest` 모듈에 두 가지 헬퍼 제공:\n  1. `fluxloop_runner` fixture: `ExperimentConfig`를 로드해 `ExperimentRunner.run_experiment()`를 직접 호출.\n  2. `fluxloop_cli` fixture: subprocess로 `fluxloop run/parse/evaluate` 명령을 실행해 CLI 경로 검증.\n- 각 fixture는 실행 결과 요약(`success_rate`, `output_dir`, `per_trace_path`)을 리턴하고, 실패 시 Pytest assertion을 발생시킨다.\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 6, "total_chunks": null}}
{"id": "2d5c9d02-2cf9-4051-b6ab-6718f2e05a11", "content": "### 4.2 결과 어댑터\n- Fixture가 반환하는 객체는 다음 정보를 포함:\n  - `output_dir`, `trace_summary_path`, `per_trace_jsonl`\n  - `summary.metrics` (성공률, avg_duration_ms 등)\n  - `errors` 리스트(실패 iteration + 메시지)\n- 사용자는 반환 객체를 기반으로 추가 assertion 또는 deepeval 메트릭을 이어 붙일 수 있다.\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 7, "total_chunks": null}}
{"id": "5c739b63-1512-48d9-a463-756597207cfe", "content": "### 4.3 구성 플로우\n```\ntests/test_fluxloop_example.py\n└── def test_travel_agent(fluxloop_runner):\n        result = fluxloop_runner.run(\n            project_root=\"examples/travel_agent\",\n            simulation_config=\"configs/simulation.yaml\",\n            overrides={\"runner.target\": \"agents.travel:run\"}\n        )\n        assert result.success_rate >= 0.9\n        assert result.metrics[\"avg_duration_ms\"] < 2000\n```\n- `overrides`는 CLI가 사용하는 `RunnerService`와 동일한 규칙(점 표기)으로 제공.\n- Fixture 내부에서 overrides를 적용한 `ExperimentConfig`를 생성하여 일관성을 담보.", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 8, "total_chunks": null}}
{"id": "36f158c8-3af0-45d4-81a9-9e3dfb25dc2d", "content": "\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 9, "total_chunks": null}}
{"id": "7d4b41ed-1709-4ce6-8602-c297ec019df2", "content": "## 5. 기능 요구사항\n| ID | 요구사항 | 설명 |\n|----|----------|------|\n| FR-1 | Fixture 제공 | `fluxloop_runner`, `fluxloop_cli` Pytest fixture 자동 등록 |\n| FR-2 | 설정 자동 로드 | `project.yaml` 위치만 전달받아 `configs/*.yaml` 체계를 자동 인식 |\n| FR-3 | Overrides | Runner/Simulation 옵션을 dict 혹은 yaml snippet으로 덮어쓰기 지원 |\n| FR-4 | 산출물 핸들링 | `output_dir` 내 `summary.json`, `trace_summary.jsonl`, `per_trace_analysis/per_trace.jsonl` 경로를 fixture가 반환 |\n| FR-5 | 실패 표준화 | Runner 예외는 Pytest `AssertionError`로 변환하고, 원본 로그 경로를 message에 포함 |\n| FR-6 | CLI/SDK 선택 | 동일 테스트 코드에서 `mode=\"sdk\"`/`mode=\"cli\"` 전환 가능 |", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 10, "total_chunks": null}}
{"id": "d9b43c45-fe10-4b74-aa74-fe8a467ab14c", "content": "| FR-7 | 로깅 | 테스트 실패 시 `output/stderr.log` 경로를 Pytest 캡처 로그에 첨부 |\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 11, "total_chunks": null}}
{"id": "8c0e4c45-78e5-4321-947a-ca002f9f8032", "content": "## 6. 기술 구현 고려사항\n- **pytest_plugins**: `packages/cli/fluxloop_cli/testing/pytest_plugin.py`에 fixture 정의 후 `entry_points`로 배포.\n- **Async 처리**: Pytest가 sync 테스트 함수를 사용하더라도 fixture 내부에서 `asyncio.run()`으로 `ExperimentRunner.run_experiment()` 수행.\n- **경로 해석**: 프로젝트 루트 기준 상대 경로 지원. 절대 경로 우선 사용 (사용자 요구와 동일).\n- **환경 변수**: `.env` 로딩 로직은 Runner와 동일, Pytest 실행 시에도 Collector on/off가 동일하게 동작해야 함.\n- **CI 샘플**: `.github/workflows/pytest.yml`에 샘플 스텝 추가 (Python 3.11, `pytest tests/test_fluxloop_example.py -n auto`).\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 12, "total_chunks": null}}
{"id": "5f504631-4349-4e85-954d-ad71d248a43a", "content": "## 7. 사용자 여정\n1. **설치**: `pip install fluxloop-cli[pytest]`.\n2. **템플릿 복사**: `fluxloop init pytest-template` 명령으로 `tests/test_fluxloop_smoke.py` 생성.\n3. **로컬 실행**: `pytest -k fluxloop_smoke --maxfail=1`.\n4. **CI 통합**: GitHub Actions에서 동일 명령 실행 + junitxml 업로드.\n5. **심화**: 반환된 `per_trace_jsonl`을 deepeval 메트릭이나 사내 규칙 기반 평가에 연동.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 13, "total_chunks": null}}
{"id": "a37e84ff-930a-4166-a5bb-bdcc91f692f8", "content": "## 8. 롤아웃 계획\n| 단계 | 내용 | 성공 지표 |\n|------|------|-----------|\n| Alpha | 내부 팀 프로젝트 2개에 Pytest fixture 적용 | 테스트 작성 시간 30분 이내 |\n| Beta | 선택 고객 3곳에 안내, feedback 수집 | 첫 시도 성공률 ≥ 80% |\n| GA | `fluxloop-cli` 0.7.x에 pytest extra 포함, 문서/블로그 공개 | Pytest 템플릿 설치 30건/월 |\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 14, "total_chunks": null}}
{"id": "d8775da4-1ec3-4c3b-841a-104004659c8c", "content": "## 9. 리스크 및 대응\n- **긴 실행 시간**: 멀티턴 실험이 Pytest 디폴트 timeout을 초과할 수 있음 → fixture에서 `pytest.mark.timeout` 권장 안내 및 `--fluxloop-timeout` 옵션 제공.\n- **로그 노이즈**: FluxLoop 출력과 Pytest 캡처가 섞일 수 있음 → fixture가 파일 로그 경로만 요약 출력하도록 조절.\n- **환경 차이**: 로컬/CI Python 버전 차이로 Runner 동작이 달라질 수 있음 → fixture가 실행 시 `fluxloop doctor --check-runner`를 선택적으로 수행.\n- **의존성 충돌**: `pytest-xdist`, `pytest-asyncio`와의 호환성 검증 필요 → 베타 단계에서 병렬 모드/async 테스트를 포함한 테스트 스위트 실행.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 15, "total_chunks": null}}
{"id": "567a89a9-b70f-49cd-ae40-13619cd95093", "content": "## 10. 작업 항목 요약\n1. `packages/cli/fluxloop_cli/testing/pytest_plugin.py` 구현\n2. Runner/CLI 공용 결과 객체(`FluxLoopTestResult`) 추가\n3. 템플릿 테스트/문서 (`docs/guides/pytest_bridge.md`) 작성\n4. 샘플 GitHub Actions 워크플로 추가\n5. 베타 고객 지원 및 피드백 라운드\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 16, "total_chunks": null}}
{"id": "866e18ab-c005-4dbe-9988-ea8ac2d194c7", "content": "## 11. 구현 계획\n| 주차 | 작업 | 산출물 |\n|------|------|--------|\n| Week 1 | 요구사항 구체화 및 Fixture 설계 | API 시그니처 초안, 테스트 케이스 목록 |\n| Week 2 | `fluxloop_runner`/`fluxloop_cli` fixture 구현 및 유닛 테스트 | `testing/pytest_plugin.py`, `FluxLoopTestResult` |\n| Week 3 | Pytest 템플릿/문서/샘플 워크플로 작성, 내부 알파 적용 | `tests/test_fluxloop_smoke.py`, `docs/guides/pytest_bridge.md`, Actions 예제 |\n| Week 4 | CLI subprocess 모드 완성, 베타 고객 3곳 적용, 피드백 반영, GA 릴리스 준비 | 개선된 fixture, changelog, 블로그/릴리스 노트 |\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 17, "total_chunks": null}}
{"id": "ed6b1983-ba7f-44db-a4b5-fb7f34b708df", "content": "### Week 1 – 설계\n- Fixture 파라미터와 반환 객체 정의 (project_root, overrides, mode, timeout 등).\n- Runner/CLI 공용 결과 스키마 설계 및 serialization 전략 확정.\n- QA용 시나리오(싱글턴, 멀티턴, MCP, 실패 케이스) 목록화.\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 18, "total_chunks": null}}
{"id": "ae3a3668-9735-4da4-8f05-687dead3850e", "content": "### Week 2 – 구현/테스트\n- `fluxloop.testing.pytest` 모듈 작성, `pytest_plugins` 엔트리 등록.\n- Async 실행 및 subprocess 모드 각각에 대한 단위 테스트 추가.\n- 실패 로그 수집/표준화 로직 구현 (`stderr.log`, `summary.json` 링크).\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 19, "total_chunks": null}}
{"id": "0977b37f-fc3a-4d53-862a-577f66a5d702", "content": "### Week 3 – 템플릿/문서/알파\n- `fluxloop init pytest-template` 명령 구현, 예제 테스트 생성.\n- 가이드 문서/블로그 초안 작성, GitHub Actions 예제 워크플로 추가.\n- 내부 프로젝트 2개에 적용해 smoke 테스트 실행 시간/안정성 측정.\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 20, "total_chunks": null}}
{"id": "c3a7acaa-24ba-4a1a-b268-dc1c32c94ff5", "content": "### Week 4 – 베타/GA\n- CLI 모드에서 `fluxloop run experiment`를 subprocess로 호출하고 stdout/stderr/summary 경로를 캡처, `FluxLoopTestResult`에 로그 위치를 추가.\n- 실행 전후에 `.env`/collector 설정을 CLI와 동일하게 주입, pyproject에서 `pytest_plugins` 자동 로딩 유지.\n- 선택 고객 3곳과 베타 프로그램 진행, `pytest-xdist`/`pytest-asyncio` 호환성 확인.\n- 피드백 반영 후 `fluxloop-cli` 0.7.x 릴리스 및 changelog 업데이트.\n- 블로그/공지 게시, 텔레메트리로 Pytest fixture 사용량 모니터링.\n\n---\n\n> Polish #13은 Pytest를 “친숙한 실행 껍데기”로 제공하여 온보딩과 CI 경험을 향상시키되, FluxLoop 엔진이 제공하는 다중 러너·멀티턴·관측 표준화를 그대로 유지하는 전략이다.\n\n", "metadata": {"source": "docs/prd/polish/polish_13_pytest_bridge.md", "chunk_index": 21, "total_chunks": null}}
{"id": "091e3b64-bffd-4c3c-a67c-3c3fe194e9a8", "content": "# FluxLoop VSCode Extension Polish #1 – 프로젝트 생성 UX 기획\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "fd24207a-ea17-405f-a844-5ccc1f85730c", "content": "## 문서 정보\n- **작성일**: 2025-11-17\n- **버전**: v0.1.0\n- **대상**: VSCode Extension 프로젝트 생성 플로우 개선 (Polish #1)\n- **관련 문서**\n  - `docs/prd/vscode_ux_improvement.md`\n  - Linear Issue: [PLU-64](https://linear.app/pluto-ai/issue/PLU-64/polishing-1-%ED%94%8C%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1)\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "7d100f14-cc5e-4b04-8e7d-8184972a673f", "content": "## 1. 배경\n- 현행 프로젝트 생성 플로우는 두 개의 폴더 선택과 환경 선택을 동시에 요구하여 학습 비용과 오류 가능성이 높음.\n- `docs/prd/vscode_ux_improvement.md`에서 제안한 개선 사항을 기반으로, **기본(Default) / 고급(Custom)** 분기 플로우를 설계하여 온보딩을 단순화하고자 함.\n- Polish #1에서는 “프로젝트 생성” 단계만 집중적으로 다듬어 재탑재를 준비한다.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "428f01c5-07bc-4063-89ff-d4f8cdec0f36", "content": "## 2. 문제 정의\n1. **사용자 혼란**: 프로젝트 루트와 FluxLoop 전용 프로젝트 간 관계를 즉시 이해하기 어려움.\n2. **환경 설정 루프**: 가상환경 검증이 실패할 경우 반복 선택이 필요하여 이탈률 상승.\n3. **폴더 관리 부담**: 결과 파일과 실험 데이터 관리 위치가 사용자마다 달라 협업 시 혼선 발생.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "f6410c5a-4de5-4cc4-b4ee-0bb14855634a", "content": "## 3. 목표\n- 기본(Default) 플로우로 **한 번의 이름 입력 + 환경 선택**만으로 프로젝트 생성 가능.\n- FluxLoop 프로젝트 결과는 **공용 루트(기본: `~/FluxLoopProjects/`)**에 일관되게 저장.\n- Custom 플로우에서 기존 “두 폴더 선택” 방식을 유지하되 고급 사용자에게만 노출.\n- 전체 흐름은 3분 이내 완료, 실패 시 명확한 가이드 제공.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c0f8483b-e08b-4d16-8e38-569eefe1ca0d", "content": "## 4. UX 전략\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "c50b88f0-2f5e-4e64-ad86-58125c34c7e4", "content": "### 4.1 플로우 개요\n```\nCreate Project\n└── Select Mode (Default / Custom)\n    ├── Default\n    │   1) 프로젝트명 입력\n    │   2) 환경 선택 (현재 워크스페이스 기준 후보 제안)\n    │   3) 예제 포함 여부 선택\n    │   4) FluxLoop 공용 루트에 프로젝트 생성\n    └── Custom\n        1) 프로젝트명 입력\n        2) FluxLoop 프로젝트 루트 선택\n        3) 환경 폴더 선택 또는 직접 입력\n        4) 예제 포함 여부 선택\n```\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "fd6209eb-6642-4fde-ba0a-bc92f149030b", "content": "### 4.2 Default 플로우\n- **Mode 선택 QuickPick**에 Default 옵션 설명:\n  - “추천 · 자동 경로 설정 · 한 번 선택으로 완료”\n- 프로젝트명 InputBox\n  - 미입력/중복시 즉시 검증\n  - 경로 미리보기: `<공용 루트>/<프로젝트명>`\n- 환경 QuickPick\n  - VSCode Python Extension에서 감지한 인터프리터를 상단 추천\n  - 워크스페이스 루트 하위의 `.venv/`, `poetry`, `conda` 등 후보 나열\n  - `Use global PATH (⚠️ 권장하지 않음)` 옵션은 하단 배치\n- 예제 포함 여부 QuickPick (기존 로직 재사용)\n- 공용 루트 생성\n  - 기본 경로: `~/FluxLoopProjects/`\n  - 최초 실행 시 존재 여부 확인 → 없으면 안내 후 자동 생성\n  - 확장 설정(`fluxloop.projectRoot`)에 저장하여 재사용\n- 최종 Confirm Notification\n  - 생성 경로 & 환경 명시\n  - 다음 단계 CTA: `Configure Inputs`, `Open Project`, `Stay`", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "fff6c02a-7ffc-4873-9424-ab3ca1724f28", "content": "### 4.3 Custom 플로우\n- 기존 플로우 유지(두 폴더 선택) + 개선된 문구 적용\n- Default 대비 차별점 강조:\n  - 경로를 수동으로 지정하고 싶은 사용자, 다중 루트/원격 개발 환경 사용자를 위한 옵션임을 설명\n- 패키지 누락 모달, Progress Notification 등은 Default와 공유\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "81d71e4c-9ca2-44e1-aad7-91548617def8", "content": "### 4.4 에러 및 Fallback\n- 공용 루트 생성 실패 → 사용자에게 다른 경로 입력 요청 + Custom 플로우로 전환 안내\n- 환경 자동 감지 실패 → QuickPick 최상단에 `Browse for environment...` 제공\n- 권한/원격 환경 경고 → Output Channel과 Notification으로 명확화\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "9c174061-8ce9-486b-927c-75ff04db4766", "content": "## 5. 기능 요구사항\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "876bf134-4d4f-44bf-832f-361f41ea77a0", "content": "### 5.1 공용 루트 관리\n- 설정 키: `fluxloop.projectRoot` (string)\n- 기본값: `~/FluxLoopProjects/`\n- 명령: “Change FluxLoop Project Root…” 추가 (Settings/Command Palette)\n- 생성 시 경로 충돌 처리:\n  - 동일 프로젝트명 존재 → `_2`, `_3` 형태 자동 증가 or 사용자 확인\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "d97d971b-0e3f-41cd-81bc-2cc9f60d3903", "content": "### 5.2 환경 후보 탐색\n- 탐색 순위:\n  1. `python.pythonPath` 또는 VSCode Python API에서 최근 사용 인터프리터\n  2. 워크스페이스 루트 하위 `.venv`, `.env`, `.python`, `poetry` 패턴\n  3. `~/.pyenv/versions/<name>/bin/python` 등 글로벌 매니저 경로(탐지 시)\n- 후보 정보 표시: 이름, 유형(venv/conda/poetry/global), 위치\n- Telemetry: 자동 감지 성공/실패, 선택된 환경 타입 기록\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "10482c76-5bf2-4e64-8b8b-fae523843720", "content": "### 5.3 예제 자원 관리\n- 예제 포함 시 `examples/` 디렉터리 자동 복사\n- 공용 루트 내 동일 자원 중복 설치 방지 (필요 시 덮어쓰기 옵션)\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "0096515b-214c-4191-8a0d-eaefd4726aac", "content": "### 5.4 진행 표시 & 로그\n- Progress Notification 단계:\n  1. “Validating Python environment…”\n  2. “Running fluxloop init project…”\n  3. “Saving VSCode settings…”\n- Output Channel: 명령 실행 로그, 오류 메시지, 경로 정보 출력\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "ec803797-afcd-4607-ac7f-c1f051e599a5", "content": "## 6. 기술 구현 고려사항\n- VSCode API\n  - `window.createQuickPick`, `window.showInputBox`, `withProgress`, `showWarningMessage`(modal)\n  - `workspace.getConfiguration`으로 공용 루트 관리\n  - Python 확장과 인터페이스: `vscode.env.openExternal`, `vscode.commands.executeCommand('python.Environments.getActiveEnvironmentPath')`\n- 파일 시스템\n  - Node.js `fs/promises` 사용\n  - 홈 디렉터리 추출: `os.homedir()`\n  - 경로 정규화: `path.join`, `path.resolve`\n- 기존 코드 영향 범위\n  - `packages/vscode/src/commands/projectCommands.ts` (플로우 작성)\n  - 신규 유틸: `packages/vscode/src/utils/environmentDiscovery.ts` (예상)", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "9497b144-32c8-4fce-bc10-8b058899a0e6", "content": "  - 설정 스키마 업데이트: `packages/vscode/package.json`\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "850e13d1-d3e5-4701-9d0d-e8dc9f5f72e3", "content": "## 7. 검증 및 롤아웃 계획\n1. **내부 알파**: 개발자 2명 대상 Default 플로우 테스트, 감지 실패/시간 측정.\n2. **베타 옵션**: 설정에서 “Use new Project Creation flow (beta)” 토글 제공.\n3. **텔레메트리 분석**: 성공률, Custom 플로우 전환 비율, 오류 유형 수집.\n4. **정식 전환**: 성공률 ≥ 95%, 평균 생성 시간 60초 이하 달성 시 기본값으로 고정.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "ae0e8f2b-2072-4c7a-9bcb-7541107da2f7", "content": "## 8. 리스크 및 대응\n- **공용 루트 권한 문제**: 생성 실패 시 Custom 플로우로 전환 + 경고 문구 제공.\n- **환경 감지 오탐**: 선택 리스트에 “경로 보기” 제공, 사용자가 직접 확인 가능.\n- **원격 개발 호환성**: Dev Container/SSH 환경에서 경로가 컨테이너 내부임을 명시.\n- **역호환**: 기존 Custom 플로우를 유지하여 사용자 반발 최소화.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "915d5875-03cb-4342-85b5-b241919afe13", "content": "## 9. 일정(초안)\n| 기간 | 작업 |\n|------|------|\n| Day 1 | UX 시나리오 확정, 설정 스키마 정의 |\n| Day 2 | Environment discovery 유틸 구현 |\n| Day 3 | Default 플로우 UI/로직 구현 |\n| Day 4 | Custom 플로우 통합 및 리팩터링 |\n| Day 5 | QA 및 텔레메트리 이벤트 점검, 베타 배포 준비 |\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "65927f6c-1039-4e1d-95bd-c54d345bca0c", "content": "## 10. 승인\n- **작성자**: FluxLoop VSCode 팀\n- **검토자**: TBD\n- **승인자**: TBD\n\n---\n\n> Polish #1은 프로젝트 생성 UX를 핵심 타겟으로 삼고, Default/Custom 이원화 전략과 공용 루트 표준화를 통해 “한 번에 생성” 경험을 제공한다. 후속 Polish에서는 Status TreeView, 입력 생성 UX 등 연계 개선을 진행한다.\n", "metadata": {"source": "docs/prd/polish/polish_1_plan.md", "chunk_index": 21, "total_chunks": null}}
{"id": "f21133e9-62a1-44c9-b4ba-ca5abcb8a93d", "content": "# FluxLoop VSCode Polish #1 – QA & Telemetry Plan\n", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 0, "total_chunks": null}}
{"id": "5e135da3-7b61-4c23-b984-738ff1326bba", "content": "## 1. Overview\n- **대상 기능**: 프로젝트 생성 Default/Custom 분기, 공용 루트 설정(`fluxloop.projectRoot`), 환경 후보 탐색(`environmentDiscovery.ts`)\n- **목표**: 베타 릴리스 전 수동 QA 수행, 텔레메트리 이벤트 정의, 롤아웃 체크리스트 정리\n- **작성일**: 2025-11-17\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a009d01c-2964-4a7a-ac56-0a14c89b4c23", "content": "## 2. Manual QA Checklist\n\n| 케이스 | 준비 조건 | 기대 결과 |\n|-------|-----------|-----------|\n| Default 플로우 – 단일 워크스페이스 | `.venv`가 있는 VSCode 워크스페이스 | 환경 QuickPick에 워크스페이스 `.venv` 우선 노출, `~/FluxLoopProjects/<name>`에 프로젝트 생성 |\n| Default 플로우 – 다중 워크스페이스 | 두 개 이상의 VSCode 워크스페이스 폴더 | 루트 선택 QuickPick 표시, 선택한 폴더 기준으로 환경 후보 제한 |\n| Default 플로우 – 환경 없음 | 워크스페이스 내 가상환경 없음 | 후보 리스트 비어 있거나 경고 포함, `Choose another environment` 선택 시 폴더 다이얼로그 열림 |\n| Default 플로우 – 공용 루트 생성 실패 | 권한 없는 경로를 설정(default) | 오류 메시지 출력 후 플로우 중단, Telemetry: `projectRootCreateFailed` |", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 2, "total_chunks": null}}
{"id": "dc2ab8a2-f7a2-4903-ac83-97f383d98dc3", "content": "| Custom 플로우 – 기존 로직 유지 | 기존 구현과 동일한 상황 | 기존 QuickPick/오류 메시지 그대로 동작 |\n| 환경 검증 실패 루프 | FluxLoop 패키지가 없는 환경 선택 | 모달 경고 후 `Retry`/`Select Different Folder` 등 버튼 정상 동작 |\n| Global PATH 선택 | QuickPick에서 `Use system Python` 선택 | modal 경고 후 `global` 모드 설정, `executionMode=global` 저장 |\n| Include/Skip 예제 | 두 옵션 각각 선택 | CLI 호출 인자 `--no-example` 확인, 생성 결과 폴더 구조 검증 |\n| 완료 후 Open 행동 | 완료 메시지에서 3가지 옵션 선택 | `Open in current`, `Open in new window`, `Stay` 각각 기대 동작 |\n", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 3, "total_chunks": null}}
{"id": "0580844d-669e-4e15-99f1-d752a2f70647", "content": "### 추가 검증 항목\n- `fluxloop.projectRoot` 설정을 사용자 정의 후 Default 플로우 재실행 → 설정값 반영 여부 확인\n- `environmentDiscovery`가 pyenv, conda 등 다양한 환경을 정확히 식별하는지 샌드박스 프로젝트로 확인\n- Telemetry 이벤트가 중복 기록되지 않는지 Output Channel 검사\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 4, "total_chunks": null}}
{"id": "55dfc691-4b08-4ed3-8987-baf2ff5e61cc", "content": "## 3. Telemetry Events\n\n| 이벤트 ID | 발생 위치 | 속성 |\n|-----------|-----------|------|\n| `projectCreation.start` | `ProjectCommands.createProject` | `mode: default/custom`, `workspaceCount`, `hasWorkspaceEnv` |\n| `projectCreation.envDetected` | `promptDefaultEnvironmentChoice` | `sources`, `candidateCount`, `selectedSource`, `confidence` |\n| `projectCreation.envValidation` | `prepareProjectEnvironment` | `result: success/fail/global`, `missingPackages` |\n| `projectCreation.rootResolved` | `ensureDefaultProjectRoot` | `path`, `created: boolean`, `error`(optional) |", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 5, "total_chunks": null}}
{"id": "1d48b454-0081-4cf1-b1a6-108521a4b625", "content": "| `projectCreation.completed` | `initializeProject` | `mode`, `includeExample`, `durationMs`, `openAction` |\n| `projectCreation.cancelled` | 모든 QuickPick/Input 취소 시 | `stage`, `mode`, `reason` |\n\n> **Implementation Note**: 텔레메트리 전송은 `packages/vscode/src/utils/telemetry.ts` (신규) 또는 기존 추적 도구를 통해 구현 예정. 현재 문서 단계에서는 API 설계만 정의.\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 6, "total_chunks": null}}
{"id": "033bb9db-c36b-4cd4-a521-bcb5eba46fdf", "content": "## 4. Beta Rollout Steps\n1. **Telemetry Wiring**  \n   - 위 이벤트를 `telemetry.report(event, properties)` 형태로 삽입  \n   - 에러 케이스(`projectRootCreateFailed`, `envValidationFailed`)는 Output Channel과 함께 기록\n2. **Internal Dogfooding (Day 1-2)**  \n   - 팀 구성원 2명 이상이 실제 프로젝트에서 Default 플로우 사용  \n   - Telemetry 대시보드(또는 로그)에서 이벤트 수집 정상 여부 확인\n3. **Beta Flag 적용**  \n   - `fluxloop.enablePolishProjectFlow` 설정 또는 명령으로 토글 제공  \n   - Release Notes 초안 작성(새 기능, Default/Custom 설명)\n4. **Feedback Window (Day 3-4)**  \n   - 발견된 이슈를 Linear 서브태스크로 기록  \n   - Telemetry 분석으로 취소율/Global PATH 비중 등 확인", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 7, "total_chunks": null}}
{"id": "5efa2107-6804-4fa5-9a2a-0e87f1e24e20", "content": "5. **Public Beta Release (Day 5)**  \n   - VSIX 베타 채널 배포  \n   - Docs/Onboarding 페이지 업데이트 (`docs/prd/vscode_ux_improvement.md` 링크)\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 8, "total_chunks": null}}
{"id": "b3ccb8b8-d421-4b4a-bf9d-8f2a404a87c9", "content": "## 5. Outstanding Items\n- Telemetry 유틸 구현 및 공용 채널 정의\n- E2E 자동화(가능하다면 CLI mock) ⇒ 미리보기 단계에서 제외\n- Dev Container/SSH 환경에서의 공용 루트 접근성 추가 점검\n\n---\n", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 9, "total_chunks": null}}
{"id": "f1af643c-bac4-4d0f-9536-16c98fa432c5", "content": "## 6. Sign-off\n- **QA Owner**: TBD  \n- **Telemetry Owner**: TBD  \n- **Release Manager**: TBD\n\n> QA/Telemetry 체크 완료 후 `todo-qa-telemetry` 항목을 완료로 업데이트한다.\n", "metadata": {"source": "docs/prd/polish/polish_1_qa_rollout.md", "chunk_index": 10, "total_chunks": null}}
{"id": "73b64444-a2bc-421e-992d-5fc26b23905d", "content": "## FluxLoop VSCode 초기화 리뉴얼 기획\n", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 0, "total_chunks": null}}
{"id": "b06a3752-9280-48f3-b94f-08e122651e28", "content": "### 목표\n- 프로젝트 생성 시 **타겟 소스 루트와 해당 Python 환경을 먼저 확정**하고, 그 환경에 FluxLoop 패키지가 설치되어 있는지 검증한다.\n- 조건을 만족한 경우에만 CLI `init`을 실행해 **항상 프로젝트 환경과 CLI 환경이 일치**하도록 유도한다.\n- 글로벌 설치로 진행하고 싶은 사용자는 명시적으로 opt-in 하도록 해 “두 군데 설치” 문제를 최소화한다.\n\n---\n", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 1, "total_chunks": null}}
{"id": "0c05d973-a0fb-423b-9662-ce540b59fbbc", "content": "### 1. 사용자 플로우 개편안\n\n1. **프로젝트 생성 명령 실행**  \n   `FluxLoop: Create Project` 선택 → 프로젝트 위치/이름 입력\n\n2. **타겟 소스 루트 선택**  \n   - 기존 폴더를 지정하거나 새 폴더 생성\n   - 선택 즉시 `fluxloop.targetSourceRoot` 설정 저장\n\n3. **환경 탐색 & 확인 단계 (신규 UI)**  \n   - `.venv`, `venv`, `env`, `.conda` 등 가상환경 검색\n   - Python 실행 파일·FluxLoop CLI·fluxloop-mcp 경로 확인\n   - UI에 탐지 결과 출력 + 옵션 제공  \n     ```\n     탐지된 환경:\n       • Python: <path> (3.11.7)\n       • fluxloop: 설치됨 / 미설치\n       • fluxloop-mcp: 설치됨 / 미설치\n     ```\n   - 선택지를 QuickPick으로 제공  \n     - `확인` (현재 환경으로 proceed)\n     - `설치 스크립트 실행` (`setup_fluxloop_env.sh` 호출)", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 2, "total_chunks": null}}
{"id": "c9ee6330-13f4-4c71-97e3-97ab1db184c3", "content": "     - `직접 설치 후 재시도`\n     - `글로벌 PATH 사용 (권장하지 않음)`\n\n4. **환경 조건 만족 여부 판단**\n   - `확인` 선택 시:  \n     - Python + fluxloop CLI + fluxloop-mcp가 모두 감지되면 통과\n     - 하나라도 없으면 에러 → 설치 안내 후 재시도 요구\n   - `설치 스크립트 실행` 선택 시:\n     - 터미널 생성하여 `bash scripts/setup_fluxloop_env.sh --target-source-root <선택>` 실행\n     - 완료 후 다시 탐색 → 충족하면 통과\n   - `글로벌 PATH 사용` 선택 시:\n     - 경고 모달(티켓 형식) → 확인하면 init을 global로 진행\n     - 이후 Output 채널에 “현재 프로젝트는 global 환경을 사용 중” 로그 기록, 추후 전환 방법 안내\n\n5. **CLI init 실행**\n   - 조건 충족 시 `EnvironmentManager.resolveCommand('fluxloop')`로 경로 확보", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 3, "total_chunks": null}}
{"id": "3a1404ab-90e5-45c8-8744-ca31992e2e04", "content": "   - 해당 경로로 `fluxloop init project --name ...` 실행\n   - 완료 후 `FluxLoop: Show Environment Info` 요약을 출력/로그로 노출\n\n---\n", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 4, "total_chunks": null}}
{"id": "4b3edcf2-8794-45d6-81ee-4e479a8162c9", "content": "### 2. UI/UX 변경 사항\n\n- **새로운 QuickPick/입력 흐름**: 프로젝트 생성 마법사 단계에 “환경 확인” UI 추가\n- **상태 메시지**:\n  - 환경 감지 결과를 Output + 알림으로 제공\n  - 에러 시 구체적 가이드 (예: 설치 명령, 문서 링크)\n- **자동 설치 옵션**:\n  - “자동 설치(스크립트 실행)” 선택 항목 제공  \n  - 완료 후 “설치 완료, `fluxloop doctor` 실행” 메시지 표시\n- **Global 사용 시 경고**:\n  - “향후 target source root 전환 시 환경을 다시 맞춰야 함” 문구\n  - “마법사 종료 후 `FluxLoop: Select Environment`로 언제든 전환 가능” 안내\n\n---\n", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 5, "total_chunks": null}}
{"id": "1c592eaa-593e-4fd7-bfd8-686408c58714", "content": "### 3. 시스템 변경 포인트\n\n1. **CommandManager**\n   - `createProject()` 로직에 환경 탐색/QuickPick 단계 삽입\n   - `setProjectSourceRoot()` 이후 환경 설치 검사 함수 호출\n\n2. **EnvironmentManager**\n   - `ensureEnvironmentReady(root, options)` 같은 유틸 추가  \n     - venv 탐색 → CLI 존재 여부 확인 → 결과 객체 반환\n   - `refreshActiveEnvironment()` 호출 타이밍 조정 (타겟 root 선택 즉시)\n\n3. **CLIManager**\n   - `runCommand`가 항상 환경 감지 이후 호출되도록 보장 (이미 적용되어 있지만 검증)\n\n4. **자동화 스크립트 연동**\n   - `setup_fluxloop_env.sh` 실행을 위해 `TerminalManager` 혹은 `vscode.window.createTerminal()` 활용  \n   - 실행 로그를 Output 채널로 미러링", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 6, "total_chunks": null}}
{"id": "9ad3c8b2-cd5a-4b7c-bdaf-31ca0acc2c13", "content": "\n5. **설정 저장**\n   - 환경 확정 시 `.vscode/settings.json`에 `fluxloop.executionMode`와 `fluxloop.targetSourceRoot` 저장\n   - Global 선택 시에는 `executionMode: global`, 프로젝트 환경 성공 시 `workspace` 또는 `auto`로 설정\n\n---\n", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 7, "total_chunks": null}}
{"id": "e105e7b6-ad4e-4a37-9af2-bb06edca3edc", "content": "### 4. 예외/오류 시나리오 처리\n\n| 상황 | 대응 | 메시지 예시 |\n| --- | --- | --- |\n| `.venv` 미존재 | 설치 필요 안내 | “선택한 경로에 가상환경이 없습니다. 아래 커맨드를 실행해 주세요…” |\n| 가상환경 있음, CLI 미설치 | 자동 설치 옵션 제공 | “FluxLoop CLI가 감지되지 않았습니다. 설치 스크립트를 실행하시겠습니까?” |\n| 설치 중 에러 발생 | 로그 + 재시도 안내 | Output에 에러 출력, QuickPick → `재시도 / 직접 설치 가이드 / 글로벌 사용` 제공 |\n| Global PATH 사용 선택 | 경고 모달 | “Global 환경으로 진행합니다. 프로젝트 환경으로 전환하려면 Select Environment를 실행하세요.” |\n| target root 없는 상태에서 init 요청 | 최종 확인 알림 | “프로젝트 환경이 설정되지 않았습니다. Global PATH로 진행하시겠습니까?” |\n\n---\n", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 8, "total_chunks": null}}
{"id": "789d6605-3d00-440b-a139-7cdec6c2fc11", "content": "### 5. 문서 & 교육 자료 연계\n\n- Getting Started / Environment Configuration 문서에 해당 플로우 반영\n- 프로젝트 생성 튜토리얼에 “환경 확인 단계” 캡처 추가\n- Troubleshooting 섹션에 “환경 미탐지 → 설치 안내” 절차 상세 기술\n\n---\n", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 9, "total_chunks": null}}
{"id": "5ef09511-88c4-4df5-9d1b-828d32819258", "content": "### 6. 단계별 개발 체크리스트\n\n1. **환경 확인 모듈**: EnvironmentManager에 `detectEnvironmentStatus(root)` 구현\n2. **UI 플로우**: CommandManager에서 QuickPick/메시지 로직 구현\n3. **설치 스크립트 연동**: Terminal 생성 + 실행 결과 핸들링\n4. **환경 설정 저장**: `.vscode/settings.json` 업데이트 보장\n5. **CLI init 연동**: 환경 확정 후 CLI 실행 경로 확인\n6. **로그/알림**: Output/알림 메시지 포맷統一\n7. **테스트 케이스**:\n   - 가상환경 있음/없음 (`.venv`, `env`, conda)\n   - FluxLoop CLI/fluxloop-mcp 설치 여부 (정상 / 일부만 설치 / 전부 미설치)\n   - 환경 선택 플로우 (프로젝트 폴더 / 다른 폴더 / Global PATH)\n   - 설치 스크립트 실행 (스크립트 존재 / 미존재 / Windows Bash 미설치)", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 10, "total_chunks": null}}
{"id": "2fcb220e-3c0a-4ef3-b960-43b5ce1ecbb5", "content": "   - 수동 설치 후 Retry 시 환경 정상 인식 여부\n   - Output 채널 로그에 상태/경고 메시지 출력 여부\n   - Windows/macOS/Linux PATH 차이\n\n---\n\n이 기획대로 진행하면 “두 군데에 CLI를 설치해야 한다”는 혼선을 줄이고, 프로젝트 환경과 FluxLoop 도구가 초기에 바로 정렬되도록 만들 수 있습니다.", "metadata": {"source": "docs/prd/project_init_renewal.md", "chunk_index": 11, "total_chunks": null}}
{"id": "7b57c260-188f-4d66-af25-ea84a2a5a5f3", "content": "## FluxLoop Runner 통합 확장 PRD (HTTP/WS, 서브프로세스, 스텝 루프 등)\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 0, "total_chunks": null}}
{"id": "e6f5a6b3-a232-4ba8-8d0c-609d45e139cd", "content": "### 1. 배경 / 문제 정의\n- 현재 `configs/simulation.yaml`의 `runner`는 6가지 패턴(Module+Function, Class.method, Bound instance, Factory, Async Generator, Async Iterable)을 공식 지원.\n- 실사용 환경에선 원격 HTTP/WS 서비스, 타 언어 런타임(Node/Go 등), 단계적 스텝 루프, 리소스 가드, 배치·데이터셋 실행, 고급 스트리밍 스키마, 컨테이너·큐 통합 등 추가 요구가 빈번함.\n- 목표는 기존 `runner` 모델을 확장해 “대부분의 chat 기반 에이전트 통합”을 코드 변경 최소화로 커버하는 것.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 1, "total_chunks": null}}
{"id": "8f003c84-460e-486b-aa5c-7a48f301b9bc", "content": "### 2. 목표(Goals)\n1. P0: HTTP/SSE/WebSocket 러너, 서브프로세스(JSONL) 브리지, 스텝 루프(`step()`+`terminate_when`), 시간/리소스 가드 제공.\n2. P1: 배치/데이터셋 실행, 고급 스트리밍 스키마(이벤트 경로/집계), 입출력 어댑터(프리/포스트 변환) 제공.\n3. P2: 컨테이너 실행(Docker), 큐/워커(Redis/SQS) 연동, 멀티타깃/컴포지트 실행 제공.\n4. 문서/CLI/VSCode 일관 UX: 설정은 `configs/simulation.yaml`(v0.2.0 구조)에 수렴.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 2, "total_chunks": null}}
{"id": "a9f128ca-5e00-42fd-8b40-b148bc68d2ed", "content": "### 3. 비목표(Non-Goals)\n- 풀스택 큐/오케스트레이션 플랫폼 제공(운영용 브로커/스케줄러 구축은 범위 밖).\n- 컨테이너 오케스트레이션(Kubernetes 등) 네이티브 통합.\n- 복잡한 실시간 멀티파티 WS 라우팅/브로커(필요 시 HTTP/WS 러너 상위에서 조합).\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 3, "total_chunks": null}}
{"id": "878873b7-5591-4e05-b913-32f9433dbb66", "content": "### 4. 참조\n- Runner 기본 패턴: `packages/website/docs-cli/configuration/runner-targets.md`\n- 설정 구조 개편: `docs/prd/fluxloop_v0.2.0_settings_recording.md`\n\n---\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 4, "total_chunks": null}}
{"id": "40fd6eea-24f2-46c1-8fc7-7fbbcb1c4f00", "content": "## 5. 기능적 요구사항(Functional Requirements)\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 5, "total_chunks": null}}
{"id": "e8ae4973-7768-40dd-a4f9-20a879baffb4", "content": "### 5.1 HTTP/SSE/WebSocket 러너 (P0)\n원격/로컬 HTTP API 또는 스트리밍 엔드포인트(SSE/WS)를 호출하여 응답(또는 델타)을 수집.\n\n예시 스키마:\n\n```yaml\nrunner:\n  http:\n    method: POST              # GET/POST/PUT...\n    url: \"http://localhost:8000/chat\"\n    headers: { Content-Type: application/json }\n    timeout: 60s              # 요청 타임아웃\n    retry:\n      attempts: 2\n      backoff: 200ms\n    stream: sse               # none | sse | websocket\n    stream_output_path: \"message.delta\"  # 델타 경로(기본값과 동일)\n    body_template:            # 선택: 입력/컨텍스트 직렬화 전략\n      type: json", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 6, "total_chunks": null}}
{"id": "c9cbd500-0d9c-4078-9573-d6f4ee197b7c", "content": "      mapping:\n        input: \"$.input\"      # 시뮬레이션 입력 JSONPath → 요청 바디 키\n        context: \"$.context\"\n```\n\n수용 기준(Acceptance):\n- SSE/WS 스트리밍에서 `stream_output_path`로 텍스트를 순서대로 조인해 단일 응답 생성.\n- 비스트리밍(`none`)의 경우 HTTP 응답 바디에서 최종 텍스트 JSONPath 추출 지원(기본: `$.output`), 실패 시 오류 보고.\n- 재시도/타임아웃 동작 및 로깅/트레이싱 기록.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 7, "total_chunks": null}}
{"id": "f4c17c2a-3d65-4b1e-b434-324b95369f96", "content": "### 5.2 서브프로세스(JSONL) 브리지 (P0)\n로컬 프로세스를 실행해 STDIN/STDOUT으로 JSONL 메시지를 교환. 타 언어 런타임(Node/Go 등)과 연동.\n\n```yaml\nrunner:\n  process:\n    command: [\"node\", \"agent.mjs\"]\n    cwd: .\n    env: { NODE_ENV: production }\n    protocol: jsonl\n    stream_output_path: \"delta\"   # JSONL 이벤트 내 델타 경로\n    ready_pattern: \"^READY$\"      # 선택: 시작 준비 신호(한 줄)\n    timeout: 120s\n```\n\n메시지 규약(권장):\n- Input: `{ \"type\": \"input\", \"input\": \"...\", \"context\": {...} }`\n- Stream: `{ \"type\": \"delta\", \"delta\": \"...\" }`\n- Final: `{ \"type\": \"final\", \"output\": \"...\" }`", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 8, "total_chunks": null}}
{"id": "f1d97d9a-6895-43b3-afc9-b34fd1bad86e", "content": "\n수용 기준:\n- 프로세스 종료·에러 코드 처리, 타임아웃 시 시그널로 정리, 잔여 로그 캡처.\n- JSONL 파싱 실패 시 라인 번호·내용 요약과 함께 실패 원인 기록.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 9, "total_chunks": null}}
{"id": "f8ce3402-5f5e-4c85-95d0-4ee3f8359f4d", "content": "### 5.3 스텝 루프 + 종료 조건 (P0)\n`step()`을 반복 호출하여 대화/플로우를 전개하고, 종료 조건으로 루프를 마무리.\n\n```yaml\nrunner:\n  target: \"app.agent:step\"\n  step_loop:\n    max_steps: 16\n    terminate_when: \"$.done == true\"   # JSONPath 기반 불리언 평가\n    aggregate:\n      strategy: concat                  # latest | concat\n      joiner: \"\\n\"\n      output_path: \"$.reply\"           # 각 스텝 결과에서 추출 경로\n```\n\n수용 기준:\n- `max_steps` 초과 시 안전 종료 및 경고.\n- `terminate_when` 참이면 즉시 종료.\n- `aggregate` 전략에 따라 최종 텍스트 구성.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 10, "total_chunks": null}}
{"id": "616d7291-365c-44cf-94be-dc2ad5a0e9e4", "content": "### 5.4 시간/리소스 가드 (P0)\n실험 안전망. 전역 또는 러너 스코프에서 적용.\n\n```yaml\nrunner:\n  guards:\n    max_duration: 120s\n    output_char_limit: 20000\n    cancel_on_keyboard_interrupt: true\n```\n\n수용 기준:\n- 제한 초과 시 중단·로깅·부분 결과 정리.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 11, "total_chunks": null}}
{"id": "c905da16-921a-4e37-9ab3-04094558c564", "content": "### 5.5 배치/데이터셋 실행 (P1)\n입력 파일(JSONL/CSV/YAML) 기반 반복 실행 및 병렬성 제어.\n\n```yaml\nsimulation:\n  batch:\n    input_file: inputs/dataset.jsonl\n    input_path: \"$.input\"      # 각 레코드 내 입력 경로\n    parallelism: 4\n    shuffle: false\n```\n\n수용 기준:\n- 진행률/성공률 요약, 실패 항목 재시도 옵션.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 12, "total_chunks": null}}
{"id": "45e0a6b1-6312-4e6e-bd5c-180b8abf5400", "content": "### 5.6 고급 스트리밍 스키마 (P1)\n툴콜/함수콜 등 다양한 이벤트를 경로로 지정하고 집계 전략을 선택.\n\n```yaml\nrunner:\n  stream_schema:\n    events:\n      text_delta: \"message.delta\"\n      tool_call_name: \"tool.name\"\n      tool_call_args: \"tool.arguments\"\n    aggregate:\n      text_delta: { strategy: concat, joiner: \"\" }\n```\n\n수용 기준:\n- 지정 이벤트가 없는 경우 기본 `message.delta`만 집계.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 13, "total_chunks": null}}
{"id": "86df7221-0108-4af8-9eaf-9a5ca223421d", "content": "### 5.7 입출력 어댑터(프리/포스트 변환) (P1)\n함수 시그니처와 시뮬레이션 입력/출력 간 매핑을 커스터마이즈.\n\n```yaml\nrunner:\n  input_adapter: \"app.adapters:to_model_input\"    # (input, context) → request\n  output_adapter: \"app.adapters:from_model_output\"# raw → final_text\n```\n\n수용 기준:\n- 어댑터 예외 시 원인/스택 포함 오류 보고.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 14, "total_chunks": null}}
{"id": "1b36fbd7-5d21-4f02-b8c1-a52b3e4d91cc", "content": "### 5.8 컨테이너 실행(Docker) (P2)\n격리·재현성. 단일 컨테이너 실행 후 HTTP/프로세스로 상호작용.\n\n```yaml\nrunner:\n  container:\n    engine: docker\n    image: my/agent:latest\n    pull: ifNotPresent        # always | ifNotPresent | never\n    command: [\"python\", \"-m\", \"app.server\"]\n    env_file: .env\n    mounts:\n      - type: bind\n        source: .\n        target: /app\n    network: bridge\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 5s\n      retries: 10\n```\n\n수용 기준:\n- 컨테이너 수명주기 관리(시작/정지/정리), 실패 시 로그 수집.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 15, "total_chunks": null}}
{"id": "f130fa41-d6ee-46f7-b229-24963e11acac", "content": "### 5.9 큐/워커 통합(Redis/SQS) (P2)\n메시지 큐를 통한 비동기 요청/응답 패턴.\n\n```yaml\nrunner:\n  queue:\n    provider: redis\n    request_queue: \"fluxloop:req\"\n    response_queue: \"fluxloop:res\"\n    correlation_key: \"request_id\"\n    timeout: 120s\n```\n\n수용 기준:\n- 상관키 기반 응답 매칭, 타임아웃/재시도, 메트릭 기록.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 16, "total_chunks": null}}
{"id": "e2d12d63-2afc-4dcd-8314-a232cc8ad758", "content": "### 5.10 멀티타깃/컴포지트 실행 (P2)\n여러 에이전트를 순차/병렬 구성해 결합 출력 생성.\n\n```yaml\nrunner:\n  compose:\n    strategy: sequence          # sequence | parallel_first | vote\n    targets:\n      - target: \"app.a:run\"\n      - http:\n          method: POST\n          url: \"http://localhost:8080/chat\"\n```\n\n수용 기준:\n- 전략별 결합 규칙(예: `sequence`: 이전 출력→다음 입력) 지원.\n\n---\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 17, "total_chunks": null}}
{"id": "93bbe696-8dd1-454f-93a4-8b533c53d0f6", "content": "## 6. 비기능 요구사항(Non-Functional)\n- 신뢰성: 타임아웃/재시도, 스트리밍 중단 복구(최소 일회성).\n- 품질: 에러 메시지는 원인·맥락·해결 힌트 포함. 트레이싱/레코딩 통합.\n- 성능: 스트리밍 경로 집계는 O(n) 메모리 사용, 대용량 시 청크 플러시.\n- 보안: 환경변수/시크릿 마스킹, URL/헤더 로깅 정책.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 18, "total_chunks": null}}
{"id": "14855991-d443-4c4e-bad9-eab5f31e4b3d", "content": "## 7. 설정/스키마 변경(요약)\n- `runner.http`, `runner.process`, `runner.step_loop`, `runner.guards`, `runner.stream_schema`, `runner.input_adapter`, `runner.output_adapter`, `runner.container`, `runner.queue`, `runner.compose` 신규 추가.\n- `simulation.batch` 섹션 추가.\n- 기본 `stream_output_path`는 기존과 동일(`message.delta`).\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 19, "total_chunks": null}}
{"id": "d19a2306-5021-4e85-a749-d467ee10cfdd", "content": "## 8. CLI/VSCode 영향 범위\n1) CLI\n - `config_loader.py`: 신규 섹션 파싱/검증.\n - `runner.py`(또는 동등 모듈): 러너 타입 디스패치/스트리밍 집계/가드.\n - `run.py`: 배치 실행/병렬성/진행률/취소.\n - `recording.py`: 스트리밍 이벤트와 최종 응답 동시 기록.\n\n2) VSCode Extension\n - `simulation.yaml` 편집기: 신규 스키마 지원(자동 완성/설명).\n - 실행 UI: 스트리밍 진행률/취소 버튼, 배치 상태 표시.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 20, "total_chunks": null}}
{"id": "02614cc3-be04-4662-afdd-3b529d207151", "content": "## 9. 성공 지표(KPIs)\n- HTTP/서브프로세스/스텝 루프 기반 시나리오에서 무오류 실행률 ≥ 90% (샘플 프로젝트 기준).\n- SSE/WS 스트리밍 응답 지연 ≤ 300ms(평균) + 텍스트 손실 0건.\n- 배치 실행 재현성: 동일 입력 세트 결과 해시 안정성 ≥ 99%.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 21, "total_chunks": null}}
{"id": "2c09a7e5-dae5-4de0-8b73-c48b2ad5a6c4", "content": "## 10. 마일스톤/일정(초안)", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 22, "total_chunks": null}}
{"id": "759ad135-c517-4439-a045-b1964d4fc23e", "content": "### M0(주 1): 스켈레톤 + P0 API\n- HTTP 러너(REST + SSE), 서브프로세스(JSONL), 스텝 루프, 가드 구현.\n- 단위/계약 테스트 및 문서 초안.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 23, "total_chunks": null}}
{"id": "78cf3374-ff62-4b43-8683-0b5ee6bfa32f", "content": "### M1(주 2): 스트리밍/UX 강화\n- WebSocket 스트리밍, 고급 스트림 스키마, 진행률/취소 UX.\n- 배치 실행(기본)과 결과 요약.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 24, "total_chunks": null}}
{"id": "82b291e1-ac6e-4de2-99ef-114c972aa79d", "content": "### M2(주 3): 어댑터/배치 고도화\n- 입력/출력 어댑터 모듈 API 정식화, 배치 병렬성/재시도/리포트.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 25, "total_chunks": null}}
{"id": "44aa38bb-6ebc-4215-830e-d8e16b7ecdd2", "content": "### M3(주 4): 컨테이너/큐 + 안정화\n- Docker 러너, 최소 Redis 큐 패턴, 문서/샘플.\n- 회귀/부하 테스트, 릴리즈 노트.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 26, "total_chunks": null}}
{"id": "734aa1b0-e574-4aa3-9d26-6c07a51f06e6", "content": "## 11. 테스트 전략\n- 단위: 각 러너 타입 I/O/에러/타임아웃.\n- 계약: 샘플 HTTP 서버/프로세스 에이전트/스텝형 더미로 golden 테스트.\n- E2E: `examples/` 연동, 스트리밍/배치/취소 시나리오.\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 27, "total_chunks": null}}
{"id": "040d2734-a25c-4df8-9805-6b17ee6cf639", "content": "## 12. 오픈 이슈\n- JSONPath 평가 표준/성능(의존 라이브러리 선정).\n- 멀티타깃 `compose`의 병렬 합의 규칙(투표/메타 합성) 구체화.\n- 컨테이너 네트워킹/권한(로컬 개발 표준).\n- 큐/워커 백엔드 추상화 범위.\n\n---\n문서 소유: Platform 팀 / FluxLoop\n최초 작성: 2025-11-07\n상태: Draft v0.1\n\n", "metadata": {"source": "docs/prd/runner_integration_extensions_prd.md", "chunk_index": 28, "total_chunks": null}}
{"id": "0d15ad6c-b763-45d3-a5be-2942575058a1", "content": "GUI/UX 기획을 위해 현재 워크플로우와 실험 관리 구조를 파악 중입니다.\n\n\n[6 tools called]\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 0, "total_chunks": null}}
{"id": "f5949569-197b-4d91-815c-41fad9314aa4", "content": "# FluxLoop VSCode Extension GUI/UX 기획\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 1, "total_chunks": null}}
{"id": "63e1f13f-5ec4-4362-9c63-55f29c827d07", "content": "## 1. 전체 워크플로우와 핵심 컨셉\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 2, "total_chunks": null}}
{"id": "8b6dad4b-58e7-45bb-8a04-9e1f12ac4a32", "content": "### 현재 플로우: Init → Record → Input Generation → Experiment → Parse → Evaluate\n- **Init**: 프로젝트 초기화 및 설정 파일 생성\n- **Record**: 실제 에이전트 실행 시 인자 기록 (선택적)\n- **Input Generation**: Base inputs + Personas + Variation strategies로 다양한 입력 생성\n- **Experiment**: 생성된 입력들로 시뮬레이션 실행\n- **Parse**: 결과를 사람이 읽기 쉬운 형태로 변환\n- **Evaluate**: 성능 평가 (향후 구현)\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 3, "total_chunks": null}}
{"id": "c7389ea3-0967-4e59-8f8a-834e53cf7c47", "content": "### 핵심 컨셉: Input Variation 기반 시뮬레이션\n- **Base Inputs**: 기본 테스트 케이스들\n- **Personas**: 다양한 사용자 유형 (novice_user, expert_user 등)\n- **Variation Strategies**: 입력 변주 전략 (rephrase, verbose, error_prone 등)\n- **LLM Generation**: LLM을 활용한 자동 입력 변주 생성\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 4, "total_chunks": null}}
{"id": "ee12afbd-e409-49de-a948-ce6363d3e38f", "content": "## 2. GUI 구조 설계\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 5, "total_chunks": null}}
{"id": "3760e74c-c0fa-4758-9744-f84fc73a3919", "content": "### 2.1 사이드바 패널 구조 (현재 확장)\n```\nFluxLoop\n├── 🧪 Experiments (실험 관리)\n│   ├── Current Experiment (setting.yaml)\n│   │   ├── Configuration\n│   │   ├── Personas (2)\n│   │   ├── Base Inputs (3)\n│   │   ├── Variation Strategies\n│   │   └── Run Experiment\n│   └── Results (완료된 실험들)\n│       ├── experiment_20241201_143022\n│       │   ├── summary.json\n│       │   ├── traces.jsonl\n│       │   └── Parse Results\n│       └── ...\n├── 📊 Results (결과 분석)\n│   ├── Live Results\n│   ├── Trace Analysis\n│   └── Performance Metrics\n└── ℹ️ Status (시스템 상태)", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 6, "total_chunks": null}}
{"id": "8240154b-2fe1-4922-b275-dc6ebba73c63", "content": "    ├── CLI: Installed\n    ├── SDK: Check in terminal\n    ├── Collector: http://localhost:8000\n    └── Config: setting.yaml found\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 7, "total_chunks": null}}
{"id": "cf879f80-9bd8-4bf2-9ddf-8fb5f727a80a", "content": "### 2.2 새로운 패널 추가 제안\n```\nFluxLoop\n├── 🧪 Experiments\n├── 📝 Inputs (새로 추가)\n│   ├── Base Inputs\n│   ├── Generated Inputs\n│   ├── Recordings\n│   └── Generate New Inputs\n├── 👥 Personas (새로 추가)\n│   ├── novice_user\n│   ├── expert_user\n│   └── Add Persona\n├── 📊 Results\n└── ℹ️ Status\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 8, "total_chunks": null}}
{"id": "207ce433-4552-4d2f-8a42-24add7ccffe1", "content": "## 3. 상세 UX 플로우 설계\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 9, "total_chunks": null}}
{"id": "585c79df-f502-44c6-97de-f39e7c892c07", "content": "### 3.1 실험 생성 및 관리 플로우\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 10, "total_chunks": null}}
{"id": "f0e4ab02-2cfe-426d-9e8a-d6818c5e82be", "content": "#### Phase 1: 프로젝트 초기화\n```\n1. \"Initialize Project\" 클릭\n   ↓\n2. 폴더 선택 다이얼로그\n   ↓\n3. 프로젝트명 입력\n   ↓\n4. 예제 에이전트 포함 여부 선택\n   ↓\n5. setting.yaml 생성 및 워크스페이스 열기\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 11, "total_chunks": null}}
{"id": "a9ab03af-ef87-4893-aa30-5c7173e96de7", "content": "#### Phase 2: 설정 구성 (GUI 기반)\n```\n1. Experiments 패널에서 \"Current Experiment\" 확장\n   ↓\n2. Configuration 클릭 → setting.yaml 편집기 열기\n   ↓\n3. 또는 GUI 기반 설정 편집기 제공 (새로 구현)\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 12, "total_chunks": null}}
{"id": "9bc4e36a-5d19-401b-98e9-548e2d90f078", "content": "#### Phase 3: 입력 데이터 준비\n```\n1. Inputs 패널에서 \"Base Inputs\" 확인/편집\n   ↓\n2. \"Generate New Inputs\" 클릭\n   ↓\n3. 입력 생성 다이얼로그:\n   - Mode: Deterministic / LLM\n   - Strategies: rephrase, verbose, error_prone (체크박스)\n   - Limit: 숫자 입력\n   - From Recording: 파일 선택 (선택적)\n   ↓\n4. 생성된 입력 미리보기 및 확인\n   ↓\n5. inputs/generated.yaml 저장\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 13, "total_chunks": null}}
{"id": "8906994d-4fdb-44f0-b704-6315f21033ea", "content": "#### Phase 4: 실험 실행\n```\n1. Experiments 패널에서 \"Run Experiment\" 클릭\n   ↓\n2. 실행 옵션 다이얼로그:\n   - Iterations: 숫자 입력\n   - Personas: 선택 (기본값: 모두)\n   - Dry Run: 체크박스\n   - No Collector: 체크박스\n   - Output Directory: 폴더 선택\n   ↓\n3. 실행 확인 다이얼로그 (총 실행 횟수 표시)\n   ↓\n4. 진행률 표시 및 실시간 로그\n   ↓\n5. 완료 후 Results 패널 자동 갱신\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 14, "total_chunks": null}}
{"id": "db078915-9fa4-4080-bc5f-b7663e00e01e", "content": "#### Phase 5: 결과 분석\n```\n1. Results 패널에서 완료된 실험 선택\n   ↓\n2. \"Parse Results\" 클릭\n   ↓\n3. 파싱 옵션:\n   - Output Directory: per_trace_analysis\n   - Overwrite: Yes/No\n   ↓\n4. 생성된 Markdown 파일들 자동 열기\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 15, "total_chunks": null}}
{"id": "ec724aea-caed-4e89-8581-35e648b10ba9", "content": "### 3.2 GUI 기반 설정 편집기 (Webview)\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 16, "total_chunks": null}}
{"id": "63821e6a-94b0-494a-8fbc-d8fed10f4032", "content": "#### 설정 편집기 구조\n```typescript\ninterface ExperimentConfigEditor {\n  // 기본 정보\n  name: string;\n  description: string;\n  version: string;\n  \n  // 시뮬레이션 설정\n  iterations: number;\n  parallelRuns: number;\n  seed?: number;\n  \n  // Personas 관리\n  personas: PersonaConfig[];\n  \n  // Base Inputs 관리\n  baseInputs: BaseInput[];\n  \n  // Variation 설정\n  variationStrategies: VariationStrategy[];\n  variationCount: number;\n  \n  // Runner 설정\n  runner: RunnerConfig;\n  \n  // Evaluators\n  evaluators: EvaluatorConfig[];\n}\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 17, "total_chunks": null}}
{"id": "b1015ffa-1128-4b7e-b81d-c92ba8e05776", "content": "#### Persona 편집기\n```typescript\ninterface PersonaEditor {\n  name: string;\n  description: string;\n  characteristics: string[];\n  language: string;\n  expertiseLevel: 'novice' | 'intermediate' | 'expert';\n  goals: string[];\n}\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 18, "total_chunks": null}}
{"id": "bc2ab42f-6536-4da0-8619-99a350c55d81", "content": "#### Base Input 편집기\n```typescript\ninterface BaseInputEditor {\n  input: string;\n  expectedIntent?: string;\n  metadata?: Record<string, any>;\n}\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 19, "total_chunks": null}}
{"id": "0fa4be9d-87bd-4779-881f-01068bdb8b33", "content": "## 4. 구현 우선순위 및 단계별 계획\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 20, "total_chunks": null}}
{"id": "51640399-1824-4987-838e-91b9d82cb954", "content": "### Phase 1: 기본 기능 확장 (1-2주)\n1. **명령어 추가**\n   - `fluxloop.generateInputs`: 입력 생성 다이얼로그\n   - `fluxloop.parseExperiment`: 결과 파싱\n   - `fluxloop.runExperiment` 고급 옵션 확장\n\n2. **Tree Provider 개선**\n   - `ExperimentsProvider`: 실험 상세 정보 표시\n   - `ResultsProvider`: 실제 결과 파일 표시\n   - `StatusProvider`: CLI/SDK 상태 확인\n\n3. **메뉴 컨텍스트 추가**\n   - Explorer에서 `setting.yaml` 우클릭 → \"Generate Inputs\"\n   - 실험 폴더 우클릭 → \"Parse Results\"\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 21, "total_chunks": null}}
{"id": "73cf3699-cd3d-451a-bdb2-d713c56f6e6e", "content": "### Phase 2: GUI 기반 설정 편집 (2-3주)\n1. **Webview 기반 설정 편집기**\n   - `setting.yaml` 시각적 편집\n   - Persona 추가/편집/삭제\n   - Base Input 추가/편집/삭제\n   - Variation Strategy 설정\n\n2. **입력 생성 마법사**\n   - 단계별 입력 생성 가이드\n   - 생성된 입력 미리보기\n   - 설정 저장 및 적용\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 22, "total_chunks": null}}
{"id": "724140e9-d7ac-4ff1-96fa-ac9462414fc5", "content": "### Phase 3: 고급 기능 (3-4주)\n1. **실시간 모니터링**\n   - 실험 진행률 표시\n   - 실시간 로그 스트리밍\n   - 취소 기능\n\n2. **결과 분석 도구**\n   - Trace 분석 뷰어\n   - 성능 메트릭 차트\n   - 비교 분석 기능\n\n3. **Docker/Dev Container 지원**\n   - 환경별 실행 옵션\n   - 컨테이너 설정 관리\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 23, "total_chunks": null}}
{"id": "ee573bc8-d0b4-4f3a-8867-770920fa334b", "content": "## 5. 기술적 구현 세부사항\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 24, "total_chunks": null}}
{"id": "2c10f630-2b9a-4a26-aa56-57fcc0b9828f", "content": "### 5.1 Webview 기반 설정 편집기\n```typescript\n// extension.ts\nexport class ConfigEditorProvider {\n  private _panel: vscode.WebviewPanel | undefined;\n  \n  createOrShow() {\n    if (this._panel) {\n      this._panel.reveal(vscode.ViewColumn.One);\n    } else {\n      this._panel = vscode.window.createWebviewPanel(\n        'fluxloopConfigEditor',\n        'FluxLoop Configuration',\n        vscode.ViewColumn.One,\n        {\n          enableScripts: true,\n          localResourceRoots: [vscode.Uri.joinPath(this.context.extensionUri, 'media')]", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 25, "total_chunks": null}}
{"id": "ab1e452a-5fda-4ace-ab57-28e9ea7c5d90", "content": "        }\n      );\n      \n      this._panel.webview.html = this.getHtmlForWebview();\n      this._panel.onDidDispose(() => this._panel = undefined);\n    }\n  }\n}\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 26, "total_chunks": null}}
{"id": "1826d08d-6d50-4105-8468-d90e6f6f1f87", "content": "### 5.2 실시간 진행률 표시\n```typescript\n// commandManager.ts\nprivate async runExperimentWithProgress() {\n  return vscode.window.withProgress({\n    location: vscode.ProgressLocation.Notification,\n    title: \"Running FluxLoop Experiment\",\n    cancellable: true\n  }, async (progress, token) => {\n    // CLI 실행 및 진행률 업데이트\n    const process = spawn('fluxloop', args, { cwd: workspaceFolder });\n    \n    process.stdout.on('data', (data) => {\n      // 진행률 파싱 및 업데이트\n      const progressMatch = data.toString().match(/(\\d+)%/);\n      if (progressMatch) {", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 27, "total_chunks": null}}
{"id": "0148150d-0951-45f5-be16-2bd28517b58d", "content": "        progress.report({ increment: parseInt(progressMatch[1]) });\n      }\n    });\n    \n    token.onCancellationRequested(() => {\n      process.kill();\n    });\n  });\n}\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 28, "total_chunks": null}}
{"id": "6cebfdd4-d647-4dc0-91c9-0de26d6f7bed", "content": "### 5.3 결과 분석 뷰어\n```typescript\n// resultsViewer.ts\nexport class ResultsViewer {\n  private _panel: vscode.WebviewPanel;\n  \n  showTraceAnalysis(traceId: string) {\n    // Trace 상세 정보 표시\n    // Timeline 시각화\n    // Input/Output 비교\n  }\n  \n  showPerformanceMetrics(experimentDir: string) {\n    // 성공률 차트\n    // 응답시간 분포\n    // 에러 분석\n  }\n}\n```\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 29, "total_chunks": null}}
{"id": "28ff970f-986e-4265-82f6-1f1df180cc45", "content": "## 6. 사용자 경험 개선 포인트\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 30, "total_chunks": null}}
{"id": "5283ab7b-30ca-4465-a488-4d36e36e1918", "content": "### 6.1 직관적인 워크플로우\n- **단계별 가이드**: 각 단계에서 다음 단계 안내\n- **상태 표시**: 현재 진행 상황 명확히 표시\n- **오류 처리**: 친화적인 오류 메시지 및 해결 방법 제시\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 31, "total_chunks": null}}
{"id": "b921378a-d1b1-4215-a586-18636518949e", "content": "### 6.2 시각적 피드백\n- **아이콘 및 색상**: 상태별 시각적 구분\n- **진행률 표시**: 실시간 진행 상황 표시\n- **결과 시각화**: 차트 및 그래프로 결과 표현\n", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 32, "total_chunks": null}}
{"id": "5c7df5dc-99d6-409d-be45-b3883d542906", "content": "### 6.3 효율성 향상\n- **단축키**: 자주 사용하는 기능에 단축키 제공\n- **템플릿**: 자주 사용하는 설정 템플릿 제공\n- **자동화**: 반복 작업 자동화\n\n이 기획안은 CLI 기능을 GUI로 확장하면서도 FluxLoop의 핵심인 Input Variation 기반 시뮬레이션 워크플로우를 유지합니다. 단계별 구현으로 점진적으로 기능을 확장할 수 있습니다.", "metadata": {"source": "docs/prd/vscode_extention.md", "chunk_index": 33, "total_chunks": null}}
{"id": "d858609d-db1d-45b6-917a-86e6a81fbec5", "content": "## VSCode Extension Implementation Plan (Aligned with CLI v0.2.0)\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 0, "total_chunks": null}}
{"id": "096529bc-f946-4750-842c-06fb6f77d289", "content": "### 1. 전반 재점검: Init → Inputs → Experiment 우선 흐름\n- `package.json` `views.fluxloop` 순서 및 레이블 재확인 (`Projects → Inputs → Experiments → Results → Status`).\n- `ProjectsProvider`, `InputsProvider`, `ExperimentsProvider`, `ResultsProvider`, `StatusProvider` 전체 흐름이 `ProjectManager` 컨텍스트 기반으로 작동하는지 재검증.\n- 신규 구조 (`configs/…`) 기준으로 존재 여부를 확인하도록 각 Provider 리팩터링.\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a66ae8e2-6069-44cb-aa76-56ddaf58975c", "content": "### 2. 프로젝트 생성/등록 플로우 재구성\n- 대상 파일: `src/commands/projectCommands.ts`, `src/project/projectManager.ts`, `projectContext.ts`\n- `fluxloop.createProject`:\n  1. 폴더 선택 → 프로젝트명 입력 → `with_example` 여부 선택 → `fluxloop init project <projectRoot> --name ... --with-example` 호출.\n  2. 실행 후 생성 구조(`configs/*.yaml`, `.env`, `recordings/`, `inputs/`, `experiments/`) 확인; 누락 시 경고 노출.\n  3. `ProjectManager.addProject` 호출 시 `projectRoot` 정확히 전달.\n- `fluxloop.addProject`:\n  - 신규 구조(`configs/`) 우선 점검 → legacy `setting.yaml` fallback.\n  - 메타데이터(`hasConfig`, `lastOpened`) 갱신.", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 2, "total_chunks": null}}
{"id": "7c791d9a-ee1f-43ba-ba75-3e313fef3e46", "content": "### 3. 설정 파일 분리 대응\n- `src/providers/experimentsProvider.ts`/`resultsProvider.ts`/`statusProvider.ts` 등에서 `setting.yaml` 참조했던 로직을 `configs/simulation.yaml` 등으로 교체.\n- `Inputs` View:\n  - `Base Inputs` → `configs/input.yaml`의 `base_inputs` 파싱.\n  - `Generated Inputs` → `inputs/` 디렉터리 감시.\n  - `Recordings` → `recordings/` 디렉터리 감시.\n- `Experiments` View:\n  - `simulation.yaml`에서 runner 정보, iterations 등 파싱; `Record Mode` 상태 (`replay_args.enabled` & `.env`) 반영.\n  - `Run Experiment` 실행 시 `cliManager.runCommand(['run','experiment'])` 호출 (config 인자 생략).", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 4, "total_chunks": null}}
{"id": "fa214161-ebb2-480e-9e34-7ead14a0843f", "content": "- `Status` View:\n  - Config 섹션 유무를 `configs/` 기준으로 표시.\n  - `.env`/`recordings` 존재 여부, `FLUXLOOP_RECORD_ARGS` 값 표시.\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 5, "total_chunks": null}}
{"id": "791fa8d8-3e5b-45ac-936b-1cd007242e1d", "content": "### 4. Input Generation Wizard 업데이트 (`fluxloop.generateInputs`)\n- 대상: `src/commands/commandManager.ts` (generateInputs 관련 메소드)\n- 기본 동작:\n  - `configs/input.yaml` 읽어 personas/strategies/default 모드 파싱.\n  - CLI 호출: `fluxloop generate inputs --limit ... --strategy ...` (config 인자 제거).\n  - `.env` 저장: `FLUXLOOP_LLM_API_KEY`/`OPENAI_API_KEY` 저장 옵션 유지.\n  - 실행 후 `inputsProvider.refresh()` 및 생성 파일 자동 열기.\n- UI 가이드: Inputs 뷰에서 “Base Inputs” → “Generate New Inputs…” → “Generated Inputs” 흐름 강조.\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 6, "total_chunks": null}}
{"id": "a25431ad-60ac-4d03-9726-bef500358a45", "content": "### 5. Record Mode 토글 구현\n- 명령: `fluxloop.enableRecording`, `fluxloop.disableRecording` 구현\n  - 대상 파일: `src/commands/commandManager.ts` 혹은 별도 `recordCommands.ts`.\n  - CLI 호출: `fluxloop record enable/disable` (프로젝트 루트 기준).\n  - `.env` 및 `configs/simulation.yaml` 갱신 후 `StatusProvider`, `ExperimentsProvider` 새로고침.\n- `Experiments` View 상단 토글:\n  - 토글 ON → 실행 관련 버튼 비활성화, 안내 배너 표시 (“서비스를 실행해 레코딩을 수집하세요”).\n  - 토글 OFF → 기존 버튼 복원.\n  - 레코딩 파일 생성 watcher → 새 파일 감지 시 알림.\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 7, "total_chunks": null}}
{"id": "f47a10aa-87e7-430a-be74-2bbb811446ca", "content": "### 6. CLIManager & Command 연동 정리\n- `src/cli/cliManager.ts`:\n  - `runCommand(args, cwd)` 기본 인자는 활성 프로젝트 path 사용.\n  - `.env` 연동: `fluxloop config set-llm` 등에서 `.env` 업데이트 감지되면 Status 갱신.\n  - LLM 키 전달: Wizard에서 받은 키를 CLI 인자(`--llm-api-key`) 또는 `.env`를 통해 전달.\n- `fluxloop run experiment`:\n  - 실행 환경 선택 UX 개선 (Status와 연계).\n  - 실행 후 `statusProvider.refresh()` 및 `resultsProvider.refresh()` 호출.\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 8, "total_chunks": null}}
{"id": "11f7abb7-c706-4075-bce4-b929285f7b97", "content": "### 7. 파일 감시자 및 Refresh 흐름\n- 활성 프로젝트 변경 시:\n  - `configs/**/*`, `.env`, `inputs/**`, `recordings/**`, `experiments/**` watch.\n  - Watch 이벤트 → 각 Provider `refresh()` 호출.\n- 프로젝트 삭제 시 watcher 해제, UI 비우기.\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 9, "total_chunks": null}}
{"id": "6f4dfb3d-70b1-4938-a84a-6ec401694734", "content": "### 8. `package.json` contributes 정비\n- 새 명령 및 뷰 context 확인.\n- Command Palette에서 record enable/disable/generate inputs 표시.\n- Explorer 컨텍스트: `configs/*.yaml` 우클릭 → Open/Run 관련 명령 추가 검토.\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 10, "total_chunks": null}}
{"id": "abb8c7af-d388-4627-b86e-f9579e62d93d", "content": "### 9. 테스트 & 품질 확인\n- 수동 시나리오:\n  1. 새 프로젝트 생성 → `configs/` 확인 → Inputs 뷰 base/generate 확인.\n  2. LLM 모드로 입력 생성 → `.env` 저장 확인 → Generated Inputs 파일 열기.\n  3. Record Mode ON → 안내 UI → 서비스 실행 → 새 JSONL 생성 → 토글 OFF → simulation.yaml 업데이트 확인.\n  4. 실험 실행 → Outputs → Results 뷰/Status 업데이트.\n- 자동 테스트: `npm run compile`, VS Code extension test (필요 시).\n", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 11, "total_chunks": null}}
{"id": "4d96e332-577e-453b-80bb-431c013f22a3", "content": "### 10. 문서/UX 업데이트\n- `docs/prd/codex_vscode_extention.md` 최신 흐름 유지.\n- Status 패널 설명, Record Mode 안내 메시지 등 copy 검토.\n- README/CHANGELOG 정리 (Extension 레벨).\n\n---\n\n위 계획을 따라 `packages/vscode/` 내 주요 파일을 단계적으로 수정·테스트하면, CLI v0.2.0 개편과 일치하는 Extension UX를 구현할 수 있습니다.", "metadata": {"source": "docs/prd/vscode_implementation.md", "chunk_index": 12, "total_chunks": null}}
{"id": "d140a5e2-6fd4-4af7-ad38-c9bc800678e1", "content": "# FluxLoop VSCode Extension UX 개선 계획\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 0, "total_chunks": null}}
{"id": "2ca648ed-e91c-445e-b927-af421a9ab32c", "content": "## 문서 정보\n- **작성일**: 2025-11-16\n- **버전**: v0.2.0\n- **대상**: VSCode Extension UX 개선\n- **관련 문서**: \n  - `vscode_extention.md`\n  - `vscode_implementation.md`\n  - `codex_vscode_extention.md`\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 1, "total_chunks": null}}
{"id": "e6953605-2b12-40a1-8c33-4a8d67299b9d", "content": "## 1. 현재 UX 프로세스 분석\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 2, "total_chunks": null}}
{"id": "c278225f-6b3d-4491-be91-481b345df793", "content": "### 1.1 전체 워크플로우\n\nFluxLoop VSCode Extension은 다음과 같은 5단계 워크플로우를 제공합니다:\n\n```\n1. 프로젝트 생성/선택 → 2. 입력 설정 → 3. 입력 생성 → 4. 실험 실행 → 5. 결과 분석/평가\n```\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 3, "total_chunks": null}}
{"id": "43816a26-815a-43ee-b09e-3e725b3f2116", "content": "#### Phase 1: 프로젝트 생성/관리 (Projects View)\n```\nFluxLoop Activity Bar → Projects\n├── Create New Project…        [새 프로젝트 생성]\n├── Add Existing Project…      [기존 프로젝트 추가]\n└── Project List\n    ├── Project A (active)     [활성 프로젝트]\n    │   ├── Target Source Root…\n    │   ├── Open in Current Window\n    │   ├── Open in New Window\n    │   ├── Set Active Project\n    │   ├── Configure Project  → configs/project.yaml\n    │   ├── Configure Environment (.env)  → .env\n    │   └── Remove from List\n    └── Project B\n```\n\n**현재 UX 흐름:**\n1. \"Create New Project…\" 클릭", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 4, "total_chunks": null}}
{"id": "f533ff88-7262-4d1e-b1c1-0528212bfb13", "content": "2. **폴더 선택 1**: 프로젝트를 생성할 부모 폴더 (rootDir)\n3. 프로젝트명 입력\n4. 예제 포함 여부 선택\n5. **폴더 선택 2**: Python 환경 선택 (`prepareProjectEnvironment`)\n   - 옵션 1: \"Use project folder\" (새 프로젝트 폴더 내부에 venv 생성)\n   - 옵션 2: \"Choose another folder…\" (기존 가상환경 폴더 선택)\n   - 옵션 3: \"Use Global PATH\"\n6. 환경 검증 및 누락 패키지 확인\n   - FluxLoop CLI/SDK/MCP 누락 시 → Setup Script 실행 or 터미널 열기 or 재선택\n7. CLI 실행: `fluxloop init project <rootDir> --name ... --with-example`\n8. 환경 설정 저장 (`.vscode/settings.json`)\n9. 프로젝트 자동 등록 및 활성화\n10. 프로젝트 열기 방식 선택 (현재 창 / 새 창 / 유지)\n\n**문제점**: ", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 5, "total_chunks": null}}
{"id": "e26a4ed8-fd4c-486d-a4f1-9050a678c2c8", "content": "- **두 개의 폴더를 선택**하는 복잡한 프로세스\n- 프로젝트 루트와 환경 루트의 관계가 명확하지 않음\n- 환경 검증 실패 시 루프 구조로 인한 혼란\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 6, "total_chunks": null}}
{"id": "aea23992-bb8d-489f-ad27-b3f9e3abb22c", "content": "#### Phase 2: 입력 설정 (Inputs View)\n```\nInputs\n├── Configure Inputs…          [configs/input.yaml 열기]\n├── Generate New Inputs…       [입력 생성 마법사]\n├── Base Inputs                [기본 입력들]\n│   ├── \"Create a simple todo app\"\n│   ├── \"Write a function to calculate...\"\n│   └── ...\n└── Generated Inputs           [생성된 입력들]\n    ├── generated_20241116_143022.yaml\n    └── ...\n```\n\n**현재 UX 흐름:**\n1. Base Inputs: `configs/input.yaml` 파싱하여 표시\n2. \"Generate New Inputs…\" 클릭\n3. 입력 생성 다이얼로그:\n   - Mode: Deterministic / LLM\n   - Limit: 숫자 입력\n   - Strategy: rephrase, verbose, etc. (체크박스)", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 7, "total_chunks": null}}
{"id": "afa0ce83-03ce-4622-a379-76b0f162a58e", "content": "   - API Key (LLM 모드 선택 시)\n4. CLI 실행: `fluxloop generate inputs ...`\n5. Generated Inputs 자동 갱신\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 8, "total_chunks": null}}
{"id": "89fc999c-2c18-4d52-8529-f1de17e9221e", "content": "#### Phase 3: 실험 구성 (Experiments View)\n```\nExperiments\n├── Current Experiment         [현재 실험 설정]\n│   ├── Open configuration    → configs/simulation.yaml\n│   ├── Runner: src/agent.py\n│   ├── Iterations: 10\n│   └── Record Mode: Disabled\n├── Run Experiment             [실험 실행 버튼]\n├── Recording Mode             [레코딩 모드 관리]\n│   ├── Enable Recording Mode\n│   ├── Disable Recording Mode\n│   └── Show Recording Status\n└── Experiments                [실험 결과 목록]\n    ├── experiment_20241116_143022\n    │   ├── summary.json\n    │   ├── traces.jsonl", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 9, "total_chunks": null}}
{"id": "45564277-b713-4867-b662-ccf8c74d55c5", "content": "    │   └── ...\n    └── ...\n```\n\n**현재 UX 흐름:**\n1. \"Run Experiment\" 클릭\n2. 실행 환경 선택: Local Python / Dev Container\n3. Iterations 오버라이드 (선택적)\n4. CLI 실행: `fluxloop run experiment`\n5. 실시간 로그 출력\n6. 완료 후 Results 자동 갱신\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 10, "total_chunks": null}}
{"id": "d485c0c1-f932-4c1a-8843-6673c7e34304", "content": "#### Phase 4: 결과 분석 (Results View)\n```\nResults\n├── Configure Evaluation…      [configs/evaluation.yaml 열기]\n└── Experiments               [실험 결과 폴더들]\n    └── experiment_20241116_143022\n        ├── Parse Results      [파싱 액션]\n        ├── Evaluate Results   [평가 액션]\n        ├── per_trace_analysis/\n        ├── evaluation/\n        ├── summary.json\n        ├── traces.jsonl\n        └── observations.jsonl\n```\n\n**현재 UX 흐름:**\n1. 실험 결과 선택\n2. \"Parse Results\" 클릭 → Markdown 타임라인 생성\n3. \"Evaluate Results\" 클릭 → 평가 실행\n4. 생성된 파일 자동 열기\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 11, "total_chunks": null}}
{"id": "bfcfd9e3-a368-4abe-8563-abb759e50e90", "content": "#### Phase 5: 통합 지원 (Integration View)\n```\nIntegration\n├── System Status\n│   ├── MCP Server: Connected\n│   ├── Knowledge Index: Ready\n│   └── Run Doctor\n├── Actions\n│   ├── Connect MCP\n│   ├── Knowledge Search\n│   └── Run Flux Agent\n└── Recent Suggestions\n    ├── Integration Suggestion #1\n    └── ...\n```\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 12, "total_chunks": null}}
{"id": "35fad99f-1ff8-4018-9c31-c1f6684f2ef8", "content": "### 1.2 현재 화면 구성\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4225a1a0-cf7b-473d-a95b-f31bed92024f", "content": "#### Activity Bar (좌측 사이드바)\n```\n┌──────────────────────────────┐\n│ FluxLoop 아이콘               │\n├──────────────────────────────┤\n│ Overview (Dashboard)          │  ← Webview 기반\n│ Projects                      │  ← TreeView\n│ Integration                   │  ← TreeView\n│                               │\n│ [Playground Mode]             │\n│ Inputs                        │  ← TreeView\n│ Experiments                   │  ← TreeView\n│                               │\n│ [Insights Mode]               │\n│ Results                       │  ← TreeView", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 14, "total_chunks": null}}
{"id": "d3e996d1-e468-4d35-bedd-cef345af1f29", "content": "└──────────────────────────────┘\n```\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 15, "total_chunks": null}}
{"id": "9cafbd0c-8016-4ba8-875b-d66e704530b3", "content": "#### Overview Dashboard (Webview)\n```\n┌────────────────────────────────────────┐\n│ 📁 Project: My Agent (active)          │\n│ 🔬 Environment: venv • python ✓        │\n├────────────────────────────────────────┤\n│ [Workspace] [Playground] [Insights]    │ ← 탭 전환\n├────────────────────────────────────────┤\n│ 💡 Onboarding Cards                    │\n│ ┌────────────────────────────────────┐ │\n│ │ Quick Start Guide              [×] │ │\n│ │ Create your first experiment       │ │\n│ │ [Get Started]                      │ │\n│ └────────────────────────────────────┘ │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 16, "total_chunks": null}}
{"id": "eaff1eb5-a9de-4cc0-9e0c-770b5928b60e", "content": "└────────────────────────────────────────┘\n```\n\nView 전환 방식:\n- **Workspace** 모드: Projects, Integration 표시\n- **Playground** 모드: Inputs, Experiments 표시\n- **Insights** 모드: Results 표시\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 17, "total_chunks": null}}
{"id": "78480ec5-77a0-470c-bb1b-efd712c1bad0", "content": "## 2. 핵심 UX 문제 및 개선안\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 18, "total_chunks": null}}
{"id": "980f17dc-1a1c-4db5-9d34-de2f804e7408", "content": "### 2.1 프로젝트 생성: \"두 폴더 선택\" 문제\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 19, "total_chunks": null}}
{"id": "d6354621-69ad-4148-8a58-c1dbf2b98e06", "content": "#### 문제점\n1. **개념적 혼란**\n   - FluxLoop 프로젝트 폴더 vs Python 환경 폴더의 차이를 모름\n   - 왜 두 개를 선택해야 하는지 설명 없음\n   - \"Choose another environment\"의 의미 불명확\n\n2. **환경 관리 복잡도 이해 부족**\n   - 환경을 재사용하면 1개 관리 (권장)\n   - 별도 venv 생성하면 2개 관리\n   - Global 사용하면 3개 환경 존재 (혼란)\n   - 현재 UI는 이를 전혀 설명하지 않음\n\n3. **검증 실패 시 루프**\n   - 패키지 누락 시 여러 옵션 제시\n   - 선택 후 다시 검증 → 루프 구조 혼란\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 20, "total_chunks": null}}
{"id": "b010e5c5-0216-4f28-8adf-604930fbb633", "content": "#### 개선안\n\n**A. 프로젝트 vs 환경 개념도**\n\n```\n┌─────────────────────────────────────────────────────────┐\n│                   FluxLoop 구조 이해                     │\n├─────────────────────────────────────────────────────────┤\n│                                                          │\n│  실험 대상 프로젝트           FluxLoop 테스트 프로젝트    │\n│  ┌──────────────────┐        ┌──────────────────┐      │\n│  │ my-coding-agent/ │        │ fluxloop-tests/  │      │\n│  ├──────────────────┤        │   agent-v1/      │      │\n│  │ src/             │        ├──────────────────┤      │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 21, "total_chunks": null}}
{"id": "7f6bd00a-3087-4cec-bfb8-1b028dbaeb2e", "content": "│  │ └─ agent.py      │◄───────┤ configs/         │      │\n│  │                  │ 테스트  │ inputs/          │      │\n│  │ .venv/           │◄───────┤ experiments/     │      │\n│  │ └─ python        │ 재사용  │ recordings/      │      │\n│  │ └─ fluxloop ✓    │        │                  │      │\n│  └──────────────────┘        └──────────────────┘      │\n│         ▲                             │                 │\n│         └─────────────────────────────┘                 │\n│           하나의 Python 환경 공유                        │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 22, "total_chunks": null}}
{"id": "89d8163c-053a-4b89-9340-b6fe88e75f10", "content": "│                                                          │\n│  💡 베스트 프랙티스:                                     │\n│     - FluxLoop 패키지를 실험 대상의 .venv에 설치        │\n│     - FluxLoop 프로젝트는 테스트 데이터만 저장          │\n│     - 결과: 환경 1개만 관리!                            │\n└─────────────────────────────────────────────────────────┘\n```\n\n**B. 프로젝트 생성 플로우 (개선)**\n\n```\n[시작] Create New Project 클릭\n   │\n   ├─ Step 1: 부모 폴더 선택 (OpenDialog)\n   │  \"프로젝트를 어디에 생성할까요?\"\n   │  → /Users/user/fluxloop-tests/\n   │\n   ├─ Step 2: 프로젝트명 입력 (InputBox)\n   │  \"프로젝트 이름: agent-v1\"", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 23, "total_chunks": null}}
{"id": "58da43ce-17b4-41ae-b823-f689fb758e92", "content": "   │  💡 Will create: /Users/user/fluxloop-tests/agent-v1/\n   │\n   ├─ Step 3: 예제 포함 여부 (QuickPick)\n   │  ○ Include example agent (권장)\n   │  ○ Skip example\n   │\n   ├─ Step 4: Python 환경 선택 (QuickPick) ✨ 핵심 개선\n   │  ┌─────────────────────────────────────────┐\n   │  │ Python Environment Setup                │\n   │  ├─────────────────────────────────────────┤\n   │  │ ★ Use detected environment (선택됨)     │\n   │  │   my-coding-agent/.venv                 │\n   │  │   ✓ Environments: 1 | No conflicts      │\n   │  │                                          │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 24, "total_chunks": null}}
{"id": "2cfeb9d8-fc49-4326-b56c-14a8f4dca0ca", "content": "   │  │   Choose another environment            │\n   │  │   Select different Python env           │\n   │  │                                          │\n   │  │   Create new venv in project            │\n   │  │   ⚠️  Environments: 2 | May conflict    │\n   │  │                                          │\n   │  │   Use system Python                     │\n   │  │   ⚠️  Not recommended                   │\n   │  └─────────────────────────────────────────┘\n   │\n   ├─ Step 5: 환경 검증\n   │  ├─ [패키지 완비] → Step 6으로\n   │  └─ [패키지 누락] → 설치 안내", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 25, "total_chunks": null}}
{"id": "0612085e-2805-462e-ae4c-585c98fa2e2b", "content": "   │     ┌─────────────────────────────────────┐\n   │     │ ⚠️  Missing Packages                │\n   │     ├─────────────────────────────────────┤\n   │     │ • fluxloop-cli                      │\n   │     │ • fluxloop-mcp                      │\n   │     │                                     │\n   │     │ [Install Automatically]             │\n   │     │ [Open Terminal]                     │\n   │     │ [Select Different Environment]      │\n   │     └─────────────────────────────────────┘\n   │\n   ├─ Step 6: 프로젝트 생성 (Progress)", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 26, "total_chunks": null}}
{"id": "234eec4b-7362-45f6-84e9-bd1f96d704e9", "content": "   │  Creating FluxLoop Project...\n   │  ████████░░ 80%\n   │\n   └─ Step 7: 완료 (Information)\n      ✓ Project \"agent-v1\" created!\n      [Open in Current Window]\n      [Open in New Window]\n      [Stay Here]\n```\n\n**C. 환경 관리 복잡도 비교**\n\n```\n┌─────────────────────────────────────────────────────────┐\n│              환경 선택에 따른 복잡도 비교                 │\n├─────────────────────────────────────────────────────────┤\n│                                                          │\n│ ✓ 옵션 1: 실험 대상 환경 재사용 (권장)                   │\n│ ┌──────────────────────────────────────────────────────┐│", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 27, "total_chunks": null}}
{"id": "8d6cf811-31a3-4654-a162-3a438b1a0dfe", "content": "│ │ 관리 환경: 1개                                       ││\n│ │                                                      ││\n│ │ my-coding-agent/.venv                                ││\n│ │ ├─ agent dependencies                               ││\n│ │ ├─ fluxloop-cli                                     ││\n│ │ ├─ fluxloop (SDK)                                   ││\n│ │ └─ fluxloop-mcp                                     ││\n│ │                                                      ││\n│ │ 장점: 한 곳에만 설치, 버전 충돌 없음                 ││\n│ │ 단점: 없음                                           ││", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 28, "total_chunks": null}}
{"id": "f6b315cc-b03e-4438-8e60-06ff02f8ad65", "content": "│ └──────────────────────────────────────────────────────┘│\n│                                                          │\n│ ⚠️ 옵션 2: FluxLoop 프로젝트에 별도 .venv               │\n│ ┌──────────────────────────────────────────────────────┐│\n│ │ 관리 환경: 2개                                       ││\n│ │                                                      ││\n│ │ my-coding-agent/.venv    agent-v1/.venv             ││\n│ │ ├─ agent dependencies    ├─ fluxloop-cli            ││\n│ │ └─ ???                   ├─ fluxloop (SDK)          ││", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 29, "total_chunks": null}}
{"id": "677f797a-7a34-4fe9-bb6a-50c23dae63dd", "content": "│ │                          └─ fluxloop-mcp            ││\n│ │                                                      ││\n│ │ 장점: 격리된 환경                                    ││\n│ │ 단점: 두 번 설치, 버전 불일치 가능, 복잡도 증가      ││\n│ └──────────────────────────────────────────────────────┘│\n│                                                          │\n│ ⚠️ 옵션 3: Global Python                                │\n│ ┌──────────────────────────────────────────────────────┐│\n│ │ 관리 환경: 3개 (혼란)                                ││\n│ │                                                      ││", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 30, "total_chunks": null}}
{"id": "5f7108b3-bcd7-4556-83f7-33df75812d55", "content": "│ │ my-coding-agent/.venv    (global)    agent-v1/.venv ││\n│ │ └─ activate 필요         활성화 안하면              ││\n│ │                          여기서 실행                 ││\n│ │                                                      ││\n│ │ 장점: 없음                                           ││\n│ │ 단점: 어느 환경에서 실행되는지 알 수 없음, 충돌 위험 ││\n│ └──────────────────────────────────────────────────────┘│\n└─────────────────────────────────────────────────────────┘\n```\n\n**D. 개선된 Python 환경 선택 화면 (QuickPick)**\n\n```\n┌─────────────────────────────────────────────────────────┐", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 31, "total_chunks": null}}
{"id": "139402e1-0ae4-4a56-958f-5c2f9e256575", "content": "│ Python Environment Setup                        Step 4/7 │\n├─────────────────────────────────────────────────────────┤\n│ Select Python environment for FluxLoop                   │\n│                                                          │\n│  ★ Use detected environment                             │\n│    my-coding-agent/.venv                                │\n│    ✓ Recommended | Environments: 1 | No version conflicts│\n│    /Users/user/my-coding-agent/.venv                    │\n│    ────────────────────────────────────────────────────  │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 32, "total_chunks": null}}
{"id": "37ad9daf-8c4c-41d3-9306-cee615540b55", "content": "│                                                          │\n│    Choose another environment                            │\n│    Select a different Python environment                │\n│    Browse for existing venv, conda, pyenv, etc.         │\n│    ────────────────────────────────────────────────────  │\n│                                                          │\n│    Create new venv in project                            │\n│    Create .venv inside FluxLoop project folder          │\n│    ⚠️  Environments: 2 | Requires separate installation │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 33, "total_chunks": null}}
{"id": "4906110a-2759-4cc7-9739-7f0c36d11c0d", "content": "│    ────────────────────────────────────────────────────  │\n│                                                          │\n│    Use system Python                                     │\n│    Global PATH                                           │\n│    ⚠️  Not recommended | May cause version conflicts    │\n│                                                          │\n└─────────────────────────────────────────────────────────┘\n```\n\n**E. 패키지 누락 시 안내 화면 (Modal Warning)**\n\n```\n┌─────────────────────────────────────────────────────────┐", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 34, "total_chunks": null}}
{"id": "c052c3d9-a3e1-48bf-93e8-dc030cd0b0e2", "content": "│ ⚠️  Missing Packages                                    │\n├─────────────────────────────────────────────────────────┤\n│                                                          │\n│ The selected environment is missing:                     │\n│ • fluxloop-cli                                           │\n│ • fluxloop-mcp                                           │\n│                                                          │\n│ Environment:                                             │\n│ /Users/user/my-coding-agent/.venv                       │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 35, "total_chunks": null}}
{"id": "068ec6cb-2432-4857-bec8-a238dba57b84", "content": "│                                                          │\n│ What would you like to do?                               │\n│                                                          │\n│ ┌──────────────────────────────────────────────────────┐│\n│ │  [Install Automatically]                             ││\n│ │  Run: pip install fluxloop-cli fluxloop fluxloop-mcp ││\n│ │  Estimated time: ~2 minutes                          ││\n│ └──────────────────────────────────────────────────────┘│\n│                                                          │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 36, "total_chunks": null}}
{"id": "c4b3f389-b4b4-42b4-83c5-5074ea966a57", "content": "│ ┌──────────────────────────────────────────────────────┐│\n│ │  [Open Terminal & Install Manually]                  ││\n│ │  We'll guide you through the installation steps      ││\n│ └──────────────────────────────────────────────────────┘│\n│                                                          │\n│ ┌──────────────────────────────────────────────────────┐│\n│ │  [Select Different Environment]                      ││\n│ │  Choose another Python environment to use            ││\n│ └──────────────────────────────────────────────────────┘│", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 37, "total_chunks": null}}
{"id": "2fae97c1-42d4-4fb8-bc01-d472935aa444", "content": "│                                                          │\n│                        [Cancel]                          │\n└─────────────────────────────────────────────────────────┘\n```\n\n**F. 프로젝트 생성 완료 후 (Information Message)**\n\n```\n┌─────────────────────────────────────────────────────────┐\n│ ✓ FluxLoop project \"agent-v1\" created successfully!     │\n├─────────────────────────────────────────────────────────┤\n│                                                          │\n│ Project: /Users/user/fluxloop-tests/agent-v1            │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 38, "total_chunks": null}}
{"id": "c843c737-a356-454d-98f5-f604f7bb4fbf", "content": "│ Environment: /Users/user/my-coding-agent/.venv          │\n│                                                          │\n│ Files created:                                           │\n│ • configs/project.yaml, input.yaml, simulation.yaml     │\n│ • .env                                                   │\n│ • inputs/, experiments/, recordings/                    │\n│ • examples/ (sample agent)                              │\n│                                                          │\n│ Next step: Configure your base inputs in Inputs view    │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 39, "total_chunks": null}}
{"id": "eeae52f1-7acf-4b3b-8880-46a84cb62ed5", "content": "│                                                          │\n│  [Open in Current Window]                               │\n│  [Open in New Window]                                   │\n│  [Stay Here]                                            │\n│                                                          │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 40, "total_chunks": null}}
{"id": "ea4589ca-2df0-4241-9ebe-ecacb7aef629", "content": "### 2.2 입력 생성\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 41, "total_chunks": null}}
{"id": "e8beca05-da13-4ac5-a852-9f64e1aac40c", "content": "#### 문제점\n1. 생성 과정 불투명 (몇 개 만들어지는지 모름)\n2. LLM 모드 설정 복잡\n3. 생성 중 진행 상태 없음\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 42, "total_chunks": null}}
{"id": "534b72ad-5547-4466-87a8-110caea93249", "content": "#### 개선안\n\n**A. 입력 생성 플로우**\n\n```\n[시작] Generate New Inputs 클릭\n   │\n   ├─ Step 1: 생성 모드 선택 (QuickPick)\n   │  ┌─────────────────────────────────────────┐\n   │  │ Generate Inputs              Step 1/4   │\n   │  ├─────────────────────────────────────────┤\n   │  │ ✨ Deterministic (선택됨)               │\n   │  │    Rule-based variations                │\n   │  │    Fast | No API key required           │\n   │  │                                          │\n   │  │ 🤖 LLM-based                            │\n   │  │    AI-powered variations                │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 43, "total_chunks": null}}
{"id": "4eab1829-390d-41eb-873b-502c2bf57192", "content": "   │  │    Requires OpenAI API key              │\n   │  └─────────────────────────────────────────┘\n   │\n   ├─ Step 2: 전략 선택 (QuickPick Multi-select)\n   │  ┌─────────────────────────────────────────┐\n   │  │ Variation Strategies         Step 2/4   │\n   │  ├─────────────────────────────────────────┤\n   │  │ ☑ rephrase                              │\n   │  │   Express same meaning differently      │\n   │  │ ☐ verbose                               │\n   │  │   Add more detail                       │\n   │  │ ☐ concise                               │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 44, "total_chunks": null}}
{"id": "05f8937c-6aae-41bc-a4c9-25957835b280", "content": "   │  │   Make shorter                          │\n   │  │ ☑ formal                                │\n   │  │   Use formal language                   │\n   │  └─────────────────────────────────────────┘\n   │\n   ├─ Step 3: 생성 개수 (InputBox)\n   │  Number of variations per base input\n   │  10\n   │  💡 Will generate: 3 base × 2 strategies × 10 = 60 inputs\n   │\n   ├─ [LLM 모드인 경우만]\n   │  Step 3-1: API Key 입력 (InputBox password)\n   │  Step 3-2: 저장 방식 선택 (QuickPick)\n   │\n   ├─ Step 4: 생성 실행 (Progress)\n   │  Generating Inputs...\n   │  Processing: Create a simple todo... (rephrase)", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 45, "total_chunks": null}}
{"id": "5ab04c2c-cf23-4b05-8de8-189075a2195d", "content": "   │  ██████████░░░░░░ 60%  [Cancel]\n   │\n   └─ Step 5: 완료 (Information)\n      ✓ Generated 60 input variations!\n      Saved to: inputs/generated_20241116.yaml\n      [Open File] [Generate More] [Close]\n```\n\n**B. 입력 생성 예상 개수 계산**\n\n```\n┌─────────────────────────────────────────────────────────┐\n│              입력 생성 예상 개수 (실시간 계산)            │\n├─────────────────────────────────────────────────────────┤\n│                                                          │\n│ Base Inputs:           3                                │\n│ Strategies selected:   2 (rephrase, formal)             │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 46, "total_chunks": null}}
{"id": "345092a3-3d83-4968-8ca8-9bc20533d460", "content": "│ Variations per input:  10                               │\n│                                                          │\n│ ┌──────────────────────────────────────────────────────┐│\n│ │ Total inputs to generate: 60                         ││\n│ │                                                      ││\n│ │ 3 base × 2 strategies × 10 variations = 60           ││\n│ │                                                      ││\n│ │ Estimated time: ~30 seconds (Deterministic)          ││\n│ │                 ~5 minutes (LLM mode)                ││", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 47, "total_chunks": null}}
{"id": "2304908a-6caf-4751-80e2-58d66cefdbf9", "content": "│ └──────────────────────────────────────────────────────┘│\n│                                                          │\n│ Output file: inputs/generated_20241116_143022.yaml      │\n│                                                          │\n└─────────────────────────────────────────────────────────┘\n```\n\n**C. 생성 진행 중 화면**\n\n```\nProgress Notification:\n┌────────────────────────────────────────┐\n│ Generating Inputs                      │\n├────────────────────────────────────────┤\n│ Processing: Create a simple todo...    │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 48, "total_chunks": null}}
{"id": "76331ef1-6b26-41ca-92dc-4422f7764c61", "content": "│ Strategy: rephrase (36/60)             │\n│ ██████████████░░░░░░░░ 60%             │\n│                             [Cancel]   │\n└────────────────────────────────────────┘\n\nOutput Channel (FluxLoop):\n──────────────────────────────────────────\n[14:30:15] Starting input generation\nMode: Deterministic\nStrategies: rephrase, formal\nBase inputs: 3\n\n[14:30:16] Processing base input 1/3\n  ✓ rephrase_1.yaml (0.1s)\n  ✓ rephrase_2.yaml (0.1s)\n  ...\n[14:30:30] Processing base input 2/3\n  ✓ formal_1.yaml (0.1s)\n  ...\n[14:30:45] Completed!", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 49, "total_chunks": null}}
{"id": "d73e663d-4dd3-4700-b7c7-b742ba38ee3c", "content": "Generated 60 inputs\nSaved to: inputs/generated_20241116_143022.yaml\n```\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 50, "total_chunks": null}}
{"id": "4bf01709-9b6a-4f29-a9d7-f5d7cb8d6646", "content": "### 2.3 실험 실행\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 51, "total_chunks": null}}
{"id": "810805fb-9849-48d3-85c7-90f74476387a", "content": "#### 문제점\n1. 실행 중 진행 상황 불명확\n2. 취소 불가\n3. Recording Mode 개념 불명확\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 52, "total_chunks": null}}
{"id": "6e090e06-e777-42a2-bf63-1b1732b2d879", "content": "#### 개선안\n\n**A. 실험 실행 플로우**\n\n```\n[시작] Run Experiment 클릭\n   │\n   ├─ Step 1: 실행 환경 선택 (QuickPick)\n   │  ┌─────────────────────────────────────────┐\n   │  │ Run Experiment               Step 1/2   │\n   │  ├─────────────────────────────────────────┤\n   │  │ 💻 Local Python (선택됨)                │\n   │  │    Current Python environment           │\n   │  │    Fast | Uses project .venv            │\n   │  │                                          │\n   │  │ 🖥️  Dev Container                       │\n   │  │    Run inside Dev Container             │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 53, "total_chunks": null}}
{"id": "d2825dcf-0ac1-47a1-8940-d96a36af038e", "content": "   │  │    Isolated environment                 │\n   │  │                                          │\n   │  │ 📦 Docker (coming soon)                 │\n   │  │    Run in Docker container              │\n   │  └─────────────────────────────────────────┘\n   │\n   ├─ Step 2: Iterations 설정 (InputBox - Optional)\n   │  Number of iterations\n   │  [empty - use default from config: 10]\n   │\n   ├─ Step 3: 실험 실행\n   │  ┌─ Progress Notification ──────────────┐\n   │  │ Running Experiment                    │\n   │  │ 450/600 runs completed                │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 54, "total_chunks": null}}
{"id": "51f22988-291c-4261-83f1-0b5d222ca32a", "content": "   │  │ ███████████████░ 75%      [Cancel]    │\n   │  └───────────────────────────────────────┘\n   │  \n   │  ┌─ Output Channel (FluxLoop Experiment) ─────────┐\n   │  │ [14:30:22] Run 1/600: novice_rephrase_1 ✓ 1.2s │\n   │  │ [14:30:23] Run 2/600: novice_rephrase_2 ✓ 0.9s │\n   │  │ [14:30:25] Run 3/600: expert_verbose_1 ✗ timeout│\n   │  │ ...                                              │\n   │  │ Progress: 450/600                                │\n   │  │ Success rate so far: 93.3%                       │\n   │  └──────────────────────────────────────────────────┘", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 55, "total_chunks": null}}
{"id": "1e4ee19b-2fbe-4428-8bef-569dd158ddda", "content": "   │\n   └─ Step 4: 완료 (Information)\n      ✓ Experiment completed!\n      Success rate: 93.3% (560/600)\n      [Parse Results] [Evaluate] [Open Folder] [Close]\n```\n\n**B. Recording Mode 안내 (TreeView)**\n\n```\nExperiments (TreeView)\n├─ Current Experiment\n│  └─ configs/simulation.yaml\n├─ Run Experiment\n└─ Recording Mode\n   ├─ 📖 What is Recording Mode? [클릭 시 설명 표시]\n   │  \"Capture real function arguments from running agent\"\n   │\n   ├─ Status: ⚪ Disabled\n   │  ┌────────────────────────────────────────────┐\n   │  │ How Recording Works:                       │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 56, "total_chunks": null}}
{"id": "905b7ea2-2c45-4461-a76d-f115fe2cbcfc", "content": "   │  │ 1. Enable Recording Mode                   │\n   │  │ 2. Run your agent normally                 │\n   │  │ 3. Arguments saved to recordings/          │\n   │  │ 4. Disable Recording Mode                  │\n   │  │ 5. Use in experiments                      │\n   │  └────────────────────────────────────────────┘\n   │\n   ├─ Enable Recording Mode [액션]\n   ├─ Disable Recording Mode [액션]\n   └─ Show Recording Status [액션]\n```\n\n**C. 실험 실행 중 상태 표시**\n\n```\n┌─────────────────────────────────────────────────────────┐\n│                  실험 실행 중 화면 구성                   │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 57, "total_chunks": null}}
{"id": "a60f543d-ff86-482c-99cc-ba0b0c160824", "content": "├─────────────────────────────────────────────────────────┤\n│                                                          │\n│ 1. Progress Notification (우측 하단)                    │\n│    ┌──────────────────────────────────────┐            │\n│    │ Running Experiment                   │            │\n│    │ 450/600 runs completed               │            │\n│    │ ███████████████░ 75%      [Cancel]   │            │\n│    └──────────────────────────────────────┘            │\n│                                                          │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 58, "total_chunks": null}}
{"id": "08cc1790-766d-4588-b898-405c5d2fbf5e", "content": "│ 2. Output Channel (하단 패널)                           │\n│    실시간 로그 스트리밍                                  │\n│    - 각 run의 성공/실패                                 │\n│    - 에러 메시지                                         │\n│    - 진행률 업데이트                                     │\n│                                                          │\n│ 3. Experiments TreeView (좌측)                          │\n│    Experiments 섹션이 자동 새로고침되어                 │\n│    완료된 실험 폴더가 실시간으로 나타남                 │\n│                                                          │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 59, "total_chunks": null}}
{"id": "b91729a5-8a3b-4081-b33d-18479becf0ee", "content": "│ 4. 취소 기능                                             │\n│    [Cancel] 클릭 시:                                    │\n│    - 진행 중인 실험 중단                                │\n│    - 부분 결과 저장 (이미 완료된 runs)                  │\n│    - Output에 취소 메시지 표시                          │\n│                                                          │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 60, "total_chunks": null}}
{"id": "b02f8caa-21e0-49d2-932f-dda4910a04a6", "content": "### 2.4 결과 분석\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 61, "total_chunks": null}}
{"id": "d1b19f91-7520-409f-b5e8-7c139352e02b", "content": "#### 문제점\n1. Parse vs Evaluate 차이 불명확\n2. 대용량 JSONL 파일 직접 열어야 함\n3. 실험 간 비교 불가\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 62, "total_chunks": null}}
{"id": "c796da74-6c58-4178-a236-6de6815fabf9", "content": "#### 개선안\n\n**A. Parse vs Evaluate 차이 시각화**\n\n```\n┌─────────────────────────────────────────────────────────┐\n│            Parse Results vs Evaluate Results             │\n├─────────────────────────────────────────────────────────┤\n│                                                          │\n│ Parse Results                                            │\n│ ┌──────────────────────────────────────────────────────┐│\n│ │ 목적: 사람이 읽기 쉬운 형태로 변환                   ││\n│ │                                                      ││\n│ │ 입력: traces.jsonl                                   ││", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 63, "total_chunks": null}}
{"id": "99b5d50d-c77f-4742-a641-461d8ff5734b", "content": "│ │ 출력: per_trace_analysis/*.md                        ││\n│ │                                                      ││\n│ │ 내용:                                                ││\n│ │ • 각 trace의 타임라인                               ││\n│ │ • 입력/출력 상세                                     ││\n│ │ • 도구 사용 내역                                     ││\n│ │ • Markdown 형식                                      ││\n│ └──────────────────────────────────────────────────────┘│\n│                                                          │\n│ Evaluate Results                                         │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 64, "total_chunks": null}}
{"id": "15bff744-6dfc-4270-b6a2-9d240d7394eb", "content": "│ ┌──────────────────────────────────────────────────────┐│\n│ │ 목적: 성능 평가 및 통계 분석                         ││\n│ │                                                      ││\n│ │ 입력: traces.jsonl + configs/evaluation.yaml        ││\n│ │ 출력: evaluation/summary.json, report.md            ││\n│ │                                                      ││\n│ │ 내용:                                                ││\n│ │ • Rule-based 평가 (성공률, 응답시간 등)             ││\n│ │ • LLM-based 평가 (정확도, 유용성 등)                ││\n│ │ • 성공 기준 충족 여부                                ││", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 65, "total_chunks": null}}
{"id": "afc19516-7f32-47f1-a407-60ac6e91a7ad", "content": "│ │ • Persona별, Intent별 분석                          ││\n│ └──────────────────────────────────────────────────────┘│\n│                                                          │\n│ 💡 권장 순서: Parse → 검토 → Evaluate                   │\n└─────────────────────────────────────────────────────────┘\n```\n\n**B. Results TreeView 구조 (현재 - 양호)**\n\n```\nResults (TreeView)\n├─ Configure Evaluation… [configs/evaluation.yaml 열기]\n└─ Experiments\n   └─ experiment_20241116_143022\n      ├─ 📊 Parse Results [클릭 시 실행]\n      │  \"Convert traces to Markdown timelines\"", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 66, "total_chunks": null}}
{"id": "596018e1-49d7-41c6-8702-3f4fcfa233f9", "content": "      │\n      ├─ 🎯 Evaluate Results [클릭 시 실행]\n      │  \"Run rule-based & LLM evaluation\"\n      │\n      ├─ 📁 per_trace_analysis/ [파싱 결과]\n      │  ├─ trace_001.md\n      │  ├─ trace_002.md\n      │  └─ ...\n      │\n      ├─ 📁 evaluation/ [평가 결과]\n      │  ├─ summary.json\n      │  ├─ per_trace.jsonl\n      │  ├─ report.md\n      │  └─ report.html\n      │\n      ├─ summary.json\n      ├─ traces.jsonl\n      └─ observations.jsonl\n```\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 67, "total_chunks": null}}
{"id": "4550ee26-c4cc-4141-a8d0-66e01c18425b", "content": "### 2.5 전체 워크플로우 연결성\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 68, "total_chunks": null}}
{"id": "f34ca956-fa09-49f2-a730-59642edf14cb", "content": "#### 문제점\n1. 단계 간 전환 시 다음 액션 안내 부족\n2. Overview Dashboard의 역할 불명확\n3. View 모드 전환 (Workspace/Playground/Insights) 이해 어려움\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 69, "total_chunks": null}}
{"id": "eab45c2d-6a5e-4464-a333-d2b60451ceb3", "content": "#### 개선안\n\n**A. 단계별 완료 후 다음 단계 안내**\n\n```\n입력 생성 완료 시:\n┌────────────────────────────────────────┐\n│ ✓ Generated 60 input variations!      │\n├────────────────────────────────────────┤\n│ Saved to: inputs/generated_...yaml    │\n│                                        │\n│ Next step:                             │\n│ → Run an experiment with these inputs │\n│                                        │\n│ [Run Experiment]  [Review]  [Close]   │\n└────────────────────────────────────────┘\n\n실험 완료 시:\n┌────────────────────────────────────────┐", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 70, "total_chunks": null}}
{"id": "af755990-337f-4235-b41c-0f9ba9ac49f4", "content": "│ ✓ Experiment completed!                │\n├────────────────────────────────────────┤\n│ Success rate: 93.3% (560/600)          │\n│ Results: experiments/experiment_...    │\n│                                        │\n│ Next steps:                            │\n│ → Parse results to readable format    │\n│ → Evaluate performance                │\n│                                        │\n│ [Parse]  [Evaluate]  [View]  [Close]  │\n└────────────────────────────────────────┘\n\n평가 완료 시:\n┌────────────────────────────────────────┐\n│ ✓ Evaluation completed!                │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 71, "total_chunks": null}}
{"id": "f13ad0a4-31a4-4669-ab59-86f8ecdfa36d", "content": "├────────────────────────────────────────┤\n│ Overall: ✓ PASS (95.2% > 90%)         │\n│ Report: evaluation/report.md           │\n│                                        │\n│ Next steps:                            │\n│ → Review evaluation report             │\n│ → Improve agent based on insights     │\n│                                        │\n│ [Open Report]  [New Experiment]  [×]  │\n└────────────────────────────────────────┘\n```\n\n**B. Overview Dashboard 개선**\n\n```\n┌─────────────────────────────────────────┐\n│ FluxLoop Overview                        │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 72, "total_chunks": null}}
{"id": "73dd233d-a371-415a-bc33-1b1047e99c38", "content": "├─────────────────────────────────────────┤\n│ 📁 Project: agent-v1                    │\n│ 🐍 Environment: my-agent/.venv          │\n├─────────────────────────────────────────┤\n│ [Workspace] [Playground] [Insights]     │\n├─────────────────────────────────────────┤\n│ Workflow Progress:                       │\n│                                          │\n│ 1. ✓ Project Created                    │\n│ 2. ✓ Inputs Configured (3 base)         │\n│ 3. ✓ Inputs Generated (60 total)        │\n│ 4. ✓ Experiment Completed (93.3%)       │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 73, "total_chunks": null}}
{"id": "1ab4d1be-097f-4f8b-b0dd-ddb409362edd", "content": "│ 5. ⏸️ Results Not Evaluated              │\n│    → [Evaluate Now]                     │\n│                                          │\n│ Recent Activity:                         │\n│ • 5 min ago: Experiment completed       │\n│ • 1 hour ago: Inputs generated          │\n└─────────────────────────────────────────┘\n```\n\n**C. 전체 워크플로우 맵**\n\n```\n┌─────────────────────────────────────────────────────────┐\n│                 FluxLoop 워크플로우 전체 맵               │\n├─────────────────────────────────────────────────────────┤\n│                                                          │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 74, "total_chunks": null}}
{"id": "f81e5698-1926-41a4-91dc-fd6920f78ace", "content": "│ [Workspace Mode]                                        │\n│   1. Create Project ──────────────────┐                │\n│      ├─ Select folders                 │                │\n│      ├─ Select Python env              │                │\n│      └─ Verify packages                │                │\n│                                         ▼                │\n│ [Playground Mode]                    Project Ready      │\n│   2. Configure Inputs ◄───────────────┘                │\n│      ├─ Edit configs/input.yaml                         │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 75, "total_chunks": null}}
{"id": "9d214367-2018-4fad-9111-e78cca551085", "content": "│      └─ Add base inputs, personas                       │\n│                                         │                │\n│   3. Generate Inputs ◄──────────────────┘               │\n│      ├─ Select mode & strategies                        │\n│      └─ Generate variations                             │\n│                                         │                │\n│   4. Run Experiment ◄───────────────────┘               │\n│      ├─ Select environment                              │\n│      ├─ Set iterations                                  │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 76, "total_chunks": null}}
{"id": "40136092-3e7c-4fe8-8a1c-d1265fb60dde", "content": "│      └─ Execute & monitor                               │\n│                                         ▼                │\n│ [Insights Mode]                     Results Saved       │\n│   5. Analyze Results ◄──────────────────┘               │\n│      ├─ Parse to Markdown                               │\n│      ├─ Evaluate performance                            │\n│      └─ Review & iterate                                │\n│                                         │                │\n│                   ┌─────────────────────┘                │", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 77, "total_chunks": null}}
{"id": "50f17e57-3eb7-4b92-90cd-90b0b17b3eb2", "content": "│                   ▼                                      │\n│              Improve Agent                               │\n│              (iterate)                                   │\n│                                                          │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 78, "total_chunks": null}}
{"id": "e7732d5b-ea71-4b3e-aa23-1f0b7a052fb4", "content": "## 3. 구현 우선순위\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 79, "total_chunks": null}}
{"id": "360c05ee-f031-4162-bdfa-39a1019540f6", "content": "### Phase 1: 프로젝트 생성 QuickPick 개선 (2-3일) ⭐⭐⭐\n\n**목표**: \"두 폴더 선택\" 혼란 해결 → 즉시 80% 효과\n\n**구현 항목:**\n1. Python 환경 선택 QuickPick 개선\n   - `detail` 필드에 \"Environments: 1/2/3\" 추가\n   - Codicons: `$(star)` (권장), `$(warning)` (주의)\n   - `picked: true`로 자동 감지 환경 기본 선택\n   - `title`: \"Python Environment Setup (Step 4/7)\"\n\n2. 패키지 누락 Warning 개선\n   - 모달 Warning (`{ modal: true }`)\n   - 3가지 명확한 액션 버튼\n   - 설치 예상 시간 표시\n\n3. 프로젝트 생성 Progress\n   - \"Running fluxloop init...\", \"Saving settings...\" 단계별 표시\n\n**예상 효과:**\n- 사용자 혼란: 80% ↓\n- 환경 설정 오류: 70% ↓\n- 프로젝트 생성 실패율: 50% ↓", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 80, "total_chunks": null}}
{"id": "c92b9d19-7a37-4fcb-a2f1-858ed59bf4e2", "content": "\n**수정 파일:**\n- `packages/vscode/src/commands/projectCommands.ts`\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 81, "total_chunks": null}}
{"id": "b8a7bff0-32dc-4f1f-9f6f-b9e164c3291a", "content": "### Phase 2: Status TreeView 대시보드 (1주) ⭐⭐\n\n**목표**: 환경 상태 실시간 모니터링\n\n**구현 항목:**\n1. Status TreeView Provider 생성\n   - Python Environment 섹션\n   - FluxLoop Packages 섹션 (클릭 시 설치)\n   - Project Structure 섹션\n   - Connection 섹션\n\n2. 클릭 액션\n   - 미설치 패키지 클릭 → 설치 대화상자\n   - Collector 클릭 → 설정 대화상자\n\n**TreeView 구조:**\n```\nStatus\n├─ Python Environment\n│  ├─ ✓ Python 3.11.5\n│  └─ Type: venv\n├─ FluxLoop Packages\n│  ├─ ✓ CLI 0.2.0\n│  ├─ ✓ SDK 0.2.0\n│  └─ ✗ MCP [클릭→설치]\n├─ Project Structure\n│  ├─ Project: agent-v1/\n│  ├─ Source: my-agent/src\n│  └─ Env: my-agent/.venv", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 82, "total_chunks": null}}
{"id": "f15dba69-856c-4466-b485-27cfccda6979", "content": "└─ Connection\n   └─ Collector: Disabled [클릭→설정]\n```\n\n**예상 효과:**\n- 환경 문제 발견 시간: 70% ↓\n- Doctor 명령 사용률: 50% ↑\n\n**수정 파일:**\n- `packages/vscode/src/providers/statusProvider.ts` (신규)\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 83, "total_chunks": null}}
{"id": "b1fc8df9-d6d7-4eac-90f9-868370a86ae1", "content": "### Phase 3: 입력 생성 UX 개선 (3-5일) ⭐\n\n**목표**: 생성 투명성 향상\n\n**구현 항목:**\n1. QuickPick Multi-select (Variation Strategies)\n2. InputBox에 예상 개수 실시간 계산 표시\n3. Progress Notification + 취소 가능\n4. 완료 시 파일 자동 열기 옵션\n\n**예상 효과:**\n- 생성 과정 투명성: 100% ↑\n- 생성 취소 가능: 새 기능\n- LLM 모드 이해도: 50% ↑\n\n**수정 파일:**\n- `packages/vscode/src/commands/commandManager.ts`\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 84, "total_chunks": null}}
{"id": "395b9209-2b0b-4e32-a5bc-53913b964a7e", "content": "## 4. 핵심 개선 요약\n\n**가장 중요한 개선: \"두 폴더 선택\" 문제**\n\n| 현재 | 개선안 | 효과 |\n|------|--------|------|\n| 설명 없음 | QuickPick `detail`: \"Environments: 1\" | 혼란 80% ↓ |\n| 기본 선택 없음 | `picked: true` + `$(star)` | 오류 70% ↓ |\n| 검증 루프 혼란 | 모달 Warning + 3가지 액션 | 이탈 50% ↓ |\n\n**구현 코스트:**\n- 코드 변경: 50줄 이내\n- 개발 시간: 2-3일\n- 난이도: ⭐ 낮음\n\n**Before vs After 시각 비교:**\n\n```\nBefore:                          After:\nChoose another folder…      →    ★ Use detected environment\n[의미 불명확]                    ✓ Environments: 1 | No conflicts\n                                 [명확한 이점 표시]", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 85, "total_chunks": null}}
{"id": "66d90dbb-b9c9-46ba-9dd6-ca02d6576530", "content": "\nUse project folder          →    Create new venv in project\n[결과 불명확]                    ⚠️  Environments: 2 | Separate install\n                                 [명확한 단점 표시]\n\nUse Global PATH             →    Use system Python\n[결과 예측 불가]                 ⚠️  Not recommended | Conflicts\n                                 [명확한 경고]\n```\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 86, "total_chunks": null}}
{"id": "49d883c3-8919-4b73-8c38-d63ddf8f015e", "content": "## 5. 기술적 실현 가능성\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 87, "total_chunks": null}}
{"id": "3c3da494-7b29-477b-a5af-216a3b039840", "content": "### VSCode API 활용 전략\n\n**네이티브 UI 우선 원칙:**\n- QuickPick: 선택, 다중 선택, 단계별 진행\n- InputBox: 텍스트 입력, 유효성 검증\n- TreeView: 계층 구조, 클릭 액션\n- Progress: 진행 상황, 취소 가능\n- Output Channel: 실시간 로그\n\n**Webview는 최소화:**\n- 현재: Overview Dashboard만 Webview 사용\n- 추가 불필요 (네이티브 UI로 충분)\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 88, "total_chunks": null}}
{"id": "188d124a-18a8-4915-a864-a2c3ebc2b784", "content": "### 구현 난이도 분석\n\n| Phase | 방법 | 난이도 | 시간 | 효과 | ROI |\n|-------|------|--------|------|------|-----|\n| Phase 1 | QuickPick detail | ⭐ | 2-3일 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |\n| Phase 2 | TreeView | ⭐⭐ | 1주 | ⭐⭐ | ⭐⭐⭐ |\n| Phase 3 | QuickPick canPickMany | ⭐ | 3-5일 | ⭐⭐ | ⭐⭐⭐ |\n\n**권장 순서:**\n1. **Phase 1 즉시 시작** (최고 ROI)\n2. Phase 2, 3는 순차적 진행\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 89, "total_chunks": null}}
{"id": "f8809747-d86d-47b0-b2a1-aba863117ccd", "content": "## 부록\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 90, "total_chunks": null}}
{"id": "6d0dc7f3-7041-4042-99d4-042c3b6d1e9e", "content": "### 관련 문서\n- `vscode_extention.md`, `vscode_implementation.md`, `codex_vscode_extention.md`\n- `packages/vscode/src/`: 실제 구현 코드\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 91, "total_chunks": null}}
{"id": "d90e45ac-784d-4b4b-a0eb-22adbfad223c", "content": "### 기술 스택\n- VSCode API: QuickPick, TreeView, Progress, Output Channel\n- 언어: TypeScript\n- UI: VSCode 네이티브 (Webview 최소화)\n\n---\n\n**문서 버전**: 3.0 (와이어프레임 및 플로우 추가)  \n**작성자**: FluxLoop Team  \n**최종 수정**: 2025-11-16\n\n---\n", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 92, "total_chunks": null}}
{"id": "969ae5bd-8bfd-4f6d-be2b-8ab79251d62f", "content": "## 문서 변경 이력\n\n- **v1.0**: 초기 작성 (Webview 기반)\n- **v2.0**: Webview 제거, QuickPick 중심으로 재작성\n- **v2.1**: 상세 코드 제거, 간결화\n- **v3.0**: 와이어프레임 및 플로우 다이어그램 추가, 코드 완전 제거", "metadata": {"source": "docs/prd/vscode_ux_improvement.md", "chunk_index": 93, "total_chunks": null}}
{"id": "dd618592-05ff-4e86-bf73-284d9148325a", "content": "# FluxLoop Web – 실행 자동화 & 코드 에이전트 로드맵\n> **버전:** 0.1  \n> **작성일:** 2025-11-19  \n> **범위:** POC 이후, FluxLoop Web을 코드 에이전트 중심의 자동화 플랫폼으로 확장하기 위한 중장기 계획\n\n---\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 0, "total_chunks": null}}
{"id": "4224837e-ce25-4149-8af6-bf6855a9ed05", "content": "## 1. 배경\n- 현재 POC는 “Git 연결 → 실행 프로파일 생성 → 샌드박스에서 FluxLoop 실험 실행 → 로그 스트리밍”까지의 코어 루프를 목표로 한다.\n- 향후에는 실패한 실험을 자동 분석하고, 수정 코드 브랜치를 생성하며, 재실행/PR까지 이어지는 **코드 에이전트(코파일럿)** 경험이 요구된다.\n- Vercel Labs의 [coding-agent-template](https://github.com/vercel-labs/coding-agent-template)와 LangChain의 [open-swe](https://github.com/langchain-ai/open-swe) 프로젝트가 유사한 워크플로우를 제공하고 있으며, FluxLoop Web 역시 해당 구조를 참고해 확장할 수 있다.\n\n---\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 1, "total_chunks": null}}
{"id": "3accf163-78f9-40ce-8a97-7aa724fd7bfd", "content": "## 2. 단계별 로드맵\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 2, "total_chunks": null}}
{"id": "5ad07a7a-aced-4899-87fb-08aa99d1d706", "content": "### Phase A. 실행 프로파일 & 샌드박스 보강 (현재 진행 중)\n1. **Execution Profile API**  \n   - Supabase `projects`/`experiments`에 `project_subdir`, `bootstrap_command`, `default_args`, `env_vars`, `runtime_driver` 등의 필드 추가  \n   - VSCode 확장(`packages/vscode/src/commands/projectCommands.ts`)에서 사용 중인 입력값을 분석하여 웹 UX에 필요한 필수 항목 정의  \n   - 후속 Runner는 이 프로파일을 기반으로 실행 전 `bootstrap_command`(예: `uv sync`)를 수행하고, 실패 시 SSE로 로그 전송\n\n2. **실행 구성 마법사(UI)**  \n   - Git 연결 후 레포 내 FluxLoop 프로젝트 자동 탐지 (`fluxloop_projects/**`, `configs/`, `setting.yaml` 스캔)  ", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 3, "total_chunks": null}}
{"id": "930befed-dc67-4d53-b49c-4044d0ea1ad6", "content": "   - 없다면 “Default vs Custom” 흐름(Polish #1 문서 참고)을 웹에 맞게 재설계하여 새 프로젝트 생성/의존성 설정 절차 제공  \n   - 실행 프로파일을 Supabase에 저장 후 `/experiments/run` API 호출\n\n3. **샌드박스 표준화**  \n   - 모든 실행은 임시 워커(로컬/K8s/Vercel Sandbox)에서 독립 수행  \n   - 로그/부트스트랩 출력은 SSE 스트림과 Supabase Storage(`logs` 버킷)에 저장  \n   - 실패 시 바로 중단하고 UI에 명확한 에러 메시지 표시\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 4, "total_chunks": null}}
{"id": "87ab3706-4ebf-444b-b04e-25d984ca619a", "content": "### Phase B. 코드 에이전트 워크플로우\n1. **실패 분석 → 수정 계획 수립**  \n   - 실패한 실험의 로그/트레이스를 AI가 분석하여 원인과 수정 가이드를 생성  \n   - LangGraph 혹은 Vercel AI SDK 기반의 멀티 스텝 워크플로우 모델링  \n   - 사용자 승인(Manual) 또는 자동(Autonomous) 모드 지원\n\n2. **코드 수정 & 브랜치 생성**  \n   - GitHub OAuth/App 연동으로 사용자 계정 권한 확보  \n   - 브랜치/커밋/PR 생성 API를 래핑하여 에이전트가 수정사항을 반영  \n   - 코드 diff와 영향 범위를 UI에서 리뷰 가능하도록 표시\n\n3. **자동 재실행 & 검증**  \n   - 수정된 브랜치로 샌드박스 실행 재호출 → 성공 시 PR 본문에 결과 첨부  \n   - 실패하면 수정 계획을 다시 갱신하거나 사용자가 수동 보정\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 5, "total_chunks": null}}
{"id": "8e817fbe-ea8d-439f-8143-e2b4086038cb", "content": "### Phase C. 운영/보안 고도화\n- **권한 관리**: 팀/조직별 RBAC, 실행 제한, 로그 접근 제어  \n- **비용 관리**: 실행 시간/토큰 사용량 추적 후 대시보드 제공  \n- **감사 추적**: 에이전트가 만든 변경 이력, 실행 결과를 모두 저장  \n- **플러그인 생태계**: LangChain Tool이나 Vercel Sandbox Task를 플러그인 형태로 추가 가능하게 설계\n\n---\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 6, "total_chunks": null}}
{"id": "210ab362-2025-4503-83fa-3870c5b3f70e", "content": "## 3. 기술 참고 & 요구 사항 추출\n\n| 구분 | 참고 링크 | FluxLoop 적용 포인트 |\n| --- | --- | --- |\n| 코드 에이전트 | [Vercel coding-agent-template](https://github.com/vercel-labs/coding-agent-template) | Vercel Sandbox 기반 실행, 브랜치/PR 생성, Realtime 로그 스트리밍 UX |\n| 멀티 스텝 플로우 | [LangChain open-swe](https://github.com/langchain-ai/open-swe) | LangGraph 스타일의 멀티 스텝 워크플로우 (분석 → 수정 → 테스트) 구현 방식 |\n| VSCode UX | `packages/vscode/src/commands/projectCommands.ts`, `docs/prd/polish/polish_1_plan.md` | 프로젝트 생성/환경 설정에 필요한 필드, 검증 로직, 사용자 가이드 |\n\n---\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 7, "total_chunks": null}}
{"id": "e0b98bee-9711-4690-9dd6-b8750e10c278", "content": "## 4. 우선 순위별 액션 아이템\n\n1. **Execution Profile 설계 & Runner 확장**  \n   - Schema/Pydantic 모델 작성 → API 구현 → Runner에서 소비하도록 통합  \n   - SSE 로그에 부트스트랩 단계/실험 단계 구분 이벤트 추가\n\n2. **웹 UI 마법사 프로토타입**  \n   - 기본(Default) 플로우: 이름 + 환경 선택 + 부트스트랩 스크립트  \n   - 고급(Custom) 플로우: 서브디렉터리 수동 지정, 다중 환경, 플러그인 설정  \n   - FluxLoop OSS 템플릿을 빠르게 적용할 수 있는 “템플릿 프로젝트 불러오기” 옵션 제공\n\n3. **LangGraph/Vercel SDK PoC**  \n   - 실패 로그를 인풋으로 받아 수정 제안과 커밋 메시지를 생성하는 간단한 그래프 작성  \n   - 샌드박스 실행 Tool을 그래프 노드로 연결하여 end-to-end 데모 구현\n\n4. **GitHub App 전략 수립**  \n   - 조직 단위 설치 vs 개인 토큰 선택 정책  ", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 8, "total_chunks": null}}
{"id": "5f317203-271e-447b-a09e-d7d5b4982357", "content": "   - 브랜치 보호/PR 검토 프로세스와의 연동 방안 마련\n\n---\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 9, "total_chunks": null}}
{"id": "e31ad05d-98af-4b6f-a8b6-7201a90bc35b", "content": "## 5. 기대 효과\n- **PM/QA**가 웹 UI만으로 실험 실행→수정→재실행→PR까지 한 루프 내에서 수행  \n- **자동화 증대**: 실패 원인 분석과 수정 제안이 자동화되어 반복 루프 시간을 단축  \n- **추적성 확보**: Supabase에 실행/수정 로그가 모두 저장되어 품질 감사가 수월  \n- **에코시스템 확장**: LangChain, Vercel Sandbox 등 외부 툴을 플러그인 형태로 쉽게 연결 가능\n\n---\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 10, "total_chunks": null}}
{"id": "7649658d-df92-4e08-aa59-ce30319302e0", "content": "## 6. 후속 과제\n- Execution Profile API 및 UI 상세 설계 문서화  \n- Runner 부트스트랩/실험 단계 분리, 롤백 전략 정의  \n- LangGraph 기반 코드 에이전트 초기 워크플로우 설계서 작성  \n- GitHub App 등록 및 권한 정책 초안 마련  \n- 비용/보안 측면의 운영 가이드라인 수립\n\n---\n\n> **요약**: FluxLoop Web은 POC에서 구축한 실행/로그 인프라를 기반으로, Execution Profile + 코드 에이전트 워크플로우를 차근차근 확장하여 “실험 실패 → 자동 수정 → 재실행 → PR”까지 연결되는 Code Ops 플랫폼으로 진화한다. 이를 위해 VSCode 확장에서 검증된 입력 요구사항을 웹용 UX로 재구성하고, Vercel 및 LangChain 사례를 참고해 멀티 스텝 에이전트를 도입한다.\n\n", "metadata": {"source": "docs/prd/web/agent_roadmap.md", "chunk_index": 11, "total_chunks": null}}
{"id": "a8c7d35e-f5b2-4889-80c5-2f7ab1f67649", "content": "# Cloud Sandbox & Runner Specification\n> **Target Status:** Draft\n> **Version:** 1.0\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 0, "total_chunks": null}}
{"id": "c26db394-93c9-4372-981f-a4d72ad68ea9", "content": "## 1. Objective\nExecute arbitrary, potentially untrusted agent code in a secure, isolated, and scalable environment, while maintaining high observability (logs/traces) and state management.\n\n---\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 1, "total_chunks": null}}
{"id": "1e48ed92-f6bb-46c8-89ff-a3fdd7f79e37", "content": "## 2. Isolation Strategy: Ephemeral Pods\nWe will use **Kubernetes (EKS/GKE)** or **AWS ECS (Fargate)** launching one-off tasks.\n\n**Why not purely Serverless (Lambda)?**\n- Agent simulations are long-running (mins to hours).\n- Dependency installation (`pip install`) is slow/heavy for Lambda cold starts.\n\n**Why Pods?**\n- Full OS control.\n- Easy resource limits (CPU/RAM).\n- Network policy enforcement.\n\n---\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 2, "total_chunks": null}}
{"id": "3a0133ff-2fd2-4a9a-bc0f-7854baef9bca", "content": "## 3. Runner Lifecycle\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 3, "total_chunks": null}}
{"id": "9430085f-5e49-4843-a1fe-153dc56907d3", "content": "### Step 1: Preparation (The Builder)\nBefore running 100 traces, we need an image or environment.\n- **Optimization:** We cannot run `pip install` 100 times.\n- **Strategy:** \"Base Image\" + \"Layer Caching\".\n    - **Repo-Specific Base:** When a project updates `requirements.txt`, we build a docker image `fluxloop/runner:{project_id}-{hash}`.\n    - **Execution:** The 100 worker pods use this pre-baked image, so startup is < 5 seconds.\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 4, "total_chunks": null}}
{"id": "b160e2d1-a621-4d8d-bc92-7aa9d6d95145", "content": "### Step 2: Execution (The Worker)\nThe Pod runs the `fluxloop-cli`.\n\n**Command:**\n```bash\nfluxloop run experiment \\\n  --repo-path /app/code \\\n  --commit {sha} \\\n  --config-overrides {base64_json} \\\n  --stream-logs-to supabase://storage/logs/{experiment_id}.log\n```\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 5, "total_chunks": null}}
{"id": "fe707239-461d-4fed-b95f-d92d44b59020", "content": "### Step 3: Secret Injection\n**Security Critical:** Never bake secrets into the image.\n- **Vault / Secrets Manager:**\n    - User stores `OPENAI_API_KEY` in Web UI (saved to Vault).\n    - At runtime, Orchestrator retrieves secrets.\n    - Secrets are injected as **Environment Variables** into the Pod definition.\n    - `env: [{name: \"OPENAI_API_KEY\", value: \"sk-...\"}]`\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 6, "total_chunks": null}}
{"id": "8b68dd28-5bfa-4506-a819-ebc3e7f06a34", "content": "### Step 4: Networking (Egress Control)\n- **Allow:** Access to LLM Providers (OpenAI, Anthropic), PyPI (if needed), Supabase Storage endpoints.\n- **Block:** Access to internal VPC, private DBs (unless explicitly whitelisted via PrivateLink).\n- **Implementation:** K8s NetworkPolicy or AWS Security Groups.\n\n---\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 7, "total_chunks": null}}
{"id": "85ceebc0-7a1c-424e-9b60-6549f3bc9f04", "content": "## 4. Log & Data Pipeline\n\n**A. Real-time Stream (WebSocket)**\n- Since we can't keep 100 connections open to the browser easily:\n- Pod -> Fluentd/Vector (Sidecar) -> Redis Pub/Sub -> Backend API -> Frontend WebSocket.\n- **Payload:** Lightweight updates (\"Trace #5 finished\", \"Step 2 done\").\n\n**B. Bulk Data (Artifacts)**\n- Full logs and trace JSONs are too big for DB.\n- Pod writes `trace_output.jsonl` to a local volume.\n- On completion, sidecar uploads to **Supabase Storage** using service-role credentials.\n- Backend API generates Supabase signed URLs for the Frontend to fetch full logs when the user clicks \"View Details\".", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 8, "total_chunks": null}}
{"id": "c2d824f4-a694-40bb-a582-67c8268f7dff", "content": "\n---\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 9, "total_chunks": null}}
{"id": "0f960f62-9f5f-43d0-ba65-45c7754a483f", "content": "## 5. Resource Management & Quotas\n- **Limits per Project:**\n    - Concurrency: Max 50 parallel traces (Free), 500 (Enterprise).\n    - Timeout: Hard kill after 30 minutes.\n- **Cost Tracking:**\n    - Track Pod execution time (seconds).\n    - Estimate token usage (from LLM logs).\n    - Display \"Cost of this Experiment\" to user.\n\n", "metadata": {"source": "docs/prd/web/cloud_sandbox_spec.md", "chunk_index": 10, "total_chunks": null}}
{"id": "96a2d5c5-9bf9-4cff-b020-5c0a8bdc8389", "content": "# FluxLoop Coder Deep-Agent Rearchitecture Plan\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 0, "total_chunks": null}}
{"id": "bccab81c-800f-4b5e-bb63-94630c35fbcb", "content": "## 1. 배경\n\n- 현재 LangGraph 상위 그래프는 **Supervisor 노드**가 엔트리 포인트이며, **Coder 그래프**는 `coder_graph.invoke()` 형태로 *외부 호출*된다.\n- 이 구조에서는 LangGraph `MemorySaver`/checkpoint 기능이 Coder에게 적용되지 않아, self-loop 때마다 메시지 히스토리가 사라지고 PlanTracker 진행 상태도 매 턴 재설정되는 문제가 반복된다.\n- Supervisor는 실제 실행을 하지 않으므로 MemorySaver가 필요 없지만, Coder는 깊은 도구 호출 루프를 유지해야 하므로 **그래프 중심을 Coder로 옮기는 재설계**가 요구된다.\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 1, "total_chunks": null}}
{"id": "065a9d3e-bbbf-411e-837f-8d7ffe28eb91", "content": "## 2. 목표\n\n1. **Coder 중심 LangGraph** 구축  \n   - MemorySaver/중단-재개/미들웨어 이점을 Coder가 직접 활용.\n2. **Supervisor 역할 단순화**  \n   - 감시·검사·피드백 기능 위주로 축소, 필요 시 Coder가 호출.\n3. **Deep-Agent 추상화**  \n   - Coder 외에도 Tester, Researcher 등 역할형 에이전트를 동일 패턴으로 재사용할 수 있는 공통 그래프 빌더 제공.\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 2, "total_chunks": null}}
{"id": "728db522-bef2-4cc3-8658-0b1380c25205", "content": "## 3. 아키텍처 개요\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 3, "total_chunks": null}}
{"id": "5a7b583c-cbba-421d-984d-723703b03eac", "content": "### 3.1 Deep Agent Core\n\n| 구성요소 | 설명 |\n|---------|------|\n| `DeepAgentState` | `messages`, `plan`, `artifacts`, `verification`, `supervisor_feedback` 등 공통 필드를 가지는 TypedDict |\n| `build_deep_agent_graph` | LLM/도구/미들웨어/프롬프트를 입력 받아 LangGraph(StateGraph)로 조합하는 빌더 |\n| Middleware Stack | PlanTracker, Memory, Skills, HITL, Summarization 등 현재 Coder 미들웨어를 일반화 |\n| Plan & Artifact Handling | TODO 관리, diff/verification 기록을 공통화 |\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 4, "total_chunks": null}}
{"id": "4fac1d7a-4cee-4a4e-80b3-20135831c7ee", "content": "### 3.2 Coder-First Graph\n\n```\nCoderAgent (entry)\n ├─ 도구 실행 루프 (create_agent)\n ├─ 조건부 edge → SupervisorNode (검토 필요 시)\n └─ END (완료)\n```\n\n- CoderAgent 노드가 LangChain AgentExecutor를 직접 실행하며 MemorySaver가 모든 메시지를 유지.\n- SupervisorNode는 필요 시 Coder 상태(`plan`, `report`, `constraints`)를 보고 피드백 메시지를 반환.\n- HITL 인터럽트는 Coder 그래프 상태에서 바로 발생하도록 유지.\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 5, "total_chunks": null}}
{"id": "486bcedf-1d92-4c65-a3eb-266e79c085d3", "content": "### 3.3 Supervisor 통합 방식\n\n- **옵션 A(권장) – Deep Agent 내 Supervisor 노드 고정 포함**  \n  - 모든 Deep Agent 그래프는 `SupervisorNode`를 기본 구성요소로 포함하며, Supervisor는 **별도 LLM**(기존 Supervisor LLM)을 사용해 피드백/요약을 생성한다.\n  - Coder가 조건부 edge(예: TODO 완료, 검증 실패, 일정 스텝 초과 등)에서 Supervisor 노드를 호출한다.\n  - Supervisor는 `HumanMessage` 형태의 피드백만 남기고, 실제 TODO 수정은 항상 Coder가 수행한다.\n  - Supervisor는 PlanTracker에 직접 접근하지 않으며, `supervisor_feedback`/`constraints` 필드로 의사결정 메시지를 전달한다.\n  - 대표적인 호출 조건:\n\n    | Trigger | 설명 |\n    | --- | --- |\n    | `pending_items == 0` | 모든 TODO가 완료된 경우 → Supervisor에게 최종 보고 및 종료 여부 판단 요청 |", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 6, "total_chunks": null}}
{"id": "a171891d-73e8-462d-9e1d-30d8f68517b8", "content": "    | `verification.status == \"failed\"` | 검증 명령 실패 시 → Supervisor가 스코프 조정/재시도 지시 |\n    | `coder_steps >= N` | 특정 연속 스텝 초과 시 → Supervisor가 진행 상황 점검 |\n    | `blocked == True` | Coder가 명시적으로 블로커를 보고할 때 |\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 7, "total_chunks": null}}
{"id": "8c2aa091-98ed-4333-8cbb-7c6e86a63f84", "content": "## 4. 상태/데이터 흐름\n\n1. **PlanTracker**  \n   - DeepAgentState 안에서 직접 관리; `todos` key를 표준화.\n2. **Artifacts / Verification**  \n   - 모든 Deep Agent가 동일 포맷(`[{action, path}]`, `[{name, status, details}]`)으로 기록.\n3. **Supervisor Feedback**  \n   - `supervisor_feedback` 또는 `constraints` 필드를 통해 Coder 메시지에 Human 지시를 append.\n4. **프롬프트 & 미들웨어 호환성**  \n   - 기존 `CODER_SYSTEM_PROMPT`는 “Supervisor directive” 표현만 일반화하면 Deep Agent 공통 프롬프트로 재사용 가능하다.  \n   - `FluxLoopAgentMemoryMiddleware`와 `FluxLoopSkillsMiddleware`는 구조 변경과 무관하게 계속 활용하되, 모듈 경로를 일반화하여 다른 역할형 에이전트도 동일 설정을 사용하도록 한다.", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 8, "total_chunks": null}}
{"id": "3b10a53d-863c-4574-a558-380fe2a667af", "content": "## 5. 이행 계획\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 10, "total_chunks": null}}
{"id": "39c14d4b-1bd4-4a97-84c3-76b145982fed", "content": "### Phase 1 – Core 추상화\n1. `DeepAgentState` TypedDict 정의.\n2. `build_deep_agent_graph` 함수 작성 (현재 Coder 그래프 로직 이동).\n3. Coder agent에서 새 빌더 사용, Supervisor 제거 후 단일 그래프로 동작 확인.\n4. API/이벤트 스펙 정비  \n   - `AgentService` 엔트리 포인트를 Supervisor → Coder로 전환할 때의 스트리밍 이벤트 변화를 명시한다.  \n   - 이벤트 payload에 `actor`/`phase`와 같은 식별자를 추가해 Coder vs Supervisor 이벤트를 구분할 수 있게 한다.  \n   - 구버전 클라이언트를 위한 호환 전략(이중 이벤트 전송, 버전 플래그 등)을 문서화한다.\n5. 테스트/검증 계획  \n   - 현행 integrator-run 시나리오를 대상으로 E2E 테스트를 실행해 기존 기능과 동등한 결과가 나오는지 확인한다.  \n   - 주요 명령(Plan 생성, TODO 업데이트, 실행/검증 로그)이 스트리밍 이벤트로 정확히 방출되는지 점검한다.", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 11, "total_chunks": null}}
{"id": "74db84d8-9625-4668-ac8b-89acbecae73d", "content": "### Phase 2 – Supervisor 재통합\n1. Coder 그래프 내에 Supervisor 노드 추가(옵션 A) 또는 middleware 삽입(옵션 B). Supervisor 노드는 독립된 LLM을 사용해 피드백/종료 결정을 내린다.\n2. 기존 `create_supervisor_node` 재사용 가능 여부 검토, 필요 시 단순화.\n3. 상태 전환/보고 경로 검증 (완료 → Supervisor Finish).\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4b03be52-461f-4ced-83fd-49721bec8ff8", "content": "### Phase 2.5 – 상위 Orchestrator/Integrator 정렬\n1. **AgentService 엔트리 전환**  \n   - LangGraph entry point를 Supervisor → DeepAgent(Coder)로 완전히 교체하고, 기존 Supervisor 노드는 제거한다.  \n   - `build_agent_graph`는 더 이상 Coder 노드를 외부 호출하지 않고, Deep Agent 그래프를 직접 반환한다.\n2. **메시지/상태 연속성**  \n   - `AgentState`에서 Coder와 Supervisor 사이에 주고받던 메시지/plan 필드를 DeepAgentState로 매핑한다.  \n   - self-loop 시 `messages`가 보존되도록 `coder_node`/상위 orchestration 로직을 정리한다.\n3. **Integrator 연결 리팩터링**  \n   - integrator-run API가 Deep Agent 그래프의 단일 실행 흐름을 호출하도록 조정한다.  \n   - 기존 Supervisor directive 생성 로직을 HumanMessage seed 형태(초기 goal)로 단순화한다.", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 14, "total_chunks": null}}
{"id": "3b8d82d2-cd11-4261-a171-bcf5c44b8e13", "content": "4. **Compatibility layer**  \n   - 이전 이벤트/상태 소비자를 위해 필요한 경우 translation layer를 제공하되, 새로운 `actor`/`phase` 필드를 기본으로 한다.\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 15, "total_chunks": null}}
{"id": "6b6be861-8b4b-4aa3-9c5e-1c47d8ea6a9f", "content": "### Phase 3 – 다중 에이전트 확장 (Multi-Agent Builder)\n\n1. **Agent Builder 패턴 도입**:\n   - `AgentService`가 단일 그래프(Integrator)만 생성하던 구조를 개선하여, `AgentConfig`에 따라 동적으로 그래프를 조립하는 **Builder 패턴**을 도입한다.\n   - 예: `build_agent_graph(config: AgentGraphConfig)`\n     - `nodes`: [\"Supervisor\", \"Coder\", \"Researcher\", \"Tester\"]\n     - `edges`: 정의된 워크플로우 (Supervisor → Coder, Supervisor → Researcher 등)\n   - 이를 통해 **Integrator**(코딩 중심), **Researcher**(분석 중심), **Supporter**(QA/문서화) 등 다양한 전문 에이전트를 `AgentService` 코드 수정 없이 정의할 수 있게 한다.\n\n2. **전문화된 Sub-Agent 정의**:", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 16, "total_chunks": null}}
{"id": "0967ac2d-948d-4333-ad9c-8b469d4f3d36", "content": "   - **Researcher Agent**: 코드를 수정하지 않고 문서 조회, 웹 검색, 로그 분석만 수행하여 Supervisor에게 보고하는 역할. `tools=[search_mcp, read_file]`로 제한.\n   - **QA/Tester Agent**: 변경된 코드를 기반으로 테스트 케이스를 생성하고 실행하는 역할. `tools=[run_test, write_file]` 중심.\n   - 각 에이전트는 독립된 LangGraph 인스턴스로 실행되거나, 상위 그래프의 노드로 포함될 수 있다.\n\n3. **Multi-Agent Orchestration**:\n   - Runner 레벨에서 여러 Deep Agent를 순차적/병렬적으로 실행하는 파이프라인을 구성한다.\n   - 예: `Researcher(분석)` → `Integrator(구현)` → `Tester(검증)`\n   - 각 단계의 에이전트는 `AgentPersistenceStore`를 통해 컨텍스트(메모리, 계획)를 공유하거나 핸드오프한다.\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 17, "total_chunks": null}}
{"id": "4dabf41f-ede9-4f55-855a-064249a07e3c", "content": "## 4. 이행 계획 (Migration Plan)\n\n1. **Phase 1: 모듈화 및 HITL 도입** (완료)\n   - `AgentService` 리팩토링 및 `AgentGraph` 분리\n   - `LangGraph` 기반 Supervisor-Worker 구조 적용\n   - HITL(Human-in-the-Loop) 인터럽트 처리 구현\n\n2. **Phase 2: 상태 관리 및 지속성** (완료)\n   - `AgentSessionStore` 구현 (Supabase 연동)\n   - `AgentPersistenceStore` (메모리/스킬/계획) 통합\n   - 이벤트 스트리밍 및 UI 실시간 연동\n\n3. **Phase 3: 다중 에이전트 확장** (완료)\n   - `AgentGraphConfig` 기반 빌더 패턴 도입\n   - `Integrator`, `Researcher` 등 역할별 에이전트 분리\n   - Context Sharing (Handoff) 기반 마련\n\n4. **Future Works (Icebox)**\n   - Multi-Agent Pipeline Orchestration (Runner 레벨)", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 18, "total_chunks": null}}
{"id": "8829742b-43a1-45c1-bdee-14cf894ed128", "content": "   - Documentation & DevEx 개선\n\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 19, "total_chunks": null}}
{"id": "e7c3faa0-5ecb-4764-ba4d-4a7aca026757", "content": "## 6. 고려 사항\n\n- **토큰 관리**: Coder 그래프가 모든 메시지를 유지하므로 SummarizationMiddleware의 trigger/keep 전략 재조정 필요.\n- **HITL 연계**: Supervisor 노드가 그래프 내부로 들어오면서 기존 HITL registry 로직과의 연결점 점검.\n- **Backward Compatibility**: 기존 API(Integrator → Supervisor → Coder) 호출 경로가 변경되므로 서비스 레이어 업데이트 계획 필요.\n\n---\n\n이 문서는 FluxLoop Coder 에이전트 재설계의 상위 방향성을 정리하며, Deep-Agent 일반화를 염두에 둔 리팩터링 가이드로 활용한다.\n", "metadata": {"source": "docs/prd/web/coder/deep_agent_rearchitecture.md", "chunk_index": 20, "total_chunks": null}}
{"id": "484ee08b-dd2f-42f2-be69-5cb362ffbb15", "content": "# FluxLoop Coder Agent Evolution Plan\n\nFluxLoop 에이전트 스택(`app/services/agent/`)은 현재 Supervisor ↔ Coder 2계층 LangGraph(`graph.py`)에 Sandbox 도구 집합(`tools/__init__.py`)을 연결하는 구조다. 아래 문서는 “얇은 Supervisor”와 “Deep Agent 지향 Coder”라는 목표를 달성하기 위해, 현 구조에서 어떤 순서로 진화해야 하는지 정리한다.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "5cfaf8f4-9ee7-4e76-9027-204dcf3df58f", "content": "## 1. 현재 구조 요약\n\n- **진입점**: `service.py` 가 RunnerService와 LangGraph를 묶어 스트리밍 루프를 실행한다. 기본 상태는 `AgentState`(`state.py`) 한 종류이며 `messages`, `next`, `current_task`, `coder_report` 만을 보관한다.\n- **Supervisor**: `supervisor/node.py` 는 `DelegateToCoder`·`Finish` 두 개의 Pydantic Tool Schema만 바인딩하고, 시스템 프롬프트(`supervisor/prompts.py`)는 FluxLoop SDK 통합이라는 단일 목표에 고정되어 있다.\n- **Coder**: `coder/node.py` 는 호출될 때마다 `create_react_agent` 를 생성해 단일 태스크를 처리한다. Planner·FS·Git·테스트 등 도구는 Sandbox executor 래퍼(`tools/*.py`)로 제공되며, TODO 상태는 `.fluxloop/todos.json` 파일 하나에만 저장된다.", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "850ba4b9-e2f2-4eae-99f4-c7832e69e41a", "content": "- **Middleware/Memory**: `MemorySaver` 외의 LangGraph 미들웨어(요약, 프롬프트 캐싱, HITL 등)는 존재하지 않는다. Coder가 자체적으로 컨텍스트를 줄이거나 장기 메모리를 다루는 구조도 없다.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "cbbef330-a30b-42f2-8091-b448a735ed0b", "content": "## 2. 목표 재정의\n\n1. **얇은 Supervisor 레이어**  \n   - 역할: Client(Integrator/Evaluator 등) 요청을 표준화하고, 목표·가드레일·검수 기준만 정의한 뒤 적절한 기능 에이전트에게 위임.\n   - 비역할: 세부 계획 수립, 파일 조작, 명령 실행, 반복 로직.\n\n2. **Autonomous Deep Coder**  \n   - 목표: Supervisor가 의뢰한 통합/개선 태스크를 자체 루프에서 계획 → 실행(파일 수정, Git ops, 테스트/검증 포함) → 보고까지 전부 처리하는 범용 코딩 능력을 갖춘다.  \n   - 범위: 대부분의 코딩 관련 업무와 git 작업을 하나의 에이전트 안에서 자율 수행하며, 향후 “리빌더”처럼 개선 과제도 동일 능력으로 담당한다.\n   - 분리: Scripter, Analyst 등 다른 기능은 별도 에이전트로 개발할 예정이므로 Coder 스펙에는 포함하지 않는다.\n   - 확장: 동일 아키텍처를 Scripter, Analyst, ReBuilder 등 기능 에이전트에도 재사용할 수 있도록 모듈화.", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "494c5744-4595-4229-902f-1186c436d89f", "content": "   - 지향점: `ref/deepagents-master/libs/deepagents/deepagents/graph.py` 가 제공하는 Deep Agent 패턴(계획·파일시스템·서브에이전트·요약·프롬프트 캐싱)을 FluxLoop 특화 기능과 결합.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "489f00b8-cfe0-4c09-a97b-7fe61c248a7d", "content": "## 3. Supervisor 경량화 전략\n\n| 단계 | 개선 포인트 | 구현 제안 |\n|------|-------------|-----------|\n| S1 | **Client 요청 표준화** | `AgentState`에 `client_request`, `constraints`, `done_definition` 등을 추가하고, `service.py`에서 세션 생성 시 채운다. |\n| S2 | **목표 템플릿화** | `supervisor/prompts.py`를 고정 미션 대신 템플릿으로 재작성. Client 별 YAML/JSON 목표를 읽어 SystemMessage로 구성. |\n| S3 | **라우팅 로직 분리** | `DelegateToCoder` 외에 향후 `DelegateToScripter`, `DelegateToAnalyst` 등 Pydantic 도구를 추가. Node 함수는 단순히 tool call을 감지해 `next`와 sub-agent 식별자만 설정하도록 유지. |\n| S4 | **검수·종료 루틴 확장** | Coder 보고(`coder_report`)를 구조화(JSON: `summary`, `tests`, `diffs`, `follow_ups`)하여 Supervisor가 결과 검증/피드백만 수행하도록 하고, Finish 시에도 동일 스키마를 사용. |", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "f546c537-c1b5-4911-bf16-00280e335b5e", "content": "\nSupervisor는 의도적으로 명령을 실행하지 않으므로, 변경 범위는 `supervisor/node.py`, `supervisor/prompts.py`, `state.py` 정도로 제한될 수 있다.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "fb1f1653-8772-4b60-9eaa-6b3bf2d0350c", "content": "## 4. Coder Deep Agent화 로드맵\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "d286cb05-7cc5-427b-a1e5-fc6a2a3800d5", "content": "### 4.1 내부 아키텍처 재구성\n1. **전용 LangGraph 또는 Middleware 스택**  \n   - `coder/node.py` 내부의 `create_react_agent` 호출을 `deepagents` 유사 구조로 교체.  \n   - 최소 구성: `TodoListMiddleware`, `FilesystemMiddleware`(FluxLoop Sandbox backend), `PatchToolCallsMiddleware`, `SummarizationMiddleware`.\n2. **상태 공유**  \n   - LangGraph nested state 또는 Store를 활용해 TODO, 조사 기록, 실행 로그를 구조화하여 Supervisor와 공유. (예: `coder_state: {plan, artifacts, metrics}`).\n3. **서브루틴(필요 시) 관리**  \n   - `deepagents.middleware.subagents.SubAgentMiddleware` 처럼 Coder 내부에서만 사용할 경량 서브루틴/전용 워커를 붙일 수 있게 해 둔다. 이들은 Coder의 확장된 능력(예: 테스트 러너, 문서 생성 루틴)을 캡슐화하는 용도이다.  ", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "64ee483b-b9db-4f95-b9bc-bc8a27b5eebb", "content": "   - Supervisor가 여러 에이전트에게 업무를 분산하는 문제는 상위 오케스트레이션 단계에서 별도로 다루며, Coder 설계와는 분리한다.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "da30010e-3cfe-4ea3-ac07-76bd94911c65", "content": "### 4.2 도구·플래닝 통합\n1. **Planning 데이터 정규화**  \n   - `.fluxloop/todos.json` 대신 LangGraph state + File Sync(필요 시) 방식으로 전환. Supervisor/TUI/CLI가 동일한 TODO 상태를 구독할 수 있도록 `state.py`에 `plan` 필드 추가.\n2. **도구 표준화**  \n   - Deep Agents와 유사하게 파일/검색/실행 도구의 인터페이스를 통일하고, MCP 전용 도구(`run_integration_workflow`)는 “전략 힌트” 계층으로 분리.\n3. **검증 자동화**  \n   - 각 작업 종료 시 `verify` 스텝을 강제하는 미들웨어 혹은 Prompt 규칙을 적용. 테스트 결과를 구조화하여 Supervisor에 전달.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "b1aaca1e-5f92-4558-89fe-fe219fc58087", "content": "### 4.3 메모리·컨텍스트 관리\n1. **요약/캐싱**  \n   - 거대한 히스토리를 요약해 state에 보존하고, 필요 시만 원본을 읽는 SummarizationMiddleware + PromptCaching을 도입.\n2. **지식 파일화**  \n   - DeepAgents CLI의 `.deepagents/agent.md` 개념을 FluxLoop용 `.fluxloop/agent.md`, `.fluxloop/skills/`로 재구성. Coder는 작업 전 자동으로 이 디렉터리를 검사하고 필요한 지식을 로딩.\n3. **HITL/승인 훅**  \n   - LangGraph interrupt_on 설정을 활용해 위험한 도구(`git_push`, `run_cmd` with destructive ops 등)에 사용자 승인을 걸 수 있게 준비.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "aa18d06c-b754-4e21-996f-d66668a8861a", "content": "## 5. 단계별 실행 계획\n\n1. **Phase A – 기초 확장**\n   - `AgentState` 확장 (`client_request`, `plan`, `artifacts` 등).\n   - Supervisor 템플릿화 + 추가 tool schema 정의.\n   - Coder 결과 스키마 정의(`CoderReport` dataclass/Pydantic).\n2. **Phase B – Coder 내부 Deep Agent화**\n   - Coder용 LangGraph(또는 `create_agent`) 구성 후 기존 ReAct 호출을 대체.\n   - `TodoListMiddleware` / `FilesystemMiddleware` / `SummarizationMiddleware` 도입 및 Sandbox backend 연결.\n   - `.fluxloop/todos.json` 연동 로직을 미들웨어 또는 state-sync 로 치환.\n3. **Phase C – 메모리 & 지식 확장**\n   - Coder 내부에서 필요한 서브루틴(테스트 러너 등)을 SubAgentMiddleware 패턴으로 캡슐화하고, 별개 에이전트(예: Scripter) 설계는 Supervisor 레이어 문서에서 다룬다.", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "8c422116-3e22-4816-92a5-bc273aa7e583", "content": "   - `.fluxloop/agent.md`, `.fluxloop/skills/*` 규약 도입, Skill metadata 파서 작성.\n   - HITL/승인 경로 및 Runner UI 연동.\n4. **Phase D – 멀티 클라이언트 지원**\n   - Integrator/Evaluator 등 각 client 모듈에서 Supervisor API를 호출하도록 정리.\n   - 결과 보고/메트릭을 REST/WS 이벤트로 표준화해 UI·CLI에서 동일하게 소비 가능하게 함.\n\n각 Phase는 독립 배포가 가능하도록 작은 PR 묶음으로 나누고, 특히 Phase B 이후에는 회귀 테스트(샌드박스 통합 테스트) 자동화가 필요하다.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "e30b1229-bb07-43c1-9dc3-e2387c6ee07b", "content": "## 6. DeepAgents 코드에서 가져올 우선순위 아이디어\n\n| 기능 | 참조 위치 | FluxLoop 적용 아이디어 |\n|------|-----------|------------------------|\n| Middleware 체인 | `libs/deepagents/deepagents/graph.py` | Supervisor 밖에서 Coder용 graph를 구성할 때 동일 미들웨어 조합을 템플릿으로 사용. |\n| SubAgentMiddleware | `deepagents/middleware/subagents.py` | Coder 내부에서 필요 시 테스트/분석 서브루틴을 운영하도록 참고. 상위 Supervisor 다중 에이전트 라우팅과는 별도. |\n| AgentMemoryMiddleware | `libs/deepagents-cli/deepagents_cli/agent_memory.py` | `.fluxloop/agent.md` / 프로젝트별 메모리 파일 로딩, 업데이트 규칙을 그대로 차용. |\n| Skills progressive disclosure | `deepagents_cli/skills/` | `.fluxloop/skills/*/SKILL.md` 구조를 도입해 FluxLoop 특화 레시피(예: Runner 설정, 공통 버그 패턴)를 스킬로 제공. |", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "823ee37b-131a-4eab-8348-36e1a772dbdb", "content": "| HITL Middleware | `deepagents-cli/tools.py` + CLI 명령 옵션 | Runner UI/CLI에서 위험 도구 사용 시 승인 플로우를 재현. |\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "1610f097-c8af-449d-b144-d4ada9764670", "content": "## 7. 기대 효과\n\n- Supervisor는 client agnostic 라우터/감독자 역할만 수행하므로 유지보수가 단순해지고, 새로운 client 모듈 추가 시 재사용성이 높아진다.\n- Coder는 Deep Agent 패턴으로 재구성되어 복잡한 FluxLoop 통합/개선 과제를 자율적으로 반복 수행할 수 있으며, 동일 구조로 Scripter/Analyst/Builder 등 기능 에이전트를 빠르게 파생 가능.\n- 플래닝·메모리·HITL·서브에이전트·요약 기능 도입으로 장기 세션 안정성과 UX가 DeepAgents 수준으로 향상된다.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "0fca5da2-36a7-4359-8a96-32aff90300eb", "content": "## 8. 구체적 구현 계획 (DeepAgents 참조)\n\n| 단계 | 구현 내용 | 참조 코드 |\n|------|-----------|-----------|\n| G1 | **Coder 전용 Deep Agent Graph 생성**<br>- 기존 ReAct 구현을 마이그레이션하거나 fallback을 유지하지 않고, DeepAgents 패턴을 기준으로 완전히 새 LangGraph를 작성한다.<br>- `coder/node.py`에서는 새 그래프를 호출하는 thin wrapper만 남기고, Supervisor와 분리된 별도 `StateGraph`가 결과(`coder_report`)만 Supervisor에 반환한다. | `ref/deepagents-master/libs/deepagents/deepagents/graph.py` (`create_deep_agent`) |\n| G2 | **Middleware 스택 이식**<br>- 최소 구성: `TodoListMiddleware`, `FilesystemMiddleware`, `SummarizationMiddleware`, `PatchToolCallsMiddleware`.<br>- FluxLoop Sandbox를 DeepAgents backend 인터페이스(`deepagents/backends/protocol.py`)에 맞춰 어댑트해 `FilesystemMiddleware`가 sandbox 파일 API를 호출하게 한다.<br>- Summarization trigger/keep 정책은 DeepAgents 기본값을 그대로 가져오고, 필요 시 FluxLoop 모델/토큰 한도에 맞춰 조정한다. | `ref/deepagents-master/libs/deepagents/deepagents/middleware/*.py` |", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "21f0452b-6791-4039-a634-345a9365c725", "content": "| G3 | **도구 세트 재구성**<br>- DeepAgents 기본 도구(`ls/read_file/write_file/edit_file/glob/grep/execute`)와 FluxLoop 특화 도구(`run_cmd`, `run_integration_workflow`, Git ops 등)를 하나의 Tool Registry로 정리한다.<br>- 도구 시그니처는 LangChain `BaseTool` 규격을 유지하되, DeepAgents가 기대하는 설명/에러 패턴을 맞춘다. | `ref/deepagents-master/libs/deepagents/deepagents/backends/filesystem.py`, `ref/deepagents-master/libs/deepagents-cli/deepagents_cli/tools.py` |\n| G4 | **Planning 데이터 통합**<br>- `TodoListMiddleware`가 사용하는 todo 상태를 FluxLoop `.fluxloop/todos.json`과 동기화하도록 Hook을 추가한다.<br>- LangGraph state에도 동일 데이터를 보관해 Supervisor/UI가 실시간으로 조회할 수 있도록 한다. | `ref/deepagents-master/libs/deepagents/deepagents/graph.py` (middleware 첨부 부분) |", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "951f2c88-358b-4118-ac3a-2d9a225f6774", "content": "| G5 | **검증·보고 스키마 확장**<br>- DeepAgents 기본 에이전트처럼 마지막 메시지를 구조화해 `summary/tests/diffs/follow_ups`를 포함한 `CoderReport` Pydantic 모델로 정리한다.<br>- 그래프 종료 시 해당 모델을 LangGraph state에 저장하고 Supervisor로 전달한다. | `ref/deepagents-master/libs/deepagents/deepagents/graph.py` (`BASE_AGENT_PROMPT` 이후 response flow) |\n| G6 | **서브루틴/워커 캡슐화**<br>- 필요 시 Coder 내부 전용 서브루틴(예: 테스트 실행기, 문서 생성기)을 `SubAgentMiddleware` 기반으로 붙인다.<br>- FluxLoop 특화 서브루틴도 동일 방식으로 추가 가능하게 템플릿화한다. | `ref/deepagents-master/libs/deepagents/deepagents/middleware/subagents.py` |", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "b5f7e964-b598-4a08-be58-0b4d86a15e65", "content": "| G7 | **메모리·스킬 시스템 접목**<br>- DeepAgents CLI의 `AgentMemoryMiddleware`를 참고하여 `.fluxloop/agent.md`, `.fluxloop/skills/*`를 자동 로딩/업데이트하는 절차를 작성한다.<br>- Skill metadata 파서와 progressive disclosure 흐름(`skills/load.py`)을 FluxLoop 프로젝트 구조에 맞게 변환한다. | `ref/deepagents-master/libs/deepagents-cli/deepagents_cli/agent_memory.py`, `deepagents_cli/skills/*` |\n| G8 | **HITL/승인 및 Sandbox 통합**<br>- DeepAgents CLI가 제공하는 HITL 플로우(`--auto-approve`)를 Runner UI에 맞게 매핑해, 위험 도구 실행 시 Interrupt hook을 제공한다.<br>- Remote sandbox(Modal/Runloop 등) 지원이 필요하면 CLI의 `integrations/sandbox_factory.py` 패턴을 참고해 FluxLoop Runner에 맞는 Selector를 구현한다. | `ref/deepagents-master/libs/deepagents-cli/deepagents_cli/commands.py`, `integrations/*.py` |", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "029f07e6-27aa-4bed-9ee1-ced76c0183f5", "content": "\n상기 단계를 순차적으로 적용하면, Coder는 DeepAgents 아키텍처를 실질적으로 내재화한 범용 Autonomous 코드 에이전트로 재탄생하며, Supervisor/기타 기능 에이전트 논의는 별도의 상위 문서에서 독립적으로 다룰 수 있다.\n\n---\n\n이 문서를 기준으로 Roadmap 이슈나 PR을 분할하면, Supervisor와 Coder가 “얇은 orchestration + 깊은 실행” 구조로 자연스럽게 진화할 수 있다.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 21, "total_chunks": null}}
{"id": "fd23717b-af83-43bf-9ed7-1c599f2cb637", "content": "### 6.1 진행 현황 (2025-11-29 기준)\n\n- **G1 – 전용 Deep Agent 그래프**: `coder/node.py`가 ReAct 호출 대신 `build_coder_agent_graph`를 감싼 래퍼로 축소되었고, 내부 LangGraph(`coder/graph.py`)가 독립적으로 상태를 관리한다.\n- **G2 – Middleware 스택**: `coder/middleware.py`에 `TodoListMiddleware`, `FluxLoopContextMiddleware`, `SummarizationMiddleware`, `PatchToolCallsMiddleware` 조합이 이식되어 기본 DeepAgent 구성이 갖춰졌다.\n- **G3 – 도구 세트**: `tools/__init__.py`가 툴 레지스트리를 정규화하고 `execute`, `run_pytest`, `write_file`, `edit_file` 등 DeepAgents 호환 명칭으로 정리되었다.\n- **G4 – Planning 데이터**: `PlanTracker`와 `.fluxloop/todos.json` 싱크, LangGraph `state[\"plan\"]` 반영, UI 스트리밍까지 완료되어 Supervisor와 Integrator UI가 동일한 TODO 상태를 본다.", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 22, "total_chunks": null}}
{"id": "51be50d7-cad5-40ce-8dd3-e12007db05be", "content": "- **G5 – 보고 스키마**: `coder/report.py`, `coder/usage.py`, `service.py` 파이프라인이 구조화된 `CoderReport` (`summary/tests/diffs/follow_ups/verification/raw_messages`)를 Supervisor·UI로 전달한다.\n- **G6 – 서브루틴/워커**: `SubAgentMiddleware`와 `coder/subagents.py`가 연결되어 `test-runner`, `doc-writer` 워커를 즉시 호출할 수 있고, 동일 패턴으로 신규 워커를 추가할 수 있다.\n- **G7 – 메모리·스킬**: `.fluxloop_user/agent.md` / `.fluxloop/agent.md` / `skills/` 경로를 자동 동기화하고, 전용 Memory/Skills 미들웨어가 시스템 프롬프트에 글로벌/프로젝트 컨텍스트를 주입한다.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 23, "total_chunks": null}}
{"id": "0e0d6357-1a67-4021-b6ff-df9cf5821639", "content": "### 6.2 G6 서브루틴/워커 캡슐화\n\n- `langchain.agents.middleware.subagents.SubAgentMiddleware`를 Coder 그래프에 추가해 `task` 툴 기반의 서브루틴을 기동할 수 있다.\n- `coder/subagents.py`에 `test-runner`, `doc-writer` 기본 워커 스펙을 정의했고, 동일 패턴으로 FluxLoop 특화 워커를 쉽게 확장할 수 있다.\n- `TASK_TOOL_PROMPT`는 서브루틴 사용 시나리오, 전달해야 할 문맥, 병렬 수행 권장을 명시하여 Supervisor가 아닌 Coder 내부에서 다단계 작업을 캡슐화하도록 유도한다.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 24, "total_chunks": null}}
{"id": "c338f2b7-fe75-409a-bdd6-035017e8d980", "content": "### 6.3 G7 메모리·스킬 시스템\n\n- Runner가 샌드박스를 준비할 때마다 호스트 전역 디렉터리(`$FLUXLOOP_USER_HOME`, 기본 `~/.fluxloop`)를 `.fluxloop_user/`로 동기화하고, 세션 종료 시 다시 반영한다.\n- Coder 프롬프트에 “Memory & Skills” 섹션을 추가하여 글로벌(`.fluxloop_user/agent.md`, `.fluxloop_user/skills/*`)과 프로젝트(`.fluxloop/agent.md`, `.fluxloop/skills/*`) 경로를 명시한다.\n- `FluxLoopAgentMemoryMiddleware` / `FluxLoopSkillsMiddleware`가 LangGraph state에 메모리·스킬 스냅샷을 저장하고 시스템 프롬프트에 주입해, 세션마다 최신 지식을 로딩한다.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 25, "total_chunks": null}}
{"id": "83ce20b1-014d-4588-b06a-0ae4ec6e039c", "content": "### 6.4 G8 HITL/승인 통합 (진행 중)\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 26, "total_chunks": null}}
{"id": "352e534c-0826-4f6d-9083-b0f4ce384ff5", "content": "#### 위험 액션 분류\n- **파일 시스템**: 대규모 삭제, `write_file`/`edit_file`로 바이너리 덮어쓰기, secrets 노출 여부 등을 `ActionRequest.description`에 포함.\n- **Git**: `git_push`, `git_reset`, `git_rebase` 등은 무조건 승인 필요. `git_commit`은 기본 auto-ok, 단 `--amend`는 승인을 요구.\n- **Shell/Execute**: `execute(\"rm -rf ...\")`, `docker push`, 외부 네트워크 호출 등 패턴 매칭으로 승인 필요. 허용 리스트(테스트, lint)는 auto-pass.\n- **SubAgents/Tasks**: `task` 도구에서 long-running subagent를 띄우는 경우에도 동일 정책을 상속. SubAgentMiddleware에 동일 Interrupt config를 주입한다.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 27, "total_chunks": null}}
{"id": "41d4a460-1d6a-4f50-ac19-50f435ffe7ad", "content": "#### 미들웨어/그래프 설계\n- `FluxLoopApprovalMiddleware` (LangChain `HumanInTheLoopMiddleware` 확장) 추가:\n  - `interrupt_on` 맵을 통해 툴 이름/패턴별로 `ActionRequest`를 발행.\n  - `FileOpTracker` 스타일의 preview builder를 차용해 diff/command snippet을 포함한 요청 payload 생성.\n  - Supervisor, Coder, SubAgent 노드 모두 동일 정책을 공유하도록 `build_coder_middleware_stack`와 향후 Supervisor graph에 주입.\n- Interrupt 발생 시 LangGraph는 `Command(pause=True)` 상태가 되고, Runner가 승인 응답을 push할 때까지 대기.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 28, "total_chunks": null}}
{"id": "2bd6f0de-d08b-4b33-858e-26e828d17549", "content": "#### Runner/Frontend 흐름\n1. **AgentService → Runner**: `_normalize_event`가 interrupt 감지 시 `{\"type\": \"hitl_request\", \"id\": ..., \"payload\": ...}` 이벤트를 SSE로 방출.\n2. **UI 표시**: IntegratorPanel이 요청 내용을 렌더링하고 Approve/Reject 버튼, Auto-approve toggle 제공.\n3. **응답 전달**:\n   - UI는 `/api/.../agent/hitl` (신규 엔드포인트)로 `{decision, request_id}`를 POST.\n   - Runner는 해당 세션의 `cancel_event`/`interrupt` queue에 `Decision` 객체를 push하여 LangGraph 실행을 재개.\n4. **자동 승인 플래그**: CLI/Runner 설정(`autoApproveDangerousOps: true`) 시 특정 카테고리 자동 승인. 설정은 AgentService에 `configurable` 값으로 전달.", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 29, "total_chunks": null}}
{"id": "8cf81e64-526f-4848-96f6-f9e074447c25", "content": "#### 추가 고려 사항\n- **Timeout**: 승인 대기 최대 N분. 초과 시 자동 취소 혹은 fallback 정책.\n- **Audit Log**: 승인 요청·결과를 Supabase `integrator_run_events`에 저장하여 추후 재현 가능.\n- **Remote Sandbox**: Modal/Runloop 같은 외부 실행기도 동일 Approval hook을 지원하려면 `sandbox_factory` 패턴을 차용, 승인 대기 중에는 작업자 VM을 유지하되 추가 비용 모니터링.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan.md", "chunk_index": 31, "total_chunks": null}}
{"id": "58a23ec7-709d-4fb7-b092-bf61b449c999", "content": "# FluxLoop Coder Agent Evolution Plan – v2\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 0, "total_chunks": null}}
{"id": "081dd626-f40a-4b85-98ca-9e002966b039", "content": "## 0. 작성 배경\n- **Phase A~C (v1)**: 전용 LangGraph, DeepAgent형 미들웨어, 플랜/보고/서브에이전트, 메모리·스킬·HITL 설계가 완료되었고 Supabase 기반 장기 상태 동기화도 Phase 3까지 마무리됨.\n- **현 시점 과제**: DeepAgents CLI 대비 남은 격차(백엔드 추상화, 프롬프트/지식 주입, stateful resume, UI/스토어 일원화)를 해소해 “장시간/재개 가능한” 완전 자율 코더를 완성해야 함.\n- **v2 목표**: AgentService·Runner·Coder 그래프 전반을 재정렬하여 FluxLoop 전용 Deep Agent 레퍼런스를 만들고, Integrator/향후 기능 에이전트가 동일 스택을 공유하도록 토대를 구축.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 1, "total_chunks": null}}
{"id": "96667599-1b41-45f4-9ff9-94d77a71da7a", "content": "## 1. 핵심 원칙\n1. **Store-first**: 모든 장기 상태(메모리·스킬·플랜·아티팩트)는 Supabase Store API를 통해서만 접근한다. Executor나 AgentService는 로컬 캐시만 다루고, 원천 데이터는 Store가 단독 책임.\n2. **Backend parity**: 파일/커맨드 도구는 DeepAgents `FilesystemMiddleware` 모델과 호환되는 FluxLoop Backend를 통해 제공한다. LangGraph state는 항상 동일 백엔드 스키마를 가정한다.\n3. **Stateful autonomy**: Coder 그래프는 `plan / artifacts / verification / memory_snapshots / hitl_requests` 등을 LangGraph state와 Checkpointer에 저장해, 중단·재개·서브루틴 간 정보 손실이 없다.\n4. **Prompt unification**: 기본 시스템 프롬프트와 Memory/Skills 주입 규칙을 DeepAgents CLI 수준으로 통일하되, FluxLoop 전용 지식 구조(`.agent/*.md`, `skills/*`, MCP 안내)를 포함한다.", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 2, "total_chunks": null}}
{"id": "f500e951-cf7a-4f74-95c2-f39939f3996d", "content": "5. **Shared observability**: 모든 이벤트는 `agent_sessions / agent_events` 테이블과 SSE 스트림으로 흘러가며, Integrator·Runner UI·CLI는 동일한 세션 ID를 구독한다.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 3, "total_chunks": null}}
{"id": "2b986753-18ee-408d-912e-872e2f3104e2", "content": "## 2. 아키텍처 개편안", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 4, "total_chunks": null}}
{"id": "24590732-a7c2-4157-8795-4352371a4a37", "content": "### 2.1 Store & Executor 경계 정리\n| 레이어 | 역할 | 변경 사항 |\n|--------|------|-----------|\n| **AgentPersistenceStore** | Supabase ↔ 호스트 캐시 동기화 | Phase 3 확장: plan 외에 artifacts(패치, 로그), HITL 기록까지 저장. Dirty 플래그 관리. AgentService/Runner가 Store API를 호출하고, Executor는 준비된 캐시 경로만 소비. |\n| **WorkspaceContext** | 실행 컨테이너 추상화 | `host_cache_path`, `agent_store_refs` 필드 추가. Executor는 이 경로만 조작하고 Store 구현을 알 필요가 없다. |\n| **FluxLoopBackend (신규)** | LangChain FilesystemBackend 호환 어댑터 | SandboxExecutor API를 감싸 DeepAgents middleware에 필요한 `ls/read/write/edit/glob/grep/execute` 인터페이스 제공. |", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 5, "total_chunks": null}}
{"id": "31b96adb-7604-454e-a157-9a8c850676ee", "content": "### 2.2 LangGraph & State\n```\nCoderAgentState {\n  version: int,\n  messages +=,\n  plan: Annotated[List[TodoItem], overwrite],\n  artifacts: Annotated[List[ArtifactSummary], concat],\n  verification: Annotated[List[TestResult], concat],\n  memory_snapshot: Optional[MemoryBundle],\n  hitl_requests: Annotated[List[HitlRecord], concat],\n}\n```\n- Checkpointer: MemorySaver → Supabase-backed Checkpointer로 교체 (LangGraph Store API 사용) 및 state version 필드로 호환성 관리.\n- Supervisor ↔ Coder 인터페이스: `coder_report` 외에 `state_checkpoint_id`를 함께 전달해 UI/Runner가 언제든 재개 가능. 구 버전 state는 version 비교로 gracefully 종료/마이그레이션.", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 7, "total_chunks": null}}
{"id": "09448c63-5aa3-427a-967d-ea11dbaa91bb", "content": "### 2.3 Prompt & Knowledge Flow\n1. **Base Prompt 템플릿**: `CODER_SYSTEM_PROMPT`를 DeepAgents `default_agent_prompt.md` 스타일로 재작성 (Memory-first, Todo 규칙, Subagent 사용법 포함).\n2. **Memory/Skills Middleware**: `.agent/*.md` + `.deepagents` 규약을 통합 소개. 사용자/프로젝트/글로벌 경로를 모두 명시.\n3. **FluxLoop Context Section**: Sandbox 규율 + MCP/Runner 도구 안내 + Integrator 요구사항을 별도 섹션으로 주입.\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 9, "total_chunks": null}}
{"id": "096c048b-5135-4f68-be24-56c49d5a60ae", "content": "## 3. 단계별 실행 (Evolution v2)\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 10, "total_chunks": null}}
{"id": "42c53c55-c184-439d-ac22-b8f553cc359e", "content": "### P0. Store-first 리팩터링\n- `_build_memory_configs` 폐기 → AgentService는 `AgentPersistenceStore.prepare_workspace()` 반환값만 사용.\n- Executor/Runner가 세션 시작 시 호출하는 Store API를 표준화(`prepare_session`, `finalize_session`, `mark_dirty`).\n- `PlanTracker`, Memory/Skills middleware가 Store 참조를 통해 최신 스냅샷을 lazy-load하도록 수정.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 11, "total_chunks": null}}
{"id": "c401e4f1-0549-4a08-990f-8e04e0779eab", "content": "### P1. FluxLoop Backend & Middleware 호환\n1. `FluxLoopSandboxBackend` (FilesystemBackend 하위) 구현:\n   - 내부적으로 `SandboxExecutor` 호출, 경로 검증/절대경로 변환 포함.\n   - 대용량 tool 결과를 `/large_tool_results`에 evict.\n2. `build_coder_middleware_stack`에서 기존 custom tools 대신 DeepAgents-style FilesystemMiddleware 제공.\n3. SubAgentMiddleware 기본 툴셋도 동일 backend를 공유하도록 정리.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 12, "total_chunks": null}}
{"id": "dcc5cbb8-ad2d-428e-a75e-3b5ae69ffae2", "content": "### P2. LangGraph State 확장\n- `CoderAgentState` 스키마 업데이트 → TodoListMiddleware / PlanTracker / UsageRecorder가 state 필드에 직접 쓰도록 변경.\n- `CoderReport` 생성 시 state 기반으로 summary 구성(별도 aggregator).  \n- HITL 재개: state에 `interrupted_tool_call` 정보를 남겨 Decision 수신 시 재주입.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 13, "total_chunks": null}}
{"id": "56985d92-4f98-4fda-bfb3-9f30fd9c68fc", "content": "### P3. Prompt & Knowledge 통합\n- 새로운 `coder/prompts_v2.py`에 베이스 템플릿 정의:\n  - Memory-first, Todo 규칙, Subagent 지침, HITL 행동, verification 체계 포함.\n  - `.agent` 파일과 DeepAgents default prompt 내용을 병합.\n- Memory/Skills middleware는 해당 템플릿의 “Memory & Skills” 섹션을 덮어쓰는 형태로 주입.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 14, "total_chunks": null}}
{"id": "710bc261-7920-4ce3-9300-f129da24cbd2", "content": "### P4. Observability & HITL 강화\n- `_normalize_event`가 LangGraph state snapshot ID를 이벤트마다 포함 → UI가 특정 시점 상태를 조회 가능.\n- `build_interrupt_config` → DeepAgents `_add_interrupt_on` 수준으로 확장 (shell, web_search, fetch_url, task 등).\n- Supabase `agent_events`에 구조화된 payload(명령/경로/exit code/diff preview/duration 등)와 HITL 요청/응답을 저장하고, Runner UI는 해당 스키마를 단계적으로 소비(feature flag 지원).\n\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 15, "total_chunks": null}}
{"id": "4bf3a422-cbdb-4a7a-b0c9-ce4f732429e9", "content": "## 4. 리스크 & 완화\n| 리스크 | 영향 | 대응 |\n|--------|------|------|\n| Store-first 전환으로 기존 `.fluxloop_user` 경로가 사라질 때 호환성 이슈 | 이전 세션 데이터 손실 | Store 마이그레이션 스크립트 + 구 버전 경로를 읽어 one-time sync. |\n| FluxLoopBackend 도입 시 도구 시그니처 변경 | 기존 Supervisor/테스트 영향 | `tools/__init__.py`에서 래퍼 클래스를 유지해 외부 호출은 동일하도록 어댑터 제공. |\n| LangGraph state 확장으로 모델 컨텍스트 증가 및 스키마 호환성 문제 | 토큰 비용 증가 / 기존 체크포인트 무효화 | SummarizationMiddleware trigger 조정(keep messages 4), plan/artifact는 별도 store 레퍼런스만 저장. `state.version` 비교로 구 버전 세션은 안전 종료/마이그레이션. |\n| HITL payload 확대 시 UI 변경 필요 | UI 릴리즈 지연 | `agent_events` 스키마 변경을 feature flag로 감싸고, Runner UI는 단계적으로 필드를 소비. |", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 16, "total_chunks": null}}
{"id": "80550fe5-4227-4750-8e59-e5576363f84c", "content": "\n---\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 17, "total_chunks": null}}
{"id": "ab17d57c-aa12-444f-acdc-793242a7b0dd", "content": "## 5. 마일스톤 & 기대효과\n| 단계 | 산출물 | 완료 기준 |\n|------|--------|-----------|\n| M1 (P0~P1) | Store-first AgentService, FluxLoopBackend | Supabase store만으로 세션 준비/종료 가능, DeepAgents middleware 호환 |\n| M2 (P2~P3) | Stateful Graph + Prompt v2 | 중단 후 state 재개 가능, 프롬프트/Memory 지침 통일 |\n| M3 (P4~P5) | HITL/Observability 확장 + 확장 도구 | Runner/UI가 공통 이벤트 소비, SubAgent/도구 파리티 확보 |\n\n**기대 효과**  \n- Coder가 DeepAgents CLI와 동급의 장기 작업·재개 능력을 갖추고, Integrator/향후 기능 에이전트가 동일 인프라를 공유.  \n- Supabase 기반 단일 진실 공급원 덕분에 멀티 러너/컨테이너 환경에서도 일관된 메모리·스킬·플랜 경험 제공.  ", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 18, "total_chunks": null}}
{"id": "f47526aa-c3e6-49f9-9ea3-ea7c4b6094e7", "content": "- Prompt/도구 규약이 통일되어 FluxLoop만의 “Deep Agent 템플릿”을 재사용 가능.\n", "metadata": {"source": "docs/prd/web/coder/evolution_plan_v2.md", "chunk_index": 19, "total_chunks": null}}
{"id": "5a733048-dace-4a4e-8ab6-3c82f7f4cb72", "content": "# Deep Agent 개선점 #1: Git 워크플로우 및 SDK 통합 강화\n", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 0, "total_chunks": null}}
{"id": "bdf15046-5c26-46d6-a6c3-43b4c5bf2509", "content": "## 1. 배경\nPhase 2.5 아키텍처 전환 후, Coder Deep Agent는 Plan 수립 및 실행, 검증 루프를 성공적으로 수행하고 있다. 그러나 실제 프로덕션 수준의 통합을 위해서는 **Git 브랜치/커밋 강제**와 **FluxLoop SDK/Runner 지식 획득** 프로세스의 보완이 필요하다.\n", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 1, "total_chunks": null}}
{"id": "2e2a384d-137a-4a36-8546-cf381bfeaa4d", "content": "## 2. 문제점 분석\n", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 2, "total_chunks": null}}
{"id": "9a356dff-9813-4f6c-a9d5-3f1453ad31d3", "content": "### 2.1 Git 워크플로우 미비\n- **브랜치 누락**: 에이전트가 작업을 시작하기 전 `create_branch`를 수행하지 않고 `main` 브랜치에서 직접 작업을 시도할 위험이 있다.\n- **커밋/푸시 부재**: 모든 파일 수정과 테스트가 완료되었음에도 `git status`만 확인하고 `git add/commit/push`를 수행하지 않은 채 작업을 종료하는 경향이 있다.\n- **권한/토큰 제약 불명확**: 기존에는 봇용 `git config`나 PAT 주입을 가정했으나, 실제 요구사항은 **기존(main/dev) 브랜치는 읽기 전용**으로 두고 **새 실험용 브랜치에서만 push** 할 수 있어야 한다. GitHub OAuth 로그인만으로 카나리아 브랜치 push 권한을 위임하려면 GitHub App 기반 설치 토큰이 필요하다.\n", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 3, "total_chunks": null}}
{"id": "963760d0-3f52-43e8-b845-07ac44d64006", "content": "### 2.2 SDK 통합 지식 부족\n- **설치/설정 가이드 부재**: 에이전트가 `pip install fluxloop` 등의 기본 명령은 수행하지만, 최신 FluxLoop Runner 설정이나 SDK 사용법에 대한 지식이 내재화되어 있지 않다.\n- **MCP 활용 미흡**: 최신 문서를 조회하기 위한 MCP(Model Context Protocol) 도구가 연결되어 있으나, 이를 적극적으로 활용하여 정확한 통합 가이드를 따르지 않고 일반적인 지식에 의존한다.\n", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 4, "total_chunks": null}}
{"id": "78f5af39-95c8-4321-8717-6c98e2f99bb0", "content": "## 3. 개선 계획\n", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 5, "total_chunks": null}}
{"id": "955e11ce-02b5-4a58-8ac0-83a9bd3fa72e", "content": "### 3.1 Git 워크플로우 강화 (가드레일)\n1. **초기 제약 조건(Constraints) 추가**:\n   - `AgentService`에서 초기 `constraints` 주입 시, **\"작업 시작 전 반드시 새 브랜치를 생성하라\"**와 **\"모든 변경사항은 커밋되어야 한다\"**를 명시한다.\n2. **Supervisor 피드백 루프 보강**:\n   - `SupervisorNode`가 `pending_items` 완료 후에도 `git status`가 clean하지 않거나 현재 브랜치가 `main`인 경우, 종료를 거부하고 Git 작업을 지시하도록 프롬프트를 수정한다.\n3. **GitHub App 기반 인증·권한 모델**:\n   - 사용자에게 추가 토큰 입력을 요구하지 않고, **GitHub OAuth + FluxLoop GitHub App 설치**만으로 레포 접근을 위임한다. OAuth는 유저 식별/프로젝트 선택에만 사용하고, 실제 git 작업은 설치 ID로부터 발급한 **installation access token**으로 수행한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 6, "total_chunks": null}}
{"id": "a9497b7b-8c91-4f99-adbb-ec5dd5d2d1ee", "content": "   - GitHub App 권한은 `Contents: Read-only`, `Metadata: Read-only`, (선택) `Pull requests: Read & Write`로 제한한다. GitHub의 권한 모델 특성상 기존 브랜치(main/dev 등)는 자동으로 쓰기 차단되지만, 새 브랜치 생성 및 push는 허용되어 **“FluxLoop 실험용 브랜치만 수정”** 요구사항을 충족한다.\n   - 저장소에는 브랜치 보호 규칙을 적용해 `main`, `dev`, `release/*` 등 기존 브랜치를 강제 read-only로 두고, AgentService는 항상 `fluxloop/<project>-<run_id>` 형태의 새 브랜치를 생성·checkout·push 하도록 강제한다.\n   - 실행 흐름:\n     1. 사용자가 OAuth로 로그인 후, UI에서 타깃 repo에 FluxLoop GitHub App을 설치(installation ID 확보).\n     2. Integrator/Runner는 installation ID로 `POST /app/installations/{id}/access_tokens`를 호출해 단기 토큰을 발급받고, 해당 토큰을 sandbox git remote 자격증명으로 주입한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 7, "total_chunks": null}}
{"id": "a2b89dc0-a6e3-4903-90ff-85e428880817", "content": "     3. AgentService는 `create_branch` → 작업 → `git_commit` → `git_push`를 항상 새 브랜치(`fluxloop/experiment-{timestamp}` 등) 이름으로 실행하고, 기존 브랜치에 대한 push 시도는 브랜치 보호 정책에 의해 차단된다.\n   - **FluxLoop UI 온보딩 플로우(Install & Authorize 통합)**:\n     0. **[전제 조건]**: Supabase Auth의 GitHub Provider 설정에 **OAuth App 대신 GitHub App의 Client ID/Secret**을 등록해야 한다. (GitHub App이 로그인과 설치를 모두 담당)\n     1. 프로젝트 생성/레포 선택 화면에서 “GitHub 연결” 클릭 시 `https://github.com/apps/fluxloop/installations/new?state=<csrf>` 로 리다이렉트한다. GitHub App 설정에서 “Request user authorization during installation” 옵션을 켜야 한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 8, "total_chunks": null}}
{"id": "7fe866f7-1984-42bc-8ee7-bc8a43575a1f", "content": "     2. GitHub 완료 후 콜백(`https://app.fluxloop.ai/github/callback?code=...&installation_id=...&setup_action=install&state=...`)을 받으면 `state`를 검증하고 `code`로 user access token을 교환한다.\n     3. `GET /user/installations` API를 user token으로 호출해 콜백에 포함된 `installation_id`가 실제 해당 사용자에게 속하는지 확인한다. 유효할 경우 `installation_id`, 연결된 repo metadata, user-id를 DB에 저장한다.\n     4. Runner가 작업을 시작할 때마다 저장된 `installation_id`로 `POST /app/installations/{id}/access_tokens`를 호출해 단기 installation token을 얻고, sandbox git remote 자격증명(HTTPS token 또는 `x-access-token:<token>`)으로 주입한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 9, "total_chunks": null}}
{"id": "041febf1-46d5-40bd-9727-df1a093d4243", "content": "     5. 설치가 이미 완료된 사용자는 먼저 OAuth만 수행해 user token을 확보하고, `GET /user/installations` 결과에 대상 repo가 없으면 다시 설치 URL로 안내한다. 이후 단계는 동일하게 installation ID 검증 → 저장 → token 발급 흐름을 재사용한다.\n   - **에이전트 실행 시 토큰 활용 흐름**:\n     1. Runner는 LangGraph 세션을 시작하기 직전에 installation ID로 새 access token을 발급하고, 만료 시각을 세션 메타데이터에 저장한다(필요 시 자동 재발급).\n     2. `GitService` 혹은 sandbox `Executor` 초기화 시, remote URL을 `https://x-access-token:{token}@github.com/<owner>/<repo>.git` 로 설정하고 `git config user.name/email` 을 FluxLoop 봇 계정으로 고정한다.\n     3. AgentService가 워크스페이스를 준비하면서 GitService를 통해 repo를 clone/checkout 하므로, Coder 에이전트가 사용하는 `create_branch`, `git_commit`, `git_push` 툴은 추가 인증 없이도 브랜치 생성/커밋/푸시가 가능하다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 10, "total_chunks": null}}
{"id": "2e800eb8-a424-45ea-b349-7c291a39edac", "content": "     4. 장기 실행 중 토큰이 만료되면 Runner가 새 토큰을 발급해 GitService에 재주입하고, 필요 시 `git remote set-url origin ...` 으로 교체한다.\n4. **Working Branch 지속성 및 재사용**:\n   - **데이터 모델 변경**:\n     - `projects` 테이블에 `active_branch text`, `active_branch_sha text`, `active_branch_updated_at timestamptz` 컬럼을 추가한다.\n     - `integrator_runs` 또는 `agent_sessions` 종료 시 해당 필드를 갱신하는 로직을 Runner에 추가한다.\n   - **저장 시점**:\n     - 에이전트가 `git_push`를 성공적으로 수행하면 Runner/AgentService가 프로젝트 메타데이터에 `active_branch = <branch_name>`, `active_branch_sha = <HEAD>`, `active_branch_updated_at = now()`를 기록한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 11, "total_chunks": null}}
{"id": "166310b8-3375-4953-beac-d46ae5431466", "content": "     - 세션이 비정상 종료(취소, 실패)되어도 마지막으로 push된 브랜치 정보는 유지한다.\n   - **재진입 로직** (Runner `run_autonomous_integrator` / `AgentService.run_agent_loop_stream`):\n     1. 새 세션 시작 시 프로젝트 메타데이터에서 `active_branch`를 읽는다.\n     2. `active_branch`가 존재하면 GitService를 통해 `git ls-remote origin <branch>`로 원격에 브랜치가 남아 있는지 확인한다.\n     3. 브랜치가 존재하고 `active_branch_sha`와 원격 HEAD가 일치하면 해당 브랜치를 checkout 하고 기존 TODO/Plan을 `AgentPersistenceStore`에서 복원한다.\n     4. 브랜치가 삭제되었거나 merge되어 `main`에 포함된 경우, 또는 원격 HEAD가 달라 충돌이 예상되면 새 브랜치(`fluxloop/<project>-<new_run_id>`)를 생성하고 `active_branch`를 갱신한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 12, "total_chunks": null}}
{"id": "dafb42f1-2892-4069-8623-0607efcb5caa", "content": "   - **Supervisor/Constraints 지침 추가**:\n     - `DEFAULT_GIT_CONSTRAINTS`에 \"기존 활성 브랜치가 제공되면 해당 브랜치에서 이어서 작업하라. 브랜치가 stale하거나 충돌이 발생하면 새 브랜치를 만들어 작업을 계속하라.\"를 추가한다.\n   - **완료 시 초기화**:\n     - 사용자가 UI에서 \"작업 완료\" 또는 \"PR 생성 완료\"를 선언하면 백엔드 API가 `projects.active_branch`를 `NULL`로 갱신한다.\n     - Supervisor가 `Finish`를 호출하며 `status=merged` 또는 `status=pr_created`를 반환하면 Runner가 자동으로 `active_branch`를 초기화한다.\n   - **UX 흐름 요약**:\n     | 상황 | 동작 |\n     |------|------|\n     | 신규 프로젝트 또는 `active_branch=NULL` | `main`에서 새 브랜치 생성 후 작업 |\n     | `active_branch` 존재 & 원격에 유효 | 해당 브랜치 checkout, TODO 복원, 이어서 작업 |", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 13, "total_chunks": null}}
{"id": "1964da51-57dc-4892-9df7-398836792966", "content": "     | `active_branch` 존재 & 원격에서 삭제/merge됨 | 새 브랜치 생성, `active_branch` 갱신 |\n     | 작업 완료(PR merge 등) | `active_branch=NULL`로 초기화, 다음 세션은 `main`에서 시작 |\n", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 14, "total_chunks": null}}
{"id": "f2dff651-6763-4a5c-b510-7727530066d4", "content": "### 3.2 SDK/Runner 통합 지능화 (MCP 연동)\n1. **Integrator/Directive 기반 특수 지시 분리**:\n   - MCP를 통한 FluxLoop/SaaS 통합과 같은 도메인 특화 지식은 Integrator(상위 orchestrator)가 추가 directive나 constraints로 전달하도록 분리한다. Coder 프롬프트는 일반적인 Git/코딩 규칙에 집중시키고, FluxLoop 관련 요구 사항은 Integrator가 명시적으로 주입한다.\n2. **MCP 도구 우선순위 상향**:\n   - FluxLoop 통합을 요청받은 경우, Integrator가 **“`search_mcp_docs`를 사용해 최신 Runner/SDK 가이드를 확인하라”**는 문구를 directive에 포함한다.\n3. **지식 기반 TODO 생성**:\n   - Integrator directive에 따라 초기 Plan에 “Consult MCP for FluxLoop runner setup”과 같은 특수 TODO를 자동으로 포함시키고, Supervisor가 해당 항목이 완료되었는지 확인한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 15, "total_chunks": null}}
{"id": "75f575ee-21b9-48a4-b3b0-ac6ec9599b21", "content": "4. **기본 가상환경 & MCP 패키지 부트스트랩**:\n   - MCP를 호출해야 하는 작업이라면 Integrator가 첫 단계에서 “`python3 -m venv .venv && source .venv/bin/activate` 후 `pip install --upgrade pip`”를 수행하라는 지시를 명시한다. 기존 `.venv`가 존재하면 재활용하되, 없는 경우 새로 생성하도록 요구한다.\n   - 같은 directive 안에서 `pip install -U fluxloop fluxloop-cli fluxloop-mcp` 패키지 설치를 필수 TODO로 추가하고, 설치가 끝나면 `fluxloop --version` 혹은 `python -c \"import fluxloop\"` 검사로 검증하게 한다.\n   - Integrator는 Runner 세션 메타데이터에 “SDK 설치 완료” 플래그를 기록해 중복 설치를 피하되, MCP가 동작하지 않으면 재설치를 시도하도록 조건부 지시를 포함한다.\n   - 이렇게 표준화된 부트스트랩 절차를 통해 에이전트가 MCP와 FluxLoop SDK 지침을 실행하기 위한 동일한 실행 환경을 항상 확보한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 16, "total_chunks": null}}
{"id": "1d6bf3c3-d9a4-41b0-8145-7a02f9be5478", "content": "## 4. 이행 가이드 (Next Steps)\n1. `services/web/backend/app/services/agent/service.py`: 초기 `constraints`에 Git 규칙 추가.\n2. `services/web/backend/app/services/agent/supervisor/prompts.py`: Supervisor가 Git 상태를 점검하도록 프롬프트 보강.\n3. `services/web/backend/app/services/agent/coder/prompts.py`: MCP 도구 활용 지침 추가.\n   - Coder 시스템 프롬프트에는 MCP 도구 존재 여부, 사용 우선순위(FluxLoop runner/SDK 관련 작업 시 반드시 호출), 대용량 문서 조회 시 페이징 규칙 등을 “기본 운영 규칙”으로 명시한다.  \n   - 구체적인 “이번 작업에서 어떤 문서를 찾아야 하는가”와 같은 특수 지시는 Integrator/Supervisor가 directive·constraints로 내려주며, Coder는 이를 Plan/TODO에 편입해 실행·보고 한다.", "metadata": {"source": "docs/prd/web/coder/improvement_01_git_and_sdk.md", "chunk_index": 18, "total_chunks": null}}
{"id": "75bccc96-5aff-44ba-829b-2cecd4bef783", "content": "- **MCP 활용 실패 (원인 추정)**  \n  - `run_integration_workflow`는 “질문(prompt)”을 받아 MCP 서버가 해당 쿼리에 맞는 Runner/SDK 가이드를 반환하는 구조인데, 이번 세션에서는 `arguments: {}` 로 호출되어 빈 요청이 전달되었습니다. 결과적으로 MCP 서버가 처리할 입력이 없어 즉시 실패했지만, 툴 래퍼가 상세 오류를 표면화하지 않아 Supervisor/PlanTool이 성공으로 간주했습니다.  \n  - **개선책**  \n    1. `run_integration_workflow` 호출 시 필수 인자로 `question` 또는 `topic`을 요구하도록 LangGraph 노드/도구 스펙을 수정하고, 누락 시 도구 자체가 ValidationError를 반환해 Coder가 즉시 재시도하게 합니다.  \n    2. MCP 래퍼가 실제 예외 메시지를 Supervisor 이벤트에 포함하도록 하여 PlanTool이 TODO 상태를 `blocked`로 전환할 수 있게 합니다.  ", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 0, "total_chunks": null}}
{"id": "c50b74f1-7f9d-426e-933a-9d6d649268bc", "content": "    3. Supervisor 프로프트에 “FluxLoop MCP 호출 시, 반드시 현재 문제를 자연어 질문으로 서술하고, 실패 시 TODO를 `blocked`로 유지하라”는 지침을 추가합니다.  \n  - **구현 계획**  \n    - [ ] `run_integration_workflow` LangGraph Tool schema에 `question: str` 필수 필드를 추가하고, AgentService에서 누락 시 ValidationError를 전달하도록 수정.  \n    - [ ] MCP Python 래퍼(`fluxloop-mcp`)에 예외 메시지/stack trace를 포함한 Response payload를 추가하고 Supervisor 이벤트에 전달하도록 AgentService `tool_error_handler` 업데이트.  \n    - [ ] `supervisor/prompts.py`에 MCP 호출 시 질문 서술·실패 시 `blocked` 유지 지침을 추가하고, PlanTool이 TODO 상태를 `blocked`로 설정하는 로직 구현.", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 1, "total_chunks": null}}
{"id": "974a5d86-3426-4127-9ef6-f05ffb6948a4", "content": "\n- **플랜 재시작 현상 (심각)**  \n  - 동일한 TODO 목록이 HITL 승인 직후마다 다시 작성되고, `plan size=0` 상태에서 에이전트가 초기화됩니다. 이는 HITL 결정을 받을 때마다 `AgentService.run_agent_loop_stream`이 새로운 세션으로 재시작하면서 기존 PlanTracker/MemorySaver 상태를 버리기 때문으로 추정됩니다. MCP 실패 등 블로커가 해소되지 않은 상태에서도 Supervisor가 “retry” 지시만 내리면 반복 루프가 발생합니다.  \n  - **개선책**  \n    1. HITL 재개 시 기존 LangGraph 체크포인트/PlanTracker를 복원하도록 `AgentSessionStore`를 통해 최신 plan snapshot을 재주입합니다.  \n    2. 동일한 TODO 세트를 1회 이상 재기록하려 할 때 Guardrail을 추가하여, 상태 변화 없이 리셋이 감지되면 Supervisor가 강제로 `blocked` 상태로 전환하거나 사용자 개입을 요구합니다.  ", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 2, "total_chunks": null}}
{"id": "3deaf4e3-f565-45b4-bac8-2aea71004a20", "content": "    3. PlanTool이 TODO를 작성할 때 `tracker_id` 기반 중복 여부를 확인해, 직전과 동일한 리스트면 `write_todos` 대신 기존 리스트를 유지하도록 수정합니다.  \n  - **구현 계획**  \n    - [ ] `AgentSessionStore.get_context_handoff`에 최신 plan snapshot을 포함시키고, `AgentService.run_agent_loop_stream`가 HITL 재시작 시 이를 LangGraph 초기 상태에 주입하도록 변경.  \n    - [ ] PlanTool `write_todos` 호출 전에 직전 스냅샷과 diff를 비교해 변화가 없으면 `write`를 차단하거나 Supervisor에 `blocked` 이벤트를 전송하는 로직 추가.  \n    - [ ] HITL 루프에서 동일 TODO 반복이 감지되면 UI에 “재시작 루프 감지” 알림을 띄우고 사용자의 추가 지시를 요청하도록 Web/HITL API 확장.\n\n- **Git 브랜치 동작**: 15:39:16에 `create_branch(\"fluxloop/sdk-integration-20250204\")` 호출이 승인되어 성공했습니다. 즉, 새로운 작업용 브랜치는 실제로 생성되었고 직후 `git status -sb`도 실행되었으므로 최소한 브랜치 강제 규칙은 작동 중입니다.", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 3, "total_chunks": null}}
{"id": "60be4ad8-d5aa-4c8e-a84b-9dde3cb88645", "content": "\n- **FluxLoop SDK 설치 시도**: `uv pip install fluxloop`는 가상환경 부재로 실패(“No virtual environment found”). 이어서 `pip install fluxloop`를 전역으로 실행해 SDK 모듈은 가져왔지만, Runner 샌드박스 정책과 다르게 시스템 Python에 설치한 상태입니다. 이 부분은 향후 재실행 시 같은 오류를 반복할 가능성이 있습니다.\n  - **개선책**: Runner 준비 단계에서 `uv venv && uv pip install -r requirements.txt`를 강제하거나, `pip install` 도구가 `--system` 사용 여부를 명시적으로 사용자에게 묻도록 가드레일을 추가합니다. 또한 SDK 설치 여부를 체크하는 전용 MCP/도구를 마련해 중복 설치를 막습니다.  \n  - **추가 조치**: 레포에는 `pyproject.toml`과 `uv.lock`만 있고 `.venv`는 git에 포함되지 않으므로, Runner가 새 워크스페이스를 만들 때 **항상** `uv venv` → `uv sync` 순으로 가상환경을 생성한 뒤 에이전트를 실행해야 합니다. 이 초기 셋업을 자동화하지 않으면, 에이전트가 매번 전역 `pip install`로 우회하여 시스템 환경을 오염시키고 재현 불가능한 상태를 만들 위험이 큽니다.", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 4, "total_chunks": null}}
{"id": "dc606e76-9ef3-4ea9-92d4-f165fe7c0bf0", "content": "  - **일반화 고려사항**: 모든 리포가 `uv`를 쓰지 않으므로, Runner는 `pyproject/uv.lock`, `requirements.txt`, `poetry.lock` 등 다양한 의존성 메타파일을 감지해 적절한 초기화 루틴을 선택해야 합니다. `uv`가 감지되면 `uv venv && uv sync`, `requirements.txt`만 있으면 `python -m venv .venv && pip install -r requirements.txt`처럼 분기하여 항상 새 가상환경을 구성한 뒤 에이전트를 실행해야 합니다.\n  - **구현 계획**  \n    - [ ] Runner `executor.prepare_workspace`에서 `uv venv` 존재 여부를 체크하고 없으면 자동 실행, 이어서 `uv sync`까지 완료하도록 추가 스텝 구현.  \n    - [ ] `execute`/`pip install` 도구에 `--system` 여부를 묻는 Guardrail 추가 및 전역 설치 시 경고 로그 emit.  ", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 5, "total_chunks": null}}
{"id": "d2514ed4-56f1-4b8f-a173-55b86d564168", "content": "    - [ ] “FluxLoop SDK 설치 상태 확인” MCP 도구를 만들어, 설치 여부를 보고하고 필요 시 `uv pip install fluxloop`를 제안하는 흐름 마련.\n\n- **초기 상태로 돌아가는 반복 여부**: MCP 실패 → TODO 초기화 → MCP 항목을 완료로 표시 → 다시 초기 탐색(프로젝트 루트 스캔, README/pyproject 열람) → 또 MCP 시도… 라는 사이클이 15:34~15:38 사이에서 반복되었습니다. 실질적 구현 작업(파일 수정, 커밋) 이전 단계에서 루프가 맴돌고 있으므로, 반복 패턴이 존재합니다.\n  - **개선책**: Supervisor가 동일한 초기 작업(디렉터리 나열, README 열람 등)만 반복할 경우 `progress_signal`을 측정해 사용자에게 HITL 알림을 띄우고, MCP 및 플랜 문제를 해결하기 전까지 추가 승인을 요구하도록 합니다.\n  - **구현 계획**  \n    - [ ] LangGraph 상태에 `progress_signal` 또는 “최근 실행된 도구 목록”을 저장하고, 동일 패턴이 반복되면 Coder에게 “변화 없음” 메시지를 쓰도록 지시.  ", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 6, "total_chunks": null}}
{"id": "8d21b8f8-e072-41d0-b885-047394ea6a19", "content": "    - [ ] Supervisor Guardrail에 “초기 탐색 명령만 반복되면 사용자에게 HITL 알림을 띄우라”는 조건을 추가하고, UI에 알림을 표시하는 API를 구현.  \n    - [ ] HITL 승인 시 최근 N회 이벤트 로그를 검토하여 동일 패턴이면 재승인 전에 사용자에게 상황을 요약해 보여주도록 Web UI를 개선.\n\n- **Runner 가상환경 부트스트랩 적용 현황**  \n  - `EnvironmentSetupPlan` 감지기를 `executor.py`에 추가해, 레포 루트에서 `uv.lock`, `[tool.uv]` 섹션, `requirements.txt`를 확인한 뒤 `uv` 또는 `pip` 기반 부트스트랩 플랜을 생성합니다.  \n  - `LocalProcessExecutor.prepare_workspace`와 `LocalDockerExecutor.prepare_workspace`는 클론 직후 `_bootstrap_environment*`를 호출해 `.venv`를 생성하고 `uv venv && uv sync` 또는 `python -m venv`/`pip install -r`를 자동 실행합니다. 실패 시 Runner 로그에 경고를 남기지만 세션은 계속 진행되므로, 향후에는 실패를 SSE 이벤트나 Supervisor guardrail로 전달해 재시도를 강제해야 합니다.  ", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 7, "total_chunks": null}}
{"id": "a4829e55-f1f5-4618-a724-bc0c4ecadff2", "content": "  - 문서에 “Runner는 전역 `pip install` 대신 항상 독립적인 `.venv`를 구성해야 하며, `uv`/`requirements`/`poetry` 등 다양한 매니페스트를 감지해 맞춤 루틴을 선택해야 한다”는 요구사항을 명시했습니다. 추후 `poetry.lock`, `pipenv` 등의 시나리오도 확장 예정입니다.  \n  - 자동화된 테스트는 아직 추가되지 않았으므로, 샘플 레포에 대해 Runner를 수동 실행해 `.venv` 생성 로그가 노출되는지 검증하는 절차가 필요합니다.\n\n- **Integrator FluxLoop 패키지 설치 지침 미흡**  \n  - 기존 레포의 `pyproject`/`requirements`에 `fluxloop*` 패키지가 없더라도, Integrator가 “가상환경 생성 → `pip install -U fluxloop fluxloop-cli fluxloop-mcp` → `fluxloop --version` 검증” 순서를 Plan/TODO에 강제해야 한다. 현 구현에서는 이 지시가 goal 텍스트나 constraints에 명시되어 있지 않아, Coder가 설치 단계를 건너뛰거나 전역 `pip install`로 우회할 위험이 있다.  ", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 8, "total_chunks": null}}
{"id": "f53189c9-b382-4b1f-9cc8-2d721e19dd5d", "content": "  - **구현 계획**  \n    - [ ] `IntegratorHandler._build_integration_goal`에 “`.venv` 생성 및 fluxloop 패키지 설치/검증” 절차를 Acceptance Criteria로 추가하고, PlanTool 초기 TODO에 `Install FluxLoop SDK packages via pip` 항목이 자동 포함되도록 수정.  \n    - [ ] `AgentService` 초기 constraints에 “FluxLoop SDK 미설치 시 반드시 `pip install -U fluxloop fluxloop-cli fluxloop-mcp`를 실행하고 결과를 보고하라”는 문구를 추가하며, 설치 완료 여부는 세션 metadata flag로 추적.  \n    - [ ] `supervisor/prompts.py`에 설치 검증 규칙을 넣어 `fluxloop --version` 또는 `python -c \"import fluxloop\"` 결과가 보고되지 않으면 Finish를 거부하고 TODO를 `blocked`로 유지.  ", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 9, "total_chunks": null}}
{"id": "e25b3ec3-da6f-428a-b47d-8a4c015d2b11", "content": "    - [ ] 향후 MCP 도구에 “FluxLoop SDK install status” 쿼리를 추가해, Integrator/Supervisor가 설치 결과를 자동 확인하고 필요 시 재설치를 지시.\n\n\n\n\n\n    ### 구현 계획 (Runner/Integrator FluxLoop 설치 가드레일)\n\n**1. Runner 가상환경 부트스트랩 강화**\n- **Manifest 탐지 범위 확장**: `services/web/backend/app/services/runner/executor.py`의 `detect_environment_plan`을 개선해, (a) repo 루트뿐 아니라 targets/엔트리 경로까지 재귀 탐색하고 (b) `poetry.lock`, `pipfile`, `requirements/*.txt` 등 다양한 매니페스트를 지원.\n- **Bootstrap 실패 표면화**: `_bootstrap_environment`와 `_bootstrap_environment_container`에서 명령 실패 시 `RunnerEvent`를 SSE로 발행하거나 예외를 올려 Integrator/Supervisor가 즉시 `blocked` 처리하도록 수정.", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 10, "total_chunks": null}}
{"id": "c68f65fd-8a15-45fd-8f8a-6f7e5dd5b6d8", "content": "- **자동 검증/로그 테스트**: Runner 단위 테스트(or smoke script) 추가하여 `.venv` 생성 커맨드가 호출됐는지 확인하고, CI에서 샘플 repo를 대상으로 prepare_workspace를 실행해 로그를 캡처.\n\n**2. Integrator FluxLoop 패키지 설치 지시**\n- **Goal/Directive 업데이트**: `services/web/backend/app/services/runner/handlers/integrator.py` `_build_integration_goal`에 “`.venv` 준비 → `pip install -U fluxloop fluxloop-cli fluxloop-mcp` → `fluxloop --version` 보고”를 Acceptance Criteria/Plan seed로 삽입. PlanTool seed TODO에 `Install FluxLoop SDK packages via pip` 추가.\n- **Session Metadata 플래그**: `AgentSessionContext.metadata`에 `sdk_bootstrap_required/done` 플래그를 저장하고, 설치 완료 시 Integrator가 Runner `update_project_active_branch`와 비슷하게 상태를 갱신.", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 11, "total_chunks": null}}
{"id": "5b6e8373-137c-40c8-b9d9-24067011b252", "content": "\n**3. AgentService/Supervisor 가드레일**\n- **Constraints 확장**: `services/web/backend/app/services/agent/service.py` 초기 constraints에 “FluxLoop SDK 미설치 → `pip install -U ...` 실행 및 결과 보고” 문구 추가. 플래그가 `done`이면 constraint 해제.\n- **설치 검증 요구**: `services/web/backend/app/services/agent/supervisor/prompts.py`에 `fluxloop --version` 또는 `python -c \"import fluxloop\"` 출력이 없으면 Finish 거부 및 TODO를 `blocked`로 유지하는 지침 추가.\n- **Tool Hook/Reporting**: `AgentService`가 `pip install` 도구 실행 결과를 파싱해 설치 성공/실패 이벤트를 기록, 실패 시 HITL 알림 연동.\n\n**4. 가드레일 for pip/execute**", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 12, "total_chunks": null}}
{"id": "24dbc75a-6520-44ea-ae04-d9ca704f945a", "content": "- **pip tool 강화**: `services/web/backend/app/services/agent/tools/pip.py`(가정)에서 `.venv` 외 경로에 설치하려 하면 경고/차단; `--system` 감지 시 실패 반환.\n- **execute tool 경고**: `execute`에서 `pip install` 문자열 감지 시 `.venv` 여부 확인 후 없으면 MCP/Integrator 경고 이벤트 발행.\n\n위 단계대로 순차 진행하면 문서 40–53행의 미완성 요구사항(가상환경 자동화 고도화, FluxLoop 패키지 설치 지침, MCP 확인 루프, Guardrail)이 모두 구현됩니다.", "metadata": {"source": "docs/prd/web/coder/issue#1.md", "chunk_index": 13, "total_chunks": null}}
{"id": "43f1e7ef-ccf5-4e6d-9d24-891231966da2", "content": "# FluxLoop Agent Persistence Plan\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "c224fca3-0a5f-4ef4-8c85-45856ddd1c5c", "content": "## 1. 목표와 범위\n- 컨테이너 수명과 무관하게 에이전트 장기 상태(메모리, 스킬, TODO/Plan)를 보존\n- 다중 런너/사용자 환경에서 동일 데이터를 공유\n- 현존 버킷(`logs`, `input-datasets`, `experiment-results`)과 Runner 구조(@runner) 및 DB 스키마(@db_sqls)를 확장해 Supabase를 단일 Source of Truth로 사용\n- 마이그레이션/백필 전략은 본 문서 범위에서 제외 (요청 사항)\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "9265f332-2ae7-4d86-8170-7eaba08b2f75", "content": "## 2. 현재 데이터 흐름 문제\n| 영역 | 현 구현 | 문제점 |\n|------|--------|--------|\n| 장기 메모리 (`.fluxloop_user/agent.md`, `.fluxloop/agent.md`) | 컨테이너 `/workspace` / repo 폴더에 직접 `mkdir` 후 사용 (`AgentService._build_memory_configs`) | Read-only 볼륨에서 실패, 컨테이너 종료 시 소실, 다중 사용자 공유 불가 |\n| 스킬 (`skills/`) | 동일 경로, 동일 문제 |\n| TODO/Plan (`.fluxloop/todos.json`) | `PlanTracker`가 repo 워크스페이스에만 저장 | 세션 사이 공유 불가, Integrator UI와 분리된 상태 관리 |\n| 로그/Artifacts | RunnerContext가 Supabase 버킷(`LOGS_BUCKET`, `INPUT_DATASETS_BUCKET`, `EXPERIMENT_RESULTS_BUCKET`)에 업로드 | 이미 bucket 기반, 그대로 유지 가능 |", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "8e6933bb-c315-4828-923a-0ce7dff2db8a", "content": "## 3. 요구사항 요약\n1. 컨테이너/워크스페이스는 **캐시**로만 사용하고, 모든 장기 상태는 Supabase(Postgres + Storage)에 보존.\n2. 에이전트 세션 시작 시 Supabase → 워크스페이스로 동기화, 세션 종료 시 변경분을 다시 Supabase로 반영.\n3. Runner/Executor 계층은 버킷/DB 접근을 추상화하여 다중 런너가 동일 상태를 공유할 수 있도록 설계.\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "33809809-e80c-48b0-adc1-68abb35a4e39", "content": "## 4. Supabase 설계", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "cfa323b4-fc3c-4bc7-9852-ad11c52e3239", "content": "### 4.1 테이블 (Postgres)\n| 테이블 | 주요 컬럼 | 용도 |\n|--------|----------|------|\n| `agent_memories` | `id uuid`, `user_id uuid`, `assistant_id text`, `content text`, `updated_at timestamptz` | 사용자 전역 메모리 저장 |\n| `project_memories` | `id uuid`, `project_id uuid`, `assistant_id text`, `content text`, `updated_at` | 프로젝트별 메모리 |\n| `agent_plans` | `id uuid`, `project_id uuid`, `run_id uuid`, `latest_plan jsonb`, `updated_at` | TODO/Plan 상태 |\n| `agent_skills_meta` | `id uuid`, `owner_type text`, `owner_id uuid`, `name text`, `description text`, `storage_key text`, `updated_at` | 스킬 메타데이터 (실제 파일은 Storage) |", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "0debd6ca-9d80-4f7f-8f14-ac5318f497b7", "content": "\n> @db_sqls (`schema_v4_1.sql`, `v4_1_patch_002_integrator.sql`) 를 기반으로 위 테이블과 RLS 정책을 추가하는 패치 작성 필요.\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "ec87416c-3610-498e-936b-7ec1ec10c3f8", "content": "### 4.2 Storage 버킷\n- 기존 버킷 유지 (`logs`, `input-datasets`, `experiment-results`).\n- 신규 버킷:\n  - `agent-memories` — 텍스트/대용량 메모리 파일\n  - `agent-skills` — skill markdown/asset\n  - 필요 시 `agent-artifacts` (서브에이전트 산출물)\n\n버킷 키 규칙 예시:\n```\nagent-memories/{user_id}/{assistant_id}/agent.md\nagent-memories/projects/{project_id}/{assistant_id}/agent.md\nagent-skills/{owner}/{skill_name}/SKILL.md\n```\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "4602d1ac-3862-48f7-9c10-af291aa9256d", "content": "## 5. 서비스 계층 설계", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "64697d69-bab7-489d-bd93-24a4844a8604", "content": "### 5.1 Store 인터페이스\n```python\nclass AgentMemoryStore(Protocol):\n    def fetch_user_memory(user_id: UUID, assistant_id: str) -> MemorySnapshot\n    def save_user_memory(snapshot: MemorySnapshot) -> None\n    def fetch_project_memory(project_id: UUID, assistant_id: str) -> MemorySnapshot\n    ...\n```\n- 구현: `SupabaseAgentMemoryStore` (Postgres + Storage 사용)\n  - 메모리는 Postgres text로, 대용량 파일은 Storage에 저장하고 메타데이터로 연결.\n- `PlanStore`: Supabase `agent_plans` 테이블과 연동하여 LangGraph `state[\"plan\"]`를 실시간 동기화.\n- `SkillStore`: `agent_skills_meta` + Storage 버킷 조합으로 CRUD 제공.", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "99f74415-16e1-4ac8-bc2a-4d2694660336", "content": "### 5.2 실행 흐름\n1. **세션 준비 (Runner/AgentService)**  \n   - Store에서 최신 메모리/스킬/플랜을 조회 → 워크스페이스 캐시 경로(`ctx.shared_root_path` 등)에 materialize.  \n   - `_build_memory_configs`는 더 이상 직접 `mkdir`하지 않고, Store가 준비한 캐시 경로만 참조.\n2. **세션 중**  \n   - LangGraph가 메모리/스킬 파일을 수정할 때 Store API를 통해 “dirty” 상태로 표시.  \n   - TODO 조작 시 `PlanStore`가 Supabase `agent_plans`에 즉시 반영.\n3. **세션 종료**  \n   - Store가 dirty 플래그를 확인해 Supabase에 업로드, 버킷/테이블 업데이트.  \n   - 워크스페이스 캐시 삭제 (컨테이너 종료 대비).\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "6adecf60-fab3-4418-b907-e326bbe279ba", "content": "### 5.3 Runner/Executor 변경\n- `WorkspaceContext` 확장: `host_workspace_path`, `shared_root_path` 등을 노출해 읽기 전용 컨테이너/런타임에서도 호스트 측 캐시 디렉터리를 참조할 수 있게 함.\n- Executors는 세션 시작 시 해당 경로(예: `host_workspace/.agent_cache`)를 생성해주고, Store는 우선적으로 이 경로를 활용해 Supabase ↔ Workspace 간 동기화를 수행.\n- RunnerContext가 이미 보유한 Supabase client를 Store에 주입해 재사용.\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "ca76928f-06c4-43ad-931c-c32869d74397", "content": "## 6. 구현 순서", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "7c2a0d36-183c-4eee-8a4f-7281c0b884fa", "content": "### Phase 0 – AgentService 리팩터링\n- `IntegratorHandler`(`services/web/backend/app/services/runner/handlers/integrator.py`)가 수행 중인 이벤트/대화 저장 책임을 `AgentService`로 이전. `run_agent_loop_stream`이 세션 생성/이벤트 발행/상태 저장을 전담하고, Integrator 등 클라이언트는 결과만 소비.\n- `AgentService.run_agent_loop_stream` 내에서 Store 계층을 직접 호출해 Supabase에 메모리/이벤트를 기록하고, 최종 결과만 클라이언트(Supervisor/Integrator 등)에 전달.\n- SSE 파이프라인도 `AgentService`가 `agent_events`를 소스로 삼아 공통 포맷으로 발행하고, 각 클라이언트 어댑터(Integrator 등)는 필요한 도메인별 메타데이터만 덧붙이는 얇은 계층으로 축소.\n- 기존 Integrator 전용 이벤트 테이블(`integrator_run_events`) 사용 대신, 공통 `agent_*` 테이블/버킷으로 이벤트를 저장하도록 어댑터 제공.", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "5617c5fb-8178-472e-ac3a-426d99eed74a", "content": "- 프런트엔드도 `agent_sessions`/`agent_events` 기반 SSE를 기본으로 소비할 수 있도록 식별자 연동 흐름(`session_id` 전달 → SSE 구독)을 정리하고, 모든 UI 스트림 경로를 공통 세션 기반으로 통합.\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "0e7a2ef7-9369-4ef3-878c-24ca8ab7ecbb", "content": "### Phase 1 – 스키마 & 버킷 준비\n- `app/db_sqls/v4_1_patch_004_agent_persistence.sql` **추가 완료**  \n  - 포함 내용: `agent_sessions / agent_events / agent_memories / project_memories / agent_plans / agent_skills_meta` 테이블, 통합 RLS, 인덱스, `integrator_runs.agent_session_id` FK.  \n  - 적용: `psql $SUPABASE_DB_URL -f services/web/backend/app/db_sqls/v4_1_patch_004_agent_persistence.sql`\n- Supabase Storage 버킷 (수동 생성):\n  - `supabase storage create-bucket agent-memories --public=false`\n  - `supabase storage create-bucket agent-skills --public=false`", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "e77e4f4d-f885-47ca-9da9-31d000469ee9", "content": "  - (선택) `supabase storage create-bucket agent-artifacts --public=false`\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "8f944ee7-6aa0-4e31-b3e6-02ea6c9b1477", "content": "### Phase 2 – Store 계층 도입\n- `app/services/agent/storage.py` 혹은 `memory_store.py` 작성.\n- `_build_memory_configs`, `PlanTracker` 등에서 Store 사용하도록 리팩터링.\n- 기존 `.fluxloop_user` 접근 로직 제거.\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "7f950009-db31-4f48-a942-1f3b2e213e5b", "content": "### Phase 3 – Runner/Executor sync\n- `RunnerContext` / executor가 세션 시작 시 Store에서 데이터를 내려받고 종료 시 업로드하도록 훅 추가.\n- 에러 시 graceful degrade (메모리 기능 비활성화, 경고 로그).\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "3363d4de-d033-4f5b-b09c-b097f4938109", "content": "### Phase 4 – 검증 및 UI 연계\n- Read-only Docker 환경에서 통합 테스트.\n- Integrator UI가 Supabase `agent_plans`를 그대로 조회하도록 연결(이미 사용 중인 경로 재사용).\n- 향후 UI에서 메모리/스킬 편집 기능을 제공하려면 별도 API 추가.\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 21, "total_chunks": null}}
{"id": "4891bd4d-bb55-4926-80e8-b6c4c6576fed", "content": "### 추천 방향\n- 장기적으로는 AgentService가 “공통 세션/이벤트 API”를 제공하고, 프런트도 이를 기본으로 삼는 것이 유지보수에 유리하다.\n- 다만 도메인별 특수 요구(Integrator TODO 보드, 승인 플로우 등)가 있다면 해당 클라이언트 전용 어댑터를 최소화된 계층으로 두고, 공통 이벤트를 확장/주입하는 방식으로 모델링한다.\n- 즉 “공통 프로토콜 + 얇은 클라이언트 어댑터” 구조를 목표로 하고, Phase 0에서 SSE를 포함한 전체 파이프라인을 이 구조로 먼저 리팩터링한 뒤 Phase 1로 넘어간다.\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 22, "total_chunks": null}}
{"id": "1f54aa76-231a-4589-805e-b7e9e78a00eb", "content": "## 7. 참고\n- @runner 현재 구조(로그/입력/결과 버킷)는 그대로 사용 가능하며, 새로운 버킷/테이블만 추가하면 된다.\n- 마이그레이션/백필은 이 문서 범위에서 제외했으므로, 기존 `.fluxloop_user` 데이터는 별도 이슈에서 다룬다.\n```\n", "metadata": {"source": "docs/prd/web/coder/supabase_persistence_plan.md", "chunk_index": 23, "total_chunks": null}}
{"id": "c5c074d6-ccc7-4101-bf54-f3b7a0b68b01", "content": "# Sandbox V2 Phase 2: Executor Abstraction\n", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 0, "total_chunks": null}}
{"id": "54da4f8e-73f7-42f2-8707-7306c800653d", "content": "## 목표\n\n현재 `RunnerService`에 강하게 결합된 **\"로컬 프로세스 실행 로직\"**을 분리하여, 향후 **Docker**나 **Remote Sandbox**로 실행 환경을 쉽게 교체할 수 있도록 **추상화 계층(Executor)**을 도입합니다.\n\n---\n", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 1, "total_chunks": null}}
{"id": "47fcdfa2-eb26-4060-84eb-e6a14a844941", "content": "## 아키텍처 변경\n", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 2, "total_chunks": null}}
{"id": "73804b03-c9cc-422b-b5b4-c1891ac3694f", "content": "### AS-IS (현재)\n```mermaid\nclassDiagram\n    class RunnerService {\n        +run_experiment()\n        -_run_subprocess()  <<Local implementation>>\n        -_git_clone()       <<Local implementation>>\n    }\n```\n", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 3, "total_chunks": null}}
{"id": "0944d6f6-d358-4e75-a616-a0a8429f1aa0", "content": "### TO-BE (목표)\n```mermaid\nclassDiagram\n    class RunnerService {\n        -executor: SandboxExecutor\n        +run_experiment()\n    }\n    \n    class SandboxExecutor {\n        <<interface>>\n        +prepare_workspace(repo_url, commit) -> WorkspaceContext\n        +run_command(cmd, cwd, env) -> ExecResult\n        +cleanup(workspace_id)\n    }\n    \n    class LocalProcessExecutor {\n        +prepare_workspace()  // git clone to /tmp\n        +run_command()        // subprocess.Popen\n    }\n    \n    class DockerExecutor {\n        +prepare_workspace()  // git clone to volume", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 4, "total_chunks": null}}
{"id": "30ec12cc-2a9e-4590-887e-d8fbe29950b1", "content": "        +run_command()        // docker exec\n    }\n\n    RunnerService --> SandboxExecutor\n    SandboxExecutor <|.. LocalProcessExecutor\n    SandboxExecutor <|.. DockerExecutor\n```\n\n---\n", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 5, "total_chunks": null}}
{"id": "217111a5-cdb6-4108-a25b-68a03035ceda", "content": "## 인터페이스 설계 (`executor.py`)\n\n```python\n@dataclass\nclass WorkspaceContext:\n    workspace_id: str\n    root_path: Path     # 로컬 경로 또는 컨테이너 내부 경로\n    repo_path: Path\n    \n@dataclass\nclass ExecResult:\n    returncode: int\n    stdout: List[str]\n    stderr: List[str]\n\nclass SandboxExecutor(Protocol):\n    def prepare_workspace(\n        self, \n        experiment_id: str, \n        repo_url: str, \n        commit_sha: Optional[str]\n    ) -> WorkspaceContext:\n        \"\"\"워크스페이스 생성 및 Git Clone 수행\"\"\"\n        ...\n\n    def run_command(\n        self,", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 6, "total_chunks": null}}
{"id": "0f13c28c-8041-43e8-a64a-037d89edaa3a", "content": "        command: List[str],\n        cwd: Path,\n        env: Dict[str, str],\n        stream_callback: Optional[Callable[[str], None]] = None\n    ) -> ExecResult:\n        \"\"\"명령 실행 (스트리밍 지원)\"\"\"\n        ...\n        \n    def cleanup(self, workspace_id: str) -> None:\n        \"\"\"워크스페이스 정리\"\"\"\n        ...\n```\n\n---\n", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 7, "total_chunks": null}}
{"id": "c6632638-1db5-4555-9fbe-7cf0e428b9ef", "content": "## 구현 단계\n\n1. **Executor 인터페이스 및 Local 구현체 작성**\n   - `services/web/backend/app/services/runner/executor.py` 생성.\n   - 기존 `RunnerService`의 `_run_subprocess`와 git clone 로직을 `LocalProcessExecutor`로 이동.\n\n2. **RunnerService 리팩토링**\n   - `RunnerService`가 `subprocess`나 `GitService`를 직접 쓰지 않고, 생성자에서 `SandboxExecutor`를 주입받도록 수정.\n   - 로직 흐름은 그대로 유지하되 호출 대상만 변경.\n\n3. **Factory 적용**\n   - `get_runner_service()`에서 `LocalProcessExecutor`를 생성하여 주입.\n   - (추후) 환경 변수(`SANDBOX_TYPE=docker`)에 따라 `DockerExecutor` 교체 가능하도록 준비.\n\n---\n", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 8, "total_chunks": null}}
{"id": "a6b94b49-df6d-4f93-aa91-d0a8ddc585b1", "content": "## 기대 효과\n\n- **코드 분리**: \"무엇을 실행할지(Runner Logic)\"와 \"어떻게 실행할지(Execution Detail)\"가 분리됨.\n- **확장성**: Docker, K8s, Vercel 등 새로운 실행 백엔드 추가 시 `RunnerService` 코드를 건드릴 필요 없음.\n- **테스트**: 실제 프로세스 실행 없이 `MockExecutor`로 Runner 로직 검증 가능.\n", "metadata": {"source": "docs/prd/web/done/phase2_executor_abstraction.md", "chunk_index": 9, "total_chunks": null}}
{"id": "aae65064-d0c4-4701-90df-45b7ea498278", "content": "# Sandbox Phase 2: Local Docker Executor\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 0, "total_chunks": null}}
{"id": "a99764bd-bc62-4577-9a3e-388ac5654115", "content": "## 개요\n\n현재의 `LocalProcessExecutor`는 호스트 머신에서 직접 명령을 실행하므로, 보안 격리가 없고 환경 오염(host env leakage) 위험이 있습니다.\n**`LocalDockerExecutor`**는 로컬 Docker 데몬을 활용하여 각 실험을 **독립된 컨테이너**에서 실행함으로써 격리성을 확보하고, 향후 K8s 확장을 위한 기반을 마련합니다.\n\n---\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a7545ccc-0af2-4efa-8e8e-9ac6a09e4148", "content": "## 아키텍처\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 2, "total_chunks": null}}
{"id": "c0dbfcd9-055a-41de-9bdf-0009ae01fe87", "content": "### 핵심 변경 사항\n\n1.  **Container per Experiment**: 실험(Experiment) 1개당 1개의 Docker 컨테이너를 실행합니다.\n2.  **Workspace Mount**: 호스트의 워크스페이스(`/tmp/fluxloop_workspaces/<id>`)를 컨테이너 내부(`/workspace`)로 마운트하여, 데이터(Repo, Venv, Logs)를 영속화합니다.\n3.  **Base Image**: 실행에 필요한 도구(Python, uv, git, fluxloop-cli 등)가 미리 설치된 최적화된 이미지를 사용합니다.\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 3, "total_chunks": null}}
{"id": "3bcb5f08-d387-4698-a803-241b2b4a5cb1", "content": "### 실행 흐름 비교\n\n| 단계 | LocalProcessExecutor (AS-IS) | LocalDockerExecutor (TO-BE) |\n|---|---|---|\n| **Setup** | `mkdir` & `git clone` on Host | `docker run -d -v host_ws:/workspace fluxloop-runner` |\n| **Git Sync** | `GitService` on Host | `docker exec git clone ...` (or Host GitService) |\n| **Venv** | `uv venv` on Host | `docker exec uv venv ...` |\n| **Run** | `subprocess.Popen` on Host | `docker exec fluxloop run ...` |\n| **Cleanup** | `rm -rf` on Host | `docker rm -f <container_id>` & `rm -rf` on Host |\n\n> **Note**: 초기에는 `GitService`를 호스트에서 실행하고 결과만 컨테이너에 마운트하는 방식이 구현이 쉽고 속도가 빠릅니다. (Git Credential 처리 용이)", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 4, "total_chunks": null}}
{"id": "b866f20f-48b3-409e-b9b2-2f87812e1248", "content": "\n---\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 5, "total_chunks": null}}
{"id": "a4c0b225-6ed1-4e23-b2e4-5cd6e5723345", "content": "## 구현 상세\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 6, "total_chunks": null}}
{"id": "ed9eba32-fcc7-49bc-8772-8074e26944ef", "content": "### 1. Base Image (`fluxloop-runner`)\n\n`Dockerfile` 작성:\n```dockerfile\nFROM python:3.11-slim\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 7, "total_chunks": null}}
{"id": "cebfe294-9882-454c-833d-d61b34d7752f", "content": "# 필수 도구 설치\nRUN apt-get update && apt-get install -y git curl && rm -rf /var/lib/apt/lists/*\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 8, "total_chunks": null}}
{"id": "f1a91ea6-0b04-4a19-a38c-fd550f939f82", "content": "# uv 설치\nRUN curl -LsSf https://astral.sh/uv/install.sh | sh\nENV PATH=\"/root/.cargo/bin:$PATH\"\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 9, "total_chunks": null}}
{"id": "38979a3e-83c9-4852-90b1-62b80ad783dd", "content": "# 작업 디렉터리 설정\nWORKDIR /workspace\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 10, "total_chunks": null}}
{"id": "d39ecc70-f921-4657-ba14-72198cc2674f", "content": "# 컨테이너를 계속 실행 상태로 유지 (Exec 모드 지원)\nCMD [\"tail\", \"-f\", \"/dev/null\"]\n```\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 11, "total_chunks": null}}
{"id": "e3956778-94d2-4b62-aa4e-6908cc7f27fe", "content": "### 2. `LocalDockerExecutor` 클래스 구현\n\n`executor.py`에 추가 구현:\n\n```python\nclass LocalDockerExecutor:\n    def __init__(self, git_service: GitService, image: str = \"fluxloop-runner\"):\n        self.git_service = git_service\n        self.image = image\n        self.client = docker.from_env()  # docker-py 사용\n\n    def prepare_workspace(self, experiment_id, repo_url, ...) -> WorkspaceContext:\n        # 1. 호스트에 워크스페이스 생성 (데이터 영속성)\n        host_ws = Path(f\"/tmp/fluxloop_workspaces/{experiment_id}\")\n        host_ws.mkdir(parents=True, exist_ok=True)", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 12, "total_chunks": null}}
{"id": "0b674835-66c1-47c1-b4a5-77e3fc0c8c65", "content": "        \n        # 2. Git Clone (호스트에서 수행 - 속도/캐시 이점)\n        repo_path = host_ws / \"repo\"\n        self.git_service.sync_repo(repo_url, target_dir=repo_path, ...)\n\n        # 3. 컨테이너 실행 (Volume Mount)\n        container = self.client.containers.run(\n            self.image,\n            detach=True,\n            volumes={str(host_ws): {'bind': '/workspace', 'mode': 'rw'}},\n            working_dir=\"/workspace\",\n            auto_remove=False  # 디버깅을 위해 명시적 삭제 전까지 유지\n        )\n        \n        return WorkspaceContext(\n            workspace_id=container.id,  # 컨테이너 ID를 workspace_id로 사용", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 13, "total_chunks": null}}
{"id": "24e0b293-cbfe-49f6-b122-c452147f9236", "content": "            root_path=Path(\"/workspace\"),  # 컨테이너 내부 경로\n            repo_path=Path(\"/workspace/repo\")\n        )\n\n    def run_command(self, command, cwd, env, ...) -> ExecResult:\n        # docker exec 호출\n        container = self.client.containers.get(workspace_id)\n        \n        # 환경변수 변환\n        exec_env = {k: v for k, v in env.items()}\n        \n        exit_code, output = container.exec_run(\n            cmd=command,\n            workdir=str(cwd),\n            environment=exec_env,\n            stream=True  # 스트리밍 지원\n        )", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 14, "total_chunks": null}}
{"id": "765c165b-a30b-438c-855d-d302c8560fb9", "content": "        \n        # 스트림 처리 로직...\n        return ExecResult(...)\n\n    def cleanup(self, workspace_id):\n        # 컨테이너 종료 및 삭제\n        container = self.client.containers.get(workspace_id)\n        container.remove(force=True)\n        # 호스트 디렉터리 정리 (옵션)\n```\n\n---\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 15, "total_chunks": null}}
{"id": "8323a975-de63-44a2-a264-c75f537c5b5e", "content": "## 작업 마일스톤\n\n1.  **Docker 환경 준비**: `Dockerfile` 작성 및 로컬 빌드 (`fluxloop-runner`).\n2.  **Executor 구현**: `executor.py`에 `LocalDockerExecutor` 추가 (`docker` 패키지 의존성 추가).\n3.  **팩토리 수정**: `get_runner_service`가 환경 변수(`FLUXLOOP_EXECUTOR_TYPE`)에 따라 Executor를 선택하도록 수정.\n4.  **검증**: 기존 테스트 케이스(튜토리얼)가 Docker 환경에서 정상 작동하는지 확인.\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 16, "total_chunks": null}}
{"id": "a37d4209-7c35-4720-bfdc-02895b21cbf8", "content": "## 고려사항\n\n-   **Host vs Container Path**: `prepare_workspace`는 호스트 경로를 반환하지만, `run_command`는 컨테이너 내부 경로를 써야 함. `WorkspaceContext`에 `host_path`와 `container_path`를 구분해서 저장해야 할 수 있음.\n-   **Git Credential**: 호스트에서 git clone을 하면 인증 처리가 쉽지만, 컨테이너 내부에서 하려면 토큰을 환경변수로 주입해야 함. (Phase 2 초기에는 호스트 수행 권장)\n-   **성능**: 매 실험마다 컨테이너를 띄우는 오버헤드(수 초) 발생. 장기 실행 실험에는 무시할 만함.\n", "metadata": {"source": "docs/prd/web/done/phase2_local_docker_executor.md", "chunk_index": 17, "total_chunks": null}}
{"id": "16c3275f-06f1-409d-a496-fb0b75e4f8c3", "content": "# ✅ 결론 먼저: FluxLoop에는 **Fly.io → Hetzner+Coolify 로드맵**이 가장 잘 맞는다\n\n이건 단순히 가격/성능 비교가 아니라, **FluxLoop의 제품 구조와 개발 흐름**을 기준으로 도출한 최적 경로.\n\n---\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 1, "total_chunks": null}}
{"id": "fc58f360-cecf-4b42-97ab-d6fffb51c9ee", "content": "# 🎯 FluxLoop의 현재 단계 기준 의사결정\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 2, "total_chunks": null}}
{"id": "35102721-bfc7-4a8e-8c02-7496423bc6af", "content": "## **📌 1. 지금 당장—Fly.io가 최적 (MVP·빠른 iteration·LLM heavy 실험)**\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 3, "total_chunks": null}}
{"id": "1266a35c-6e25-4255-b430-26dbfb9d29a2", "content": "### 왜 지금은 Fly.io?\n\n* **컨테이너 기반이라 환경 재현성이 완벽함** → FluxLoop 샌드박스 구조에 딱 맞음\n* **Machines로 실험 단위로 격리 실행 가능**\n\n  * 실험할 때만 기동 → idle cost 거의 없음\n* **설정 난이도 최소**\n\n  * 10~20분이면 FastAPI + Redis + 작업기 셋업 끝\n* **Railway보다 안정적이고, Render보다 확장성 낫다**\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 4, "total_chunks": null}}
{"id": "37637ac8-bbc7-4be1-9df5-5c9b590a28fb", "content": "### Fly.io의 완전한 fit 포인트\n\nFluxLoop는 “각 실험을 독립된 샌드박스 컨테이너에서 실행”이 목표인데\n→ **Fly Machines = 실험 단위 ephemeral sandbox**가 자연스럽게 구현됨.\n\n**즉, FluxLoop 실험 모델과 Fly.io의 철학이 완벽히 맞는다.**\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 5, "total_chunks": null}}
{"id": "8fa48f7d-4627-4a98-8443-44087f816dfb", "content": "### 지금 단계의 운영 비용\n\n* FastAPI 상시 실행: 월 $10~20\n* Redis: 월 $5 수준\n* Machines 실험 비용: 실험량에 따라 월 $20~30\n\n👉 전체 월 **$30~50**이면 충분\n→ AWS 대비 **말도 안 되게 저렴 + 설정/유지보수 부담 거의 없음**\n\n**따라서 현 단계(MVP)는 Fly.io가 가장 현실적이고 탁월하다.**\n\n---\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 6, "total_chunks": null}}
{"id": "1870d436-554c-49d5-8593-165ca01b8120", "content": "## **📌 2. 실험량이 늘고 비용 최적화가 중요해지면 → Hetzner + Coolify로 이동**\n\nMVP 검증이 끝나고 아래 신호가 생기면 Coolify+Hetzner가 베스트:\n\n* 실험량 폭증 → Machines 비용이 누적됨\n* LLM 테스트 시 긴 시간 실행되는 프로세스를 여러 개 띄우기 시작함\n* 샌드박스 노드를 여러 대 확장해야 하는 시점\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 7, "total_chunks": null}}
{"id": "c9dc1557-53fa-4d09-8fc3-841af6c37e69", "content": "### Coolify + Hetzner는 아래가 핵심 경쟁력:\n\n* **8 vCPU / 32GB RAM을 월 $32.7 (AWS는 $226)**\n* **네트워크 트래픽 사실상 무제한**\n* 완전한 Docker 기반 → Fly.io에서 그대로 옮길 수 있음\n* Coolify가 GitHub 연동 + 자동배포 + HTTPS까지 다 처리\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 8, "total_chunks": null}}
{"id": "ff14f187-4a9b-4f35-a6df-5615c21eba68", "content": "### 실제 구조 예시\n\n```\nCoolify (관리)\n  ├─ Backend servers (FastAPI)\n  ├─ Redis cluster\n  ├─ Worker node pool\n  │    ├─ Docker container per experiment\n  │    └─ Auto cleanup / auto scale-out 가능\n```\n\n이 시점부터는 AWS는 전혀 필요 없음.\n로컬-first OSS 제품을 만들고 있는 FluxLoop의 정체성에도 더 부합.\n\n---\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 9, "total_chunks": null}}
{"id": "7a900884-d2d8-4bff-8dc1-5c0309ddf2c3", "content": "# 📌 3. 장기적으로 PMF 이후\n\n**Kubernetes나 AWS가 아니라 Hetzner Kubernetes(K3s) 쪽이 오히려 자연스러움.**\n\nFluxLoop의 워크로드는:\n\n* Web traffic ≪ sandbox simulation workload\n* compute bound, not network bound\n* long-running jobs 중심\n* deterministic pod scaling 불필요\n\n따라서:\n\n* AWS = 과금이 비정상적으로 비쌈\n* GCP도 마찬가지\n* Hetzner가 구조적으로 최적\n\n---\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 10, "total_chunks": null}}
{"id": "a8e9ea3d-610d-4547-9464-420c72ac6ac4", "content": "# 🔥 선택 가이드 TL;DR\n\n| 단계               | 추천                          | 이유                                   |\n| ---------------- | --------------------------- | ------------------------------------ |\n| **지금 (MVP)**     | ⭐ **Fly.io**                | 설정 빠름, 실험 단위 Machines 적합, idle 비용 없음 |\n| **조금 후 (실험 증가)** | ⭐ **Coolify + Hetzner**     | 비용 1/10, 완전 제어권, 샌드박스 병렬 실험 적합       |\n| **스케일링**         | **Hetzner Kubernetes(k3s)** | compute 중심 워크로드에 최적화                 |\n\n---\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 11, "total_chunks": null}}
{"id": "08913a60-38d3-4954-bb82-089513b1943c", "content": "# 📌 FluxLoop의 성격을 기준으로 한 근거\n\nFluxLoop는:\n\n* **Agent QA + Agent Simulation**\n* **비결정론 반복 실험**\n* **샌드박스 격리 실행**\n* **LLM-heavy workload**\n\n즉:\n\n1. 컨테이너 격리 필요\n2. 긴 job 많음\n3. 실행 시에만 비용 나가는 구조가 효율적\n4. LLM 비용에 예산 대부분이 들어가므로 인프라 비용은 최소화해야 함\n\n→ **Fly.io → Hetzner**는 이런 구조를 위해 태어난 조합이다.\n\n---\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 12, "total_chunks": null}}
{"id": "8624c22e-b864-49bf-b8b9-a75ec33821b5", "content": "# 🚀 최종 답변\n\nFluxLoop의 현재 상황(MVP 단계, 빠른 iteration 필요, 샌드박스 구조 실험 중)이라면\n**지금은 Fly.io가 가장 맞다.**\n그리고 실험량 증가 순간 바로 **Coolify + Hetzner로 이사**하면 된다.\n\n둘 다 Docker 기반이라 마이그레이션도 몇 분 수준.\n\n\n\n\n\n이 전략은 **FluxLoop의 현재 단계와 기술적 요구사항(Sandbox, Isolation, LLM-heavy)을 완벽하게 꿰뚫은 최적의 로드맵**입니다.\n\n특히 \\*\\*\"Fly Machines = Ephemeral Sandbox\"\\*\\*라는 해석은 기술적으로 매우 날카로운 통찰입니다. AWS Lambda는 런타임 제약이 심하고, EC2는 관리가 무거운데, Fly Machines는 그 중간에서 \\*\\*\"켜고 끄는 컨테이너(Firecracker MicroVM)\"\\*\\*라는 FluxLoop에 딱 맞는 Sweet Spot을 제공하기 때문입니다.\n\n제안하신 내용 중 \\*\\*지금 당장 필요한 [Phase 1: Fly.io 아키텍처 및 구현]\\*\\*을 구체적으로 설계해 드립니다.", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 13, "total_chunks": null}}
{"id": "a68166ae-3995-409f-bec6-3c180c1aaf1b", "content": "\n-----\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 14, "total_chunks": null}}
{"id": "e7e27147-43e9-4912-a412-509ae91ead0d", "content": "# 🚀 Phase 1: FluxLoop on Fly.io (Architecture & Implementation)\n\nFluxLoop의 핵심은 \\*\\*\"실험 관리자(Control Plane)\"\\*\\*와 실제 실험이 도는 \\*\\*\"샌드박스(Data Plane)\"\\*\\*의 분리입니다.\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 15, "total_chunks": null}}
{"id": "18a79f2c-23f2-46c3-92a7-5cbcee2cd92c", "content": "### 1\\. 아키텍처 다이어그램 (Hub & Spoke 구조)\n\n  * **FluxLoop Core (Hub):** 상시 실행되는 FastAPI 서버. 실험 요청을 받고, DB(Redis/Postgres)를 관리하며, 사용자 UI와 통신합니다.\n  * **Sandbox Machines (Spokes):** Core의 명령을 받아 \\*\\*\"필요할 때만 생성되고, 실험 후 자동 소멸\"\\*\\*되는 일회성 MicroVM들입니다.\n\n-----\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 16, "total_chunks": null}}
{"id": "1e0dd36b-d168-41e8-9302-4c33fe20eeaa", "content": "### 2\\. 구현 상세: Fly Machines 기반 샌드박스 시스템\n\n이 구조를 구현하기 위한 핵심 설정 파일과 코드를 정리했습니다.\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 17, "total_chunks": null}}
{"id": "2348d61d-dc32-48e7-b8ca-8ff9607c05ef", "content": "#### A. FluxLoop Core (`fly.toml`)\n\nCore 서버는 상시 떠 있어야 하므로 표준적인 서비스 설정을 따릅니다.\n\n```toml", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 18, "total_chunks": null}}
{"id": "d3d887c3-8ad3-4a56-82b4-8596e36c6ede", "content": "# fly.toml (FluxLoop Core)\napp = \"fluxloop-core\"\nprimary_region = \"nrt\" # 한국에서 가까운 도쿄(nrt) 추천\n\n[build]\n  dockerfile = \"Dockerfile.core\"\n\n[http_service]\n  internal_port = 8000\n  force_https = true\n  auto_stop_machines = false # Core는 상시 실행\n  auto_start_machines = true\n  min_machines_running = 1\n\n[[vm]]\n  size = \"shared-cpu-1x\" # Core는 가벼운 요청 처리 위주이므로 작게 시작\n  memory = \"512mb\"\n```\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 19, "total_chunks": null}}
{"id": "106aaa9f-d4f7-44a8-882b-3773700c066d", "content": "#### B. Sandbox Machine 제어 코드 (Python)\n\n이것이 FluxLoop의 핵심 경쟁력입니다. Core 서버에서 Fly Machines API를 호출하여 **격리된 실험 환경을 동적으로 생성**하는 로직입니다.\n\n```python\nimport httpx\nimport os\n\nFLY_API_TOKEN = os.getenv(\"FLY_API_TOKEN\")\nFLY_APP_NAME = \"fluxloop-sandbox-workers\" # Core와 별도의 App으로 격리 추천\n\nasync def spawn_sandbox_experiment(experiment_id: str, config: dict):\n    \"\"\"\n    특정 실험을 위한 1회성 Sandbox Machine을 생성하고 실행합니다.\n    \"\"\"\n    url = f\"https://api.machines.dev/v1/apps/{FLY_APP_NAME}/machines\"\n    \n    headers = {\n        \"Authorization\": f\"Bearer {FLY_API_TOKEN}\",", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 20, "total_chunks": null}}
{"id": "cde60784-d6b3-47d5-9fbf-8dc40c5e7464", "content": "        \"Content-Type\": \"application/json\"\n    }\n    \n    # 샌드박스 사양 정의 (실험 강도에 따라 동적 조절 가능)\n    payload = {\n        \"name\": f\"sandbox-{experiment_id}\",\n        \"region\": \"nrt\",\n        \"config\": {\n            \"image\": \"registry.fly.io/fluxloop-sandbox:latest\", # 미리 빌드된 샌드박스 이미지\n            \"guest\": {\n                \"cpu_kind\": \"shared\",\n                \"cpus\": 2,      # 실험용이므로 Core보다 고사양 할당 가능\n                \"memory_mb\": 2048 \n            },\n            \"auto_destroy\": True, # 중요: 프로세스 종료 시 VM 자동 삭제 (비용 절감)\n            \"restart\": {\"policy\": \"no\"}, # 실패해도 재시작 안 함 (디버깅 용이)", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 21, "total_chunks": null}}
{"id": "a2ea467c-4f9e-4b5f-a33b-06a729b0b5f0", "content": "            \"env\": {\n                \"EXPERIMENT_ID\": experiment_id,\n                \"CONFIG_JSON\": str(config) # 실험 설정 주입\n            },\n            # 실험 스크립트 실행 커맨드\n            \"init\": {\n                \"cmd\": [\"python\", \"run_experiment.py\"] \n            }\n        }\n    }\n\n    async with httpx.AsyncClient() as client:\n        response = await client.post(url, json=payload, headers=headers)\n        \n    if response.status_code == 200:\n        return response.json() # 생성된 머신 정보 반환\n    else:\n        # 에러 처리 로직\n        print(f\"Sandbox Start Failed: {response.text}\")", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 22, "total_chunks": null}}
{"id": "aa8b77be-7305-4982-8a64-6a8540bca61d", "content": "        return None\n```\n\n-----\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 23, "total_chunks": null}}
{"id": "d3f67984-dd74-4658-b939-bbca0ab90ec9", "content": "### 3\\. 이 구조가 FluxLoop에 최적인 이유 (검증)\n\n| 특징 | 기존 방식 (Celery/Queue) | **Fly Machines 방식 (추천)** | FluxLoop 이점 |\n| :--- | :--- | :--- | :--- |\n| **격리성** | Worker 프로세스 공유 (메모리 누수/충돌 위험) | **완벽한 VM 레벨 격리** | 실험 A가 터져도 실험 B에 영향 없음 (샌드박스 본질) |\n| **비용** | Worker 서버 상시 대기 (Idle 비용 발생) | **실행된 시간(초 단위)만 과금** | 실험 안 할 땐 비용 $0. LLM API 비용 방어 가능 |\n| **확장성** | Worker 수동 증설 필요 | **API 호출 한 번에 무한 증식** | 동시 실험 100개도 코드 한 줄로 처리 가능 |\n| **환경** | 의존성 충돌 가능성 | **Docker 이미지 기반** | 로컬 환경과 100% 동일한 재현성 보장 |\n\n-----\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 24, "total_chunks": null}}
{"id": "9b04d444-3fd5-4acd-bcfc-0be23a5b61b1", "content": "### 4\\. 배포 및 운영 체크리스트\n\n1.  **Docker Image 분리:**\n      * `fluxloop-core`: FastAPI 서버, DB 연결, API 엔드포인트.\n      * `fluxloop-sandbox`: 실제 LLM 에이전트가 구동되는 무거운 라이브러리 포함 이미지.\n2.  **Secrets 관리:**\n      * Fly.io Secrets 기능을 사용하여 `OPENAI_API_KEY` 등을 `fluxloop-sandbox` 앱에 미리 주입해 두거나, Machine 생성 시 `env`로 주입합니다.\n3.  **Log Aggregation:**\n      * Sandbox가 사라지면 로그도 사라질 수 있습니다. Sandbox 내부 코드에서 실험 결과와 중요 로그를 실행 즉시 Core 서버(Webhook)나 DB로 전송하도록 코딩해야 합니다.\n\n-----\n", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 25, "total_chunks": null}}
{"id": "cdca265e-4667-4a68-aada-25e768c0fb49", "content": "### 요약 및 다음 단계\n\n지금 바로 **Fly.io 계정을 생성하고 `fluxloop-core` 앱을 띄우는 것**부터 시작하면 됩니다. 이 구조는 나중에 **Hetzner + Coolify**로 넘어갈 때도, `spawn_sandbox_experiment` 함수 내부의 호출 타겟만 Docker API(또는 Coolify Webhook)로 바꾸면 되므로 **코드 폐기율이 거의 없습니다.**\n\n**다음으로 무엇을 도와드릴까요?**\n\n1.  `fluxloop-sandbox`용 **Dockerfile 예시** (필요한 라이브러리 최적화 포함)\n2.  실험 로그 및 결과를 Core로 다시 보내는 **Callback/Webhook 패턴 설계**\n3.  지금 바로 적용 가능한 **Fly.io 배포 명령어 세트** (Copy & Paste 용)", "metadata": {"source": "docs/prd/web/infra/infra_roadmap.md", "chunk_index": 26, "total_chunks": null}}
{"id": "fe9462b1-ed2b-4aea-9eac-33d5e1aef93e", "content": "[1 tool called]\n\n발견된 이슈들은 단순한 개선 사항이 아니라 **시스템이 정상적으로 동작하기 위해 반드시 수정해야 하는 치명적인 결함(Critical Bugs)**과 **보안 취약점**입니다. 현재 상태로는 실험이 성공해도 API가 에러를 뱉고, 샌드박스는 뚫려 있으며, 실시간 로그 기능은 작동하지 않습니다.\n\n각 항목별 수정 필요성과 계획을 정리해 드립니다.\n", "metadata": {"source": "docs/prd/web/patch_1.md", "chunk_index": 0, "total_chunks": null}}
{"id": "e9b8dcf2-6290-4feb-86ea-a80be7a70c41", "content": "### 1. API Crash 수정 (`KeyError`) - **긴급**\n*   **이유**: `RunnerService.run_experiment`가 반환하는 딕셔너리에 API가 기대하는 `trace` 키가 없습니다. 이로 인해 실험이 실제로는 성공했어도 API 응답은 500 에러가 발생하고, 프론트엔드/CLI에서는 \"실패\"로 인식됩니다.\n*   **계획**: `RunnerService`가 `trace` 객체 전체를 반환하도록 수정하여 API 스키마와 맞춥니다.\n", "metadata": {"source": "docs/prd/web/patch_1.md", "chunk_index": 1, "total_chunks": null}}
{"id": "4300b0c2-28c8-4376-9441-73cb9c03f115", "content": "### 2. Docker 보안 취약점 (Path Traversal) - **긴급**\n*   **이유**: `LocalDockerExecutor`가 파일 경로를 검증하지 않습니다. 에이전트가 `../../etc/passwd` 같은 경로로 시스템 파일에 접근할 수 있어 샌드박스의 격리 목적이 훼손됩니다.\n*   **계획**: 경로가 워크스페이스 내부인지 확인하는 `safe_join` 로직을 추가합니다.\n", "metadata": {"source": "docs/prd/web/patch_1.md", "chunk_index": 2, "total_chunks": null}}
{"id": "d86eb0fc-d464-4520-9d8a-70d2dc5087b2", "content": "### 3. Docker `shell=True` 미지원 - **필수**\n*   **이유**: `|` (파이프), `&&` (연쇄 실행), `>` (리다이렉션) 같은 쉘 기능이 포함된 명령어가 Docker 환경에서 실행되면 문법 에러로 실패합니다. 부트스트랩 단계의 스크립트들이 대부분 여기서 막힙니다.\n*   **계획**: `shell=True`일 때 명령어를 `[\"/bin/sh\", \"-c\", cmd]` 형태로 감싸서 실행하도록 수정합니다.\n", "metadata": {"source": "docs/prd/web/patch_1.md", "chunk_index": 3, "total_chunks": null}}
{"id": "1470f1fc-c195-4108-b607-53e00d9e01af", "content": "### 4. Docker 리소스 누수 (Workspace Leak) - **필수**\n*   **이유**: 실험이 끝날 때마다 호스트에 생성된 임시 디렉토리(Repo clone 등)가 삭제되지 않고 쌓입니다. 장기간 운영 시 디스크 공간 부족을 야기합니다.\n*   **계획**: `cleanup` 메서드에서 호스트 측 마운트 디렉토리도 삭제하도록 보완합니다.\n", "metadata": {"source": "docs/prd/web/patch_1.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c516c09f-91a1-406d-b1d0-35043550746e", "content": "### 5. 비동기 실행 (Async Streaming) - **중요**\n*   **이유**: 현재 API는 실험이 끝날 때까지 응답을 주지 않습니다(Blocking). 사용자는 실험이 진행되는 수십 초~수 분 동안 \"로딩 중\"만 보게 되며, 실시간 로그 스트리밍(`--follow`)이 불가능합니다.\n*   **계획**: `BackgroundTasks`를 도입하여 API는 `Accepted`를 즉시 응답하고, 실험은 백그라운드에서 돌도록 구조를 변경합니다.\n\n---\n\n이 수정 사항들을 진행하기 위해 **TODO 리스트**를 생성했습니다. 가장 급한 **API Crash**와 **Docker 관련 버그**부터 순차적으로 수정하겠습니다.\n\n**첫 번째로 API Crash 문제부터 해결하시겠습니까?**", "metadata": {"source": "docs/prd/web/patch_1.md", "chunk_index": 5, "total_chunks": null}}
{"id": "9537c8b6-6578-47c5-910e-91093de18c61", "content": "# FluxLoop Web POC Implementation Plan\n> **Target Status:** Draft\n> **Version:** 1.0\n> **Goal:** Build a Minimum Viable Product (MVP/POC) to demonstrate the end-to-end flow: Git Connect -> Run Simulation -> View Result.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "80df51f6-6d24-4c95-affe-a49709314de9", "content": "## 1. POC Scope (What to build first)\n\nTo validate the core value quickly, we will limit the scope for the POC:\n\n- **Source:** Local directory or Single Public GitHub Repo (Hardcoded or simple input).\n- **Auth:** Supabase Auth (Email/Password or GitHub).\n- **Runner:** Local Subprocess Runner (instead of full K8s/Cloud Sandbox).\n- **Frontend:** Minimal Dashboard & Trace Viewer.\n- **Database:** Supabase (PostgreSQL).\n\n**Core User Story for POC:**\n1. User logs in (Supabase Auth).\n2. User inputs a GitHub URL (must have `fluxloop` setup).", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "9790e249-173d-41f0-8cc8-c0bac8deb3ab", "content": "3. User clicks \"Run Experiment\".\n4. Backend clones repo, runs `fluxloop run`, streams logs.\n5. User views the list of traces and pass/fail status.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "f0108f57-d06f-4739-896e-34c82c2a3238", "content": "## 2. Directory Structure (services/web)\n\nWe will create a new `services/web` directory to house the full-stack application.\n\n```\nservices/\n  collector/          # Existing service (keep as is)\n  web/                # NEW: Web Platform\n    backend/          # FastAPI Backend\n      app/\n        api/          # Endpoints\n        core/         # Config, Supabase Client\n        models/       # Pydantic schemas (DB models managed by Supabase)\n        services/     # Business Logic (Runner, Git)\n      main.py         # Entrypoint", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "30ba6c03-b31b-4101-adda-acd5795f9643", "content": "    frontend/         # Next.js Frontend (optional for POC, or use simple Jinja templates/React)\n      app/\n      components/\n      lib/\n      supabase/       # Supabase types/client\n    run_poc.sh        # One-click script to start everything\n```\n\n---\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "267d5500-f4df-4f1e-9f43-b4a2b5912d94", "content": "## 3. Implementation Steps\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "ee2f2d48-9ba1-48ec-a047-eeded97422a6", "content": "### Step 1: Supabase Setup & Backend Scaffold\n- **Task:** Create Supabase project.\n- **Task:** Define SQL Schema (Projects, Experiments, Traces).\n- **Task:** Setup FastAPI with `supabase-py` client.\n- **Deliverable:** API connected to Supabase DB.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "5b85261b-5996-4dd3-855d-7efbe74c31d9", "content": "### Step 2: Git & Runner Service (The Core Logic)\n- **Task:** Implement `GitService` to clone/pull repos to a temp dir.\n- **Task:** Implement `RunnerService` to execute `fluxloop-cli` as a subprocess.\n- **Task:** Store results to Supabase DB (`traces` table).\n- **Deliverable:** `POST /api/v1/experiments/run` endpoint + CLI helper (`python -m app.cli.run_experiment`) returning the new `trace_id` for downstream UI.\n- **TODO:** Extend experiment metadata to capture FluxLoop project configuration (project subdirectory, environment bootstrap commands, default CLI flags) so the runner knows exactly where/how to execute within the repo.", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "1cef57ee-6b4b-406b-bab6-010beeaca5ed", "content": "### Step 2.5: Execution Profile Capture (New)\n- **Goal:** Mirror the FluxLoop VSCode extension’s project setup UX while tailoring it for the web.\n- **Reference:** Review `packages/vscode/src/commands/projectCommands.ts`, `environmentDiscovery.ts`, and related UX docs (e.g., `docs/prd/polish/polish_1_plan.md`) to extract the required inputs (project root, configs, interpreter/venv, bootstrap scripts).\n- **Tasks:**\n  - Extend Supabase schema (`projects`, `experiments`) with fields such as `project_subdir`, `bootstrap_command`, `default_args`, `env_vars`, `runtime_driver`.", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "d5d4e7fe-62e8-407e-8c1d-edc64a7a1536", "content": "  - Design a backend “execution profile” model (Pydantic schema + CRUD endpoints) that persists these fields and surfaces them to the runner.\n  - Update `RunnerService` to: \n    1. Change directory into the configured `project_subdir`.\n    2. Execute `bootstrap_command` steps (e.g., `uv sync`, custom shell scripts) with live SSE logging.\n    3. Run the FluxLoop CLI with `default_args`, merging any ad-hoc overrides from the launch request.\n  - Record bootstrap/log artifacts (success/failure) in Supabase Storage for auditability.", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "4a090572-5d7d-4296-aa1d-f436d60b791d", "content": "- **Deliverable:** A fully reproducible “ExecutionProfile” linked to each experiment so that sandbox runs are deterministic even when the raw Git repo lacks FluxLoop scaffolding.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "877de6f6-864c-4e96-8fc2-cad8d4983c77", "content": "#### 2.5.1 Database Schema Proposal\n- **`execution_profiles`**\n  - `id uuid primary key`\n  - `project_id uuid references projects(id)`\n  - `name text` (human-friendly label, e.g. “Default tutorial profile”)\n  - `project_subdir text` (relative path from repo root to FluxLoop project, e.g. `fluxloop_projects/tutorial`)\n  - `bootstrap_steps jsonb` (ordered list of `{name, command, shell}` objects to run before the experiment; default includes `uv sync`)\n  - `default_cli_args jsonb` (array of strings appended after `fluxloop run experiment`)", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "101ed326-d982-4b33-9a82-847c56736dca", "content": "  - `env_vars jsonb` (key/value pairs applied during bootstrap + run)\n  - `python_environment jsonb` (mirrors VSCode’s environment metadata: `{type, path, interpreter}`; optional for remote runners)\n  - `artifacts_config jsonb` (optional hints for where results/logs live inside the repo/project)\n  - `created_by uuid`, `created_at timestamptz`, `updated_at timestamptz`\n- **`experiments` (add columns)**\n  - `execution_profile_id uuid references execution_profiles(id)`\n  - `cli_args_override jsonb` (optional array to append/override per run)", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4c9b1575-b0d9-4852-be21-f60706721272", "content": "  - `env_override jsonb` (per-run env additions)\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "be079cdd-c1ee-49f4-9bd1-bf51a3b6fcc0", "content": "#### 2.5.2 API Shapes\n- `POST /api/v1/execution-profiles` → create a profile\n  - Body: `ExecutionProfileCreate`\n    ```json\n    {\n      \"project_id\": \"...\",\n      \"name\": \"Default tutorial\",\n      \"project_subdir\": \"fluxloop_projects/tutorial\",\n      \"bootstrap_steps\": [\n        {\"name\": \"Install deps\", \"command\": \"uv sync\", \"shell\": \"/bin/zsh\"}\n      ],\n      \"default_cli_args\": [\"--config\", \"configs/simulation.yaml\"],\n      \"env_vars\": {\"PYTHONUNBUFFERED\": \"1\"},\n      \"python_environment\": {\"type\": \"venv\", \"path\": \".venv\", \"interpreter\": \".venv/bin/python\"}", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "5477f807-d1a1-42e9-a528-4dca345c9d55", "content": "    }\n    ```\n- `GET /api/v1/execution-profiles?project_id=...` → list profiles for selection in the UI.\n- `PATCH /api/v1/execution-profiles/{id}` → update fields when the user edits the configuration wizard.\n- Experiments `POST /api/v1/experiments/run` request body gains optional `execution_profile_id`, `cli_args_override`, `env_override`.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "4c0c942c-8dd1-41b2-af45-c19ec863a24d", "content": "#### 2.5.3 Runner Changes\n- Lookup execution profile; fail fast with `422` if missing required fields.\n- Change working directory to `repo_root / project_subdir`.\n- For each `bootstrap_step`:\n  1. Emit SSE event `bootstrap_start`.\n  2. Run command via shell (default `/bin/sh`), stream output.\n  3. On failure → mark experiment `failed_bootstrap`, stop run, persist log artifact.\n- After bootstrap, assemble CLI command `[fluxloop, \"run\", \"experiment\", *default_cli_args, *cli_args_override]`.\n- Merge `env_vars` + `env_override`, ensuring secrets filtered from SSE payload.", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "075a45e4-64ba-4043-a918-c95b1c61c22e", "content": "- Persist per-step timing/exit codes into `traces.result_data.bootstrap`.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "2e3896b8-24f6-4def-9f33-e2a8ba0c2119", "content": "#### 2.5.4 Frontend Wizard Requirements\n- **Detection pass:** When user connects a repo, call a detection endpoint (`GET /api/v1/execution-profiles/suggest`) that:\n  - Scans for directories matching `fluxloop_projects/**`, `configs/simulation.yaml`, `setting.yaml` (reuse VSCode heuristics).\n  - Returns candidate profiles (subdir path + default CLI args).\n- **Creation flow:** If no profile, show wizard with:\n  1. Project path picker (autocomplete based on detection).\n  2. Bootstrap script editor (pre-populated with `uv sync`).", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "e4500a22-e8fc-4ce7-ab62-6f4e60cf70ee", "content": "  3. CLI argument editor (chips or textarea).\n  4. Optional environment metadata (interpreter path).\n- **Reuse flow:** If profiles exist, let user select existing or “Create new”.\n- On submit, call `POST /execution-profiles`, then show confirmation and allow immediate experiment launch.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "7e28b402-eb16-49a1-86a3-ac5f93d6e446", "content": "### Step 3: Log Streaming (Realtime)\n- **Task:** Stream stdout via HTTP Server-Sent Events (SSE) endpoint (lighter than full WebSocket).\n- **Backend implementation:** FastAPI `EventSourceResponse` wraps a generator that tails runner stdout and yields newline-delimited JSON objects (`{\"line\": \"...\", \"timestamp\": ...}`) as the process runs. Endpoint accepts `experiment_id`/`trace_id` to correlate updates.\n- **Frontend consumption:** Use the browser-native `EventSource` API; append incoming lines to the log viewer with auto-scroll & manual pause.", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 21, "total_chunks": null}}
{"id": "392f54dd-94e0-4f7b-aacc-0b1a3f7be957", "content": "- **Persistence to Supabase Storage:** Buffer streamed lines to a temporary file; once the run finishes, upload the file to `supabase://storage/logs/{experiment_id}/{trace_id}.log` and update the trace record with the storage path.\n- **Fallback:** If SSE is blocked (older proxies), fall back to periodic HTTP polling that fetches appended log chunks from Supabase Storage.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 22, "total_chunks": null}}
{"id": "d6873375-0695-458d-ac6b-d66a8e0ccd57", "content": "### Step 4: Frontend - Experiment Launcher\n- **Task:** Login page (Supabase Auth UI).\n- **Task:** Simple page to input Repo URL and Commit Hash.\n- **Task:** \"Run\" button that calls the API.\n- **Upcoming extension:** Add a configuration wizard that:\n  - Detects existing FluxLoop projects within the repo (scan for `fluxloop_projects/**`, `configs/`, `setting.yaml`).\n  - Offers a guided setup when no project is found (inspired by VSCode Default/Custom flows) to gather execution profile data.\n  - Stores the captured profile via the Step 2.5 APIs before triggering a run.", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 23, "total_chunks": null}}
{"id": "eddf42cc-9cb9-4ea4-9f14-7b7bee13560d", "content": "### Step 5: Frontend - Result Viewer\n- **Task:** Trace list page (Fetch from Supabase).\n- **Task:** Detail view showing the conversation.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 25, "total_chunks": null}}
{"id": "60009dd7-377b-4250-ae5e-77b4db7aeb2b", "content": "## 4. Tech Stack for POC\n\n- **Language:** Python 3.11+ (Backend), TypeScript/React (Frontend).\n- **Frameworks:** FastAPI, Next.js.\n- **DB & Auth:** Supabase.\n- **Deployment:** Localhost only.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 26, "total_chunks": null}}
{"id": "544568fe-035a-4d43-af14-34957f4eb004", "content": "## 5. Next Actions\n1. Create `services/web` structure.\n2. Initialize `backend` with FastAPI.\n3. Initialize `frontend` with Next.js (using `create-next-app`).\n4. Connect them via a proxy or CORS.\n5. Draft the Execution Profile schema + API (Step 2.5) using the VSCode extension implementation as a requirements baseline.\n6. Prototype the frontend configuration wizard to populate execution profiles before runs.\n\nLet's start with **Step 1 & 2: Backend & Runner Logic**.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan.md", "chunk_index": 27, "total_chunks": null}}
{"id": "a6b51092-9453-49d6-9f91-05631e15c636", "content": "# FluxLoop Web POC Implementation Plan V2\n> **Status:** Draft\n> **Goal:** Extend the Web POC to support the full FluxLoop workflow (Init -> Generate -> Run -> Parse -> Evaluate) using the stabilized Runner V2 infrastructure.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 0, "total_chunks": null}}
{"id": "e1647c2e-fa7d-4d82-b7ab-6b38716f0392", "content": "## 1. Overview\n\nWe have successfully implemented `Runner V2` (with Docker isolation) and `Agent Service` (Interactive/Deep Agent).\nNow we need to close the gap between the current backend capabilities and the full CLI feature set.\n\n**Core Missing Features:**\n1. **Project Init**: `fluxloop init` (Bootstrapping new projects)\n2. **Input Generation**: `fluxloop generate inputs`\n3. **Trace Parsing**: `fluxloop parse` (Preprocessing results for eval)\n4. **Evaluation**: `fluxloop evaluate`\n5. **Artifact Management**: Persisting inputs, parsed traces, and evaluation results.", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 1, "total_chunks": null}}
{"id": "6974462d-d96a-4591-9488-c531666e1e55", "content": "\n---\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 2, "total_chunks": null}}
{"id": "39a6a39d-aca0-4ed8-b24b-d815c0879331", "content": "## 2. Extended Architecture\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 3, "total_chunks": null}}
{"id": "dabc7f49-6b09-4816-bff8-9987ec431f2f", "content": "### 2.1 Service Layer Expansion\nThe `RunnerService` is generic enough to run any command. We will add facade methods for specific workflows.\n\n```python\nclass RunnerService:\n    # Existing\n    def run_experiment(...) -> Trace\n\n    # New\n    def init_project(self, repo_url: str, template: str) -> Project\n    \n    def generate_inputs(self, repo_url: str, profile: ExecutionProfile, ...) -> InputDataset\n\n    def parse_trace(self, trace_id: str) -> ParsedTrace\n\n    def evaluate_experiment(self, experiment_id: str, ...) -> EvaluationResult", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 4, "total_chunks": null}}
{"id": "596ff586-1daa-4ce7-be46-c1e5958b4a16", "content": "```\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 5, "total_chunks": null}}
{"id": "f9ad81b4-edf9-43e7-b257-8e0f8178fa29", "content": "### 2.2 Data Model Extensions (Supabase)\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 6, "total_chunks": null}}
{"id": "070ff79b-1966-4d56-9d66-62279fef3cbd", "content": "#### `input_datasets`\n- Metadata about generated `inputs.jsonl`.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 7, "total_chunks": null}}
{"id": "0ef098da-6eac-4f8e-8899-4a1abcea30ac", "content": "#### `evaluations`\n- Evaluation run results linked to an experiment.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 8, "total_chunks": null}}
{"id": "451cacce-b48f-4162-93de-48bb531253e1", "content": "#### `trace_summaries` (New)\n- Metadata about parsed trace files (`trace_summary.jsonl`) ready for evaluation.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 9, "total_chunks": null}}
{"id": "b40dc579-bca3-473d-93b8-2a62c4ebe222", "content": "## 3. Synchronization Strategy\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 10, "total_chunks": null}}
{"id": "0f9e17ff-5479-4e20-ae9d-d2ff9b70d9fd", "content": "### 3.1 Configuration Sync: \"DB First + Runtime Injection\"\n- Web UI edits DB -> Runner injects YAML files at runtime.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 11, "total_chunks": null}}
{"id": "989ee723-a366-45c0-849f-6d232183df57", "content": "### 3.2 Result Sync: \"Batch Upload\" (Collector Removed)\n- **No separate Collector service.**\n- VS Code / Runner runs experiment offline (logging to `traces.jsonl`).\n- Upon completion, VS Code uploads the `jsonl` files to Web Backend.\n- Backend saves to Storage and triggers ETL for DB population.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 12, "total_chunks": null}}
{"id": "37809abc-bfac-4bb5-bbcf-dd45e10e5b3d", "content": "## 4. Detailed Implementation Steps\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 13, "total_chunks": null}}
{"id": "5bf59237-bd73-4b6c-8fe9-4ca127c6c18b", "content": "### Phase 0: Project Initialization (`init`)\n**Goal:** Bootstrap a new FluxLoop project in an empty repo.\n\n> VS Code expects the user to drive onboarding. The Web backend must perform the same sequence autonomously right after connecting a repo.\n\n1.  **Workspace Detection**\n    - After cloning, inspect the repo for `configs/project.yaml` (or `.fluxloop/root`) to determine whether a FluxLoop root already exists.\n    - **Existing Project:** Reuse the detected root (respect custom `fluxloop.projectRoot`) and skip bootstrap—identical to VS Code’s “Custom flow”.", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 14, "total_chunks": null}}
{"id": "8434c7a0-3e75-4fdc-891e-a54f0ed2619c", "content": "    - **New Project:** Continue with the automated pipeline below.\n\n2.  **Backend: `init` API**\n    - Endpoint: `POST /api/v1/projects/init`\n    - Logic:\n        - Setup workspace (clone empty repo).\n        - Run `fluxloop init --template ...` using the **default** VS Code flow (shared root + interpreter discovery).\n        - Commit and Push changes to the repo.\n        - Register project in DB.\n\n3.  **MCP Integration Bootstrap**\n    - Call `fluxloop-mcp` (`run_integration_workflow` or `fetch_integration_context`) to analyze the freshly initialized repo.", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 15, "total_chunks": null}}
{"id": "a877b58d-cf50-42f0-a0b3-59d47b0f4585", "content": "    - Store the resulting integration plan + checklist so that the backend (or future code agent) can apply edits automatically.\n    - Persist MCP outputs per project so that subsequent agent runs can reuse the cached context.\n4.  **FluxLoop Root Policy (Unified with VSCode)**\n    - **Auto-detect existing roots**: if `configs/project.yaml` or `fluxloop.projectRoot` metadata is present, reuse that directory. No manual prompt in the web wizard.\n    - **Shared default root**: when no root exists, always create the project under the shared folder (`~/FluxLoopProjects/<project-name>` by default, matching `fluxloop.projectRoot` semantics).", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 16, "total_chunks": null}}
{"id": "7e2cb2eb-158a-4323-9cce-cecc8b5ca401", "content": "    - The wizard surfaces the resolved path for transparency, while advanced overrides live in separate project settings (not the default flow).\n    - ✅ `POST /api/v1/projects/init` (RunnerService.init_project) implements workspace detection, automatic `fluxloop init`, git commit/push, and MCP cache upload.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 17, "total_chunks": null}}
{"id": "47234fcd-1320-4734-a2ac-75be4470544b", "content": "### Phase 1: Input Generation (`generate`)\n**Goal:** Generate test cases from the web UI.\n\n1.  **Backend: `generate_inputs` API**\n    - Endpoint: `POST /api/v1/inputs/generate`\n    - Logic:\n        - Setup workspace.\n        - Inject `input.yaml` from DB.\n        - Run `fluxloop generate inputs`.\n        - Upload `inputs.jsonl` to Storage.\n        - ✅ Implemented via `InputGenerationRequest` + `RunnerService.generate_inputs`, storing artifacts in Supabase Storage.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 18, "total_chunks": null}}
{"id": "bb14e16f-cda7-4218-884a-1de423dd1fc1", "content": "### Phase 2: Execution & Parsing (`run` + `parse`)\n**Goal:** Run experiment and automatically prepare data for evaluation.\n\n1.  **Backend: `upload_results` API**\n    - Endpoint: `POST /api/v1/experiments/{id}/results`\n    - Payload: `traces.jsonl`, `observations.jsonl` (multipart or JSON content)\n    - Logic:\n        - Save files to Supabase Storage (e.g., `experiments/{id}/traces.jsonl`).\n        - Trigger async task to parse traces and update `traces` table.\n        - ✅ Implemented via enhanced upload endpoint that stores artifacts in Supabase and generates per-trace analysis.", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 19, "total_chunks": null}}
{"id": "b5ad77ee-dfd2-4c6d-95b0-070064f6a25e", "content": "\n2.  **Runner/VS Code Update**:\n    - `run_experiment` runs locally/remote.\n    - On success/failure, read local `experiments/latest/*.jsonl`.\n    - Call `upload_results` API.\n        - ✅ RunnerService now enforces deterministic output directories, auto-runs `fluxloop parse`, and uploads artifacts for evaluation.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 20, "total_chunks": null}}
{"id": "7bfc0f72-b8b8-4ad4-95c6-c4aca8c2ca63", "content": "### Phase 3: Evaluation (`evaluate`)\n**Goal:** Run evaluators on parsed results.\n\n1.  **Backend: `evaluate` API**\n    - Endpoint: `POST /api/v1/experiments/{id}/evaluate`\n    - Logic:\n        - Setup workspace.\n        - Download `trace_summary.jsonl`.\n        - Inject `evaluation.yaml`.\n        - Run `fluxloop evaluate`.\n        - Upload results and update DB.\n        - ✅ Implemented via `EvaluationRequest` + RunnerService `evaluate_experiment`, persisting summaries/reports in Supabase.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 21, "total_chunks": null}}
{"id": "ba95797a-13d7-4195-975d-1c56293d7cb9", "content": "## 5. Refined Workflow (User Journey)\n\n1.  **Init**: User enters empty repo URL -> FluxLoop pushes template code.\n2.  **Generate**: User configures inputs -> FluxLoop generates `inputs.jsonl`.\n3.  **Run**: User runs experiment -> FluxLoop runs -> parses -> saves summary.\n4.  **Evaluate**: User clicks \"Evaluate\" -> FluxLoop scores the summary.\n", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 22, "total_chunks": null}}
{"id": "f1ed01dc-c268-4c62-a3dd-f8f1dbdb593a", "content": "## 6. Next Actions\n1.  Implement workspace detection + branching (existing FluxLoop root vs blank repo).\n2.  **Remove `services/collector` code.**\n3.  Implement `upload_results` endpoint in Web Backend.\n4.  Update VS Code to upload results after experiment.\n5.  Integrate MCP bootstrap (cache `run_integration_workflow` outputs per project).\n6.  Update DB Schema for inputs/evals.\n7.  Implement `init` and `generate` endpoints.", "metadata": {"source": "docs/prd/web/poc_implementation_plan_v2.md", "chunk_index": 23, "total_chunks": null}}
{"id": "b0fbb88f-e289-44a8-a4cc-30bdda18df5e", "content": "# FluxLoop Web POC v3 구현 계획  \n> **버전:** 0.2 (Updated)  \n> **작성일:** 2025-11-24  \n> **참고 문서:** `poc_implementation_plan_v2.md`, `fluxloop_v4_concept.md`\n\n---\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "40789135-1618-4fdc-af80-63ae9baef341", "content": "## 1. 목표 (Updated)\n1. **단일 웹 경험 완성**: Init → Generate → Run → Parse → Evaluate 전 과정을 Web UI에서 수행.\n2. **Agent Console 통합**: LangGraph 기반 ReAct/DeepAgent 이벤트를 실시간으로 보여주는 콘솔 구현 (V3: Read-only).\n3. **배포 가능한 MVP**: Fly.io + Supabase 조합으로 백엔드/프론트엔드를 실제로 배포하고 데모 가능 상태 확보.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "8119a57a-41c0-4efe-9bf5-9a26c27ff7c5", "content": "## 2. 사용자 여정 (V2 대비 개선점)\n| 단계 | UX 목표 | Backend 연동 |\n| --- | --- | --- |\n| **Connect Repo** | GitHub App 연동 → `POST /projects/init` 호출 후 Init Progress UI 표시. **FluxLoop 루트는 사용자가 입력하지 않으며, 기존 `configs/project.yaml` 또는 `fluxloop.projectRoot`가 감지되면 해당 경로를 자동 재사용하고, 없으면 기본 공용 루트(`~/FluxLoopProjects/<project-name>`)에 자동 생성** | Runner `init_project`, MCP 분석 |\n| **Configure** | Execution Profile 폼 (project_subdir, bootstrap, env vars 등) + Inputs/Evaluators Form | Supabase `execution_profiles`, `input_datasets` |\n| **Run & Monitor** | Run Modal + SSE Log Stream + 상태 카드 | `/experiments/run`, Live log SSE |", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "d4dee563-9305-4ea6-845b-35afd0d2ff2c", "content": "| **Parse/Evaluate** | 자동 Parse 결과, Evaluate 버튼 → 요약 카드 + 리포트 링크 | `/experiments/{id}/results`, `/experiments/{id}/evaluate` |\n| **Agent Console** | Chat/Action UI에서 Plan → Tool → Verify 단계 확인 | `/api/v1/agents/run` SSE |\n\n---\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "8e45b948-2702-49be-a3e2-82865b6632d4", "content": "## 3. 프론트엔드 구현 계획 (`services/web/frontend`)\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "54e62735-88ad-46cb-95c1-c771481fc107", "content": "### 3.1 기술 스택\n- Next.js 15 + App Router\n- shadcn/ui 컴포넌트 + Tailwind\n- **Auth**: **Supabase Auth (SSR)**\n- **AI SDK – AI Elements** (로그 뷰어로 활용)\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "ef5e4717-5b9f-4eb1-9a0f-e36673cc0dc4", "content": "### 3.2 주요 변경 사항 (V4 이관 항목)\n다음 기능들은 V3의 \"안정적인 실행\" 목표 달성 후 V4(Interactive Platform)에서 다루기로 결정되었습니다 (`fluxloop_v4_concept.md` 참조).\n\n1.  **Real-time Status Sync**: V3에서는 **Polling**으로 해결. WebSocket 기반 양방향 상태 동기화는 V4로 이관.\n2.  **Interactive Console**: V3 Agent Console은 **Read-only**. 실행 중 개입(Pause/Resume)은 V4로 이관.\n3.  **Input Generation UI**: 복잡한 생성 로직은 CLI/Script 위주로 유지하고, 웹 UI는 실행 트리거 역할에 집중.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "d3e9b6ee-0f13-4840-8b81-2973d27a8997", "content": "## 4. 백엔드/Runner 반영 사항 (Completed)\n| 기능 | 상태 | 비고 |\n| --- | --- | --- |\n| `init_project` | 완료 | Indentation 오류 수정됨 |\n| `generate_inputs` | 완료 | Executor 기반 파일 처리 통일 |\n| `run_experiment` | 완료 | CLI Magic Prefix 프로토콜 추가 |\n| `evaluate_experiment` | 완료 | 대용량 Artifact 다운로드(stdin archive) 개선 |\n| **Refactoring** | 완료 | `RunnerService` → `Context` + `Handler` 패턴으로 전면 개편 |\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "4f7bd4db-9c34-44d8-86ee-ab90f49b40c1", "content": "### 4.1 FluxLoop 루트 자동화 정책\n- **자동 감지 우선순위**: Runner가 `configs/project.yaml` 또는 `fluxloop.projectRoot` 메타를 찾으면 해당 디렉터리를 즉시 재사용한다.\n- **공용 루트 기본값**: 감지된 루트가 없으면 `~/FluxLoopProjects/<project-name>` (VScode와 동일한 공용 루트) 하위에 새 프로젝트를 생성한다.\n- **Wizard 입력 제거**: Web Init Wizard는 루트 경로를 직접 묻지 않으며, 위 규칙에 따라 계산된 경로를 UI에 안내만 한다. 고급 사용자는 별도의 프로젝트 설정에서만 override 할 수 있다.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "d0a8f49f-b23b-4d21-a7d9-3d6b187f0b6e", "content": "## 5. 인프라 & 배포 전략\n1. **1단계 – Fly.io + Vercel**\n   - 백엔드: Fly.io (Runner 포함)\n   - 프론트엔드: Vercel\n   - DB/Storage: Supabase Hosted\n2. **Runner Security**\n   - V3: `LocalDockerExecutor` 사용 (Fly.io 머신 내 Docker-in-Docker 또는 로컬 프로세스 격리).\n   - V4: Kubernetes / Firecracker 기반 Multi-tenant 격리 도입 예정.\n\n---\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "01df58b2-7d60-42d1-b07a-5d427ee7d969", "content": "## 6. 일정 (잔여 작업)\n| 주차 | 주요 작업 |\n| --- | --- |\n| Week 1-2 | (완료) Auth, Init Flow, Run/Eval UI, Runner Refactoring |\n| Week 3 | Fly.io 배포, 베타 프로젝트 연결, QA 시나리오 작성 |\n| Week 4 | 피드백 반영, 문서화, 데모 준비 |\n\n---\n", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "67f4d1ad-9806-4d24-8051-d1de78543aa4", "content": "## 7. 결론 (Updated)\nV3 개발 과정에서 **Runner의 안정성(대용량 파일 처리, Docker 호환성)과 코드 구조(Facade 패턴)**를 대폭 개선했습니다.\n이제 남은 것은 **실제 배포 환경에서의 검증**과 **문서화**입니다. 복잡한 상호작용 기능은 V4 로드맵으로 명확히 분리함으로써, V3는 \"신뢰할 수 있는 실험 파이프라인\"으로서의 완성도를 높이는 데 집중합니다.", "metadata": {"source": "docs/prd/web/poc_v3_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "e59ba916-f76f-4ecb-9a67-fca54843d2ac", "content": "# FluxLoop Sandbox & Coding Agent Roadmap\n\n이 문서는 FluxLoop의 실행 환경(Sandbox)과 그 위에서 동작할 지능형 주체(Coding Agent)의 진화 방향을 정의합니다.\n\n---\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 0, "total_chunks": null}}
{"id": "246f090f-a518-4d12-9202-c63e83ecce41", "content": "## 🌏 Part 1: Sandbox Infrastructure (실행 환경)\n\n**목표**: \"오래 걸리는 실험(Experiment)을 가장 저렴하고 안정적으로 실행하는 자체 인프라 구축\"\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 1, "total_chunks": null}}
{"id": "cb0b9b7d-4610-486d-aab6-b37d3f30587e", "content": "### Phase 1: Runner V2 안정화 (완료 ✅)\n- **핵심**: 경로 꼬임 해결, 단일 워크스페이스 구조 확립.\n- **구현체**: `LocalProcessExecutor` (로컬 `subprocess`).\n- **상태**: `Running` (FluxLoop 로컬 개발 환경).\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 2, "total_chunks": null}}
{"id": "9b4601a2-3cdb-4244-9f19-7ada304fd355", "content": "### Phase 2: Docker 기반 격리 (완료 ✅)\n- **목표**: 로컬 환경 오염 방지 및 기본적인 리소스 격리.\n- **구현체**: `LocalDockerExecutor`.\n- **작업**:\n  - `RunnerService`가 호스트의 Docker Daemon(`unix:///var/run/docker.sock`)을 통해 컨테이너 실행.\n  - 워크스페이스를 Docker Volume으로 마운트하여 데이터 영속성 확보.\n  - `fluxloop-runner` 베이스 이미지 구축 (Python, uv, git 미리 설치).\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 3, "total_chunks": null}}
{"id": "aff2ff75-04b9-4d64-b75c-45d36e1ba312", "content": "### Phase 3: 자체 클러스터 구축 (중기 목표)\n- **목표**: 다중 동시 실행(Parallel Execution) 및 비용 최적화.\n- **구현체**: `K8sExecutor` (또는 `RemoteDockerExecutor`).\n- **전략**: **AWS Spot Instances / GCP Preemptible VMs** 활용.\n  - 실험(Experiment)은 중단되어도 재시작하면 되므로, 저렴한 Spot 인스턴스가 최적.\n  - K8s Job으로 실험 하나를 매핑하여, 실행 후 Pod(및 노드) 자동 종료.\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 4, "total_chunks": null}}
{"id": "33c7ea17-5aef-413c-bf45-12de985d2d5d", "content": "### Phase 4: 하이브리드 샌드박스 (장기 목표)\n- **목표**: 보안 수준에 따른 유연한 환경 선택.\n- **전략**:\n  - **내부 신뢰 코드**: 자체 클러스터(K8s)에서 실행 (비용 절감).\n  - **외부 불신 코드(Untrusted)**: Vercel Sandbox / Firecracker VM으로 격리 실행 (보안 강화).\n\n---\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 5, "total_chunks": null}}
{"id": "864c2f0a-4c00-4dc9-9ba8-88eba5ea926f", "content": "## 🤖 Part 2: Coding Agent Evolution (지능형 주체)\n\n**목표**: \"단순 스크립트 실행을 넘어, 스스로 코드를 읽고 고치고 검증하는 에이전트 개발\"\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 6, "total_chunks": null}}
{"id": "201aaf7e-28c6-493f-bae3-3ff0278686c1", "content": "### Phase 1: Script Runner (완료 ✅)\n- **기능**: 미리 정의된 시나리오(Simulation)를 한 번 실행하고 결과 수집.\n- **한계**: 동적 수정 불가능. 정해진 입력에 정해진 출력만 나옴.\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 7, "total_chunks": null}}
{"id": "0095c4fc-86a7-4173-8b94-6aa3b112b4fd", "content": "### Phase 2: Interactive Workbench (완료 ✅)\n- **목표**: 샌드박스를 'API화'하여 에이전트가 도구로 활용.\n- **작업**: `SandboxExecutor` 인터페이스 확장.\n  - `read_file(path)`: 코드 읽기.\n  - `write_file(path, content)`: 코드 수정.\n  - `exec_command(cmd)`: 테스트 실행, 린트 검사.\n- **시나리오**: 에이전트가 `test_*.py` 실패 로그를 보고 → 소스 수정 → 다시 테스트 실행.\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 8, "total_chunks": null}}
{"id": "6ba73f34-b10a-44b2-9aaf-9ed63d4763ff", "content": "### Phase 3: Plan-and-Execute Agent (완료 ✅)\n- **목표**: `langchain-ai/open-swe` 스타일의 계획 기반 에이전트.\n- **워크플로우**:\n  1. **Planner**: 이슈 분석 후 \"A파일 수정 → B테스트 추가\" 계획 수립.\n  2. **Human**: 계획 승인/반려.\n  3. **Executor**: 샌드박스 API를 통해 계획 수행.\n  4. **Verifier**: 실행 결과(테스트 통과 여부) 판단 후 재시도/완료 결정.\n- **구현체**: `DeepAgent` Graph + Planning Tools (`write_todos`, `update_todo`).\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 9, "total_chunks": null}}
{"id": "40424ea6-8db2-425c-afae-fa07e2ce583e", "content": "### Phase 4: GitOps Agent (장기 목표 🚧)\n- **목표**: 개발 프로세스(Branch, PR)에 직접 통합.\n- **기능**:\n  - 스스로 `git checkout -b` 브랜치 생성.\n  - 작업 완료 후 `git push` 및 GitHub API로 PR 생성.\n  - CI 피드백(GitHub Actions 실패 등)을 보고 스스로 PR 수정 커밋(Push).\n\n---\n", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 10, "total_chunks": null}}
{"id": "0b02cd65-0ef2-4b38-ae64-91eedcfaeb06", "content": "## 🗺️ 통합 마일스톤 (Integrated Milestone)\n\n| 시기 | Sandbox (Infra) | Agent (Logic) | 목표 시나리오 |\n|------|-----------------|---------------|---------------|\n| **Step 1 (완료)** | `LocalDockerExecutor` | `File I/O API` | 에이전트가 컨테이너 안에서 파일 하나를 고치고 테스트를 통과시킴. |\n| **Step 2** | `K8sExecutor` (Spot) | `Plan-Execute` | 사용자 요청(\"버그 고쳐줘\")을 받아 계획을 세우고 저렴한 클러스터에서 해결책 찾기. |\n| **Step 3** | `Hybrid Cluster` | `GitOps` | 에이전트가 밤새 수십 개의 이슈를 병렬로 처리하고 아침에 PR 목록을 제출. |", "metadata": {"source": "docs/prd/web/roadmap_sandbox_and_agents.md", "chunk_index": 11, "total_chunks": null}}
{"id": "bbba44b5-7b34-41d7-a1b8-dbf4abc5129d", "content": "# Runner V2: Simple Local Sandbox Design\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 0, "total_chunks": null}}
{"id": "c8640d61-b315-4141-875c-be8c71227246", "content": "## 설계 원칙\n\n**\"하나의 워크스페이스, 하나의 venv, 명확한 순서\"**\n\n- 모든 실행은 단일 워크스페이스 루트에서 발생\n- 경로는 항상 절대경로로만 처리\n- Bootstrap과 CLI 실행은 완전히 분리된 단계\n- 명령 리라이트 없음 - 환경 변수로만 제어\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 1, "total_chunks": null}}
{"id": "2d5ca2e0-32a1-4b36-982c-d86204028d07", "content": "## 워크스페이스 구조\n\n```\n/tmp/fluxloop_workspaces/<experiment_id>/\n  └── repo/                              ← git clone 결과 (GitService가 관리)\n      └── <project_subdir>/              ← pyproject.toml이 있는 곳\n          ├── .venv/                     ← Python 가상환경 (프로젝트 루트에 생성)\n          │   └── bin/\n          │       ├── python\n          │       └── fluxloop\n          └── <run_subdir>/              ← CLI 실행 디렉터리\n```\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 2, "total_chunks": null}}
{"id": "68abcf01-eb75-40c9-96f1-829dfb7b812f", "content": "### 경로 정의\n- **workspace_root**: `/tmp/fluxloop_workspaces/<experiment_id>`\n- **repo_path**: `workspace_root/repo`\n- **project_path**: `workspace_root/repo/<project_subdir>` ← **pyproject.toml 위치**\n- **venv_path**: `project_path/.venv` ← **프로젝트 루트에 생성 (중요!)**\n- **run_path**: `project_path/<run_subdir>` (없으면 project_path와 동일)\n- **cli_path**: `venv_path/bin/fluxloop`\n\n> **왜 venv를 project_path에 생성하나?**  \n> `uv sync`는 `pyproject.toml`을 읽고 빌드 백엔드(hatchling 등)를 자동으로 설치합니다. 이 과정이 제대로 작동하려면 `uv venv`와 `uv sync`를 반드시 `pyproject.toml`이 있는 디렉터리에서 실행해야 합니다. workspace 루트나 다른 곳에 venv를 두면 빌드 의존성 해석이 실패합니다.", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 3, "total_chunks": null}}
{"id": "1a346430-e65d-45d7-ba26-a7c53103f4c5", "content": "\n---\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 4, "total_chunks": null}}
{"id": "784209a9-3bcf-446d-abb9-5ffb2eb48ebc", "content": "## 실행 흐름\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 5, "total_chunks": null}}
{"id": "75a28512-5cca-4f44-ae37-c96ccb4250b5", "content": "### Phase 1: Workspace 초기화\n```python", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 6, "total_chunks": null}}
{"id": "c23bec37-645a-4a6b-8470-ae503fe7b0ff", "content": "# 1. 워크스페이스 생성\nworkspace = Path(f\"/tmp/fluxloop_workspaces/{experiment_id}\")\nworkspace.mkdir(parents=True, exist_ok=True)\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 7, "total_chunks": null}}
{"id": "226e80f9-7e51-4a10-a4e4-e992822bb85a", "content": "# 2. Git clone\nrepo_path = workspace / \"repo\"\ngit_service.sync_repo(repo_url, target_dir=repo_path, branch=branch)\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 8, "total_chunks": null}}
{"id": "d92b3370-159b-44ba-be5b-e51a41991af0", "content": "# 3. 프로젝트 디렉터리 결정\nproject_subdir = execution_profile.get(\"project_subdir\", \"\")\nproject_path = (repo_path / project_subdir).resolve()\nif not project_path.exists():\n    raise RunnerServiceError(f\"Project directory not found: {project_subdir}\")\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 9, "total_chunks": null}}
{"id": "2a4cef9f-4928-489b-aea9-d0196d926658", "content": "# 4. 실행 디렉터리 결정 (선택적)\nrun_subdir = execution_profile.get(\"run_subdir\", \"\")\nrun_path = (project_path / run_subdir).resolve() if run_subdir else project_path\n```\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 10, "total_chunks": null}}
{"id": "fe1155c1-5533-4e93-acda-8b62e1f8b176", "content": "### Phase 2: Python 환경 준비\n```python", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 11, "total_chunks": null}}
{"id": "41222966-1cc4-4bcc-bf58-58cd4ceafb3c", "content": "# 5. venv 생성 (project_path에 생성)\nvenv_path = project_path / \".venv\"\nsubprocess.run(\n    [\"uv\", \"venv\", \"--python\", \"python3.11\", \"--seed\", \"--clear\", str(venv_path)],\n    cwd=project_path,  # pyproject.toml이 있는 곳에서 실행\n    check=True\n)\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 12, "total_chunks": null}}
{"id": "9b818abb-fb6d-4a3e-ab4b-22b4203189f0", "content": "# 6. 의존성 설치 (같은 디렉터리에서 실행)\nsubprocess.run(\n    [\"uv\", \"sync\", \"--python\", \"python3.11\", \"--reinstall-package\", \"fluxloop-cli\"],\n    cwd=project_path,\n    env={\n        \"UV_PROJECT_ENVIRONMENT\": str(venv_path),\n        **os.environ\n    },\n    check=True\n)\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4437fb21-3858-48e6-9805-93df9049e93e", "content": "# 7. CLI 실행파일 확인\ncli_executable = venv_path / \"bin\" / \"fluxloop\"\nif not cli_executable.exists():\n    raise RunnerServiceError(f\"FluxLoop CLI not found at {cli_executable}\")\n```\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 14, "total_chunks": null}}
{"id": "4ec7b6aa-d492-4e00-b2ca-2eb980840bc7", "content": "### Phase 3: Bootstrap 실행 (선택적)\n```python", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 15, "total_chunks": null}}
{"id": "fba012ba-31e8-4785-9ace-de2ff54832c5", "content": "# 8. Bootstrap 단계들 실행\nbootstrap_env = {\n    \"VIRTUAL_ENV\": str(venv_path),\n    \"PATH\": f\"{venv_path}/bin:{os.environ['PATH']}\",\n    **execution_profile.get(\"env_vars\", {}),\n    **env_overrides\n}", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 16, "total_chunks": null}}
{"id": "04182bac-a9d1-4650-874d-e729269b032b", "content": "# PYTHONPATH는 bootstrap에서 제외 (모듈 캐싱 방지)\n\nfor step in bootstrap_steps:\n    subprocess.run(\n        step[\"command\"],\n        shell=True,\n        cwd=project_path,  # 모든 bootstrap은 project_path 기준\n        env=bootstrap_env,\n        check=True\n    )\n```\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 17, "total_chunks": null}}
{"id": "05f3ff40-efac-42df-bb11-befb1b8bc4af", "content": "### Phase 4: CLI 실행\n```python", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 18, "total_chunks": null}}
{"id": "316ac675-8d55-45f7-a140-2be263d40945", "content": "# 9. CLI 명령 구성 (절대경로)\ncommand = [\n    str(cli_executable),  # project_path/.venv/bin/fluxloop\n    \"run\",\n    \"experiment\",\n    \"--no-display\",\n    *execution_profile.get(\"default_cli_args\", [])\n]\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 19, "total_chunks": null}}
{"id": "70e52b42-c69c-4129-89ed-879b9d0ec7b1", "content": "# 10. 실행 환경 구성\nrun_env = {\n    \"VIRTUAL_ENV\": str(venv_path),\n    \"PATH\": f\"{venv_path}/bin:{os.environ['PATH']}\",\n    \"PYTHONPATH\": str(project_path),  # project_path를 import 기준으로\n    **execution_profile.get(\"env_vars\", {}),\n    **env_overrides\n}\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 20, "total_chunks": null}}
{"id": "fecdd7f9-ede3-4216-b5ef-ddd85e6651b0", "content": "# 11. CLI 실행\nsubprocess.run(\n    command,\n    cwd=run_path,  # CLI는 run_path에서 실행\n    env=run_env,\n    stdin=subprocess.PIPE,\n    stdout=subprocess.PIPE,\n    stderr=subprocess.STDOUT\n)\n```\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 21, "total_chunks": null}}
{"id": "63742409-5808-4dbd-8d84-26b2bb3ea006", "content": "## Execution Profile 단순화\n\n**기존 (복잡)**:\n```json\n{\n  \"project_subdir\": \"langgraph/customer-support/fluxloop_projects/tutorial\",\n  \"python_environment\": {\n    \"path\": \"../../.venv\",\n    \"interpreter\": \"../../.venv/bin/python\",\n    \"project_root\": \"../../\"\n  },\n  \"pythonpath_entries\": [\"../..\"],\n  \"bootstrap_steps\": [\n    {\"name\": \"Install deps\", \"command\": \"cd ../.. && UV_PROJECT_ENVIRONMENT=.venv uv sync ...\"}\n  ]\n}\n```\n\n**신규 (단순)**:\n```json\n{\n  \"project_subdir\": \"langgraph/customer-support\",\n  \"run_subdir\": \"fluxloop_projects/tutorial\",", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 22, "total_chunks": null}}
{"id": "86271c48-c9f2-4d5d-bc5a-f37793731258", "content": "  \"bootstrap_steps\": [\n    {\"name\": \"Check env\", \"command\": \"python --version\"}\n  ],\n  \"default_cli_args\": [\"--config\", \"configs/simulation.yaml\"],\n  \"env_vars\": {\n    \"PYTHONUNBUFFERED\": \"1\",\n    \"FLUXLOOP_ENV\": \"sandbox\"\n  }\n}\n```\n\n**변경점**:\n- `python_environment` 섹션 제거 → Runner가 자동으로 `workspace/.venv` 사용\n- `pythonpath_entries` 제거 → Runner가 자동으로 `project_path` 설정\n- Bootstrap 명령 단순화 → `cd`, `UV_PROJECT_ENVIRONMENT` 같은 것 불필요\n- 상대 경로 완전 제거\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 23, "total_chunks": null}}
{"id": "35d1fea0-ed94-41be-bad1-3a97f46db1c6", "content": "## 핵심 차별점: 레거시와 어떻게 다른가?\n\n| 측면 | 레거시 Runner | V2 Simple Runner |\n|------|---------------|------------------|\n| **경로 기준** | repo_root, project_root, run_directory 3개 | workspace_root 하나 |\n| **venv 위치** | execution profile이 지정 (`../../.venv`) | 고정: `workspace/.venv` |\n| **경로 해석** | 상대경로를 3개 기준점에 대입해 계산 | 절대경로만 사용 |\n| **Bootstrap CWD** | run_directory 또는 리라이트된 cd 경로 | 항상 project_path |\n| **CLI CWD** | run_directory | 항상 run_path |\n| **명령 리라이트** | `fluxloop` → 절대경로, `cd` → 절대경로, `uv sync` 확장 | 리라이트 없음 |\n| **환경 변수** | context/config에서 조립 | subprocess 호출 시점에 dict로 직접 전달 |", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 24, "total_chunks": null}}
{"id": "9ce7a649-93eb-491c-8e85-2b744218251c", "content": "| **시점 문제** | command 생성 → bootstrap → 경로 갱신 시도 | phase별로 명확히 분리, 재스캔 |\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 25, "total_chunks": null}}
{"id": "2106d69f-26be-48a4-9aa1-0c7d9e278867", "content": "## Vercel Sandbox 같은 외부 환경으로 가면?\n\n**Vercel/Fly.io/CodeSandbox API 모델**:\n```python", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 26, "total_chunks": null}}
{"id": "d6c86bc4-64ae-4a17-b513-b95f7ff6e4a3", "content": "# Runner는 job 제출만\nresponse = sandbox_api.create_job({\n    \"repo\": repo_url,\n    \"branch\": branch,\n    \"commands\": [\n        \"cd langgraph/customer-support\",\n        \"uv venv .venv && uv sync\",\n        \".venv/bin/fluxloop run experiment --config configs/simulation.yaml\"\n    ],\n    \"env\": execution_profile[\"env_vars\"]\n})\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 27, "total_chunks": null}}
{"id": "b060b316-e594-4d6e-8abf-6309e042a156", "content": "# 로그 스트리밍\nfor log_line in sandbox_api.stream_logs(response.job_id):\n    log_stream.publish_line(trace_id, log_line)\n```\n\n**Runner 코드가 극단적으로 단순해집니다**:\n- 경로 관리 없음 (샌드박스가 알아서)\n- venv 관리 없음 (샌드박스가 알아서)\n- subprocess 관리 없음 (API가 추상화)\n\n하지만:\n- API 연동, 비용, 네트워크 지연 등 새로운 복잡도 추가\n- 로컬 디버깅 불가능\n- Supabase 키 같은 시크릿을 외부에 안전하게 전달해야 함\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 28, "total_chunks": null}}
{"id": "c2d29afb-575a-4a74-a086-a11b987b3492", "content": "## 추천 방향\n\n**단계적 접근**이 가장 안전합니다:\n\n1. **지금 (V2 Simple Local)**: 로컬 샌드박스를 최대한 단순하게 재구현. \"워크스페이스 통일 + 절대경로 + phase 분리\"로 현재 문제 해결.\n   - 장점: 빠르게 안정화, 기존 인프라 유지\n   - 목표: 300줄 이내, 명확한 단계 분리\n\n2. **다음 단계 (Executor 추상화)**: 로컬이 안정되면, 실행 부분만 인터페이스로 추상화.\n   ```python\n   class LocalExecutor:\n       def run_experiment(...) -> logs\n   \n   class VercelSandboxExecutor:\n       def run_experiment(...) -> logs\n   ```\n   - Runner는 Executor를 주입받아 사용\n   - 로컬/외부를 설정으로 토글 가능\n\n3. **장기 (Full External)**: 로컬은 개발용으로만, production은 완전히 외부 샌드박스로 전환.\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 29, "total_chunks": null}}
{"id": "f7260a52-da73-491e-87c2-4c8d56280520", "content": "## 결론\n\n- **로컬 V2로 먼저 단순화**를 추천합니다. 외부 샌드박스는 로컬이 안정된 후 Executor만 교체하는 식으로 점진적 전환이 가능합니다.\n- 지금 겪는 복잡도는 \"레거시 + 3중 경로 + 시점 꼬임\"이 합쳐진 것이라, 단일 워크스페이스 구조만으로도 **충분히 해소**될 것으로 예상합니다.\n- 다만 처음부터 외부로 가고 싶으시면, Vercel Sandbox API 연동부터 설계하는 것도 가능합니다.\n\n어떤 방향으로 가시겠어요?\n", "metadata": {"source": "docs/prd/web/sandbox/runner_v2_simple.md", "chunk_index": 30, "total_chunks": null}}
{"id": "6c6e812b-1caa-448b-a829-f61b6bd2c6ba", "content": "# Sandbox Execution Notes\n\nThis document captures the current behaviour and open questions around the runtime sandbox that powers FluxLoop Web experiment runs.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 0, "total_chunks": null}}
{"id": "7657b659-a523-467d-b9ea-a81373607845", "content": "## Workspace Axes\n\n- **`repo_root`** – output of `GitService.sync_repo`; immutable clone location.\n- **`project_root`** – directory that owns the project’s `pyproject.toml` / `.venv`. Resolution order:\n  1. `execution_profile.python_environment.project_root`\n  2. Parent of `execution_profile.python_environment.path`\n  3. First ancestor of `run_directory` containing `pyproject.toml`\n  4. Fallback: `repo_root`\n- **`run_directory`** – CLI working directory derived from `execution_profile.project_subdir`; defaults to `repo_root` if unset.", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 1, "total_chunks": null}}
{"id": "cb3094c8-f247-483e-8dab-1487701c61cf", "content": "\nTypical tutorial layout:\n  ```\n<repo_root>/\n    langgraph/\n    customer-support/        -> project_root (pyproject/.venv live here)\n        fluxloop_projects/\n        tutorial/            -> run_directory\n            configs/\n            inputs/\n            ...\n      customer_support/      -> import target\n  ```\n\nRunner builds a `WorkspaceContext` encapsulating these paths so future backends (remote disks, sandbox API, etc.) can swap in alternative implementations.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 2, "total_chunks": null}}
{"id": "f409b1ef-1bd4-4652-b0b4-166529b429f5", "content": "## Environment Preparation Flow\n\n1. **Environment variables**\n   - `.env` → Execution profile `env_vars` → per-run overrides are merged in this order.\n   - `OPENAI_API_KEY` from `.env` becomes the default key (can be overridden by profile/env override).\n2. **PYTHONPATH assembly**\n   - Runner copies the incoming value (if any) and appends `run_directory`, its parent, and `project_root`.\n   - Execution profile `pythonpath_entries` are resolved relative to the workspace (run dir → project root → repo root) and deduplicated.", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 3, "total_chunks": null}}
{"id": "d24a4cb2-711b-4238-8f3f-29c7c84ec72c", "content": "   - Example: the tutorial profile still uses `[\"../..\"]`, but now resolution stays inside the repo even if the path escapes with `..`.\n3. **Bootstrap steps**\n   - Steps run via the new command executor abstraction; stdout streams through SSE as before.\n   - Runner normalises each command:\n     - `cd` targets become absolute paths within `repo_root`.\n     - `fluxloop` tokens are rewritten to the resolved CLI inside the virtualenv.\n     - `source <venv>/bin/activate` is rewritten to point at `project_root`’s environment.", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 4, "total_chunks": null}}
{"id": "55e2b0d7-5417-4fb1-82ad-4e286f26ff7b", "content": "     - `uv sync …` commands are expanded to `uv venv --seed --clear` + `uv sync` (honouring any original flags) executed from `project_root` with a stable `UV_PROJECT_ENVIRONMENT`.\n   - With this rewrite, profiles can keep bootstrap commands simple, e.g.\n     ```json\n     [\n       {\"name\": \"Install deps\", \"command\": \"uv sync --python python3.11\", \"shell\": \"/bin/bash\"},\n       {\"name\": \"Check CLI version\", \"command\": \"fluxloop --version\", \"shell\": \"/bin/bash\"}\n     ]\n     ```\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 5, "total_chunks": null}}
{"id": "8d26cedf-2c79-44f3-bdbc-3a636a206e93", "content": "## FluxLoop CLI Invocation\n\n- Final command: `fluxloop run experiment --config configs/simulation.yaml --no-display`\n- `--no-display` disables the Rich progress UI so that the CLI emits step-by-step updates as plain text (ideal for streaming to the web UI).\n- CLI is launched with `stdin=subprocess.PIPE`; we auto-send `\"y\\n\"` to pass the “Continue?” prompt.\n- SSE events:\n  - `run_start` when the CLI begins streaming output\n  - `log` for each stdout line (now includes progress lines emitted in `--no-display` mode)\n  - `run_end` on completion with `status` (`success`/`failed`) and `returncode`", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 6, "total_chunks": null}}
{"id": "376d83db-2234-47e6-8ec6-38c5290361dd", "content": "  - `log_uploaded` after log file is uploaded to Supabase Storage\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 7, "total_chunks": null}}
{"id": "8756cf1c-f19e-40e1-a0ac-e0a4ff35cd9f", "content": "## Known Issues / TODOs\n\n- **Venv reuse**: runner seeds/syncs using the resolved `project_root` + `.venv`. Ensure profiles still point `python_environment.path` at the shared location to avoid rebuilding environments.\n- **pythonpath_entries**: must be list-valued; entries are resolved via the workspace context. Verify relative paths stay within the repo after resolution.\n- **Input/recording workflow**: current POC runs assume pre-generated inputs/recordings. Future phases must expose API/UI to generate inputs, enable recording, run `fluxloop parse/evaluate`, etc.", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 8, "total_chunks": null}}
{"id": "c63e06e7-9828-40d3-ac7e-48ec17d83340", "content": "- **CLI overrides**: Execution profile + request overrides work for CLI args and env vars. Confirm we persist chosen values (iterations, personas, multi-turn settings) when the UI wizard is built.\n- **CLI display mode**: Backend runs always append `--no-display` so stdout carries human-readable progress updates. Interactive use of the CLI still defaults to the Rich progress bar.\n- **Sandbox DB cache (NEW)**: For tutorials relying on `customer_support/data/travel_db.py`, sandbox caching lives under `~/.cache/customer_support/`. If downloads fail or the SQLite file becomes corrupted, delete both `travel2.sqlite` and `travel2.backup.sqlite` so the next run re-downloads them. Execution profiles may override the cache directory via `CUSTOMER_SUPPORT_DATA_DIR`.", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 9, "total_chunks": null}}
{"id": "d71a5c97-475f-457d-b154-7594f95cc426", "content": "## Quick Reference Commands\n\n- Create execution profile (tutorial example):\n  ```bash\n  curl -X POST http://127.0.0.1:8001/api/v1/execution-profiles \\\n    -H \"Content-Type: application/json\" \\\n    -d '{\n      \"project_id\": \"...\",\n      \"name\": \"Tutorial default\",\n      \"project_subdir\": \"langgraph/customer-support/fluxloop_projects/tutorial\",\n      \"bootstrap_steps\": [\n        {\"name\": \"Install deps\", \"command\": \"uv sync --python python3.11\", \"shell\": \"/bin/bash\"},\n        {\"name\": \"Check CLI version\", \"command\": \"fluxloop --version\", \"shell\": \"/bin/bash\"}", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 11, "total_chunks": null}}
{"id": "88cdb719-354f-4076-b5ef-f86e1713e0dd", "content": "      ],\n      \"default_cli_args\": [\"--config\", \"configs/simulation.yaml\"],\n      \"env_vars\": {\"PYTHONUNBUFFERED\": \"1\", \"FLUXLOOP_ENV\": \"sandbox\"},\n      \"pythonpath_entries\": [\"../..\"],\n      \"python_environment\": {\n        \"type\": \"venv\",\n        \"path\": \"../../.venv\",\n        \"interpreter\": \"../../.venv/bin/python\",\n        \"project_root\": \"../../\"\n      }\n    }'\n  ```\n- Run experiment via CLI helper:\n  ```bash\n  uv run python -m app.cli.run_experiment \\\n    --experiment-id <UUID> \\\n    --repo-url https://github.com/chuckgu/fluxloop-tutorials.git \\", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 12, "total_chunks": null}}
{"id": "ac18e917-a9c8-4a7a-90f1-ed72d775dcee", "content": "    --branch main \\\n    --execution-profile-id <PROFILE_UUID> \\\n    --follow\n  ```\n\n\n문제의 핵심은 **세 가지 루트**가 뒤엉켜 있다는 겁니다.\n\n1. **repo clone root** – GitService가 내려받는 위치 (`…/fluxloop_repos/<repo_hash>/`)\n2. **FluxLoop 프로젝트 루트** – `pyproject.toml`/`.venv`가 있는 곳 (튜토리얼은 `langgraph/customer-support/`)\n3. **실행(run) 루트** – `execution_profile.project_subdir`(예: `fluxloop_projects/tutorial`)\n\n현재 `RunnerService`는 run 디렉터리만 뚜렷하고, 나머지 두 개가 중간에 뒤섞입니다.  \n그 결과 bootstrap 명령이\n\n```\ncd clone_root && uv sync …\n```\n\n처럼 런타임마다 다른 디렉터리에서 돌아가 pyproject를 못 찾거나, 빈 `.venv`를 새로 seed해도 곧바로 다른 위치에서 `uv sync`를 돌려버리는 악순환이 생깁니다.", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 13, "total_chunks": null}}
{"id": "24aab4c5-69f9-4043-a245-9cb856f011b4", "content": "\n---\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 14, "total_chunks": null}}
{"id": "533c29b8-5f3f-4e14-96e0-9569fdecb769", "content": "## 필요한 정리: “세 축 분리” 재설계\n\n| 축 | 필요한 역할 | Runner 관점에서 해야 할 일 |\n|----|-------------|----------------------------|\n| Repo Root (`repo_path`) | Git clone 결과 | 이미 확보됨 (`langgraph/…` 바로 위). 건드리지 않음. |\n| 프로젝트 루트 (`project_root`) | `pyproject.toml`, `.venv`, `uv` 설정 | 명확히 찾아 저장. 기본은 `execution_profile.python_environment.project_root` 또는 `python_environment.path`의 부모. 없다면 `repo_path` 안에서 최초 `pyproject.toml` 찾기. |\n| 실행 루트 (`run_directory`) | CLI의 working dir | `execution_profile.project_subdir`로 유지하되, bootstrap/fluxloop 실행 시 항상 `project_root`와 구분해 사용. |", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 15, "total_chunks": null}}
{"id": "62d92760-29d2-4807-9dbe-663b3f7d1c06", "content": "\n---\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 16, "total_chunks": null}}
{"id": "d1a10ab5-a825-4c14-9ca9-63ef2926e1af", "content": "## Runner 로직 재구성 제안\n\n1. **초기화 단계**\n\n   ```python\n   repo_path = git_service.sync_repo(...)\n   run_directory = repo_path / execution_profile.project_subdir\n   project_root = self._resolve_project_root(repo_path, execution_profile)\n   venv_path    = self._resolve_venv_path(project_root, execution_profile)\n   ```\n\n   `_resolve_project_root`는 다음 순서로 결정합니다.\n\n   - `execution_profile.python_environment.project_root`\n   - `python_environment.path`의 부모\n   - `run_directory`에서 상위로 올라가며 `pyproject.toml` 찾기\n   - 실패하면 `repo_path`\n\n2. **환경 준비**", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 17, "total_chunks": null}}
{"id": "32278b42-2c32-4f74-b0aa-9049d9ad2027", "content": "\n   - `uv venv --python … --seed venv_path`\n   - `UV_PROJECT_ENVIRONMENT=venv_path uv sync --no-build-isolation --python …`\n   - 두 명령 모두 `cwd=project_root`로 실행 (pyproject를 읽도록)\n   - `python_env_config`에서 `interpreter`/`path`를 새 값으로 업데이트\n\n3. **환경 변수를 일관되게 구성**\n\n   ```python\n   env[\"VIRTUAL_ENV\"] = str(venv_path)\n   env[\"PATH\"] = f\"{venv_path/bin:existing}\"\n   env[\"PYTHONPATH\"] = [run_directory, run_directory.parent, profile.pythonpath_entries…]\n   ```\n\n4. **CLI 실행**\n\n   - `fluxloop` 바이너리는 `venv_path/bin/fluxloop`가 우선\n   - `command` 실행은 `cwd=run_directory`", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 18, "total_chunks": null}}
{"id": "c0578faf-614c-4f3c-ad4d-6f511403e238", "content": "   - `stdin`으로 `y\\n` 자동 전송 유지\n\n5. **기존 bootstrap_steps 처리**\n\n   - 명령에 `UV_PROJECT_ENVIRONMENT=…`나 `uv sync`가 포함되어도,  \n     `_prepare_bootstrap_command`가 “프로젝트 루트 + 통일된 venv” 규칙으로 재작성합니다.\n   - `--no-build-isolation`과 `uv venv --seed`는 Runner가 자동으로 넣고 중복 옵션은 정리.\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 19, "total_chunks": null}}
{"id": "45e70b14-bdd3-4770-b11c-efe71efebb5e", "content": "## VSCode + Polish 문맥\n\n- VSCode 확장도 기본(Default) 모드에서는 공용 루트에 `.venv`와 프로젝트 구조를 만들어 주도록 설계하려는 상황(Polish #1).  \n  Runner의 위 구조는 그 UX 방향과 정확히 일치합니다.\n\n- Custom 모드에서는 사용자가 직접 루트/venv를 지정하도록 하되, Runner는 동일한 기준 (`project_root`, `venv_path`)을 사용해 안정적 실행을 보장.\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 20, "total_chunks": null}}
{"id": "eae54ff7-006c-4d9c-ae94-c9f195a362b3", "content": "## 실행 전략\n\n1. **Runner 리팩터링**\n   - `_resolve_project_root`, `_resolve_venv_path`, `_prepare_uv_environment` 등의 헬퍼 추가\n   - 기존 `_prepare_bootstrap_command`는 단순히 “template → repo_root/venv 반영” 업무에 집중\n   - 예외 처리가 명확한지 (pyproject 없을 때 Warning/Fail) 점검\n\n2. **테스트**\n   - 튜토리얼처럼 루트와 실행 디렉터리가 다른 repo\n   - 루트에 `pyproject`만 있고 subdir이 없는 repo\n   - `python_environment.path`가 절대경로인 실행 프로파일\n\n3. **문서/프로파일 업데이트**\n   - `docs/prd/web/sandbox/sandbox.md`에 “루트에서 uv venv/uv sync” 규칙 명시\n   - 기존 execution profile JSON에 있는 cmd를 새 규칙에 맞게 조정\n\n---", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 21, "total_chunks": null}}
{"id": "60055703-7ad4-4ab5-95d2-f4706781524c", "content": "\n이렇게 “루트 ↔ venv ↔ 실행 디렉터리” 관계를 명확히 정리하면, `hatchling`이나 `pyproject` 오류 같은 혼란 없이 어떤 샌드박스에서도 같은 절차로 실행할 수 있습니다. 필요한 경우 리팩터링 diff 초안을 함께 드릴 수 있으니 말씀 주세요!\n\n[3 tools called]\n\n- Runner bootstrap 로직을 바꿔서, `uv sync` 전에 repo 루트에서 `uv venv --seed`를 실행하고 동일한 `.venv`에 `uv sync --no-build-isolation`을 붙였습니다. 덕분에 빈 venv 문제 없이 루트 `pyproject.toml` 설정이 항상 반영됩니다.\n- 부가적으로 `UV_PROJECT_ENVIRONMENT`는 자동으로 같은 `.venv`를 가리키도록 유지하되, 기존 hatchling 수동 설치 코드는 제거했습니다.\n- 변경된 흐름을 `docs/prd/web/sandbox/sandbox.md`에 반영해 “Install deps” 단계가 `uv venv --seed` → `uv sync` 순으로 이루어지도록 문서화했습니다.", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 22, "total_chunks": null}}
{"id": "b67c6bc3-5453-48c2-a120-dbcb355f7104", "content": "\n다음 단계: 샌드박스에서 동일 프로필로 실험을 재실행하여 bootstrap이 통과하는지 확인해 주세요.\n\n\n✔ “uv sync를 루트에서 실행하는 방식이라면 문제 없다”\n❌ “runner가 루트로 잡히지 않으면 build-time hatchling 누락 문제 100% 생긴다”\n🔒 문제를 완전히 고정시키는 2가지 방법\n방법 1 — runner가 반드시 repo 루트에서 uv sync 실행하도록 강제\n\n즉:\n\ncd $SANDBOX_ROOT\nuv sync\nuv run ...\n\n\n이렇게 해야 root pyproject.toml이 적용됨.", "metadata": {"source": "docs/prd/web/sandbox/sandbox.md", "chunk_index": 23, "total_chunks": null}}
{"id": "f7ea0a52-5d93-4e70-a3d5-a873414fc7a4", "content": "# Sandbox V2: Scalable & Interactive Execution Environment\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 0, "total_chunks": null}}
{"id": "3a1793d9-352e-4464-b9d3-823dcbfcd9ee", "content": "## 1. 비전 및 목표\n\n**\"단순 실행(Runner V2)을 넘어, 병렬 확장과 코딩 에이전트 협업이 가능한 완전 격리형 샌드박스\"**\n\nRunner V2가 \"로컬 파일시스템 위에서 꼬임 없이 실행하기\"를 해결했다면, Sandbox V2는 이를 **확장(Scaling)**하고 **상호작용(Interaction)**하는 데 초점을 맞춥니다.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 1, "total_chunks": null}}
{"id": "aae9e53a-6956-4df3-8c21-2dd0cc58b2d8", "content": "### 핵심 목표\n1. **확장성 (Scalability)**: 로컬 프로세스 한계를 넘어, 다수의 샌드박스를 병렬로 실행 (Docker/K8s/Firecracker).\n2. **격리성 (Isolation)**: 호스트 환경과 완벽히 분리되어, `rm -rf /` 같은 명령도 안전하게 수행.\n3. **상호작용 (Coding Agent)**: 단순 실행뿐 아니라, 코드 수정(Edit) → 브랜치 생성 → PR 제출까지 지원하는 양방향 워크플로우.\n4. **영속성 & 상태 관리**: 실행 후 워크스페이스를 즉시 삭제하지 않고, 디버깅하거나 이어서 작업할 수 있는 세션(Session) 개념 도입.\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 2, "total_chunks": null}}
{"id": "2b9c023f-a177-4bdb-932f-47ce8fb13d07", "content": "## 2. 아키텍처 진화\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 3, "total_chunks": null}}
{"id": "905eb62c-9ca3-4962-8489-2aca6a74c0a1", "content": "### Phase 1: Runner V2 (현재) - \"Local Process Sandbox\"\n- **구조**: `/tmp/fluxloop_workspaces/<id>` 디렉터리 격리.\n- **실행기**: `subprocess.Popen`.\n- **한계**: 로컬 자원 종속, 보안 취약, 동시 실행 수 제한.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 4, "total_chunks": null}}
{"id": "b61a4f53-297d-40b1-8fdc-3adcc09179ae", "content": "### Phase 2: Containerized Sandbox - \"Docker/Pod per Session\"\n- **구조**: 각 실험(Experiment) 또는 세션마다 독립된 Docker 컨테이너 할당.\n- **워크스페이스**: 컨테이너 내부 `/workspace`에 repo clone 및 venv 생성.\n- **Runner 역할**:\n  - 컨테이너 프로비저닝 (Start/Stop)\n  - 명령 전달 (`docker exec` or API)\n  - 로그/파일 스트리밍\n- **장점**: 환경 완벽 격리, 로컬 호스트 오염 방지.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 5, "total_chunks": null}}
{"id": "27c9d948-f498-4f78-9e10-7336a817b5eb", "content": "### Phase 3: Remote Sandbox Service - \"Serverless/Cluster\"\n- **구조**: 별도의 샌드박스 클러스터(K8s 또는 Fly.io 등)에 작업 위임.\n- **API**: `POST /sandboxes`, `POST /sandboxes/{id}/exec`.\n- **기능**:\n  - Pre-warmed 환경 (미리 python/uv 설치된 이미지 대기).\n  - 스냅샷 & 재개 (실패 지점부터 디버깅).\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 6, "total_chunks": null}}
{"id": "2b3b5c0a-564c-43fe-afe4-9b68d28774f0", "content": "## 3. 코딩 에이전트 워크플로우 (Coding Agent Workflow)\n\nSandbox V2는 단순 실행기가 아니라, 에이전트가 코드를 고치고 검증하는 **작업대(Workbench)**가 됩니다.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 7, "total_chunks": null}}
{"id": "56d713f6-bef1-49a0-a65f-e5d7b8b47607", "content": "### 시나리오: \"PR 자동 생성 에이전트\"\n\n1. **Init**: Sandbox V2 세션 생성 (Docker 컨테이너 시작).\n2. **Setup**: Repo clone, venv 구성 (Runner V2 로직 재사용).\n3. **Edit Loop**:\n   - 에이전트가 `read_file`, `grep`으로 코드 분석.\n   - `write_file`로 코드 수정.\n   - `run_test` 명령으로 검증 (샌드박스 내 `uv run pytest`).\n4. **Commit & PR**:\n   - `git checkout -b feature/fix-typo`\n   - `git commit -am \"Fix typo\"`\n   - `git push origin feature/fix-typo`\n   - GitHub API로 PR 생성.\n5. **Teardown**: 세션 종료 및 컨테이너 삭제.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 8, "total_chunks": null}}
{"id": "21c18b61-1088-400d-8ed5-04eabae785b3", "content": "### 필요한 기능 확장\n- **FileSystem API**: 샌드박스 내부 파일을 읽고 쓰는 HTTP API (`GET/PUT /files`).\n- **Terminal API**: 웹소켓을 통한 실시간 셸 접속 (에이전트/사람 공용).\n- **Git Helper**: 인증 정보(Git Token)를 안전하게 주입하고, git 명령을 쉽게 래핑.\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 9, "total_chunks": null}}
{"id": "401e8aa8-bdab-4d4d-b9b8-cb1605685ca7", "content": "## 4. 데이터 모델 (Draft)\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 10, "total_chunks": null}}
{"id": "b28d3008-c616-4735-bfb4-f49288d8eb1b", "content": "### `sandboxes` 테이블 (신규)\n| Column | Type | Description |\n|--------|------|-------------|\n| `id` | UUID | 샌드박스 세션 ID |\n| `status` | Enum | `provisioning`, `running`, `stopped`, `failed` |\n| `type` | Enum | `local_process`, `docker`, `remote_api` |\n| `metadata` | JSON | 컨테이너 ID, 호스트 IP, 포트 등 |\n| `created_at` | Timestamp | |\n| `expires_at` | Timestamp | 자동 정리 시간 |\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 11, "total_chunks": null}}
{"id": "9f7d5924-a2be-474b-bf34-e7f0cc2b80fa", "content": "### `traces` 테이블 (확장)\n- `sandbox_id`: 실행이 일어난 샌드박스 FK.\n\n---\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 12, "total_chunks": null}}
{"id": "67161cc4-6536-4645-a243-e0cfae005849", "content": "## 5. 로드맵\n\n1. **Step 1 (현재 완료)**: Runner V2 안정화 (로컬 프로세스 기반).\n2. **Step 2 (단기)**: **Docker Executor** 구현.\n   - `RunnerService`가 `subprocess` 대신 `docker run`을 호출하도록 추상화.\n   - 로컬 Docker 데몬 사용.\n3. **Step 3 (중기)**: **Persistent Session** 지원.\n   - 실행 후 워크스페이스 유지 → 에이전트가 추가 명령 내릴 수 있게 API 개방.\n4. **Step 4 (장기)**: **Remote Cluster** 구축.\n   - 다수의 샌드박스를 관리하는 오케스트레이터 도입.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 13, "total_chunks": null}}
{"id": "6333c7f7-f0fc-46f9-b17c-4f07242e9740", "content": "## 6. 결론\n\nRunner V2에서 확립한 **\"단일 워크스페이스 + 절대경로 + 명확한 단계\"** 원칙은 Sandbox V2에서도 그대로 유효합니다. 다만 그 워크스페이스가 **\"로컬 디렉터리\"에서 \"컨테이너 내부\"로 이동**할 뿐입니다. 이 구조를 유지하면, 백엔드 로직을 크게 뜯어고치지 않고도 실행 환경만 교체(Swap)하여 확장할 수 있습니다.\n", "metadata": {"source": "docs/prd/web/sandbox/sandbox_v2.md", "chunk_index": 14, "total_chunks": null}}
{"id": "358180eb-ddb6-4b50-8e9d-c8119f5055a3", "content": "# Auth Verification & Performance Plan\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "fbef6889-9966-4489-bc88-2626b1a6e4e3", "content": "## 현재 구조\n1. Frontend가 Supabase Auth로 GitHub OAuth 세션 생성.\n2. 모든 API 호출에 `Authorization: Bearer <supabase access token>`을 포함.\n3. FastAPI는 `require_user` 의존성에서 Supabase `/auth/v1/user`를 호출해 토큰을 검증하고, 사용자 정보를 반환.\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a116df0b-ea30-46d2-8c72-edcd07c4618e", "content": "## 문제점\n- 매 요청마다 Supabase Auth 서버로 round-trip을 수행 → 레이턴시 및 Supabase 요청 수 증가.\n- `/auth/v1/user`는 HTTP 호출 기반으로만 제공되므로, 대량 트래픽 시 병목이 발생할 수 있음.\n- Runner/CLI에서 토큰을 붙이지 않는 경우가 아직 존재.\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "22b76f4d-4f89-4d36-9390-32f28365b6f1", "content": "## 개선 목표\n1. **JWT 오프라인 검증**: Supabase가 사용하는 JWKS를 주기적으로 캐싱하고 FastAPI가 로컬에서 서명을 검증하도록 변경.\n2. **토큰 캐시**: 동일 토큰에 대한 사용자 정보는 TTL 캐시에 저장 → `/auth/v1/user` 호출을 최소화.\n3. **단기 세션**: access token TTL을 짧게 유지하면서, refresh token 기반으로 frontend에서 재발급.\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "c5782d1b-e2fe-4af7-a709-2005f27fd97f", "content": "## 구현 플랜", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c5e842b4-6964-4abb-9994-ad0610a9fa21", "content": "### 1. JWKS 캐싱\n- Supabase는 `https://<project>.supabase.co/auth/v1/jwks`에서 공개 키를 제공.\n- FastAPI 시작 시 JWKS를 가져와 `python-jose` 또는 `jwt` 라이브러리로 서명 검증.\n- 키 회전 대비: 15분~1시간 주기로 백그라운드 작업이 JWKS를 리프레시.\n- `require_user`는 `/auth/v1/user` 대신 로컬 검증 → `user` claim을 직접 파싱.\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "e2bda591-f81a-44d3-8b6e-3bb4a8a96ff4", "content": "### 2. 캐시 계층\n- Redis 또는 in-memory LRU 캐시(예: `cachetools`)에 `token -> user` 매핑을 TTL과 함께 저장.\n- 새로운 토큰은 JWKS로 검증 후 캐시에 등록.\n- 만료되었거나 부정확한 토큰은 즉시 거부.\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "11b7e75b-c5c3-477e-ac0e-faf84d67b7a5", "content": "### 3. Runner/CLI 개선\n- Runner/CLI 실행 시, Supabase 세션에서 발급한 JWT를 환경 변수(`SUPABASE_ACCESS_TOKEN`)로 받아 API 호출마다 전달.\n- CLI 헬퍼를 추가해 `fluxloop_cli run --with-token` 형태로 쉽게 주입.\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "e591a0b0-5963-43e7-be59-7abdc32273bd", "content": "### 4. 모니터링\n- `/auth/v1/user` 호출 빈도를 Prometheus/Grafana 또는 Supabase metrics에서 모니터링.\n- 5xx/401 추이를 Grafana alert에 연결하여 auth 실패율 감시.\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 8, "total_chunks": null}}
{"id": "1941b5b2-682e-40de-bbfc-76a48070600c", "content": "## 일정 제안\n| 주차 | 작업 |\n| --- | --- |\n| Week 2.5 | JWKS 캐싱 + 토큰 검증 코드 작성, 기존 `/auth/v1/user` 호출 제거 |\n| Week 3 | Cache layer 및 Runner/CLI 토큰 주입 | \n| Week 4 | 모니터링 + 경고 설정, 성능 테스트 |\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "b37d37e3-c7a0-491f-94f6-165d9ace0027", "content": "## 참고\n- Supabase 공식 문서: [Auth - verifying JWTs](https://supabase.com/docs/guides/auth/server-side/verify-jwts)\n- Python 라이브러리: `python-jose` or `authlib`\n", "metadata": {"source": "docs/prd/web/security/auth_perf_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "ca2d249f-b672-4d1d-8f11-0b2d363f63d0", "content": "# Seed Data & RLS Verification Playbook\n", "metadata": {"source": "docs/prd/web/security/seed_and_rls.md", "chunk_index": 0, "total_chunks": null}}
{"id": "38a93d5b-cd0b-4e17-a09e-956e2b5d5654", "content": "## 1. Seed Demo Data\n\nPrerequisites:\n- `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`, `SUPABASE_OWNER_ID` (실제 auth.users UUID)\n- `uv` (Python dependencies already bootstrapped)\n\n```bash\ncd services/web/backend\nexport SUPABASE_URL=https://<project>.supabase.co\nexport SUPABASE_SERVICE_ROLE_KEY=...\nexport SUPABASE_OWNER_ID=<uuid from auth.users>\nuv run python scripts/seed_mock.py\n```\n\n결과:\n- `projects`, `experiments`, `traces` 테이블에 데모 레코드가 생성됩니다.\n- Frontend Dashboard는 즉시 mock 없이 실데이터를 로딩할 수 있습니다.\n", "metadata": {"source": "docs/prd/web/security/seed_and_rls.md", "chunk_index": 1, "total_chunks": null}}
{"id": "827dd771-109e-4396-90ff-1b4521f6297b", "content": "## 2. Supabase Auth Webhook 설정\n\n1. Supabase Console → **Auth → Hooks** 이동.\n2. `user_signed_in`, `user_signed_up` 이벤트에 대한 Webhook 추가.\n3. 엔드포인트는 `https://webhook.site/...` 같은 테스트 URL 또는 사내 핸들러를 기입.\n4. GitHub OAuth 로그인 후 Auth Hook 로그를 확인하여, 로그인 이벤트가 기록되는지 검증.\n\n> 실제 운영 시에는 Slack/Notion 등 알림 채널이나 감사(audit) 파이프라인으로 Webhook을 연결합니다.\n", "metadata": {"source": "docs/prd/web/security/seed_and_rls.md", "chunk_index": 2, "total_chunks": null}}
{"id": "354e77fb-1af5-4932-89ab-56439ac1040d", "content": "## 3. RLS(행 수준 보안) 점검\n\n1. **Owner 토큰**으로 `GET /api/v1/projects` 호출 시 방금 seed한 프로젝트가 보이는지 확인.\n2. **다른 사용자 토큰**을 발급(예: `supabase.auth.signUp`) 후 동일 API를 호출하면 0건이어야 함.\n3. 실패 케이스가 있을 때 Supabase Dashboard → SQL Editor에서 `auth.uid()`를 활용한 Policy가 올바른지 재검토.\n", "metadata": {"source": "docs/prd/web/security/seed_and_rls.md", "chunk_index": 3, "total_chunks": null}}
{"id": "a111a4c2-cc40-4361-8fa6-b6c8d205b3f8", "content": "### 예시: REST Client 시나리오\n\n`tests/e2e/rls_checks.http`를 VS Code REST Client 등에서 열어 아래 요청을 실행합니다.\n\n- 요청 1: `{{TOKEN_OWNER}}`로 `GET /projects` → 1건 이상 반환.\n- 요청 2: `{{TOKEN_OTHER}}`로 `GET /projects` → 빈 배열.\n- 요청 3: 토큰 없이 `GET /projects` → 401.\n\n이 과정을 통해 RLS 정책이 실제 JWT 기반으로 동작함을 빠르게 검증할 수 있습니다.\n", "metadata": {"source": "docs/prd/web/security/seed_and_rls.md", "chunk_index": 4, "total_chunks": null}}
{"id": "144eb9ce-bf44-47a7-8cbc-c77da9710aa8", "content": "## 4. 문제 해결 체크리스트\n\n- ❌ 프로젝트가 보이지 않는다면: `owner_id`가 올바르게 세팅됐는지 `select id, owner_id from projects`로 확인.\n- ❌ Webhook이 도달하지 않는다면: Supabase Hook 설정에서 Retry 로그를 확인하고, 엔드포인트 URL/Secret을 재검토.\n- ❌ RLS가 비정상이라면: Supabase SQL Editor에서 `ALTER POLICY ... USING ...` 구문을 점검하고 `ENABLE ROW LEVEL SECURITY`가 적용됐는지 확인.\n", "metadata": {"source": "docs/prd/web/security/seed_and_rls.md", "chunk_index": 5, "total_chunks": null}}
{"id": "ce159bfa-096a-42ae-a2ba-31bcb76b8430", "content": "# Runner ↔ Backend SSE Spec (POC v3)\n\nPOC v3 standardizes how experiment logs leave the Runner process, reach the FastAPI backend, and get consumed by both the CLI (`fluxloop --follow`) and the Next.js UI (Live Log Drawer, Run detail drawer). This note documents the shared contract so new event types can be added without breaking either consumer.\n\n---\n", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 0, "total_chunks": null}}
{"id": "606e0887-2fa1-4040-9f26-fdab2491630b", "content": "## 1. Data Flow Overview\n\n1. **Runner Service** (`services/web/backend/app/services/runner/service.py`)\n   - Emits raw stdout via `_cli_callback` → `log_stream.publish_line(trace_id, line)`.\n   - Emits structured milestones via `log_stream.publish_event(...)` for bootstrap/run lifecycle.\n   - Persists a trace row + artifacts in Supabase when execution finishes.\n2. **Log Stream Broker** (`services/web/backend/app/services/log_stream.py`)\n   - Maintains in‑memory buffers per `trace_id`.\n   - Supports `subscribe(trace_id)` so multiple readers (CLI + UI) see the same sequence.", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 1, "total_chunks": null}}
{"id": "df91b2ac-0857-41c7-901b-ae6b7f0a5843", "content": "   - Flushes buffers once `complete(trace_id)` is called and no listeners remain.\n3. **SSE Endpoint** (`GET /api/v1/experiments/{trace_id}/logs/stream`)\n   - Wraps a subscriber queue in `EventSourceResponse`.\n   - Emits `event` + JSON `data` payload; appends a terminal `event: end`.\n4. **Consumers**\n   - **CLI** (`app/cli/run_experiment.py`): `--follow` flag opens SSE stream directly and prints lines/events.\n   - **Frontend**: `src/app/api/internal/log-stream/route.ts` proxies SSE with Supabase auth → `LiveLogDrawer` + Agent console.", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 2, "total_chunks": null}}
{"id": "bd5de65c-4106-45d5-b913-697fc3176f58", "content": "\nA single SSE channel therefore reflects runner stdout, bootstrap events, and completion metadata in chronological order for every experiment trace.\n\n---\n", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 3, "total_chunks": null}}
{"id": "94703f0f-1183-4faf-8dc9-f9cca30efd81", "content": "## 2. Event Envelope\n\n- HTTP headers: `Content-Type: text/event-stream`, streaming response.\n- Each message contains:\n\n```text\nevent: <event_type>        # defaults to \"log\"\ndata: {\"timestamp\": 1700000000.123, ...}  # JSON string\n\n```\n\n- Backend guarantees a monotonically increasing `timestamp` (Unix seconds, float).\n- Consumers should treat unknown fields as opaque JSON and log/ignore them to maintain forwards compatibility.\n\n---\n", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 4, "total_chunks": null}}
{"id": "cd9ae2f1-a7e0-43cd-87dd-aa5f533ef732", "content": "## 3. Canonical Event Types\n\n| Event | Payload Fields | Emitted From | UI Usage |\n| --- | --- | --- | --- |\n| `log` | `line` (string) | `publish_line` (stdout, `_log_phase`) | Body of Live Log Drawer, CLI stdout |\n| `bootstrap_start` | `step`, `name` | Before each bootstrap command | Timeline pill “Running step …” |\n| `bootstrap_log` | `step`, `name`, `line` | `stream_callback` while bootstrap command runs | Inline step output |\n| `bootstrap_end` | `step`, `name`, `status`, `returncode` | After bootstrap command finishes | Success/Failure badge per step |", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 5, "total_chunks": null}}
{"id": "2fb4c93b-65f7-4211-bfe1-12e9ef764072", "content": "| `run_start` | `command` (array), `cwd` | Immediately before `fluxloop run experiment` | Header pill shows command/dir |\n| `run_end` | `status`, `returncode` | After trace + Supabase update complete | Drawer status pill (success/failed) |\n| `log_uploaded` | `path` (Supabase URL) | After raw log file upload | Drawer “download full logs” link |\n| `end` | `status` (`complete`) | SSE generator when queue closes | Consumers close stream + update UI |\n\nOther ad‑hoc events (e.g., `run_error`, future `evaluation_*`) must follow the same `event + data` shape so the CLI prints `[SSE:<type>] {...}` while the UI can add richer affordances. When adding a new event, document it in this file and update the Live Log Drawer reducer.", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 6, "total_chunks": null}}
{"id": "07214bc8-f04e-4092-a71a-8034fc3633e7", "content": "\n---\n", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 7, "total_chunks": null}}
{"id": "097a6353-deef-45e1-bd70-bd7ca8474d80", "content": "## 4. Sample Stream\n\nCaptured from a small run (whitespace trimmed):\n\n```text\nevent: log\ndata: {\"timestamp\": 1732267594.12, \"line\": \">>> Checking out repository...\"}\n\nevent: bootstrap_start\ndata: {\"timestamp\": 1732267595.02, \"step\": 0, \"name\": \"uv sync\"}\n\nevent: bootstrap_log\ndata: {\"timestamp\": 1732267595.30, \"step\": 0, \"name\": \"uv sync\", \"line\": \"Resolved 152 packages\"}\n\nevent: bootstrap_end\ndata: {\"timestamp\": 1732267602.44, \"step\": 0, \"name\": \"uv sync\", \"status\": \"success\", \"returncode\": 0}\n\nevent: run_start\ndata: {\"timestamp\": 1732267602.80, \"command\": [\"...\",\"run\",\"experiment\",\"--output\",\"...\"], \"cwd\": \"/tmp/checkout\"}", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 8, "total_chunks": null}}
{"id": "772535e7-a70c-4313-a670-0d1a0096eed0", "content": "\nevent: log\ndata: {\"timestamp\": 1732267603.15, \"line\": \"Collecting tasks: 12\"}\n\nevent: log_uploaded\ndata: {\"timestamp\": 1732267609.31, \"path\": \"supabase://logs/trace-123/raw.log\"}\n\nevent: run_end\ndata: {\"timestamp\": 1732267609.33, \"status\": \"success\", \"returncode\": 0}\n\nevent: end\ndata: {\"status\": \"complete\"}\n```\n\n---\n", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 9, "total_chunks": null}}
{"id": "8b62778f-fe02-48f8-9620-ef5094b777f4", "content": "## 5. UI / CLI Expectations\n\n- **Ordering**: consumers should not assume strict grouping—`log` events may interleave between bootstrap phases.\n- **Reconnection**: if the SSE connection drops, the frontend should allow manual retry; the backend keeps buffered events until `complete(trace_id)` so reconnecting clients catch up automatically.\n- **Timeouts**: CLI exposes `--sse-timeout`. UI should surface a toast if no events arrive after N seconds but keep the connection alive unless server closes it.\n- **Authorization**: all SSE requests require a Supabase JWT (frontend adds it via `/api/internal/log-stream`, CLI uses `FLUXLOOP_API_TOKEN`). Missing/expired tokens result in 401; clients should prompt for login refresh.", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 10, "total_chunks": null}}
{"id": "a0f2b2d6-b33b-44d5-baa3-c87104e6bded", "content": "\n---\n", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 11, "total_chunks": null}}
{"id": "d6c9e6d8-1857-40fa-9756-bc2a21613e2c", "content": "## 6. Extending The Spec\n\n1. Emit a new event from `RunnerService` via `log_stream.publish_event(trace_id, \"<event>\", {...})`.\n2. Update this document with:\n   - Event name\n   - Fields + semantics\n   - Intended UI/CLI handling\n3. Keep payload JSON serializable; prefer primitives / small dicts so SSE payloads stay light.\n4. For long-form blobs (markdown, HTML) continue uploading to Supabase Storage and emit a `supabase://` URI via `log_uploaded` or a future `<type>_uploaded` event rather than embedding large text directly in SSE.", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 12, "total_chunks": null}}
{"id": "5f0caee4-0826-426d-a88e-c09854f01603", "content": "\nThis shared spec keeps CLI and web surfaces aligned so the Run → Parse → Evaluate experience remains consistent regardless of client.\n", "metadata": {"source": "docs/prd/web/spec/runner_cli_sse_spec.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4cd1cba9-2356-4428-9bb8-2d9e762b04b0", "content": "# System Architecture & Data Design\n> **Target Status:** Draft\n> **Version:** 1.0\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 0, "total_chunks": null}}
{"id": "5f8261a7-36f4-4b21-a706-ca9a3a33f117", "content": "## 1. System Overview\nThis document defines the technical architecture for FluxLoop Web, a platform for managing, executing, and analyzing AI agent simulations.\n\n**Key Tech Stack Decisions:**\n- **Frontend:** Next.js (React), TypeScript, Tailwind CSS\n- **Backend API:** Python (FastAPI) - leveraging existing FluxLoop SDK/CLI logic easily.\n- **Database:** Supabase (PostgreSQL) - for Auth, DB, and Realtime Subscriptions.\n- **Task Queue:** Redis & Celery (or Arq)\n- **Orchestration:** Kubernetes (K8s) or Serverless Containers (AWS ECS/Fargate) for Runner scaling.", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a51fa65b-0140-4fc1-b312-47872d14975a", "content": "\n---\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 2, "total_chunks": null}}
{"id": "9a8dc61c-1e95-4e12-bc47-7464759251f2", "content": "## 2. High-Level Architecture Diagram\n\n```mermaid\ngraph TD\n    User[User / PM] -->|HTTPS| FE[Next.js Frontend]\n    FE -->|REST / WebSocket| API[Backend API (FastAPI)]\n    \n    subgraph \"Data Layer\"\n        API --> DB[(PostgreSQL)]\n        API --> Cache[(Redis)]\n        API --> Storage[(Supabase Storage)]\n    end\n\n    subgraph \"Git Integration\"\n        API <-->|App API| GitHub[GitHub / GitLab]\n    end\n\n    subgraph \"Execution Plane (Sandbox)\"\n        Worker[Celery Worker] -->|Spawns| Pod[Runner Pod]\n        Pod -->|Clones| GitHub", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 3, "total_chunks": null}}
{"id": "c8e37d89-4dac-4a1e-bba8-03eb38f5906b", "content": "        Pod -->|Runs| FluxLoopCLI[fluxloop-cli]\n        Pod -->|Streams Logs| Storage\n        Pod -->|Updates Status| API\n    end\n```\n\n---\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 4, "total_chunks": null}}
{"id": "5b4c2437-88c5-4231-8693-3d21d1445385", "content": "## 3. Database Schema (Supabase PostgreSQL)\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 5, "total_chunks": null}}
{"id": "4bb0bce4-ebc8-4560-88cb-dc7587f25804", "content": "### 3.1. Core Entities\n\n**Organization**\n- `id`: UUID\n- `name`: String\n- `subscription_tier`: Enum (Free, Team, Enterprise)\n\n**Project (Repository)**\n- `id`: UUID\n- `org_id`: FK(Organization)\n- `name`: String\n- `git_url`: String\n- `default_branch`: String\n- `installation_id`: String (GitHub App Install ID)\n\n**Experiment (Simulation Run)**\n- `id`: UUID\n- `project_id`: FK(Project)\n- `commit_sha`: String\n- `branch`: String\n- `config_snapshot`: JSONB (Snapshot of inputs/eval settings used)\n- `status`: Enum (Pending, Running, Completed, Failed)", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 6, "total_chunks": null}}
{"id": "a5a24362-cf31-4e62-b592-34fcc42cfc11", "content": "- `created_at`: Timestamp\n- `created_by`: UUID (Supabase Auth User ID)\n- `summary_metrics`: JSONB (Pass rate, avg latency, cost)\n\n**Trace (Single Execution)**\n- `id`: UUID\n- `experiment_id`: FK(Experiment)\n- `input_id`: String (Test Case ID)\n- `status`: Enum (Success, Failure, Error)\n- `duration_ms`: Integer\n- `token_usage`: JSONB\n- `log_path`: String (Storage Path for full logs)\n- `result_data`: JSONB (Captured outputs)\n\n**EvaluationResult**\n- `id`: UUID\n- `trace_id`: FK(Trace)\n- `evaluator_name`: String\n- `score`: Float\n- `reasoning`: Text", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 7, "total_chunks": null}}
{"id": "21bb564b-7419-4b5a-a626-1123cabb75ba", "content": "- `passed`: Boolean\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 8, "total_chunks": null}}
{"id": "db113d8c-0398-4b5c-b25e-a4234b701bd1", "content": "### 3.2. Collaboration Entities\n\n**Annotation (Human Feedback)**\n- `id`: UUID\n- `trace_id`: FK(Trace)\n- `user_id`: UUID (Supabase Auth User ID)\n- `type`: Enum (ThumbsUp, ThumbsDown, Comment, Correction)\n- `content`: Text (or JSONB for corrected output)\n\n**Suggestion (Analyst Agent)**\n- `id`: UUID\n- `experiment_id`: FK(Experiment)\n- `type`: Enum (ConfigChange, CodeFix)\n- `content`: Text (Description)\n- `payload`: JSONB (The actual diff/patch)\n- `status`: Enum (Proposed, Accepted, Rejected)\n\n---\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 9, "total_chunks": null}}
{"id": "80c8fab8-3596-4eb6-9906-2578f35d8c9a", "content": "## 4. API Specification Strategy\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 10, "total_chunks": null}}
{"id": "b1f8cfab-8e2e-4d3e-b516-aebc3ae88c04", "content": "### 4.1. REST API (Control Plane)\nStandard CRUD operations.\n\n- `GET /projects/{id}/experiments`: List history\n- `POST /projects/{id}/experiments`: Trigger run\n    - Body: `{ branch: \"main\", config_overrides: {...} }`\n- `GET /experiments/{id}/traces`: Paginated list of traces\n- `POST /annotations`: Submit human feedback\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 11, "total_chunks": null}}
{"id": "7f93a9ca-987e-4979-b5d6-9133f46b798a", "content": "### 4.2. WebSocket (Real-time Plane)\nUsed for live updates of running experiments.\n\n- **Endpoint:** `/ws/experiments/{id}`\n- **Events:**\n    - `trace_started`: `{ trace_id, input_id }`\n    - `log_chunk`: `{ trace_id, content }`\n    - `trace_completed`: `{ trace_id, status, result }`\n    - `experiment_progress`: `{ completed_count, total_count }`\n\n---\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 12, "total_chunks": null}}
{"id": "d5736fc5-aa36-43c6-81d7-6c6d4b38c8e8", "content": "## 5. State Management Strategy\n\n1.  **Trigger:** User clicks \"Run\". API creates `Experiment(status=Pending)` record and pushes job to Redis Queue.\n2.  **Pick Up:** Worker picks up job, updates status to `Provisioning`.\n3.  **Execution:**\n    - Worker spins up a Sandbox (Pod/Container).\n    - Sandbox clones repo & installs deps.\n    - Sandbox runs `fluxloop run --stream`.\n4.  **Streaming:**\n    - Sandbox stdout is captured by a sidecar or direct callback.\n    - Logs are buffered to Redis for WebSocket broadcasting.\n    - Logs are persisted to Supabase Storage for long-term retention.", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 13, "total_chunks": null}}
{"id": "d9f35cf4-b94a-4b13-aba9-7ac69b782841", "content": "5.  **Completion:**\n    - When CLI finishes, it uploads `trace.jsonl` and `metrics.json` to Supabase Storage.\n    - Worker parses final results, updates DB `Experiment(status=Completed)`, and triggers notifications.\n\n", "metadata": {"source": "docs/prd/web/technical_architecture.md", "chunk_index": 14, "total_chunks": null}}
{"id": "5bde7f19-1e3a-4136-a48a-00b8fad35838", "content": "# UI/UX Wireframes & Storyboard\n> **Target Status:** Draft\n> **Version:** 1.0\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 0, "total_chunks": null}}
{"id": "6cda0666-6a1a-4acf-b9eb-0a772de06216", "content": "## 1. Design Philosophy\n- **Role-Focused:** \"Code for Developers, Config for PMs\". Hide the code editor by default; show the Form/Visual editor.\n- **Data-Centric:** Always show \"Pass Rate\" and \"Regression Status\" prominently.\n- **Action-Oriented:** Every insight should lead to a \"Fix\" or \"PR\" button.\n\n---\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 1, "total_chunks": null}}
{"id": "edc1a54b-3ee8-4be5-a79d-441fd6b147c5", "content": "## 2. User Flow: \"The Loop\"\n\n1.  **Dashboard:** User sees \"Project X pass rate dropped to 85%\".\n2.  **Drill Down:** Clicks the project -> Views latest Experiment.\n3.  **Analysis:** Filters by \"Failed Traces\". Opens a trace.\n4.  **Chat:** Asks Analyst \"Why did this fail?\". Analyst says \"Hallucination on price\".\n5.  **Action:** User clicks \"Add Price Evaluator\" suggestion.\n6.  **Review:** System shows diff of `evaluation.yaml`. User clicks \"Commit & Run\".\n\n---\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 2, "total_chunks": null}}
{"id": "63663e10-2ec8-4403-9b20-94b186b3c6f5", "content": "## 3. Key Screen Specifications\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 3, "total_chunks": null}}
{"id": "adab9978-5756-4e34-a1dd-9396852e7b89", "content": "### 3.1. Main Dashboard\n**Layout:** Sidebar (Projects) + Main Content.\n\n**Content:**\n- **Project Cards:** Name, Last Run Status (Green/Red bar), 7-day Trend Sparkline.\n- **Activity Feed:** \"Alice merged PR #42\", \"Bob commented on Trace #123\".\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 4, "total_chunks": null}}
{"id": "2c1a1759-8d6a-4998-ac72-6903bd79f7a6", "content": "### 3.2. Config Editor (The \"No-Code\" Yaml)\n**Goal:** Replace direct YAML editing.\n\n**Tabs:**\n- **Inputs:**\n    - List of Personas (Card view).\n    - \"Generate More\" button (AI-powered).\n    - Form fields: Name, Description, Tone, Constraints.\n- **Evaluation:**\n    - List of Active Evaluators.\n    - \"Add Evaluator\" Wizard:\n        - Type: Rule-based (Regex) or LLM-Judge.\n        - Prompt Template Editor (for LLM Judge).\n        - Test Sandbox: \"Try this evaluator on recent traces\".\n- **Simulation:**\n    - Settings: Max turns, Parallelism limit, Supervisor mode.", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 5, "total_chunks": null}}
{"id": "88b4d2ff-0120-4159-82b8-a30b5c6813d7", "content": "### 3.3. Experiment Detail (Live View)\n**Header:**\n- Progress Bar (e.g., \"45/100 traces completed\").\n- Stop / Re-run Buttons.\n\n**Trace Grid:**\n- Table or Grid view of traces.\n- Columns: Status (Icon), Input Summary, Duration, Cost, Score.\n- **Filters:** \"Show Failures Only\", \"Show Regressions\".\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 7, "total_chunks": null}}
{"id": "e67ed1b4-6aa1-496e-b532-51eb7a0f5f8c", "content": "### 3.4. Trace Detail View (The Inspector)\n**Left Panel (Chat Replay):**\n- Rendered chat interface (User/Agent bubbles).\n- Tool calls shown as collapsible blocks.\n- **Annotation Mode:** Hover over a bubble to \"Thumbs Up/Down\" or \"Edit Golden Response\".\n\n**Right Panel (Internals):**\n- **Step Details:** Raw input/output of the selected step.\n- **Evaluator Logs:** Why did \"Politeness\" fail? (Show LLM Judge reasoning).\n- **Logs:** Raw stdout stream.\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 8, "total_chunks": null}}
{"id": "14cd941d-ea6c-4660-b19e-9f698c0d8678", "content": "### 3.5. Analyst Chat Interface\n**Location:** Slide-out panel or persistent bottom widget.\n\n**Features:**\n- **Context Aware:** Knows you are looking at Experiment #5, Trace #9.\n- **Suggested Queries:** \"Summarize failures\", \"Compare with previous run\".\n- **Interactive Responses:**\n    - \"I found 3 similar failures. [Click to filter]\"\n    - \"Shall I create a PR to fix this? [Preview PR]\"\n\n---\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 9, "total_chunks": null}}
{"id": "74c3c059-2abc-4d84-9d7c-4d82d514e3ff", "content": "## 4. Visual States\n- **Pending:** Grey/Loading skeletons.\n- **Success:** Green accents, checkmarks.\n- **Failure:** Red accents, warning icons.\n- **Improvement:** Blue/Up-arrow (vs previous run).\n- **Regression:** Orange/Down-arrow.\n\n", "metadata": {"source": "docs/prd/web/ui_ux_design.md", "chunk_index": 10, "total_chunks": null}}
{"id": "df9a699c-55cc-4fdf-a644-a3a0538a3ee1", "content": "# FluxLoop Frontend UI/UX Design Specification\n\n> **Status:** Draft\n> **Date:** 2024-11-21\n> **Related Docs:** `poc_implementation_plan_v2.md`, `web_version_plan.md`, `implementation_plan_agent_service.md`\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 0, "total_chunks": null}}
{"id": "ad6eaeb2-18e4-4c4e-a5d1-2ef403886124", "content": "## 1. 디자인 철학 및 목표 (Design Philosophy)\n\n**\"Developers build the engine, PMs steer the ship.\"**\n\nFluxLoop의 프론트엔드는 복잡한 CLI 도구를 **직관적인 협업 플랫폼**으로 변환해야 합니다.\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 1, "total_chunks": null}}
{"id": "2b26999c-31eb-4454-8cc4-75218b4842d0", "content": "### 1.1 제품 포지셔닝 및 전략 (Product Positioning Strategy)\n\nFluxLoop는 사용자의 기술 수준과 역할에 따라 두 가지 형태로 제공됩니다.\n\n| 구분 | **Core (CLI / SDK / VS Code)** | **Cloud (Web Platform)** |\n| :--- | :--- | :--- |\n| **타겟** | **개발자 (Developers)** | **PM / 도메인 전문가 (Product Managers)** |\n| **접근성** | 무료, 로컬 설치 필요 | **자동 설치**, 관리형 서비스 (SaaS) |\n| **핵심 가치** | 빠른 로컬 개발 및 디버깅 | **협업**, 데이터 시각화, 노코드 설정 |\n| **진입 경험** | `pip install fluxloop` | **Connect with GitHub** (Git 연동 즉시 사용 가능) |\n\n**웹 버전의 핵심 미션:**\n\"터미널이 낯선 PM도 GitHub 레포지토리만 연결하면, 백그라운드에서 자동으로 환경이 구축되고 즉시 에이전트를 테스트하고 개선할 수 있어야 한다.\"", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 2, "total_chunks": null}}
{"id": "02e50a54-f2bc-4b57-8f25-4ab5d760d2b5", "content": "\n---\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 3, "total_chunks": null}}
{"id": "b18cc589-68e0-4035-a469-f2840431fc50", "content": "### 1.2 핵심 원칙 (Core Principles)\n\n1.  **Git-Native Experience**: 모든 변경 사항은 Git 커밋/PR로 연결된다는 것을 시각적으로 인지시킵니다. (저장 버튼 대신 \"Commit/PR\" 메타포 사용)\n2.  **Transparency (투명성)**: \"블랙박스\"인 에이전트의 실행 과정을 채팅 UI와 로그로 투명하게 보여줍니다.\n3.  **Data-Driven Iteration**: 실행 -> 분석 -> 수정의 루프가 끊김 없이(Seamless) 이어지도록 설계합니다.\n4.  **Professional & Clean**: `shadcn/ui` 스타일의 깔끔하고 밀도 높은 정보 전달 (Dashboard Style).\n\n---\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 4, "total_chunks": null}}
{"id": "82112dce-938a-4a2e-b257-72ccf96afc83", "content": "## 2. 정보 구조 (Information Architecture)\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 5, "total_chunks": null}}
{"id": "bae708f8-05e9-444b-b031-8d5880738673", "content": "### 2.1 Site Map\n```\n/ (Home)\n├── /dashboard (Projects List)\n└── /project/{repo_owner}/{repo_name}\n    ├── /overview (Summary Dashboard)\n    ├── /configuration (Inputs & Rules Editor)\n    │   ├── Inputs (Personas, Test Cases)\n    │   └── Evaluators (Golden Dataset, Criteria)\n    ├── /experiments (Run History)\n    │   ├── [New Run Modal]\n    │   └── /run/{run_id} (Results & Analysis)\n    │       ├── Overview (Pass Rates, Latency)\n    │       └── Traces List (Filterable)\n    │           └── Trace Detail (Chat View + Debug Info)", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 6, "total_chunks": null}}
{"id": "26e87c24-a508-4d7b-a65f-07bba8a4e4e0", "content": "    └── /settings (Secrets, Connections)\n```\n\n---\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 7, "total_chunks": null}}
{"id": "eb47f2ca-4084-4b8d-ac80-ec4a5c046de7", "content": "## 3. 상세 화면 설계 (Screen Specifications)\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 8, "total_chunks": null}}
{"id": "46719fe8-5584-407f-bca2-91aa4e377734", "content": "### 3.1 프로젝트 생성 및 온보딩 (Onboarding Flow)\n*대상: 신규 사용자 (특히 PM/Non-Dev)*\n\n1.  **Repo Import Modal**:\n    *   GitHub App 연동을 통해 저장소 목록 표시.\n    *   **Zero-Config Setup**: 레포지토리 선택 시, 백엔드가 `fluxloop init` 과정을 자동 수행.\n    *   URL 직접 입력 지원.\n2.  **Auto-Detection & Setup**:\n    *   `fluxloop` 설정 파일 감지 로딩.\n    *   **Case A (설정 없음)**: \"Initialize Project\" 마법사 실행.\n        *   Template 선택 (General Chatbot, RAG, Coding Agent 등).\n        *   기본 `inputs.yaml`, `evaluation.yaml` 생성 후 자동 PR 생성.\n        *   *사용자는 로컬에 아무것도 설치할 필요가 없음.*\n    *   **Case B (설정 있음)**: 대시보드로 즉시 이동.", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 9, "total_chunks": null}}
{"id": "7396cc49-b744-43b6-9dbb-3a3383317edb", "content": "### 3.2 구성 스튜디오 (Configuration Studio)\n*목표: YAML을 직접 수정하지 않고 Form으로 테스트 케이스 관리*\n\n**A. Input Editor (Test Cases)**\n*   **Split View**: 좌측 목록 / 우측 상세 에디터.\n*   **Persona Builder**:\n    *   Avatar, Name, Tone, Knowledge Base 설정.\n*   **Task Generator (AI-Powered)**:\n    *   \"Generate Inputs\" 버튼 (Magic Wand Icon).\n    *   Prompt 입력: \"여행 예약 시나리오 10개 만들어줘\" -> 백엔드 API 호출 -> 목록 채워짐.\n*   **Review & Commit**:\n    *   변경된 사항이 있으면 상단에 \"Changes Unsaved\" 배지 표시.\n    *   \"Create PR\" 버튼 클릭 시 변경 요약(Diff) 보여주고 PR 생성.\n\n**B. Evaluator Builder**", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 11, "total_chunks": null}}
{"id": "78d2ec3c-4c7e-49b6-9112-3f114f97ef77", "content": "*   **Card Layout**: 각 평가 기준(Evaluator)을 카드로 표시 (예: `exact_match`, `llm_judge`).\n*   **Interactive Tuning**:\n    *   \"Golden Answer\" 예시 입력 필드.\n    *   \"Criteria\" 자연어 입력 필드 (\"친절한지 확인해줘\").\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 12, "total_chunks": null}}
{"id": "31b63ac2-6555-4a82-800c-e2f3ea080312", "content": "### 3.3 실험 실행기 (Experiment Runner)\n*목표: 배치 실행 현황을 실시간 모니터링*\n\n**A. Run Setup Modal**\n*   **Branch Selection**: 어떤 브랜치 코드로 실행할지 선택 (기본: main).\n*   **Dataset Selection**: 전체 실행 vs 특정 태그(Smoke Test) 실행.\n*   **Environment**: Local Docker vs Cloud Sandbox 선택.\n\n**B. Live Progress Dashboard**\n*   **Status Bar**: 진행률 (45/100 Traces), 예상 남은 시간.\n*   **Mini Charts**: 실시간 Pass/Fail 비율 도넛 차트.\n*   **Log Stream**: 하단 접이식 패널에 `runner` 컨테이너의 raw log 스트리밍.\n*   **Action**: \"Stop Execution\" (비상 정지).\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 13, "total_chunks": null}}
{"id": "b7deb7d8-8a38-4fd6-a0cb-dd0898fa1a3e", "content": "### 3.4 분석 및 트레이스 상세 (Analysis & Trace Detail)\n*핵심 기능: 에이전트의 사고 과정을 디버깅*\n\n**A. Run Overview Page**\n*   **Score Card**: 평균 점수, P95 Latency, 토큰 비용.\n*   **Filterable Table**:\n    *   컬럼: ID, Status (Pass/Fail), Duration, Score, Topic.\n    *   빠른 필터: \"Show Failures Only\", \"Low Score (< 0.5)\".\n\n**B. Trace Detail View (The \"Chat\" View)**\n*   **Layout**: 3-Column Layout\n    *   **Left (Steps)**: 에이전트 실행 단계 (Thought -> Action -> Observation) 타임라인.\n    *   **Center (Conversation)**: 실제 사용자와 에이전트 간의 대화창 (메신저 UI).\n        *   Thinking Process는 아코디언으로 접힘/펼침 가능.", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 14, "total_chunks": null}}
{"id": "0cb98df3-4063-4bf2-86cf-886f8b20ec9d", "content": "    *   **Right (Inspector)**:\n        *   **Metadata**: 사용된 모델, 비용, 지연시간.\n        *   **Evaluation Result**: 각 평가 항목별 점수 및 근거(Reasoning).\n        *   **Feedback**: 사용자가 직접 👍/👎 혹은 코멘트 달기 (Implicit Criteria 수집용).\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 15, "total_chunks": null}}
{"id": "b7bdedf1-103c-4f4f-afce-d55a20a073e4", "content": "### 3.5 Analyst Agent (Floating Interface)\n*목표: 데이터 분석가와 대화하듯 인사이트 도출*\n\n*   **Global Action**: 우측 하단 챗봇 아이콘 (항상 떠 있음).\n*   **Context Aware**: 현재 보고 있는 페이지(특정 Run 혹은 전체 프로젝트)를 컨텍스트로 인식.\n*   **Suggested Prompts**:\n    *   \"이번 실행에서 실패율이 가장 높은 원인이 뭐야?\"\n    *   \"지난주보다 성능이 떨어진 시나리오는?\"\n    *   \"이 에러를 고치기 위한 PR을 만들어줘.\"\n*   **Interactive Response**:\n    *   텍스트 답변 + **Clickable Charts/Traces**.\n    *   \"Fix it\" 버튼 클릭 시 -> `implementation_plan_agent_service.md`의 Coding Agent가 백그라운드에서 코드 수정 후 PR 제안.\n\n---\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 16, "total_chunks": null}}
{"id": "56627d67-8a1d-4416-b4c9-efe925e7ebc0", "content": "## 4. UI 컴포넌트 시스템 가이드 (Component System)\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 17, "total_chunks": null}}
{"id": "4bdfc17e-f652-4bc1-8941-45b38121237b", "content": "### 4.1 Color Palette\n*   **Primary**: Violet/Indigo (미래지향적, AI 느낌).\n*   **Status Colors**:\n    *   Success: Green-500 (Pass).\n    *   Error: Red-500 (Fail, Exception).\n    *   Warning: Amber-500 (Low Score).\n    *   Neutral: Slate-400 (Logs, Metadata).\n*   **Background**:\n    *   Dark Mode Default (개발자 친화적).\n    *   Card UI는 약간 밝은 Gray 사용 (`bg-slate-900`).\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 18, "total_chunks": null}}
{"id": "c94c4c7b-49eb-4c31-aaf2-d495ba34e899", "content": "### 4.2 Typography\n*   **Headings**: Inter, Bold.\n*   **Body**: Inter, Regular.\n*   **Code/Logs**: JetBrains Mono (가독성 필수).\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 19, "total_chunks": null}}
{"id": "58c8d455-5f6b-4a1c-bed5-2fe3d64ab43c", "content": "### 4.3 Key Interactions\n*   **Diff Viewer**: Monaco Editor의 Diff View 활용 (Before/After 명확히).\n*   **Optimistic Updates**: 설정 저장 시 UI 즉시 반영 후 백그라운드 동기화.\n*   **Toasts**: 실행 완료, PR 생성 등 주요 이벤트 알림.\n\n---\n", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 20, "total_chunks": null}}
{"id": "31602f30-8380-46a8-bc6b-029ef78a8c8d", "content": "## 5. 개발 우선순위 (Implementation Phases)\n\n1.  **Phase 1 (Viewer)**: Trace List & Detail View 구현. (기존 jsonl 파일 시각화)\n2.  **Phase 2 (Runner)**: Run Setup Modal & Live Progress 연동. (SSE/WebSocket)\n3.  **Phase 3 (Editor)**: Input/Eval Form Editor & Git Commit 로직 구현.\n4.  **Phase 4 (Analyst)**: Chat Interface & Agent Service 연동.", "metadata": {"source": "docs/prd/web/ui_ux_design_spec.md", "chunk_index": 21, "total_chunks": null}}
{"id": "9191859a-1106-4485-9d2a-11fcdf54e8b8", "content": "# FluxLoop V4.1 – 완전 자율 Deep Agent 전환 기획서\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 0, "total_chunks": null}}
{"id": "a0e89c93-46da-4563-b1e5-61fda78f84ca", "content": "## 0. 목적\n- Stage B 레거시(가이드 모드) 로직을 완전히 제거하고, Stage C를 **LangGraph 기반 Deep Agent** 아키텍처로 재구성한다.\n- Runner는 sandbox 준비와 결과 중계만 담당하고, 나머지 모든 계획/편집/검증/배포는 Agent가 스스로 수행하도록 한다.\n- MCP, Git, Test, Telemetry 등 모든 기능을 **Tool**로 제공하여 Supervisor가 필요한 순간에 호출하도록 한다.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 1, "total_chunks": null}}
{"id": "52da614c-a767-4c3c-b7e0-bb3e359efab6", "content": "## 1. 시스템 전경\n\n```mermaid\nflowchart LR\n    User[\"Init Checklist\\nIntegrate 버튼\"] --> API[\"API: POST /integrator-runs\"]\n    API --> Runner[\"Runner Service\\n(sandbox 준비)\"]\n    Runner --> Supervisor[\"Deep Agent (LangGraph)\\nGoal: FluxLoop SDK 통합\"]\n\n    subgraph Agent Loop\n        Supervisor --> Planner[\"Planner Tool (LLM Planning)\"]\n        Planner --> Todos[\"TODO State (Supabase + .fluxloop/todos.json)\"]\n        Supervisor --> Worker[\"Worker Subagent\\n(FileOps, Search, Cmd)\"]\n        Worker --> Sandbox[\"Sandbox Repo\\n(WorkspaceContext)\"]", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 2, "total_chunks": null}}
{"id": "85fc8c4b-422a-4173-bc2a-8e4602228eb2", "content": "        Supervisor --> Tester[\"Test Tool\\n(pytest, custom)\"]\n        Supervisor --> GitOps[\"Git Tools\\n(branch, commit, push, reset)\"]\n        Supervisor --> MCP[\"MCP Tool\\n(domain knowledge)\"]\n    end\n\n    Supervisor --> EventStream[\"SSE Events\\nintegrator_run_events\"]\n    Supervisor --> Summary[\"Run Summary\\n(Supabase)\"]\n    Summary --> UI[\"Integrator Modal\\n(Event Stream + Result)\"]\n```\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 3, "total_chunks": null}}
{"id": "2f85199a-d4a5-4db1-9b45-5638e72e0a1c", "content": "## 2. 실행 흐름 (Runner ↔ Deep Agent)\n1. **사용자 트리거**: Init Checklist의 “Integrate” 버튼 → `POST /api/v1/projects/{project_id}/integrator-runs`\n2. **Runner 준비**:\n   - 저장소 체크아웃 + sandbox 생성\n   - 프로젝트 크레덴셜 주입\n   - Goal/Context 패키징 (project metadata, init checklist 상태 등)\n3. **Deep Agent 호출**:\n   - Supervisor에게 단일 Goal: `“FluxLoop SDK를 현재 repo에 통합하고 테스트/배포 준비까지 완료하라.”`\n   - Runner는 LangGraph Deep Agent를 실행하고, 이벤트 스트림 채널(`integrator:{run_id}`)만 열어둔다.\n4. **Agent 자율 루프**:\n   - repo 스캔 → 계획 수립 → TODO 업데이트 → 파일 수정 → 테스트 → Git ops\n   - 모든 중간 상태는 `integrator_run_events` + `.fluxloop/todos.json`에 기록", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 4, "total_chunks": null}}
{"id": "2dee3aba-b136-4237-acff-1319c22e6801", "content": "5. **결과 중계**:\n   - 성공 시: 브랜치/커밋 정보, 테스트 결과, 요약을 Supabase에 저장\n   - 실패 시: 오류 메시지 + 다음 조치 제안 기록\n6. **UI 반영**:\n   - Integrator Panel은 SSE를 통해 실시간 이벤트 / LLM 응답 / 테스트 결과를 노출\n   - 성공 시 Init Progress에 Run Summary append\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 5, "total_chunks": null}}
{"id": "084559ce-c11e-4725-8949-3f9c0728fc17", "content": "## 3. Deep Agent 구성\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 6, "total_chunks": null}}
{"id": "ff08e389-1830-4fc5-99a5-d2511d1b10b5", "content": "### 3.1 Supervisor Agent\n| 항목 | 내용 |\n| --- | --- |\n| 모델 | GPT-4o (code interpreter) |\n| Prompt | `BASE_SYSTEM + Deep Agent 목적 + 프로젝트 컨텍스트(.langcode / Supabase metadata)` |\n| Goal | FluxLoop SDK 완전 통합 (config 갱신, code instrumentation, 테스트, git push) |\n| 책임 | 계획 수립, 작업 분배, 도구 호출, 실패 재시도, 최종 보고 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 7, "total_chunks": null}}
{"id": "23f5c1c5-85fd-421e-9318-f42cce2211a2", "content": "### 3.2 Planner/Worker/Tester\n- **Planner**: repo 구조를 분석하고 TODO 리스트를 동적으로 작성/수정. (write_todos, update_todo_status tool 사용)\n- **Worker**: 파일 읽기/쓰기/검색/명령 실행 담당. (read_file, write_file, search_replace, run_cmd 등)\n- **Tester**: `pytest`, `custom test_cmd`를 실행하여 결과를 Supervisor에게 반환.\n- **GitOps**: 브랜치 생성, 커밋, 푸시, 리셋을 Supervisor가 필요 시 호출.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 8, "total_chunks": null}}
{"id": "20c31d22-9512-4df0-847f-98f10d66ab30", "content": "### 3.3 Tool 목록 (초안)\n| 카테고리 | Tool | 설명 |\n| --- | --- | --- |\n| FileOps | `read_file`, `write_file`, `search_replace`, `list_dir` | 현재 executor 기반 도구 유지 |\n| RepoOps | `glob`, `grep` | 코드 검색 도구 (langchain-code 예제 참고) |\n| Planner | `write_todos`, `update_todo_status`, `list_todos` | .fluxloop/todos.json 기반 |\n| CMD | `run_cmd`, `run_script` | shell 실행, multi-step script 지원 |\n| Git | `create_branch`, `git_commit`, `git_push`, `git_reset` | 기존 `_create_auto_branch`, `_commit_and_push` 로직을 Tool로 추출 |\n| Test | `run_pytest`, `run_custom_test` | 기존 `_run_tests` → Tool |", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 9, "total_chunks": null}}
{"id": "1dcffb6c-7663-4c34-a954-6aef64d42098", "content": "| MCP | `run_integration_workflow` | 기존 `_collect_integration_plan` → Tool화 |\n| Supabase | `log_event`, `update_run_summary` | SSE 이벤트/요약을 Supervisor가 직접 호출 (필요 시 Runner API로 위임) |\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 10, "total_chunks": null}}
{"id": "8ec0ef43-0ef9-4c1f-8afd-2fa5beabf8cc", "content": "## 4. Runner 변경 사항\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 11, "total_chunks": null}}
{"id": "48c6b254-d43a-42d3-a8b4-6a184f050280", "content": "### 4.1 Handler 재설계\n- `IntegratorAutonomousHandler` → `DeepAgentIntegratorHandler`로 대체.\n- 책임:\n  1. sandbox 준비 (git clone, credential 주입)\n  2. Deep Agent 실행 (`create_deep_agent` 유사 로직)\n  3. 에이전트 종료 시 결과 수집 (summary, branch, push_url)\n  4. 예외 처리 및 SSE 채널 정리\n- 기존 `_analyze_repository`, `_run_tests`, `_commit_and_push` 등 절차 함수 제거.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 12, "total_chunks": null}}
{"id": "68f482af-8fee-4453-a05d-48cdf94c91ef", "content": "### 4.2 이벤트/요약 저장\n- Supervisor가 `log_event` Tool을 통해 Supabase `integrator_run_events`에 직접 쓰도록 API 제공.\n- Runner는 최소한의 fallback (tool 실패 시)만 담당.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 13, "total_chunks": null}}
{"id": "1dc30055-3108-4cc2-91b3-c16f96c9d92f", "content": "## 5. 프론트엔드 & UX\n1. **Integrator Modal**:\n   - 좌: Run 생성 + 최근 기록\n   - 중: TODO/Branch/Status 요약\n   - 우: Event Stream + Agent Response (LLM 출력, 테스트 결과 등)\n   - 큰 가로폭 및 스크롤 영역 확보 (이미 적용됨)\n2. **Init Progress**:\n   - 성공 Run append (branch, push URL, 테스트 상태)\n   - 실패 Run은 “Needs revision” 섹션 아래에 정리\n3. **SSE 이벤트 규격**:\n   ```json\n   {\n     \"eventId\": \"...\",\n     \"eventType\": \"integrator_step\",\n     \"payload\": {\n       \"phase\": \"plan|edit|test|git|completed|failed\",\n       \"status\": \"running|success|warning|failed\",\n       \"todoId\": \"...\",", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 14, "total_chunks": null}}
{"id": "ba8aff1e-817b-46e9-a5c5-4c92e6a03b89", "content": "       \"message\": \"...\",\n       \"result\": \"LLM response\",\n       \"tests\": [{ \"name\": \"pytest\", \"status\": \"failed\", \"output\": \"...\"}],\n       \"branchName\": \"...\",\n       \"pushUrl\": \"...\"\n     },\n     \"createdAt\": \"...\"\n   }\n   ```\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 15, "total_chunks": null}}
{"id": "ba6c7842-d989-4d14-b21f-a6b2d7b86515", "content": "## 6. 마이그레이션 계획\n1. **준비**: Deep Agent 의존성(langgraph, 추가 tools) 설치, Sandbox Executor 확장.\n2. **코드 정리**:\n   - `app/services/runner/handlers/integrator*.py` 제거.\n   - 새 Handler + Deep Agent Runner 구성.\n   - MCP/Tool 모듈 재구성.\n3. **프론트엔드 반영**: Event Stream + Run Summary UI 이미 개편 완료. 추가로 TODO 상태 업데이트 로직 개선.\n4. **QA**:\n   - 샘플 repo 5개로 end-to-end 실행.\n   - 실패 시 Supervisor가 재시도하거나 TODO를 수정할 수 있는지 확인.\n5. **출시**:\n   - Stage C-only 모드 활성화.\n   - Stage B 관련 DB 컬럼/테이블 정리 완료 (이미 진행됨).\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 16, "total_chunks": null}}
{"id": "c4baa523-d0f7-473a-8ec2-0bccf10dedd9", "content": "## 7. 리스크 & 대응\n| 리스크 | 대응 |\n| --- | --- |\n| LangGraph Deep Agent 안정성 | recursion_limit, checkpointing(MemorySaver) 활용, run timeout 설정 |\n| Sandbox 자원 사용량 증가 | Agent가 장시간 실행할 수 있으므로 실행 시간/비용 모니터링 |\n| Tool 실패 시 복구 | 각 Tool에 명확한 오류 메시지 반환, Supervisor가 재시도 로직 포함 |\n| Git 충돌 | branch 작명 규칙 유지(`fluxloop/auto/<ts>`), push 실패 시 rollback & 경고 이벤트 |\n| MCP 부재 시 성능 저하 | MCP Tool optional화, 없으면 LLM Planning으로 fallback |\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 17, "total_chunks": null}}
{"id": "75f485c6-55b6-4602-81de-090e7b66573c", "content": "## 8. 산출물\n- 새 Runner Handler (`DeepAgentIntegratorHandler`)\n- Tool 세트 (Git/Test/MCP 등)\n- Supervisor/Planner/Worker Prompt 정의\n- 업데이트된 PRD / 시스템 다이어그램 (본 문서)\n- QA Checklist 및 롤아웃 가이드\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 18, "total_chunks": null}}
{"id": "ae8284fe-8264-4694-8986-098f9fd3747c", "content": "## 9. 다음 단계\n1. Deep Agent Prototype을 runner sandbox에서 실행 가능하도록 세팅.\n2. Tool 인터페이스 확정 및 구현.\n3. Runner ↔ Agent ↔ Supabase 파이프라인 통합 테스트.\n4. 프론트엔드 TODO 상태 실시간 업데이트 로직 개선.\n\n---\n\n**결론:** Stage C의 진정한 목적은 “Agent가 목표를 이해하고 스스로 해결”하는 것. Deep Agent 아키텍처로 전환함으로써, 레거시 절차 로직을 제거하고 Supervisor 기반 자율 통합을 완성한다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_deep_agent_transition.md", "chunk_index": 19, "total_chunks": null}}
{"id": "6d1c63f5-2da4-4b8e-b101-e4034e739d8f", "content": "# Fluxloop V4.1 Project Onboarding PRD\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 0, "total_chunks": null}}
{"id": "6231c142-f1ae-4a7b-84aa-bdca7a79128c", "content": "## 1. Summary\n- **Vision**: 사용자가 Git URL과 권한만 제공하면 10분 내 Fluxloop 실험을 시작한다.\n- **Key Feature**: Integrator Agent가 `code agent@langchain-code-main`을 재사용해 코드 수정·테스트·실행·Git push를 자동으로 수행한다. MCP는 지식 조회 전용이다.\n- **Approach**: Stage A→B→C 단계로 내부 검증을 진행하며, 모든 Stage를 통과한 뒤에만 외부 사용자에게 일괄 제공한다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 1, "total_chunks": null}}
{"id": "b6849ab2-3c1b-4bfb-be09-731ade33bd45", "content": "## 2. Background\n- Phase 0 마이그레이션으로 Run/Experiment 스키마 재정비 완료.\n- 다음 목표는 신규 프로젝트 온보딩 자동화이며, 기존 문서 `fluxloop_v4_concept.md`의 Phase 1 내용을 v4.1 전용 PRD로 분리했다.\n- 배포 일정은 아직 미정이므로, 안정적인 구현 단계를 정의하고 검증 기준을 사전에 명확히 한다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 2, "total_chunks": null}}
{"id": "3d3c0678-e94f-48ec-a877-3f9e3cb7a529", "content": "## 3. Goals & Non-goals\n| 구분 | 설명 |\n|------|------|\n| Goal | Git URL → 자동 감지/SDK 주입 → 첫 Experiment 생성까지 무중단 플로우 |\n| Goal | Integrator Agent가 미통합 프로젝트를 분석해 TODO, 코드 수정, 테스트, 브랜치 생성, push까지 완료 |\n| Goal | 실패 시 재시도/롤백/로그 확인이 가능한 관찰성 확보 |\n| Non-goal | Stage C 이전까지 완전 무감독 배포 (Stage A/B는 사람 승인 포함) |\n| Non-goal | Fluxloop 외 타 워크스페이스 자동 배포 (향후 단계에서 검토) |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 3, "total_chunks": null}}
{"id": "34adbdc9-4507-49aa-a4fd-d48f76f25587", "content": "## 4. User Journeys\n| 유즈케이스 | 상세 시나리오 | 성공 기준 |\n|-----------|---------------|-----------|\n| 신규 프로젝트 온보딩 | Git URL, deploy target 입력 → Detection → Template → Push → 첫 Run 생성 | 모든 단계 진행 상황을 UI로 확인 가능, 실패 시 가이드 표시 |\n| 기존 프로젝트 동기화 | 이미 SDK가 있는 repo에 재주입 없이 push만 실행 | 중복 주입 0건, 변경 diff 명확 표시 |\n| Agent 서포트 | Integrator Agent가 코드 수정·테스트·실행 후 전용 브랜치에 push, 사용자는 diff 승인 | 자동 실행 성공률 70% 이상, 잔여 수동 작업 < 10분 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 4, "total_chunks": null}}
{"id": "70bb93a5-0245-476f-8fa8-82fe970984c5", "content": "## 5. Stage Plan (@v4)\n| 단계 | 코드네임 | 범위 | 완료 조건 |\n|------|----------|------|-----------|\n| Stage A | `v4.1-foundation` | Detection/Template/Git Push 안정화 + 온보딩 UI 기본형 | 샘플 5개 repo에서 자동 주입 성공, 오류 로그 수집 |\n| Stage B *(retired)* | `v4.1-guided` | **Deprecated.** 기능 요구사항이 Stage C 자율 에이전트에 통합됨 | — |\n| Stage C | `v4.1-autonomous` | 완전 자동 Agent (코드 수정→테스트→브랜치 생성→push) | Sandbox 실행/롤백, 브랜치 링크 제공, 자동 push 성공률 90% |\n\n**Stage Gate 원칙**\n- 각 Stage는 순차적으로 진행하며, 내부 QA/도그푸드 환경에서만 검증한다.\n- Stage N이 합격해야 Stage N+1을 시작할 수 있으며, 외부 사용자 공개는 Stage C 완료 후 한 번에 이루어진다.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 5, "total_chunks": null}}
{"id": "70cacaf8-f406-413f-8f4f-e38050814d14", "content": "### 5.1 Stage A: Foundation\n| 태스크 | 세부 단계 | 산출물 |\n|--------|-----------|--------|\n| Init UI 개선 | 연결 상태/진행률 표시, 실패 로그 & 재시도, 첫 Run CTA | `InitWizard.tsx`, Empty-state |\n| Framework Detection | `detector.py`, 룰 관리, API/UX 통합 | `framework_detector`, 룰 JSON, 성공/실패 메트릭 |\n| Template Injection | Framework별 템플릿 매트릭스, patch/skip 로직, diff preview | `templates/<framework>`, 패치 스크립트, diff API |\n| Git Push 안정화 | Credential UX 통합, 충돌 가이드, SSE push 로그 | `git_service.py` 재시도 로직, PushResult 모델 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 7, "total_chunks": null}}
{"id": "ba1189a3-a8d0-441c-a0e8-1885e0d3b4e9", "content": "#### Stage A 현황 & 필수 액션\n- **Backend**: `POST /api/v1/projects/init` → `RunnerService.init_project` → `ProjectInitHandler`가 이미 `git clone → fluxloop init project → (선택) commit/push → MCP plan`을 수행하고, 로그는 `log_stream`을 통해 `/api/v1/experiments/{run_id}/logs/stream` SSE로 송출된다.\n- **Frontend**: `InitProgressTimeline`은 `/api/mock/init-status` 더미 SSE만 구독하여 실제 init 상태와 무관한 진행률을 표시한다. Project init을 호출하는 UI도 없다.\n- **Action Items**\n  1. Mock SSE 라우트 제거 및 Project Init UX(버튼/위자드)에서 `POST /api/v1/projects/init`을 호출하도록 연동, 응답의 `run_id`를 저장.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 8, "total_chunks": null}}
{"id": "b333a9cc-53ff-4dd0-bedb-9011a34e5a36", "content": "  2. 타임라인 컴포넌트는 백엔드 SSE를 구독하고, Step ID(`repo_sync`, `detector`, `template`, `git_push`)와 상태(`running/success/failed`)를 기반으로 UI를 갱신.\n  3. `ProjectInitHandler`가 `log_stream.publish_event`로 단계별 구조화 이벤트를 내보내도록 확장해 UI와 PRD 단계 정의를 일치.\n  4. 필수 요소(테스트 스크립트, 환경 변수 등)가 누락된 경우 API 응답에 `requirements` 필드를 포함하고, UI에서 사용자 입력/업로드를 요청하는 Fallback UX를 제공.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 9, "total_chunks": null}}
{"id": "d55a092d-dc36-425e-873e-c4214ad6c507", "content": "#### Stage A 상세 스펙 & 구현 계획\n\n**1) 제품 범위**\n- 대상 사용자: 신규 프로젝트를 Fluxloop 웹에서 온보딩하려는 엔지니어.\n- 목표 경험: Git URL과 Branch를 입력하고 “Init Project”를 실행하면, 실제 Runner 파이프라인이 수행되고 UI에서 단계별 진행 상황과 오류/요구사항을 실시간으로 확인한다.\n- 성공 조건: Stage A 체크리스트(샘플 5개 repo 자동 주입, Detection FP ≤ 5%, Import 오류 0건, Push 로그 100% 수집) 달성.\n\n**2) 백엔드 구현**\n- API 계약: `POST /api/v1/projects/init` 응답 스키마에 `run_id`, `step_events_url`, `requirements` 필드 추가.\n- 이벤트 스키마:\n  ```json\n  {\n    \"event\": \"init_step\",\n    \"data\": {\n      \"stepId\": \"repo_sync|detector|template|git_push\",", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 10, "total_chunks": null}}
{"id": "97dc428f-eb31-413d-9a04-bda09630a50d", "content": "      \"status\": \"pending|running|success|failed\",\n      \"message\": \"...\",\n      \"timestamp\": \"...\",\n      \"requirements\": [\"missing_tests\", \"set_env:OPENAI_API_KEY\"]\n    }\n  }\n  ```\n- `ProjectInitHandler`는 각 단계 진입 시 `status=running`, 완료 시 `success/failed` 이벤트를 `log_stream`으로 송출. 오류 발생 시 `requirements`와 `next_actions`를 채워 Fallback UX에 활용.\n- Supabase 업데이트: 성공 시 `projects.bootstrap_status=initialized`, 실패 시 `failed` + `bootstrap_log` 경로 저장.\n- Telemetry: Stage A KPI 저장용 `project_bootstrap_metrics` 테이블 추가(필드: project_id, duration_ms, detection_result, template_result, push_result, created_at).", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 11, "total_chunks": null}}
{"id": "837cccf0-5751-4bde-b211-4703ea65b7f5", "content": "\n**3) 프론트엔드 구현**\n- Init Wizard 모달/페이지:\n  - 입력: Git URL, Branch, Project Name, Fluxloop Root, With Example toggle, Force flag.\n  - 제출 시 `POST /api/v1/projects/init` 호출 → 응답의 `run_id` / `step_events_url` 저장.\n  - 결과 상태(Init 성공/실패/요구사항)와 Supabase 메타데이터 갱신을 Project Overview에 반영.\n- Timeline 컴포넌트:\n  - 기존 mock SSE 제거, `step_events_url` (또는 `/api/v1/projects/{id}/init/stream`) 구독.\n  - Step 정의: `repo_sync`, `detector`, `template`, `git_push`. 각 단계에 설명/아이콘, 로그 링크, 실패 시 요구사항 버튼 표시.\n  - 요구사항 UX: `requirements`가 내려오면 사용자에게 체크리스트/업로드/입력 폼을 노출하고, 완료 시 Init을 재시도하는 CTA 제공.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 12, "total_chunks": null}}
{"id": "d5c59eb8-fb30-4fb8-9bc0-0ddaea69701a", "content": "- 상태 표시:\n  - `bootstrap_status`와 `bootstrap_log`를 보여 주는 세컨더리 카드.\n  - 최근 Init 기록(날짜, 사용자, 결과)을 Activity 리스트에 추가.\n\n**4) 인프라 & 인증**\n- Runner Sandbox: 기존 `LocalDockerExecutor` 이미지(`fluxloop-runner`) 최신화 및 캐시 볼륨 확인.\n- Git Credential UX: Init Wizard에서 SSH Key/Personal Access Token 입력을 받아 Vault에 저장하거나 일회성 환경 변수로 Runner에 전달.\n- Supabase 권한: Init API 호출 전 프로젝트 소유자/멤버 권한 검사.\n\n**5) QA/검증 계획**\n- 샘플 Repo 5개(언어별 최소 2개) 선정하여 Stage A 시나리오 실행.\n- 자동화 테스트: `tests/e2e/init_flow.http`를 업데이트해 실제 SSE 이벤트와 결과 상태를 검증.\n- 모니터링: 실패 케이스 발생 시 Slack/Webhook 알림 설정.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 13, "total_chunks": null}}
{"id": "d0ac6cf8-f7db-48f7-818d-b5314364e0ad", "content": "\n**6) 일정 및 의존성**\n- Week 1: Backend 이벤트 스키마+API 확장, Supabase 스키마/metrics 추가.\n- Week 2: Frontend Wizard/SSE 통합, 요구사항 UX 구현.\n- Week 3: Credential UX, QA & Telemetry 대시보드, 샘플 Repo 검증.\n- 완료 게이트: Stage A KPI 충족 및 내부 도그푸드 OKR 달성 시 Stage B 착수 승인.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 14, "total_chunks": null}}
{"id": "3a56cb60-935a-46e1-8896-7692ca402891", "content": "#### Stage A-1: Project Creation Wizard\n\n| 태스크 | 세부 단계 | 산출물 |\n|--------|-----------|--------|\n| GitHub Repo 선택 UI | GitHub OAuth로 가져온 Repo 리스트 표시, 검색/필터 기능으로 대상 Repo 선택 | `RepoPickerModal` 컴포넌트, `/api/internal/github/repos` API |\n| Branch 선택 | Repo 선택 시 기본 Branch 목록 로드 → 사용자 선택 | Branch 드롭다운, `/api/internal/github/branches?repo=...` API |\n| 메타데이터 자동 채움 | Repo name/description을 기반으로 Project Name/Description 기본값 설정 | 자동 채움 로직, 입력 Validation |\n| 프로젝트 생성 API 연동 | `POST /api/internal/projects` 호출 → 성공 시 Project Overview로 이동 | `CreateProjectWizard` 완료 상태, success toast |", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 15, "total_chunks": null}}
{"id": "ac99b780-91c4-4a9e-8d61-94cd496ab06a", "content": "\n**상세 플로우**\n1. 사용자가 “New Project” 버튼 또는 빈 카드 클릭 → `CreateProjectWizard` 모달 표시.\n2. 상단에 GitHub Repo 검색 필드 + 리스트가 나타나며, 로그인된 계정의 repo들을 pagination + fuzzy search로 노출.\n3. Repo를 클릭하면 Branch 선택 영역이 활성화되어 최신 Branch 목록을 불러오고, 기본값은 Repo default branch.\n4. Repo 이름을 기반으로 Project Name, Repo description을 기반으로 Project Description Input이 자동 채워지고 수정 가능.\n5. “Create Project” 제출 시 `/api/internal/projects` → 백엔드 `POST /api/v1/projects` 호출, 성공 시 모달 닫고 Dashboard/Project Overview 갱신, 실패 시 오류 메시지 표기.\n\n**검증 항목**\n- [ ] Repo 검색/선택 latency < 2초 (GitHub API pagination 포함)", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 16, "total_chunks": null}}
{"id": "8d4fc261-1c6a-4859-8af7-02647591e1d4", "content": "- [ ] Branch 목록 최대 50개까지 무한스크롤 지원, 선택 즉시 미리보기 업데이트\n- [ ] 프로젝트 생성 후 즉시 Dashboard와 Project Overview에서 신규 항목 확인 가능\n- [ ] GitHub 권한 부족/Repo 비공개 등 오류 시 사용자 안내 (ex: “Repo access denied”)\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 17, "total_chunks": null}}
{"id": "2ced2bdd-9276-4960-aa57-1fc8ac567e57", "content": "### 5.2 Stage B: Guided Agent *(Deprecated)*\n\n> **Note:** Stage B (Guided Agent) 요구사항은 Stage C 자율 에이전트에 흡수되어 더 이상 별도 플로우로 유지하지 않습니다. 아래 내용은 참고용 기록입니다.\n| 태스크 | 세부 단계 | 산출물 |\n|--------|-----------|--------|\n| MCP 지식 파이프라인 | SDK 통합 가이드/체크리스트를 MCP endpoint로 구성 | `integration_knowledge.json`, MCP 경로 |\n| Guided Agent UI | TODO, diff, 테스트 로그 표시 + 승인/적용 버튼 | `IntegratorPanel.tsx`, 승인 API |\n| Semi-auto Executor | Code Agent 호출로 patch 제안/테스트, commit/push는 사용자 수행 | `integrator_executor` Stage B 모드, `IntegratorRun` 제안/로그 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 18, "total_chunks": null}}
{"id": "67305cfe-2085-497c-aada-1da6e5f7c923", "content": "#### Stage B 현황 & 필수 액션\n- **전제**: Stage A/Stage A-1 구현으로 Init 파이프라인, 프로젝트 생성, SSE 기반 관찰성이 확보됐다. Stage B는 동일한 Runner 인프라 위에 “완전 자동 전 단계의 반자동(제안→사용자 승인)” 레이어를 올린다.\n- **핵심 과제**: Agent가 Repo별로 필요한 TODO와 Patch, 테스트 결과를 신뢰도 있게 제안하고, 사용자가 UI에서 이를 검토/승인해 수동으로 Git push까지 이어가는 경험을 만든다.\n- **Action Items**\n  1. MCP 지식 파이프라인: Fluxloop SDK 가이드, 예제 코드, 체크리스트를 JSON으로 정규화하고 버전 관리 → MCP endpoint에서 조회.\n  2. Guided Agent 실행: `integrator_executor` Stage B 모드에서 `plan → edit → test → awaiting_approval` 루프를 수행하고 `IntegratorRun` 레코드로 저장. _(현재는 Stage C 자율 에이전트에 통합됨)_", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 19, "total_chunks": null}}
{"id": "5bb31ae4-5931-442a-a0b1-b7097bce85d7", "content": "  3. UI/승인 흐름: `IntegratorPanel.tsx`가 TODO/patch/test 로그를 스트리밍으로 보여주고, 사용자가 “Apply Patch”, “Reject”, “Request Update” 등을 선택하면 백엔드 승인 API를 호출. _(현재 비활성화)_\n  4. Telemetry & Rollback: 제안 품질, 승인률, 소요 시간을 측정하고 실패 시 재실행/수정 요청 루프를 지원.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 20, "total_chunks": null}}
{"id": "d5bb93e0-6325-4615-96eb-703b57c158d7", "content": "#### Stage B 상세 스펙 & 구현 계획\n\n**1) 제품 범위**\n- 대상 사용자: Stage A 파이프라인을 통과했지만 Fluxloop SDK 코드/테스트 정리가 필요한 엔지니어.\n- 목표 경험: Project Init 이후 “Guided Agent”를 실행하면 TODO 리스트와 patch 제안, 테스트 로그를 UI에서 검토하고, 승인 시 로컬/CI 환경에서 patch를 적용해 push를 완료한다.\n- 성공 조건: Stage B KPI(`TODO → diff → 테스트` UI 연결, 승인 후 머지까지 1시간 내, MCP latency < 3초, 환각률 < 5%) 충족.\n\n**2) MCP 지식 파이프라인 (Stage B 간소화 버전)**\n- **역할**: 복잡한 지식 그래프 대신, `fluxloop-mcp` 내장 툴(`RunIntegrationWorkflowTool`)을 활용하여 Repo 분석 및 TODO 제안을 수행하는 **정적 분석 엔진** 역할.\n- **데이터 흐름**:\n  1. Runner가 `fluxloop-mcp` 실행.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 21, "total_chunks": null}}
{"id": "2b2a10b6-1415-41ae-84ab-1b027bf76b53", "content": "  2. MCP가 Repo 스캔 후 JSON 결과(프레임워크, TODO, 레시피) 반환.\n  3. Runner는 결과를 파싱하여 `integrator_run_todos` DB에 저장.\n- **캐싱 전략**: 별도의 캐시 레이어 없이, Runner 실행 시점마다 실시간 분석을 수행하고 결과를 `integrator_runs` 테이블에 스냅샷으로 저장하여 이력 관리.\n- **Fallback**: MCP 실행 실패 시, 최소한의 필수 파일(`project.yaml`) 생성 룰만 적용하는 안전 장치 마련.\n\n**3) Guided Agent UI (`IntegratorPanel.tsx`)**\n- 진입점: Project Overview 카드에 “Guided Agent (beta)” CTA 추가. 실행 시 Init 로그 카드 아래 패널이 펼쳐져 최신 `IntegratorRun`을 표시.\n- 구성 요소:\n  - TODO 보드: `severity`, `category`, `blocking` 플래그, 추천 작업(예: “Add experiment manifest”). 체크박스 완료 시 API 호출.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 22, "total_chunks": null}}
{"id": "7f1b99fe-3e53-473a-8fb8-41ab7612c93d", "content": "  - Diff 미리보기: `diff_preview_url` iframe 또는 인라인 viewer. 다중 patch stack 지원, 각 patch마다 “Apply locally” 스니펫 제공.\n  - 테스트 로그: `pytest`/`npm test` stdout folding, 실패 시 스택트레이스 요약 + 재실행 버튼.\n  - 승인 바: `Approve patch`, `Reject`, `Need revision` 버튼. 선택 결과는 `POST /api/internal/integrator-runs/{id}/decisions`로 전달.\n  - Manual push 가이드: 승인되면 `git fetch && git checkout -b fluxloop/stage-b/<run>` 스크립트와 patch 적용 명령을 안내하고, 사용자 체크 확인 후 완료 처리.\n- SSE 연동: `/api/internal/log-stream?run_id=...&channel=integrator` 구독, 이벤트별 카드 상태 업데이트 및 재접속 시 최근 50개 이벤트를 재생.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 23, "total_chunks": null}}
{"id": "7e0fbb3f-61e9-43bc-b758-805c24e81ff7", "content": "\n**4) 백엔드 & Semi-auto Executor**\n- 새로운 API\n  - `POST /api/v1/projects/{project_id}/guided-runs`: _(폐지됨. 현재는 `/integrator-runs` 엔드포인트 사용)_\n  - `GET /api/v1/projects/{project_id}/guided-runs/{run_id}`: _(폐지됨)_.\n  - `POST /api/v1/projects/{project_id}/guided-runs/{run_id}/decision`: _(폐지됨)_.\n- 이벤트 스키마:\n  ```json\n  {\n    \"event\": \"integrator_step\",\n    \"data\": {\n      \"phase\": \"plan|edit|test|run|completed|failed\",\n      \"todoId\": \"sdk-entrypoint\",\n      \"status\": \"running|success|failed\",\n      \"tests\": [{ \"name\": \"pytest::tests/test_init.py\", \"status\": \"passed\" }],", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 24, "total_chunks": null}}
{"id": "981b46f4-bfb0-4006-b8d0-7a195739850c", "content": "      \"branchName\": \"fluxloop/auto/20241125...\",\n      \"pushUrl\": \"https://github.com/...\",\n      \"timestamp\": \"...\"\n    }\n  }\n  ```\n- `integrator_executor` Stage C 모드:\n  1. MCP 지식 조회 → TODO 그래프 작성(우선순위/선행조건 포함).\n  2. 각 TODO마다 LangGraph 기반 ReAct agent가 `plan → edit → test` 루프를 수행하고 바로 작업 디렉터리에 반영.\n  3. 테스트 통과 후 자동 커밋/브랜치 생성 및 원격 push, 모든 상태는 SSE 이벤트로 전달.\n  4. 실패 시 TODO/이벤트에 오류 메시지 및 다음 조치 힌트를 기록하고 브랜치를 롤백.\n- 로그 메타데이터: `IntegratorRun` 레코드에 knowledge_version, repo_commit, runner_image, executor_trace_id 추가. 실패 시 `failure_reason`, `next_actions` 필드 채움.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 25, "total_chunks": null}}
{"id": "3fae1bdf-29bc-40fb-8d2d-1529eb96604c", "content": "- 실패 처리: MCP 조회 실패 → Stage A fallback 안내. 테스트 실패 → 로그와 함께 TODO에 “manual fix required” 태그.\n\n**5) 데이터 모델 & Telemetry**\n- Supabase 테이블:\n  - `integrator_runs(run_id, project_id, mode, status, knowledge_version, started_at, completed_at, created_by)`\n  - `integrator_run_todos(todo_id, run_id, category, severity, status, checklist_refs)`\n  - `integrator_run_events`로 SSE 재생 산출.\n- 메트릭 대시보드:\n  - TODO 생성 → 승인까지 평균 소요 시간.\n  - Patch 승인률, 거절 사유 Top 5.\n  - MCP 응답 latency/환각률(샘플 TODO와 실제 적용 여부 비교).\n  - 사용자 수동 push 완료율(승인 후 24h 내 Git push 여부).", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 26, "total_chunks": null}}
{"id": "185708e9-dec0-47ef-ad5d-e90f26a2df04", "content": "\n**6) QA & 검증**\n- 시나리오: 템플릿 Repo 5개 + 실사용 Repo 5개(총 10개)에서 Stage C 자율 루프 실행.\n- 체크리스트:\n  - [ ] 각 Repo에서 최소 1건 이상의 TODO가 기록되고 SSE `plan` 이벤트가 수신된다.\n  - [ ] Agent가 TODO별 수정을 완료하면 `edit` 이벤트와 함께 브랜치 정보가 갱신된다.\n  - [ ] 테스트 실패 시 UI가 즉시 `needs_revision` 상태를 표시하고 재시도 로직이 작동한다.\n  - [ ] MCP 지식 버전 mismatch 발생 시 사용자에게 최신화 안내 메시지가 SSE/요약에 포함된다.\n  - [ ] SSE 누락 없이 IntegratorPanel이 이전 로그를 복원하고 실행 기록을 계속 append 한다.\n- 안전장치: push 실패 또는 권한 오류 시 자동 롤백 후 `needs_revision`으로 종료하며, 사용자가 수동으로 브랜치를 삭제하지 않아도 되도록 정리 이벤트를 남긴다.\n\n**7) 일정 & 의존성**\n- Week 1: MCP 파이프라인 정의, knowledge JSON 생성/버전 관리, Supabase 스키마 추가.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 27, "total_chunks": null}}
{"id": "4a818798-563d-4473-ad27-65c2366a9c58", "content": "- Week 2: `integrator_executor` Stage B 모드, API/이벤트 스키마 구현, SSE 채널 확장.\n- Week 3: Guided Agent UI, 승인 플로우, Manual push 가이드, QA & Telemetry 계측.\n- 게이트: Stage B KPI 달성 + 내부 도그푸드 3팀 승인 후 Stage C 착수.\n\n**8) 오픈 이슈**\n- Patch Conflict UX: Stage B는 사용자 수동 적용이므로 git conflict 안내 모달/문서 필요.\n- Credential 범위: Guided Agent 실행 시 읽기 전용 토큰만 필요하지만 테스트 명령이 외부 API를 호출할 경우 토큰 스코프 추가 정의 필요.\n- Multi-user 협업: 동일 프로젝트에서 동시 Guided Run 실행 시 race condition 방지를 위한 locking 전략 필요(예: `integrator_runs` 상태가 `running`이면 추가 Run 생성 제한).\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 28, "total_chunks": null}}
{"id": "a1cfb447-53cd-4231-8c2f-4085440a5f5d", "content": "### 5.3 Stage C: Autonomous Agent\n| 태스크 | 세부 단계 | 산출물 |\n|--------|-----------|--------|\n| Fluxloop 통합 감지 | Repo clone 후 `fluxloop_check.py`로 SDK 여부 판별 | 감지 스크립트, Health Report |\n| Sandbox 환경 부팅 | 기존 Runner 파이프라인(git pull → bootstrap → run → evaluate)을 재사용해 컨테이너 내부에서 의존성 설치/환경 변수 주입 자동화 | Sandbox 부팅 스크립트, 설치 로그 |\n| Fully-auto Executor | MCP 지식 → TODO → `plan → edit → test → run` 자동화 → `fluxloop/auto/*` 브랜치 생성 & push. 미지원 요소 감지 시 사용자에게 필요한 파일/설정을 요청하는 인터랙션 포함 | `integrator_executor` Stage C 모드, 자동 브랜치 규칙, push 로그, 요구사항 요청 UX |", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 29, "total_chunks": null}}
{"id": "21c8b316-43cc-48d0-be80-7b69ccb457b7", "content": "| 실행 관찰성 | 실시간 로그 스트리밍, 롤백/재시작, diff preview 링크 | `IntegratorRunResult` 확장, UI 표시 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 30, "total_chunks": null}}
{"id": "607585a1-3ca3-4b80-8a65-89eb30f9843a", "content": "#### Stage C 상세 구현 계획\n1. **Sandbox & Credential 계층**\n   - Runner가 Sandbox 컨테이너를 생성할 때 Git SSH/토큰, 환경 변수(예: `OPENAI_API_KEY`)를 Vault에서 주입하는 API 신설.\n   - 컨테이너 수명 주기: `prepare → execute → upload artifacts → cleanup`을 Stage B와 동일 규칙으로 관리하되, Stage C는 테스트 실행까지 한번에 수행.\n2. **자동 Git 워크플로우**\n   - `integrator_executor`를 Stage C 모드로 확장해 `fluxloop/auto/<timestamp>` 브랜치 생성, commit author, sign-off 규칙을 내장.\n   - Push 실패 시 재시도 + 사용자 액션 필요 시 SSE 이벤트로 전달.\n   - API: `POST /api/v1/projects/{project_id}/integrator-runs` (트리거), `GET /api/v1/projects/{project_id}/integrator-runs/{run_id}` (상세), `GET .../integrator-runs/{run_id}/events/stream` (SSE).", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 31, "total_chunks": null}}
{"id": "c4ee89a2-bc74-4e5e-b2a4-26c01277313e", "content": "3. **Code Agent 루프**\n   - LangChain Code Agent reference(`plan → edit → test → run`)를 가져와 Runner 내부에서 돌릴 수 있게 파이썬 모듈화.\n   - MCP는 `knowledge lookup` 전용 툴로 제한하고, 실제 수정/테스트 명령은 Agent가 shell/pytool로 실행.\n   - 테스트 실패 시 자동 롤백 후 TODO 보정, 최대 N회 재시도 설정.\n4. **결과 산출물 관리**\n   - Stage B에서 구축한 Artifact 파이프라인을 재사용하여, 각 자동 실행 Run에 대해 `plan.json`, `diff.patch`, `test_logs.txt`, `bootstrap.tar.gz`를 Storage에 업로드.\n   - `IntegratorRunResult`를 확장해 diff preview 링크, 테스트 요약, push branch 정보를 UI에 노출.\n5. **승인·배포 흐름**\n   - 성공적으로 push된 자동 브랜치는 Git PR 생성 혹은 링크 공유까지 자동화(Optional flag).", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 32, "total_chunks": null}}
{"id": "11be1dd6-d8f9-4a87-9b71-5b4cece534dc", "content": "   - 사용자는 Stage B와 동일한 승인 UI에서 결과를 확인하고, 필요 시 Agent 재실행/중단/롤백을 선택할 수 있게 한다.\n6. **안정성 & 모니터링**\n   - SSE 채널에 `plan/edit/test/run` 각 단계별 이벤트를 표준 포맷으로 송신.\n   - 실패 유형별 알람(credential, 테스트 실패, push 실패)을 Cloud Logging/Alerting에 연결해 Stage C 품질 지표를 수집.\n\n**지원 시나리오 & Fallback**\n- 현재 Sandbox Docker는 git pull → bootstrap → run experiment → parse/evaluate까지 이미 동작하므로, Stage C는 동일 파이프라인 위에 Code Agent의 수정/테스트 루프를 얹는다.\n- Repo에 필수 요소(테스트 스크립트, 환경 설정 등)가 없으면 Agent가 사용자에게 필요한 정보를 요청하거나 체크리스트를 안내한 뒤 진행한다.\n- “Fluxloop 템플릿 또는 호환 구조”인 Repo에서 높은 성공률(70%+)을 목표로 하고, 극단적 Edge 케이스는 사용자 협업/추가 입력 방식으로 해결한다.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 33, "total_chunks": null}}
{"id": "cb979afd-43f9-4b49-ad95-24e3a15e4012", "content": "## 6. Agent Architecture\n- `langchain-code-main` repo를 reference로 하여 Code Agent 편집/테스트/실행 loop 재사용.\n- Fluxloop 워크스페이스는 sandbox 컨테이너로 분리, 쓰기 권한 제한.\n- MCP는 레시피·SDK 가이드 등 정적 지식 조회 전용이며, 모든 쓰기/실행은 Code Agent가 담당.\n- 실행 로그(`plan → edit → test → run`)는 SSE로 스트리밍, 사용자 중단/재시작/재시도 가능.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 35, "total_chunks": null}}
{"id": "466f0753-cb83-4b6e-afc1-aa063fc2532c", "content": "## 7. Stage C Execution Flow\n1. Git URL·자격 증명 입력 → sandbox clone.\n2. `fluxloop_check.py`로 통합 여부 감지. 이미 통합이면 종료 후 Step 5(Experiment 생성)로 이동.\n3. 미통합이면 MCP에서 최신 가이드 조회 → Agent가 TODO 리스트 작성 후 UI에 공유.\n4. TODO 기반 `plan → edit → test` 루프 수행, `pytest`/`npm test` 실행.\n5. 성공 시 `fluxloop/auto/<timestamp>` 브랜치 생성 및 push, 실패 시 롤백과 TODO 갱신.\n6. 브랜치 링크, diff preview, 실행 로그, 승인 CTA 제공.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 36, "total_chunks": null}}
{"id": "e0d16ecd-d583-4dd7-9667-4494d8411e29", "content": "## 8. API & Data Model Impact\n```python\nclass ExperimentCreateRequest(BaseModel):\n    project_id: UUID\n    name: str\n    description: Optional[str] = None\n    template_id: Optional[UUID] = None\n    metadata: dict[str, str] = Field(default_factory=dict)\n\nclass InitProjectStatus(BaseModel):\n    project_id: UUID\n    phase: Literal[\"clone\",\"detect\",\"inject\",\"push\",\"done\"]\n    progress: int\n    logs: list[str]\n    executor_phase: Optional[Literal[\"plan\",\"edit\",\"test\",\"run\"]]\n    executor_result: Optional[IntegratorRunResult]\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 37, "total_chunks": null}}
{"id": "d5f4d413-772a-43df-8d86-49377b867b50", "content": "class IntegratorRunResult(BaseModel):\n    plan: list[str]\n    last_command: Optional[str]\n    tests: list[TestResultSummary]\n    status: Literal[\"success\",\"failed\",\"needs_approval\"]\n    diff_preview_url: Optional[AnyHttpUrl]\n    branch_name: Optional[str]\n    git_push_url: Optional[AnyHttpUrl]\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 38, "total_chunks": null}}
{"id": "47d3bde7-b71a-48ce-b518-d35b6595f2e5", "content": "## 9. Telemetry & Validation\n- **Stage A**\n  - [ ] 신규 프로젝트 5개 샘플 end-to-end 성공\n  - [ ] Framework Detection false-positive ≤ 5%\n  - [ ] Template 주입 후 테스트 import 오류 0건\n  - [ ] Push 실패 로그 100% 저장/조회\n- **Stage B**\n  - [ ] TODO → diff → 테스트 로그 UI 연결, 승인 후 머지까지 1시간 내 완료\n  - [ ] MCP 지식 조회 latency < 3초, 환각률 < 5% (샘플 20건)\n- **Stage C**\n  - [ ] Agent 자동 실행 성공률 ≥ 70%, 실패 시 롤백 로그 확보\n  - [ ] Agent 제안 → 적용까지 평균 < 2분\n  - [ ] 자동 브랜치 생성 및 push 성공률 ≥ 90%, 실패 시 재시도 UX 제공\n  - [ ] 지원 대상 Repo(Fluxloop 템플릿 또는 호환 구조)에서 Sandbox 부팅→테스트→Evaluate 전체 성공률 ≥ 80%", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 39, "total_chunks": null}}
{"id": "4c72791b-f9ba-4f98-9001-3e55cf79330a", "content": "## 10. Risks & Mitigations\n| 리스크 | 설명 | 대응 |\n|--------|------|------|\n| Detection 실패 | Edge repo에서 룰 기반 감지가 실패 | requirements 스캔 fallback, 수동 선택 옵션 |\n| Git 권한 이슈 | Credential 오류/만료로 push 실패 | 사전 Health Check, SSH 키 업로드 모달, 재시도 로직 |\n| Agent 원격 실행 | Sandbox 외부에 쓰기 발생, rollback 실패 | Sandbox 격리, 라이브러리 버전 고정, 테스트 실패 시 자동 롤백 |\n| Agent 환각 | 잘못된 patch로 빌드 실패 | `dry_run` + 테스트 통과 필수, Stage B에서 사용자 승인 |\n| Credential 보안 | 토큰 노출 | 일회성 토큰 저장, 컨테이너 종료 시 파기, 로그 마스킹 |\n| 일정 | 기능 복잡도 증가 | 내부 검증 단계(Stage A→B→C)를 철저히 지키며, 완성도 미달 시 출시 연기 |", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 41, "total_chunks": null}}
{"id": "8959d0e2-5059-4801-872e-5693bc42704b", "content": "## 11. Dependencies & Open Questions\n- LangChain code agent 레퍼런스(`ref/langchain-code-main`)와 동기화 전략 필요.\n- 샘플 repo 리스트(언어별 최소 3개) 확보.\n- Sandbox 인프라 및 Credential Vault 연동 방식 결정.\n- Stage C 성공률 측정을 위한 텔레메트리 스키마 확정.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 43, "total_chunks": null}}
{"id": "43faa024-9212-4190-be0c-4bca7f62b3fd", "content": "## 12. Rollout Strategy\n1. Stage A를 내부 QA/도그푸드 환경에서 검증하여 Detection/Template/Push 안정성을 확보한다 (외부 공개 없음).\n2. Stage B는 동일한 내부 환경에서 Agent 제안 품질과 MCP 지식 정확도를 검증하고, 승인 플로우를 완성한다.\n3. Stage C에서 fully-autonomous 실행을 sandbox로 반복 검증하여 성공률 KPI를 충족하면, Stage A~C 전체 기능을 한 번에 프로덕션으로 출시한다.\n4. 외부 롤아웃 이후에도 상세 문서는 본 PRD로 유지하고, `fluxloop_v4_concept.md`에는 Stage 요약만 기록한다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 44, "total_chunks": null}}
{"id": "9cc60c38-f6db-403b-bff2-5b25982bcb92", "content": "## 13. Real Autonomous Agent Implementation Details (Stage C Deep Dive)\n\n이 섹션은 Stage C의 핵심인 \"진정한 자율 에이전트(Real Autonomous Agent)\" 구현을 위한 상세 설계를 기술한다. 정적 패치 적용 방식을 폐기하고, Agent가 스스로 코드를 분석하고 수정하는 동적 방식으로 전환한다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 45, "total_chunks": null}}
{"id": "fd4e1cf0-056f-469a-a815-7662fd8ef744", "content": "### 13.1 Core Concept: From Static Patch to Dynamic Solving\n- **AS-IS (Stage B)**: 사전에 정의된 diff 템플릿을 `git apply`로 적용. 유연성이 없고 Edge case에 취약함.\n- **TO-BE (Stage C)**: `ReAct` 에이전트가 \"문제 정의(TODO)\"를 입력받아 파일 탐색, 코드 수정, 검증을 스스로 수행.\n    - **Plan**: 정적 분석기가 \"무엇을 해야 하는지(TODO)\"와 \"참고할 만한 패턴(Reference)\"을 제공.\n    - **Solve**: Agent가 실제 파일 구조를 읽고, Reference를 응용하여 코드를 수정.\n    - **Verify**: 수정 후 문법 체크 및 테스트 실행으로 정합성 검증.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 46, "total_chunks": null}}
{"id": "ba53d62e-0e5b-4409-95cf-6c5745170f2c", "content": "### 13.2 Architecture Components\n\n1.  **IntegratorAutonomousHandler (Orchestrator)**\n    - 전체 파이프라인 관리: Workspace 준비 -> Credential 주입 -> Plan -> Agent Loop -> Git Push.\n    - AgentService를 호출하여 각 TODO 항목을 처리.\n\n2.  **AgentService (The Brain)**\n    - **Graph**: `LangGraph` 기반의 ReAct 루프 (`Plan -> Edit -> Test`).\n    - **Tools**: Sandbox 내부 파일 조작(`read_file`, `write_file`, `search_replace`), 쉘 실행(`run_cmd`).\n    - **Prompt**: `INTEGRATOR_SYSTEM_PROMPT`를 통해 \"FluxLoop 통합 엔지니어\" 페르소나 주입.\n\n3.  **Static Analyzer (The Compass)**", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 47, "total_chunks": null}}
{"id": "0f6f92f2-424f-4ec1-84ad-fb60dfc19cda", "content": "    - 기존 `_analyze_repository` 로직을 유지하되, 산출물을 \"Diff\"가 아닌 \"Hint/Reference\"로 변경.\n    - 예: \"이 파일에 이 코드를 추가해\" 대신 \"Reference: `configs/project.yaml` 예시 구조는 다음과 같음\" 형태로 제공.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 48, "total_chunks": null}}
{"id": "a1021cbc-c37c-4dba-b182-d0eb933df7a2", "content": "### 13.3 Execution Workflow\n\n1.  **Initialization & Planning**\n    - Repo Clone 및 환경 변수 주입.\n    - `Static Analyzer`가 프로젝트 구조를 스캔하여 `Initial TODO List` 생성.\n    - 각 TODO에는 `Title`, `Description`, `Reference Snippet`(선택적)이 포함됨.\n\n2.  **Agent Execution Loop (Per TODO)**\n    - Handler가 Agent에게 작업을 지시:\n        > \"Task: `configs/project.yaml` 생성.\n        > Context: FluxLoop Runner가 실험을 찾기 위해 필요함.\n        > Reference: (YAML 예시)\"\n    - **Agent Action**:\n        1.  `list_dir` / `read_file`로 현재 상태 파악.\n        2.  `write_file`로 파일 생성 또는 `search_replace`로 코드 수정.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 49, "total_chunks": null}}
{"id": "ee731423-e4b4-4529-9d9b-5c06b9a6edd4", "content": "        3.  `run_cmd` (python check 등)로 기본 문법 검증.\n    - **Verification**: Handler가 `pytest` 또는 통합 테스트 스크립트 실행. 실패 시 Agent에게 피드백(\"테스트 실패함, 에러 로그: ...\") 후 재시도(Max 3회).\n\n3.  **Finalization**\n    - 모든 TODO 완료 후 통합 테스트 수행.\n    - 성공 시 `fluxloop/auto/<timestamp>` 브랜치 생성 및 Push.\n    - 실패 시 변경 사항 롤백 및 실패 리포트 생성.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 50, "total_chunks": null}}
{"id": "884bb192-2453-4e1f-a8c0-81d161de18bc", "content": "### 13.4 Prompt Engineering Strategy\n\n- **System Prompt**:\n    - 역할: \"너는 사용자의 코드를 안전하게 수정하여 FluxLoop SDK를 통합하는 엔지니어다.\"\n    - 제약 사항: \"사용자의 비즈니스 로직을 해치지 말 것\", \"최소한의 변경만 수행할 것\", \"주어진 도구만 사용할 것\".\n- **Dynamic Context**:\n    - 현재 파일 구조 트리.\n    - 해결해야 할 구체적인 에러 로그.\n    - 이전 시도의 실패 원인 (재시도 시).\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 51, "total_chunks": null}}
{"id": "5c640760-ff41-45fb-a527-09d792e029f7", "content": "### 13.5 Migration Plan\n1.  **Refactor Handler**: `IntegratorAutonomousHandler`에서 `_apply_patch` 제거, `AgentService` 호출 로직 구현.\n2.  **Enhance Analyzer**: 하드코딩된 Patch를 Reference 텍스트 생성 로직으로 변경.\n3.  **Prompt Tuning**: 다양한 언어/프레임워크 환경에서 Agent가 올바른 판단을 하도록 프롬프트 고도화.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_1_project_onboarding_prd.md", "chunk_index": 52, "total_chunks": null}}
{"id": "e11886f3-aa21-4bb4-a822-ddd0ff23beba", "content": "# FluxLoop V4.2 – Multi-Agent Architecture (Hierarchical Purpose-Functional Model)\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 0, "total_chunks": null}}
{"id": "2aeca2d7-9511-4697-966c-2c1f775b0ae0", "content": "## 0. 개요\nV4.1의 단일 Deep Agent 구조를 넘어, **역할이 명확히 분리된 계층형 멀티 에이전트 시스템(Hierarchical Multi-Agent System)**으로 진화한다.\n'목적 지향(Purpose)'의 Supervisor와 '기능 수행(Functional)'의 Worker Agent를 분리하여, 복잡한 통합 과제를 체계적으로 해결하고 향후 확장을 용이하게 한다.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 1, "total_chunks": null}}
{"id": "6f333133-ca61-4d54-95e1-a102a92f4d62", "content": "## 1. 아키텍처 철학: Purpose vs Functional\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 2, "total_chunks": null}}
{"id": "729429f0-7deb-4eee-b42f-fb34cb6529b0", "content": "### 1.1 Purpose Agent (Supervisor)\n- **역할**: 사용자의 모호한 요구사항(\"FluxLoop SDK 통합해줘\")을 해석하고, 전체적인 진행 상황을 감독한다. 직접 코드를 짜거나 계획을 세우기보다, 전문가(Functional Agent)에게 **목표(Goal)**를 전달하고 결과물을 **검토(Review)**하는 결정권자(Decision Maker)다.\n- **모델**: **GPT-5** (Reasoning & Orchestration 특화)\n- **책임**:\n  - **Delegation**: 적절한 Functional Agent에게 High-level Task 할당.\n  - **Review**: Agent의 결과물이 목표에 부합하는지 검증 (테스트 통과 여부, 코드 품질 기준 등).\n  - **State Tracking**: 각 에이전트의 진행 상태(ToDo, 실패 이력)를 모니터링.\n  - **Knowledge**: MCP를 통해 프로젝트 전반의 문맥과 외부 지식을 파악.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 3, "total_chunks": null}}
{"id": "02794774-b877-4c42-aa34-66594d4a230f", "content": "### 1.2 Functional Agent (Worker)\n- **역할**: 구체적이고 명확한 지시를 받아 **스스로 계획(Plan)하고 실행(Execute)**하는 실무자.\n- **특징**: 각 도메인에 특화된 Toolset과 프롬프트를 가지며, 자신만의 Task Queue를 관리한다.\n- **확장**: Coder를 시작으로 Tester, Evaluator, DataGenerator 등으로 수평 확장된다.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 4, "total_chunks": null}}
{"id": "1992ce56-c031-4134-ae6c-31a34f4e54f0", "content": "## 2. 상세 구성\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 5, "total_chunks": null}}
{"id": "128b5d0f-8bf0-48a4-b5d4-f07645ef9175", "content": "### 2.1 Coder Agent (Functional)\n- **목적**: 코드 구현, 수정, 디버깅, 테스트, 그리고 GitOps 수행.\n- **모델**: **GPT-5.1 Codex** (Coding Specialist)\n- **Tools**:\n  - `FileSystemTools`: read, write, list, search_replace, grep\n  - `GitTools`: branch, commit, push, reset (실무 Git 작업 전담)\n  - `TestTools`: run_pytest (로컬 검증)\n  - `MCP`: 프레임워크 지식, 라이브러리 사용법 조회 (필수)\n  - `PlannerTools`: write_todos, update_todo (자신의 작업 계획 수립)\n- **Workflow**:\n  1. 지시 수신 (\"설정 파일 구성해\")\n  2. **Planning**: MCP 조회 및 파일 탐색 후 상세 TODO 수립.\n  3. **Execution**: 코드 작성/수정.\n  4. **Verification**: 로컬 테스트 실행 및 Self-Correction.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 6, "total_chunks": null}}
{"id": "d0da1808-aaf1-4db9-bac9-1a43537285ee", "content": "  5. **GitOps**: 작업 단위별 커밋 (Supervisor 승인 전에는 로컬 커밋 위주).\n  6. **Reporting**: Supervisor에게 결과 보고 (diff, test result, commit hash).\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 7, "total_chunks": null}}
{"id": "67a4a36c-5c22-406e-a611-fda8cafd6fc5", "content": "### 2.2 Supervisor Agent (Purpose)\n- **목적**: 프로젝트 온보딩 및 SDK 통합 완수.\n- **모델**: **GPT-5**\n- **Tools**:\n  - `DelegateToCoder`: Coder Agent 호출 (인자: task_description).\n  - `DelegateToTester`: (Optional) 통합 테스트 전문 에이전트 호출.\n  - `MCP`: 프로젝트 스펙, 모범 사례 조회.\n  - `Finish`: 전체 작업 완료 선언.\n  - `ApprovePush`: Coder가 수행한 변경 사항을 최종 확인 후 Push 허용.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 8, "total_chunks": null}}
{"id": "adf13398-b42d-43d7-8f6a-df9ce3f0a424", "content": "## 3. Execution Flow (LangGraph)\n\n```mermaid\ngraph TD\n    User[User Goal] --> Supervisor(GPT-5)\n    \n    subgraph Supervisor Loop\n        Supervisor -->|Reasoning & State Tracking| Decision{Decide}\n        \n        Decision -->|Delegate| Coder(GPT-5.1 Codex)\n        \n        subgraph Coder Workflow\n            Coder -->|MCP/Search| Analysis\n            Analysis -->|Plan| MyTodos[Internal Plan]\n            MyTodos -->|Edit/Test/Commit| Loop\n            Loop -->|Success/Fail| Report\n        end\n        \n        Report -->|Result (Diff/Log)| Supervisor", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 9, "total_chunks": null}}
{"id": "0bcc9c4e-87bb-4121-98ae-c15e2e499f47", "content": "        \n        Supervisor -->|Review (Test Pass? Style OK?)| Critic{Critique}\n        Critic -->|Reject (Feedback)| Supervisor\n        Critic -->|Approve| Pusher[Git Push Trigger]\n    end\n    \n    Pusher --> Finish\n```\n\n1. **Initialization**: Supervisor가 사용자 Goal 수신 및 프로젝트 상태 파악.\n2. **Delegation**: Supervisor가 MCP를 참고하여 큰 그림을 보고, Coder에게 \"설정 파일부터 구성해\"라고 지시.\n3. **Coder Action**:\n   - Coder가 리포지토리를 분석하고 \"1. 파일 생성, 2. 환경변수 추가\" 등의 계획을 스스로 세움.\n   - 코드 작성 -> 테스트 -> 커밋 반복.\n   - 완료 후 Supervisor에게 \"설정 완료했습니다 (Test: Pass, Commit: ab12cd)\" 보고.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 10, "total_chunks": null}}
{"id": "0e62fd74-d02c-4097-943d-6049436551e0", "content": "4. **Reflection & Feedback**:\n   - Supervisor가 결과를 확인. 테스트 실패나 구현 누락이 있으면 피드백과 함께 재지시.\n   - 모든 기준 충족 시 다음 단계 진행.\n5. **Completion & GitOps Approval**:\n   - 모든 통합 절차가 완료되면 Supervisor가 최종 검토 후 `git push` 승인.\n   - 작업 종료 선언.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 11, "total_chunks": null}}
{"id": "87570c40-58c1-4aa7-80e8-62a91499371d", "content": "## 4. 모델 스펙 및 설정\n\n| Agent | Model | Temperature | System Prompt Key |\n|-------|-------|-------------|-------------------|\n| **Supervisor** | **GPT-5** | 0.1 | `SUPERVISOR_PROMPT_V2` |\n| **Coder** | **GPT-5.1 Codex** | 0.0 | `CODER_PROMPT_V2` |\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 12, "total_chunks": null}}
{"id": "ca2521de-0d7f-447b-bea0-ef861f032124", "content": "## 5. 확장 로드맵\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 13, "total_chunks": null}}
{"id": "276222e0-0ec3-4432-a993-6a05f4888c73", "content": "### Phase 1: Core Integration (Current)\n- Supervisor + Coder(Codex) 2-Agent 체제.\n- Coder가 Planning/Coding/GitOps/MCP 전권 행사.\n- **안전장치**: Supervisor의 명시적 승인(`ApprovePush`)이 있어야 원격 저장소 반영.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 14, "total_chunks": null}}
{"id": "905f961a-d09b-41a0-baa0-a59f9e03dfde", "content": "### Phase 2: Quality Assurance\n- **Tester Agent** 추가.\n- Supervisor가 Coder의 구현 후 Tester에게 교차 검증을 지시.\n- 상태 추적 로직 고도화: 각 에이전트의 성공률/재시도 횟수 메트릭 수집.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 15, "total_chunks": null}}
{"id": "19f15a5a-1b87-4e19-8dee-08d8e6640422", "content": "### Phase 3: Data & Eval\n- **DataGen Agent**: 테스트용 합성 데이터 생성.\n- **Evaluator Agent**: 성능 평가.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 16, "total_chunks": null}}
{"id": "947c8a44-b072-4b51-b5d3-2f6a57a6caa8", "content": "## 6. 결론\nV4.2 아키텍처는 실무자(Coder)에게 **구체적인 계획 수립과 실행 권한**을 이양하고, Supervisor는 **검토와 승인(Review & Approval)**에 집중함으로써 안정성을 확보한다. **MCP는 모든 에이전트의 공통 지식 베이스**로 활용되며, 명확한 피드백 루프와 승인 절차를 통해 자율 에이전트의 리스크를 통제한다.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 17, "total_chunks": null}}
{"id": "24092b97-5f0e-4408-9d22-0035cfae9de5", "content": "## 7. 상세 구현 계획 (Detailed Implementation Plan)\n\n이 섹션은 위 아키텍처를 `services/web/backend` 서비스 내에 구현하기 위한 구체적인 기술 명세서이다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 18, "total_chunks": null}}
{"id": "ce3dfa81-2408-424e-9022-3257debe874d", "content": "### 7.1 디렉토리 구조 변경 (Directory Structure Changes)\n`services/web/backend/app/services/agent/` 디렉토리를 다음과 같이 리팩토링하여 에이전트별 역할을 분리한다.\n\n```\napp/services/agent/\n├── __init__.py\n├── service.py          # AgentService (Entry point)\n├── graph.py            # Main Graph Builder (Supervisor + Subgraphs)\n├── state.py            # AgentState Schema Definition\n├── tools/              # Shared Tools\n│   ├── __init__.py\n│   ├── filesystem.py   # Read/Write/Search/List\n│   ├── git.py          # Commit/Push/Branch/Reset\n│   ├── terminal.py     # RunCmd", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 19, "total_chunks": null}}
{"id": "fda7bf72-15bf-42cc-9fa4-6ed93c818b96", "content": "│   ├── planning.py     # Todo Management\n│   └── mcp.py          # MCP Integration\n├── supervisor/         # Supervisor Agent Specifics\n│   ├── __init__.py\n│   ├── node.py         # Supervisor Node Logic\n│   └── prompts.py      # SUPERVISOR_PROMPT_V2\n└── coder/              # Coder Agent Specifics\n    ├── __init__.py\n    ├── node.py         # Coder Node Logic (Sub-graph or ReAct)\n    └── prompts.py      # CODER_PROMPT_V2\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 20, "total_chunks": null}}
{"id": "93905448-dc72-4327-a6df-a89ebca8bd05", "content": "### 7.2 State Definition (State Schema)\n`langgraph`의 `MessagesState`를 확장하여 멀티 에이전트 간의 통신과 제어 흐름을 관리한다.\n\n```python", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 21, "total_chunks": null}}
{"id": "c8fe2cac-1b53-4036-99fc-af07447aa49b", "content": "# app/services/agent/state.py\nfrom typing import TypedDict, Annotated, List, Optional\nfrom langchain_core.messages import BaseMessage\nimport operator\n\nclass AgentState(TypedDict):\n    # 채팅 히스토리 (전체 대화 맥락)\n    messages: Annotated[List[BaseMessage], operator.add]\n    # 다음에 실행할 에이전트 이름 (\"Coder\", \"Supervisor\", \"__end__\")\n    next: str\n    # 현재 작업의 Context (Supervisor가 Coder에게 내린 지시사항 등)\n    current_task: Optional[str]\n    # Coder의 작업 결과 요약\n    coder_report: Optional[str]\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 22, "total_chunks": null}}
{"id": "bc191e0b-a9aa-476e-9fb4-f12afd85288f", "content": "### 7.3 Supervisor Agent Implementation\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 23, "total_chunks": null}}
{"id": "fc24b8ed-c8d7-442f-95c0-886aaf215c49", "content": "#### 7.3.1 Prompt (`SUPERVISOR_PROMPT_V2`)\nSupervisor는 \"Router\"이자 \"Manager\" 역할을 수행한다. `LangCode`의 `AUTOPILOT` 철학을 계승하여 전체 흐름을 주도한다.\n\n```python", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 24, "total_chunks": null}}
{"id": "ca6d9261-6359-496c-880d-be7cf7d05a1a", "content": "# app/services/agent/supervisor/prompts.py\n\nSUPERVISOR_SYSTEM_PROMPT = \"\"\"You are the FluxLoop Integration Supervisor.\nYour goal is to oversee the integration of FluxLoop SDK into the user's codebase autonomously.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 25, "total_chunks": null}}
{"id": "841f8e01-5c41-4376-9f14-a3f207d34f5b", "content": "## Role\n1. **Analyze**: Understand the user's high-level goal.\n2. **Plan & Delegate**: Break down the goal into specific, actionable tasks for the **Coder** agent.\n   - Example: \"Create a new configuration file named fluxloop.yaml.\"\n   - Example: \"Install the fluxloop-sdk package.\"\n   - You act as the Orchestrator.\n3. **Review**: When Coder reports back, verify if the task was completed successfully.\n   - Check if tests passed.\n   - Check if the code looks correct based on your knowledge.\n4. **Approve**: If all tasks are done and verified, approve the changes to be pushed.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 26, "total_chunks": null}}
{"id": "06eac7e4-2d79-4abc-998a-dc67f2dddb34", "content": "## Control Flow\n- If there is pending work -> Call `DelegateToCoder`.\n- If Coder finished a task -> Review it.\n  - If satisfactory -> Plan next step or Finish.\n  - If unsatisfactory -> `DelegateToCoder` with feedback (Be specific about what failed).\n- If everything is done -> Call `Finish`.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 28, "total_chunks": null}}
{"id": "a52fa183-fad7-498c-a912-00f7942cb312", "content": "## Constraints\n- You do NOT write code yourself.\n- You do NOT run terminal commands directly.\n- You ONLY use the provided tools to control the workflow.\n- **Be Decisive**: If the Coder fails repeatedly, suggest a simpler approach or stop to ask for help (via Finish).\n\"\"\"\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 29, "total_chunks": null}}
{"id": "0d59278d-b66d-4467-a38d-521d572f2c92", "content": "#### 7.3.2 Tools & Node Logic\nSupervisor는 함수 호출(Function Calling)을 통해 다음 단계를 결정한다. `node.py`는 이 호출을 해석하여 `AgentState`의 `next` 값을 설정하는 역할을 한다.\n\n```python", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 30, "total_chunks": null}}
{"id": "7727a4fe-aa7d-43bc-8e3d-9fb5a99900b9", "content": "# app/services/agent/supervisor/node.py\n\nfrom langchain_core.pydantic_v1 import BaseModel, Field\nfrom ..state import AgentState\n\nclass DelegateToCoder(BaseModel):\n    \"\"\"Delegate a specific coding task to the Coder agent.\"\"\"\n    task_description: str = Field(..., description=\"Detailed description of what the Coder should do.\")\n\nclass Finish(BaseModel):\n    \"\"\"Mark the entire integration process as complete.\"\"\"\n    final_summary: str = Field(..., description=\"Summary of what was achieved.\")\n\ndef supervisor_node(state: AgentState):", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 31, "total_chunks": null}}
{"id": "e0bbcb10-8fcb-4209-b2a2-50b5e2232f54", "content": "    # LLM 호출 및 Tool Selection 로직\n    # ...\n    # Tool이 DelegateToCoder면 next=\"Coder\"\n    # Tool이 Finish면 next=\"__end__\"\n    return {\"next\": ...} \n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 32, "total_chunks": null}}
{"id": "4c44b292-46ff-4a1f-bda6-894ecdfb91dd", "content": "### 7.4 Coder Agent Implementation\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 33, "total_chunks": null}}
{"id": "d0865183-e1f7-4eca-93b3-1f9fbb181a2d", "content": "#### 7.4.1 Prompt (`CODER_PROMPT_V2`)\nCoder는 주어진 `current_task`를 완수하기 위해 Loop를 돈다. `LangCode`의 `BASE_SYSTEM` 및 `RUNTIME_POLICY`를 적극 반영하여 자율성과 안정성을 확보한다.\n\n```python", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 34, "total_chunks": null}}
{"id": "f49cb98e-9c46-43d4-96bf-dc3abafaa186", "content": "# app/services/agent/coder/prompts.py\n\nCODER_SYSTEM_PROMPT = \"\"\"You are the FluxLoop Coder, an autonomous coding assistant running in a secure sandbox.\nYou have been assigned a task by the Supervisor: \"{current_task}\"\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 35, "total_chunks": null}}
{"id": "776fd657-6e2e-4a54-bdad-1a216b4ddfdc", "content": "## Core Behavior\n- **Discover First**: Use tools to understand the codebase before making changes. Do not guess file paths.\n- **Autonomous**: Make changes without asking for permission. You have full access to the sandbox.\n- **Verify**: Always verify your changes by reading files or running tests/commands after editing.\n- **Precise**: When using `search_replace`, ensure the target string is unique.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 36, "total_chunks": null}}
{"id": "2dd37fc4-3f07-4d0b-898f-4532033af282", "content": "## Available Tools\n- **Files**: `list_dir`, `read_file`, `write_file`, `search_replace` (Surgically modify files)\n- **Shell**: `run_cmd` (Execute git, pytest, ls, grep, etc.)\n- **Planning**: `write_todos`, `update_todo_status`, `list_todos` (Track your own progress)\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 37, "total_chunks": null}}
{"id": "e4fed414-0a3d-4dce-9c98-6f0b1b67cbe2", "content": "## Workflow\n1. **Plan**: \n   - Start by calling `write_todos` to break down the assigned task into steps.\n   - Example: [\"Find config file\", \"Add env var\", \"Run verification script\"]\n2. **Discover**: \n   - Use `list_dir` or `run_cmd` (with `find`/`grep`) to locate relevant code.\n   - **Never** guess file paths.\n3. **Act**:\n   - Use `read_file` to inspect the code structure.\n   - Use `search_replace` for editing existing code (safer than overwriting).\n   - Use `write_file` for creating new files.\n4. **Verify**:\n   - Re-read the modified file to confirm the edit.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 38, "total_chunks": null}}
{"id": "6e67d6be-8f13-41db-ad42-0caf7c48f958", "content": "   - **MANDATORY**: Run tests (`run_pytest`) or a script (`python -c ...`) to verify functionality.\n   - If verification fails, read the error, fix the code, and retry.\n5. **Report**: \n   - When the task is done, return a summary.\n   - Include: Files changed, Verification results (Pass/Fail), any obstacles.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 39, "total_chunks": null}}
{"id": "55551551-9a07-4c7b-a001-9cd7f11301d3", "content": "## Runtime Discipline\n- **Explore first**: `list_dir`, `grep` to find targets.\n- **Directory handling**: If a folder is missing, just write files (parents are auto-created).\n- **Verification**: Never assume your code works; always run it. If `run_cmd` returns non-zero, fix it.\n- **Do not** ask the user for code snippets; read the files yourself.\n\"\"\"\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 40, "total_chunks": null}}
{"id": "9a34e8ee-bfb6-4f80-91e9-e1753bb12a24", "content": "#### 7.4.2 Node Logic\nCoder는 `prebuilt.create_react_agent`를 사용하여 자체적인 Tool Execution Loop를 가진다.\n`node.py`는 이 Sub-graph를 캡슐화하여 Supervisor가 호출할 수 있는 Node 형태로 제공한다.\n\n```python", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 41, "total_chunks": null}}
{"id": "a8cc908a-b215-449d-b04e-54cd69bd8d1f", "content": "# app/services/agent/coder/node.py\n\ndef coder_node(state: AgentState):\n    # Supervisor가 설정한 current_task를 가져옴\n    task = state[\"current_task\"]\n    \n    # Coder ReAct Agent 실행 (Sub-graph invocation)\n    # result = coder_agent.invoke({\"messages\": [HumanMessage(content=task)]})\n    \n    # 결과를 요약하여 Supervisor에게 보고할 메시지 생성\n    return {\n        \"messages\": [AIMessage(content=f\"Task Completed: {result['output']}\")],\n        \"coder_report\": result['output'],\n        \"next\": \"Supervisor\" # 작업 완료 후 Supervisor에게 복귀\n    }\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 42, "total_chunks": null}}
{"id": "884ec379-4de1-44d2-93d3-d940024ecd24", "content": "### 7.5 Graph Construction\n\n`langgraph`를 사용하여 계층형 그래프를 구성한다.\n\n```python", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 43, "total_chunks": null}}
{"id": "8a5b205b-0bdc-4b01-985c-8d6f9b197ab8", "content": "# app/services/agent/graph.py (Conceptual)\n\nfrom langgraph.graph import StateGraph, END\nfrom .state import AgentState\nfrom .supervisor.node import supervisor_node\nfrom .coder.node import coder_node\n\ndef build_hierarchical_graph():\n    workflow = StateGraph(AgentState)\n\n    # Nodes\n    workflow.add_node(\"Supervisor\", supervisor_node)\n    workflow.add_node(\"Coder\", coder_node)\n\n    # Edges\n    # Start at Supervisor\n    workflow.set_entry_point(\"Supervisor\")\n\n    # Supervisor Logic: decides whether to go to Coder or End\n    workflow.add_conditional_edges(", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 44, "total_chunks": null}}
{"id": "7285db03-6c4e-40a2-ab4c-67baca8004af", "content": "        \"Supervisor\",\n        lambda state: state[\"next\"],\n        {\n            \"Coder\": \"Coder\",\n            \"__end__\": END\n        }\n    )\n\n    # Coder Logic: always returns to Supervisor after finishing its task\n    workflow.add_edge(\"Coder\", \"Supervisor\")\n\n    return workflow.compile()\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 45, "total_chunks": null}}
{"id": "963869c1-3097-47fe-a73b-2022e34a1cc0", "content": "### 7.6 Service Layer Integration\n\n기존 `AgentService.run_agent_loop_stream` 메서드를 수정하여 새로운 그래프를 지원한다.\n\n1. `mode=\"hierarchical\"` (또는 `v4.2`) 파라미터 추가.\n2. 스트리밍 로직에서 `Supervisor`와 `Coder`의 이벤트를 구분하여 프론트엔드에 전달 (예: \"Supervisor가 지시 중...\", \"Coder가 코딩 중...\").\n3. **Session Persistence**: `MemorySaver`를 사용하여 Supervisor와 Coder 간의 왔다갔다 하는 긴 호흡의 대화를 저장.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 46, "total_chunks": null}}
{"id": "4eab29ca-2ddb-47da-8a75-90bb0908e354", "content": "### 7.7 마이그레이션 단계\n\n1. **Step 1**: `app/services/agent/tools/` 리팩토링 (기존 `tools.py` 분리).\n2. **Step 2**: `state.py` 및 Supervisor/Coder 디렉토리 생성.\n3. **Step 3**: `graph.py`에 `build_hierarchical_graph` 구현.\n4. **Step 4**: `AgentService`에 연결 및 통합 테스트.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_2_multi_agent_architecture.md", "chunk_index": 47, "total_chunks": null}}
{"id": "8960a1a9-12fc-4f50-bc52-bec01066f319", "content": "# FluxLoop V4 Concept: Full Lifecycle Management\n> **버전:** 1.0 (Schema Migration + Full Plan)  \n> **작성일:** 2025-11-24  \n> **최종 수정:** 2025-11-24  \n> **참고 문서:** `poc_v3_plan.md`, `future_roadmap.md`\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 0, "total_chunks": null}}
{"id": "628eb561-e68a-44d1-a77e-36447b127b13", "content": "## 1. 배경 및 목표 (Context)\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 1, "total_chunks": null}}
{"id": "bf2fe651-5363-4f49-a750-c7fd645b9b8b", "content": "### 1.1 V3 성과: 파이프라인 안정화\n- **Run → Parse → Evaluate** 핵심 루프 완성.\n- **Ephemeral Runner** 기반의 안정적 실행 환경 구축.\n- **Artifact 기반 동기화** (Snapshot & Hydrate) 검증 완료.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 2, "total_chunks": null}}
{"id": "5ee46e25-b6e4-48ed-bc09-96332f52634a", "content": "### 1.2 V4 목표: 완전한 실험 수명 주기 (Full Lifecycle)\n**\"V3의 안정적인 엔진 위에서, 사용자 경험의 빈틈(Init, Input, History)을 메꾼다.\"**\nV4는 아키텍처를 크게 변경하지 않고(Ephemeral 유지), 웹 UI만으로 프로젝트의 시작부터 끝까지 관리할 수 있도록 기능을 확장하는 데 집중합니다.\n\n> **Note:** 실시간 상호작용 및 Hot Pool 기반의 **Interactive Console** 기능은 **V5 (Next Gen)**로 이관되었습니다.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 3, "total_chunks": null}}
{"id": "5a41a8d6-b1ab-4a74-aab0-cadd8d679182", "content": "## 2. V4 핵심 Data Model & ID Strategy (Critical)\n복잡한 실험 데이터의 관계를 명확히 하고, 버전별 비교 분석을 가능하게 하는 핵심 구조입니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 4, "total_chunks": null}}
{"id": "dea7cc34-2679-4efc-9c6c-3a3463779b4f", "content": "### 2.1 계층 구조 (Hierarchy)\n**\"1:N 관계\"**를 기본으로 하여 유연한 확장성을 보장합니다.\n\n1.  **Project (Repo)**: 최상위 컨테이너. (예: \"Customer Support Bot\")\n2.  **Experiment (Scenario)**: 테스트 목적/시나리오 정의. (예: \"Refund Policy Test\")\n    - 하나의 프로젝트 내에 여러 개의 실험 목적이 존재.\n    - Git Version에 관계없이 논리적인 \"실험 주제\"를 유지.\n3.  **Run (Execution Snapshot)**: 실제 실행 1회. (예: \"Run #42\")\n    - **Git Version (Commit SHA)**: 실행 시점의 코드 스냅샷.\n    - **Dataset Version**: 실행 시점의 입력 데이터 스냅샷.\n    - **Experiment ID**: 소속된 실험 주제.\n    - **Description**: 실행 의도/변경점을 남겨 히스토리를 빠르게 식별.\n4.  **Evaluation (Analysis)**: Run에 대한 평가 결과. (예: \"GPT-4 Eval\", \"Claude Eval\")", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 5, "total_chunks": null}}
{"id": "76a2a694-c3ff-4985-beb6-30fc947515ac", "content": "    - **Run : Evaluation = 1 : N**.\n    - 하나의 실행 결과(Run)를 다양한 기준(Evaluator)으로 여러 번 평가 가능.\n\n```mermaid\nclassDiagram\n    Project \"1\" -- \"*\" Experiment : contains\n    Experiment \"1\" -- \"*\" Run : executes\n    Run \"1\" -- \"*\" Evaluation : analyzed by\n\n    class Project {\n        id: UUID\n        repo_url: string\n    }\n\n    class Experiment {\n        id: UUID\n        name: \"Refund Policy Test\"\n        description: \"Strict check for refund rules\"\n    }\n\n    class Run {\n        id: UUID\n        experiment_id: UUID\n        git_commit_sha: \"a1b2c3d\"", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 6, "total_chunks": null}}
{"id": "60043013-3fdc-46d6-a016-08868993c386", "content": "        git_branch: \"main\"\n        dataset_version_id: UUID\n        execution_profile_id: UUID\n        status: \"completed\"\n        duration_ms: 1234\n    }\n\n    class Evaluation {\n        id: UUID\n        run_id: UUID\n        evaluator_config: \"Strict_Model_v2\"\n        score: 95\n        report_url: \"report.md\"\n    }\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 7, "total_chunks": null}}
{"id": "e326dc6c-41a2-420b-ae17-41a424b9fa24", "content": "### 2.2 테이블 이름 변경: `traces` → `runs`\n**이유**: \"Trace\"는 추적/로그의 의미가 강하고, \"Run\"은 실행 인스턴스를 직관적으로 표현합니다.\n\n| 기존 | 변경 후 | 의미 |\n|------|---------|------|\n| `traces` | `runs` | 실제 실험 실행 1회 |\n| `trace_id` | `run_id` | FK 및 API 파라미터 |\n| `TraceResponse` | `RunResponse` | API 스키마 |\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 8, "total_chunks": null}}
{"id": "6a5eeb49-c211-41d0-b3f5-beb54845eb30", "content": "## 3. V4 핵심 기능 및 UX (Features & UX)\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 9, "total_chunks": null}}
{"id": "c06c07bb-1ada-48d8-9760-45030fa5e349", "content": "### 3.1 Project Initialization (Init)\n- **UI Flow**: `Connect Repo` → `Detect Framework` → `Bootstrap Template` → `Commit & Push`.\n- **Backend**: `init_project` 핸들러가 `fluxloop init`을 수행하고, `.fluxloop/` 설정 파일을 생성하여 원격 저장소에 푸시.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 10, "total_chunks": null}}
{"id": "a3472f3f-07e4-4d69-8c90-9e0692edd1b9", "content": "### 3.2 Input Generation & Management\n- **Input Studio**: 웹 폼에서 테스트 케이스(Input)를 생성, 편집, 관리.\n- **Dataset Versioning**: \n    - Dataset은 **불변(Immutable)** 버전 관리.\n    - 수정 시 새로운 `Version ID` 생성 → 실험의 완벽한 재현성(Reproducibility) 보장.\n- **Run UX**: 실행 시 `Dataset Version`을 선택 (Default: Latest).\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 11, "total_chunks": null}}
{"id": "7ef89a0a-5b35-4116-ba7e-a791f84f94c3", "content": "### 3.3 Argument Recording & Replay\n- **FluxLoop Record**: CLI 실행 시 사용된 인자(`--top-p` 등)를 DB에 **Execution Profile**로 저장.\n- **Run Modal UX**:\n    - **Code Source**: `Branch` (최신 Commit 자동 매핑) 또는 `Commit SHA` (과거 버전) 선택.\n    - **Dataset**: `Refund Cases v1.2` 선택.\n    - **Profile**: `GPT-4 Default` 선택.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 12, "total_chunks": null}}
{"id": "b0a3f3b0-c486-4462-9414-e27ee2263115", "content": "### 3.4 Versioned History & Comparison\n- **History View**: 하나의 **Experiment** 안에서, 서로 다른 Git Commit/Branch의 Run들이 시간순으로 나열됨.\n    - 예: `Run #5 (Commit B) - 95점` vs `Run #4 (Commit A) - 90점`\n- **Comparison UX**:\n    1.  두 개의 Run 선택 (Checkboxes).\n    2.  `Compare` 버튼 클릭.\n    3.  **Diff View** 진입:\n        - 좌우로 로그/대화 내용 배치.\n        - 평가 점수 차이(Delta) 하이라이트.\n- **Evaluations Tab**: Run 상세 화면에서 `[+ New Evaluation]` 버튼을 통해, 재실행 없이 평가 모델만 바꿔서 다각도로 분석 가능.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 13, "total_chunks": null}}
{"id": "6d98bb03-c233-40be-857b-c5b7ea0fa33b", "content": "### 3.5 Interactive Criteria Discovery (ICD)\n**FluxLoop의 차별점: 귀납적 기준 발견 프로세스**\n사용자가 명확한 평가 기준을 모를 때, 사례를 통해 기준을 발견하고 정제하는 워크플로우입니다.\n\n1.  **Discovery Mode (탐색)**\n    - 평가 기준 없이 실험(Run)을 먼저 수행합니다.\n    - **Human Feedback**: 결과(Run)를 보면서 직관적인 피드백을 남깁니다.\n        - `Thumb Up/Down`: 단순 좋음/나쁨.\n        - `Annotation`: \"이건 환불해주면 안 되는 건데 해줬음\", \"말투가 너무 딱딱함\".\n        - `Correction`: \"이렇게 답변했어야 함 (Golden Response)\".\n\n2.  **Criteria Extraction (추출)**\n    - 어느 정도 피드백이 쌓이면 **Analysis Agent**가 패턴을 분석하여 기준을 제안합니다.\n    - *\"사용자님, 환불 거절 시 '공감 표현'이 없는 경우를 싫어하시는 것 같습니다. 이를 평가 기준에 추가할까요?\"*", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 14, "total_chunks": null}}
{"id": "138db33f-7b6a-4cb2-9274-fae4862efda8", "content": "    - *\"단순 변심 케이스(#3, #7)는 모두 거절해야 한다는 규칙을 발견했습니다.\"*\n\n3.  **Evaluator Generation & Versioning (생성)**\n    - 사용자가 승인하면, FluxLoop는 이를 **LLM-as-a-Judge 프롬프트**로 변환하여 `evaluation.yaml`에 추가합니다.\n    - **Versioning**: \n        - `Refund_Eval_v1`: 기본 규칙.\n        - `Refund_Eval_v2`: +공감 표현 체크.\n    - 이렇게 생성된 Evaluator는 **Profile**처럼 저장되어 다음 실험부터 자동 적용됩니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 15, "total_chunks": null}}
{"id": "71505b50-5c6d-4cfa-b08f-140fa7df694d", "content": "### 3.6 Agent Strategy: Roles & UX (Detailed)\nV4에서는 단순한 LLM Feature와 자율적 Agent를 명확히 구분합니다. Agent는 복잡한 의사결정이 필요하거나 사용자에게 컨설팅을 제공하는 영역에 투입됩니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 16, "total_chunks": null}}
{"id": "0744ee38-8dc8-47d2-a8ed-64fe436eb5f7", "content": "#### A. The Integrator (Integration Agent)\n> *\"소스 코드를 분석해서 FluxLoop를 심어드릴게요.\"*\n\n- **Problem**: 사용자는 Repo만 연결하면 되지만, 실제로 어디에 SDK를 심어야 할지 모름. `Quick Action` 버튼으로는 불충분.\n- **Role**: Code Agent (Coder)\n- **Workflow**:\n    1.  **Scan**: Repo 연결 즉시 MCP(Data Service)를 통해 프레임워크(Django/FastAPI/LangChain) 식별.\n    2.  **Diagnose**: 메인 루프(`views.py` 등)를 찾아 SDK 삽입 지점 식별.\n    3.  **Propose**: *\"Django 기반이네요. `integration` 브랜치를 만들고 SDK를 심는 PR을 생성할까요?\"*\n    4.  **Execute**: 승인 시 코드 수정, `requirements.txt` 업데이트, PR 생성 및 링크 제공.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 17, "total_chunks": null}}
{"id": "d6c0dfd5-d3a0-4529-96f3-750200adc97d", "content": "#### B. The Scripter (Scenario Agent)\n> *\"복잡한 시나리오도 말만 하세요.\"*\n\n- **Problem**: 단순 입력(`inputs.yaml`)은 폼으로 가능하지만, Multi-turn 시나리오(중간에 마음 바꾸기, 에러 유발 등)는 작성이 어려움.\n- **Role**: Scenario Writer\n- **Workflow**:\n    1.  **Trigger**: Input Studio에서 \"Create Scenario with AI\" 클릭.\n    2.  **Chat**: *\"사용자가 예약했다가 날씨 때문에 취소하고 환불로 싸우는 시나리오 만들어줘.\"*\n    3.  **Draft**: Agent가 대화 흐름을 시뮬레이션하고 구조화된 JSONL 포맷으로 변환하여 미리보기 제공.\n    4.  **Refine**: *\"좀 더 진상 고객처럼 수정해줘.\"* -> 수정 후 Dataset으로 저장.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 18, "total_chunks": null}}
{"id": "1ccbd84b-6750-4452-8e49-0267f258993f", "content": "#### C. The Analyst (Evaluation & Counseling Agent)\n> *\"점수가 왜 떨어졌는지, 어떻게 고칠지 알려드릴게요.\"*\n\n- **Problem**: 그래프만 보여주고 해석은 사용자의 몫. 결과가 나빠도 \"그래서 뭘 고쳐?\"를 모름.\n- **Role**: Data Scientist + Consultant\n- **Workflow**:\n    1.  **Watch**: 평가 완료 후 리포트 우측 패널에 대기. (Reactive)\n    2.  **Analyze**: *\"이번 실험(#42)에서 '환불 거절' 케이스 점수가 15% 하락했습니다. 주요 원인은 '공감 표현 부족'입니다.\"* (ICD 결과 연동)\n    3.  **Suggest**: *\"시스템 프롬프트에 '거절 시 완곡한 표현 사용' 지침을 추가해볼까요? 제가 수정안을 만들어 드릴 수 있습니다.\"*\n    4.  **Action**: 승인 시, Agent가 프롬프트 파일을 수정하여 새로운 Commit을 생성(Git Push).\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 19, "total_chunks": null}}
{"id": "ee4e80bb-08fc-4adc-805d-2d3ac2abbf19", "content": "### 3.7 Operational Excellence (Safety & Collaboration)\n성공적인 실행뿐만 아니라 실패와 협업에 대한 운영 UX를 보강합니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 20, "total_chunks": null}}
{"id": "d63a0ee9-cc3b-462f-b67b-c57cc55941fc", "content": "#### Failure Intelligence (실패 대응)\n- **Problem**: Ephemeral 환경 특성상 실행이 중단되면 원인 파악이 어렵고 모든 로그가 증발함.\n- **Solution**:\n    - **Partial Artifact Preservation**: 실행 프로세스가 죽더라도(`SIGKILL` 등), 직전까지 스트리밍된 로그와 임시 파일들을 반드시 **Supabase Storage에 스냅샷**으로 남김.\n    - **Smart Diagnosis**: Analyst Agent가 실패 로그를 분석하여 원인(OOM, Timeout, Syntax Error)을 분류하고 해결책 제안 (예: \"메모리 부족입니다. Profile에서 RAM을 4GB로 늘려보세요.\").\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 21, "total_chunks": null}}
{"id": "c045e5d4-d85b-4a56-b7dc-a2116d6fd3b1", "content": "#### Collaboration & Access (협업)\n- **Shared Experiments**: 실험 URL을 공유하여 팀원이 결과를 보고 코멘트/라벨링을 할 수 있음.\n- **Git Auth Delegation**: 사용자의 GitHub 권한(Token)을 안전하게 위임받아, Agent가 사용자 대신 PR을 생성하거나 코드를 수정할 때 사용 (User-Agent Pattern).\n- **Concurrency Control**: 동일한 Dataset이나 설정을 여러 명이 동시에 수정할 때의 충돌 방지 (Optimistic Locking 적용).\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 22, "total_chunks": null}}
{"id": "265d6f4e-b209-4862-a488-0312da2fa505", "content": "#### Cost & Quota (비용 관리)\n- **Quota Management**: 프로젝트/유저별 일일 실행 횟수 제한.\n- **Cost Estimation**: 실험 실행 전 예상 비용(LLM 토큰 + 샌드박스 시간)을 계산하여 Run Modal에 표시 (\"예상 비용: $1.20\").\n- **Auto-Kill Policy**: 무한 루프나 과도한 리소스 점유 시 자동으로 컨테이너를 종료하는 타임아웃 정책 시각화.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 23, "total_chunks": null}}
{"id": "ebbdfa19-bba1-40d4-8848-c153b8909b37", "content": "## 4. 기술 스택 및 변경점 (Tech Stack)\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 24, "total_chunks": null}}
{"id": "94eb5e07-dde6-4fae-a5f5-bf71e2784882", "content": "### 4.1 State Synchronization: Runtime Injection & Caching\nEphemeral Runner 위에서 파일 기반 CLI를 완벽하게 지원하고, 사용자의 Git Repo 오염을 방지하기 위한 전략입니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 25, "total_chunks": null}}
{"id": "69e490de-9f24-420d-94c9-e42484a17670", "content": "#### A. Architecture: DB-Centric Configuration\n- **원칙**: 실험 설정(`inputs.yaml`, `evaluation.yaml`)의 Source of Truth는 **FluxLoop DB**입니다. 사용자의 Git Repo는 **User Code**만 관리합니다.\n- **Git Push Policy**: **Integrator Agent**가 SDK를 통합하거나 코드를 수정해야 할 때만 PR을 생성합니다. 그 외의 실험 설정 변경은 Git에 푸시하지 않습니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 26, "total_chunks": null}}
{"id": "acf34453-46cc-4c65-9c04-cb77c2b88bfc", "content": "#### B. Execution Flow (The \"Synthetic Workspace\")\nRunner는 실행 직전, 사용자의 코드와 FluxLoop의 설정을 합쳐 **합성 워크스페이스**를 구성합니다.\n\n1.  **Prepare**:\n    - `git clone` (User Code, Read-onlyish).\n    - `mkdir .fluxloop inputs evaluation`.\n    - **Config Injection**: DB에서 설정을 읽어 `.fluxloop/inputs.yaml`, `evaluation/evaluation.yaml` 파일 생성.\n    - **Data Hydration**: Supabase Storage에서 대용량 `inputs.jsonl` 다운로드 (Host Cache 활용).\n2.  **Execute**:\n    - CLI 실행 시 명시적 경로 인자 전달:\n      `fluxloop run --config .fluxloop/inputs.yaml --input-file inputs/inputs.jsonl ...`", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 27, "total_chunks": null}}
{"id": "eadb7d7d-c6a2-4687-89cf-4c570050b18f", "content": "3.  **Cleanup**:\n    - 결과물(`traces.jsonl`) 업로드 후 컨테이너 파기.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 28, "total_chunks": null}}
{"id": "c72563b9-6af0-4fb2-8611-04164a5db40e", "content": "#### C. Large File Optimization (Smart Caching)\n- **Problem**: 매번 수백 MB의 데이터셋을 다운로드하면 실행 지연 및 비용 발생.\n- **Solution**:\n    - **Host Volume Cache**: Runner 호스트(Node)에 영구 볼륨(`/cache`)을 마운트.\n    - **Check & Link**: 컨테이너 시작 시 `/cache/datasets/{version_id}.jsonl` 존재 여부 확인.\n        - Hit: `ln -s` 또는 `cp`로 워크스페이스에 연결.\n        - Miss: Storage에서 다운로드 후 캐시에 저장.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 29, "total_chunks": null}}
{"id": "1c8a36d7-f883-4040-a54c-c4dc75af9d0a", "content": "## 5. 로드맵 (Phased Approach)\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 30, "total_chunks": null}}
{"id": "5f8437f4-7827-48a0-a2cd-7be3ecd6518b", "content": "### Phase 0: Schema Migration & Foundation (1주)\n**\"V4 시작 전 기반 정리\"**\n\n스키마와 코드 전반에서 `traces` → `runs` 이름 변경 및 Experiment 개념 확장을 수행합니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 31, "total_chunks": null}}
{"id": "0f29fb24-bbb9-417a-9dec-cb1a0873e129", "content": "#### 0.1 DB 스키마 마이그레이션\n\n**Step 1: 테이블 이름 변경**\n```sql\n-- 1. traces → runs 테이블 이름 변경\nALTER TABLE public.traces RENAME TO runs;\n\n-- 2. evaluations FK 컬럼 이름 변경\nALTER TABLE public.evaluations RENAME COLUMN trace_id TO run_id;\n\n-- 3. RLS 정책 재생성 (테이블명 변경으로 인해)\nDROP POLICY IF EXISTS \"Project members manage traces\" ON public.runs;\nCREATE POLICY \"Project members manage runs\"\n    ON public.runs\n    FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.projects\n            JOIN public.experiments ON projects.id = experiments.project_id", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 32, "total_chunks": null}}
{"id": "7f08e04e-4784-4f3a-b247-1d6ca048bb84", "content": "            WHERE experiments.id = runs.experiment_id\n            AND projects.owner_id = auth.uid()\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.projects\n            JOIN public.experiments ON projects.id = experiments.project_id\n            WHERE experiments.id = runs.experiment_id\n            AND projects.owner_id = auth.uid()\n        )\n    );\n```\n\n**Step 2: experiments 테이블 확장**\n```sql\n-- Experiment = \"실험 주제\" 개념으로 확장\nALTER TABLE public.experiments \n    ADD COLUMN name text,\n    ADD COLUMN description text,", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 33, "total_chunks": null}}
{"id": "6059bb9d-f23c-480f-aaf7-a3faf384ad34", "content": "    ALTER COLUMN commit_sha DROP NOT NULL,\n    ALTER COLUMN branch DROP NOT NULL;\n```\n\n**Step 3: sessions 테이블 생성 (V5 대비)**\n```sql\n-- V5 Interactive Console을 위한 세션 관리\n-- V4에서는 사용하지 않지만 스키마 미리 준비\nCREATE TABLE IF NOT EXISTS public.sessions (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    project_id uuid NOT NULL REFERENCES public.projects(id) ON DELETE CASCADE,\n    name text,\n    status text NOT NULL DEFAULT 'active', -- active, completed, expired\n    metadata jsonb NOT NULL DEFAULT '{}'::jsonb,\n    created_by uuid DEFAULT auth.uid(),", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 34, "total_chunks": null}}
{"id": "41d5a31a-c901-4768-8da7-ddabb10a214e", "content": "    created_at timestamptz NOT NULL DEFAULT now(),\n    expires_at timestamptz  -- Hot Pool 만료 시간\n);\n\n-- RLS 정책\nALTER TABLE public.sessions ENABLE ROW LEVEL SECURITY;\nCREATE POLICY \"Project members manage sessions\"\n    ON public.sessions FOR ALL\n    USING (EXISTS (\n        SELECT 1 FROM public.projects\n        WHERE projects.id = sessions.project_id\n        AND projects.owner_id = auth.uid()\n    ));\n```\n\n**Step 4: runs 테이블 확장**\n```sql\n-- Run에 실행 시점의 버전 정보 + Session 연결\nALTER TABLE public.runs\n    ADD COLUMN git_commit_sha text,", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 35, "total_chunks": null}}
{"id": "90f95e27-8128-470a-828a-388da6f18d2c", "content": "    ADD COLUMN git_branch text,\n    ADD COLUMN dataset_version_id uuid REFERENCES public.input_datasets(id),\n    ADD COLUMN session_id uuid REFERENCES public.sessions(id) ON DELETE SET NULL;\n\n-- 인덱스 (V5 Session 조회 최적화용)\nCREATE INDEX idx_runs_session ON public.runs(session_id) WHERE session_id IS NOT NULL;\n```\n\n**Step 5: input_datasets 버전 관리 + 설명 필드 추가**\n```sql\nALTER TABLE public.input_datasets\n    ADD COLUMN version_id uuid DEFAULT gen_random_uuid(),\n    ADD COLUMN parent_version_id uuid REFERENCES public.input_datasets(id),", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 36, "total_chunks": null}}
{"id": "13ec96af-8f13-4a5c-ac8d-a88dd9818aeb", "content": "    ADD COLUMN is_latest boolean DEFAULT true,\n    ADD COLUMN description text;\n\n-- 인덱스 추가\nCREATE INDEX idx_input_datasets_version ON public.input_datasets(project_id, is_latest);\n```\n\n**Step 6: Run Description 필드**\n```sql\nALTER TABLE public.runs\n    ADD COLUMN description text;\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 37, "total_chunks": null}}
{"id": "995de963-4621-4699-be11-8449fcc80519", "content": "#### 0.2 Backend 코드 변경\n\n| 파일 | 변경 내용 |\n|------|-----------|\n| `app/schemas/traces.py` | → `app/schemas/runs.py` (파일명 + 클래스명 변경) |\n| `app/api/v1/experiments.py` | `trace_id` → `run_id`, `TraceResponse` → `RunResponse` |\n| `app/services/runner/handlers/experiment.py` | Trace 생성 로직 → Run 생성 로직 |\n| `app/services/runner/context.py` | `trace_id` → `run_id` |\n\n**주요 변경 예시:**\n```python", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 38, "total_chunks": null}}
{"id": "a6eb8996-4dd8-47d1-9f07-0bebc8262e37", "content": "# Before\nclass TraceResponse(BaseModel):\n    id: UUID\n    experiment_id: UUID\n    ...\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 39, "total_chunks": null}}
{"id": "146da6a9-1cdc-457c-9da2-5c186b72477d", "content": "# After\nclass RunResponse(BaseModel):\n    id: UUID\n    experiment_id: UUID\n    git_commit_sha: Optional[str] = None\n    git_branch: Optional[str] = None\n    dataset_version_id: Optional[UUID] = None\n    ...\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 40, "total_chunks": null}}
{"id": "15c5b039-467c-4531-a8e0-53bc51617979", "content": "#### 0.3 Frontend 코드 변경\n\n| 파일 | 변경 내용 |\n|------|-----------|\n| `lib/api.ts` | `TraceRecord` → `RunRecord`, API 함수명 변경 |\n| `components/experiments/TraceTable.tsx` | → `RunTable.tsx` |\n| `components/experiments/TraceDetailDrawer.tsx` | → `RunDetailDrawer.tsx` |\n| `components/experiments/types.ts` | 타입명 일괄 변경 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 41, "total_chunks": null}}
{"id": "324afac3-18eb-4fca-af69-47fd28354ac0", "content": "#### 0.4 검증 체크리스트\n- [x] DB 마이그레이션 스크립트 실행\n- [ ] Backend 단위 테스트 통과\n- [ ] Frontend 빌드 성공\n- [ ] Run 실행 → 평가 E2E 테스트\n- [ ] SSE 로그 스트리밍 정상 동작\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 42, "total_chunks": null}}
{"id": "a0f2f569-a338-4000-90d5-451cbc7bfdf7", "content": "### V4.1 Project Onboarding Roadmap (단계적 구현)\n**\"새 프로젝트를 웹에서 바로 시작\"** — 일정 제약을 두지 않고 @v4 내에서 순차적으로 완성도를 높인다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 43, "total_chunks": null}}
{"id": "2606be41-5adf-46cb-aa7a-3a25d93f2b99", "content": "#### V4.1 전체 목표\n- 사용자는 깃 URL만으로 10분 이내에 초기 실험을 실행할 수 있다.\n- `init_project` API는 95% 이상의 성공률을 유지하며, 실패 시 즉각적인 재시도 플로우와 원인 로그를 제공한다.\n- 자동 Framework Detection과 템플릿 주입으로 SDK 삽입까지 무(無)설명 상태를 최소화한다.\n- **Integrator Agent**는 `code agent@langchain-code-main` 레퍼런스를 기반으로 실제 코드를 수정·테스트·실행까지 완료하며, MCP는 지식 조회 전용으로 사용한다.\n- Git 주소와 권한을 제공하면 Agent가 기존 Fluxloop 통합 여부를 감지하고, 미통합 시 TODO를 생성→코드 수정→브랜치 생성→Git push까지 완료한다.\n\n| 유즈케이스 | 상세 시나리오 | 성공 기준 |\n|-----------|---------------|-----------|\n| 신규 프로젝트 온보딩 | 사용자가 git URL, deploy target을 입력 → 자동 감지/주입 → 첫 Run 생성 | 평균 3분 내 완료, 실패 시 가이드 표시 |", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 44, "total_chunks": null}}
{"id": "c943a37c-cb8a-430f-9917-4128377461bc", "content": "| 기존 프로젝트 동기화 | 이미 SDK가 있는 프로젝트에도 재주입 없이 Git Push만 수행 | 중복 주입 0건, 변경 diff 명확 표시 |\n| Agent 서포트 | Integrator Agent가 코드를 수정·테스트·실행하고 전용 브랜치에 push, 사용자는 diff 승인만 진행 | 자동 실행 성공률 70% 이상, 잔여 수동 작업 < 10분 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 45, "total_chunks": null}}
{"id": "12337b1f-759f-4975-be0b-c7886efa0232", "content": "#### @v4 단계별 구현 계획\n\n| 단계 | 코드네임 | 범위 | 완료 조건 |\n|------|----------|------|-----------|\n| Stage A | `v4.1-foundation` | Detection/Template/Git Push 안정화 + 온보딩 UI 기본형 | 샘플 5개 repo에서 자동 주입 성공, 오류 로그 수집 |\n| Stage B | `v4.1-guided` | MCP 지식 기반 TODO 생성, 반자동 Agent(제안+수동 승인) | TODO→Patch diff→테스트 리포트까지 UI 연동, 승인 후 수동 push |\n| Stage C | `v4.1-autonomous` | 완전 자동 Agent (코드 수정→테스트→브랜치 생성→push) | Sandbox 실행/롤백, 브랜치 링크 제공, 자동 push 성공률 90% |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 46, "total_chunks": null}}
{"id": "e6a661ff-8ade-4e67-9a2d-84b52b20d48f", "content": "##### Stage A: Foundation (@v4.1-foundation)\n| 태스크 | 세부 단계 | 산출물 |\n|--------|-----------|--------|\n| Init UI 개선 | (1) Repository 연결 상태, Detection 진행률 표시<br>(2) 실패 시 로그/재시도 버튼<br>(3) 첫 Run 생성 CTA 연결 | `InitWizard.tsx` (새 단계 컴포넌트), Empty-state 일러스트 |\n| Framework Detection | (1) Git clone 후 `detector.py` 실행<br>(2) LangChain/Django/FastAPI 시그니처 룰 관리<br>(3) 결과를 UI와 API 양쪽으로 반환 | `framework_detector` 모듈, 룰 JSON, 성공/실패 메트릭 |\n| Template Injection | (1) Framework별 템플릿 매트릭스 정의<br>(2) 파일 존재 여부에 따라 patch 적용/skip<br>(3) dry-run diff 미리보기 | `templates/<framework>` 디렉터리, 패치 스크립트, diff 미리보기 API |", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 47, "total_chunks": null}}
{"id": "1c0acda6-663d-4784-bf76-70b2a6dd1b3d", "content": "| Git Push 안정화 | (1) SSH/HTTPS credential UX 통합<br>(2) 충돌 시 rebase 가이드 문구 적용<br>(3) push 로그를 SSE로 스트리밍 | `git_service.py` 재시도 로직, PushResult 모델, 프론트 status 토스트 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 48, "total_chunks": null}}
{"id": "5e7d84c3-eb32-4a9a-a516-178b8f0c1543", "content": "##### Stage B: Guided Agent (@v4.1-guided, Deprecated)\n\n> Stage B 요구사항은 Stage C 자율 에이전트에 통합되어 현재는 히스토리로만 유지됩니다.\n| 태스크 | 세부 단계 | 산출물 |\n|--------|-----------|--------|\n| MCP 지식 파이프라인 | Fluxloop SDK 통합 가이드/체크리스트를 MCP 경로로 정리 | `integration_knowledge.json`, MCP endpoint |\n| Guided Agent UI | TODO 리스트, diff 미리보기, 테스트 로그를 표시하고 수동 승인/적용 버튼 제공 | `IntegratorPanel.tsx`, 승인 이벤트 API |\n| Semi-auto Executor | `code agent@langchain-code-main`을 호출해 patch 제안과 테스트를 수행하되, commit/push는 사용자가 결정 | `integrator_executor` Stage B 모드, `IntegratorRun` 모델(제안/로그) |", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 49, "total_chunks": null}}
{"id": "934734ec-c8c2-41e1-9d1c-6f32c93d167b", "content": "##### Stage C: Autonomous Agent (@v4.1-autonomous)\n| 태스크 | 세부 단계 | 산출물 |\n|--------|-----------|--------|\n| Fluxloop 통합 감지 | Repo clone 후 `fluxloop_check.py`로 SDK 통합 여부 감지 | 감지 스크립트, Health Report |\n| Fully-auto Executor | MCP로 지식 조회 → TODO 생성 → `plan → edit → test → run` 루프 자동화 → `fluxloop/auto/*` 브랜치 생성 & push | `integrator_executor` Stage C 모드, 자동 브랜치 규칙, push 로그 |\n| 실행 관찰성 | 실시간 로그 스트리밍, 롤백/재시작, diff preview 링크 제공 | `IntegratorRunResult` 확장, UI 표시 |\n\n**Agent 실행 아키텍처**\n- `langchain-code-main` repo를 reference로 삼아 Code Agent 행위(편집, 테스트, 런)를 재사용하고, Fluxloop 워크스페이스에 sandbox 권한으로 붙인다.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 51, "total_chunks": null}}
{"id": "e3edb8bf-509f-4e6d-a63b-fcc270e76346", "content": "- MCP는 레시피/SDK 가이드, 프레임워크별 체크리스트 등 정적 지식만 조회하며, 모든 쓰기/실행은 Code Agent 루프에서 수행한다.\n- 실행 로그(`plan → edit → test → run`)를 스트리밍하여 사용자가 언제든 중단/재시작할 수 있게 한다.\n\n**Agent 실행 플로우 (Stage C)**\n1. 사용자로부터 Git URL과 자격 증명을 입력받고 repo를 sandbox에 clone.\n2. `fluxloop_check.py`로 SDK 통합 여부를 감지하여 이미 통합된 경우 완료 표시 후 Step 5(Experiment 생성)로 이동.\n3. 미통합이면 MCP에서 최신 통합 가이드/레퍼런스를 조회하고, Agent가 세부 TODO 리스트를 작성해 UI에 공유.\n4. TODO를 기반으로 `plan → edit → test` 루프를 수행하여 코드 수정 및 `pytest`/`npm test` 실행.\n5. 성공 시 `fluxloop/auto/<timestamp>` 브랜치를 생성하고 push, 실패 시 롤백 후 로그와 TODO 재갱신.", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 52, "total_chunks": null}}
{"id": "e5d35162-e049-40d5-bb3d-e7d6cec9a88c", "content": "6. 브랜치 링크와 diff preview, 실행 로그를 사용자에게 제공하고 승인/머지까지 이어지는 CTA를 노출.\n\n**V4.1 누적 검증 체크리스트**\n- Stage A\n  - [ ] 신규 프로젝트 5개 샘플에 대해 end-to-end 온보딩 성공\n  - [ ] Framework Detection false-positive 5% 이하\n  - [ ] Template 주입 후 테스트 실행 시 import 오류 0건\n  - [ ] Push 실패 로그 100% 저장/조회 가능\n- Stage B\n  - [ ] TODO → diff → 테스트 로그가 UI에서 연결되고, 사용자 승인 후 머지까지 1시간 내 이뤄짐\n  - [ ] MCP 지식 조회 latency < 3초, 환각률 < 5% (샘플 20건 기준)\n- Stage C\n  - [ ] Agent 자동 실행(수정→테스트→실행) 성공률 70% 이상, 실패 시 롤백 로그 확보\n  - [ ] Agent 제안 → 적용까지 평균 < 2분\n  - [ ] 자동 브랜치 생성 및 push 성공률 90% 이상, 실패 시 재시도 UX 제공", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 53, "total_chunks": null}}
{"id": "db0485ef-5133-4fdb-8fdb-3bc80b1d59d7", "content": "#### V4.1 UX 플로우\n```\nProject Wizard\n ├─ Step 1: Repo 연결 (URL/Access Token 검증)\n ├─ Step 2: Framework Detection (spinner + 로그 패널)\n ├─ Step 3: Template Preview (diff 확인, 선택적 적용)\n ├─ Step 4: Git Push (progress + retry)\n └─ Step 5: 첫 Experiment 생성 (이름/설명 입력)\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 55, "total_chunks": null}}
{"id": "1a9f3817-40b6-4fd0-8f7a-38f996d7e77d", "content": "#### V4.1 API & 서비스 영향\n```python", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 56, "total_chunks": null}}
{"id": "ae030ca0-6bb4-4083-9de0-5fe042ec6b2f", "content": "# experiments.py 확장\nclass ExperimentCreateRequest(BaseModel):\n    project_id: UUID\n    name: str  # NEW: 실험 주제 이름\n    description: Optional[str] = None  # NEW: 설명\n    template_id: Optional[UUID] = None  # NEW: 선택한 템플릿 추적\n    metadata: dict[str, str] = Field(default_factory=dict)  # NEW: detector 결과 저장\n    # commit_sha, branch는 Run 생성 시로 이동\n\nclass InitProjectStatus(BaseModel):\n    project_id: UUID\n    phase: Literal[\"clone\",\"detect\",\"inject\",\"push\",\"done\"]\n    progress: int  # 0~100\n    logs: list[str]\n    executor_phase: Optional[Literal[\"plan\",\"edit\",\"test\",\"run\"]]", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 57, "total_chunks": null}}
{"id": "599f36b6-a8dd-45e9-ab13-2a9d6489817f", "content": "    executor_result: Optional[IntegratorRunResult]\n\nclass IntegratorRunResult(BaseModel):\n    plan: list[str]\n    last_command: Optional[str]\n    tests: list[TestResultSummary]  # pytest, npm test 등\n    status: Literal[\"success\",\"failed\",\"needs_approval\"]\n    diff_preview_url: Optional[AnyHttpUrl]\n    branch_name: Optional[str]\n    git_push_url: Optional[AnyHttpUrl]\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 58, "total_chunks": null}}
{"id": "946f10fd-ff9b-4c73-b087-573223434b5b", "content": "#### V4.1 리스크 & 완화 전략\n- Detection이 실패하는 Edge Repo: 룰 기반 + fallback으로 requirements 탐색, 실패 시 수동 선택 옵션 제공.\n- Git Push 권한 문제: 사전 Credential Health Check, 실패 시 SSH Key 업로드 모달 연결.\n- Integrator Agent 원격 실행 리스크: sandbox 컨테이너에만 쓰기 권한을 부여하고, `code agent@langchain-code-main` 라이브러리 버전을 고정하며, 테스트 실패 시 자동 롤백.\n- Integrator Agent 환각: 제안 패치가 테스트를 통과해야만 적용되도록 `dry_run` 실행 및 사용자 확인 필수.\n- Git Credential 보안: 일회성 토큰만 저장하고 Agent 컨테이너 종료 시 파기, push 로깅 시 민감정보 마스킹.\n- 일정 리스크: Stage A를 우선 출시해 사용자 데이터를 확보하고, Stage B/C는 feature flag로 점진 롤아웃.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 59, "total_chunks": null}}
{"id": "c9eb3e8e-eb2e-4318-8241-b790c6eb02d8", "content": "---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 60, "total_chunks": null}}
{"id": "56bed22b-3efe-4d38-82e2-c505a18269ed", "content": "### 4.2 Artifact Lifecycle Management (Common Infrastructure)\nV4의 Ephemeral Runner 철학을 유지하면서, Init/Run/Eval 전 과정에서 생성되는 파일들을 안전하게 관리하기 위한 공통 정책입니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 61, "total_chunks": null}}
{"id": "6204c71f-237f-4ad1-87e4-df1ea7906d51", "content": "#### A. Immutable Artifacts Strategy\n- **Run-Based Versioning**: 모든 실행 결과물(Artifact)은 `run_id`를 기준으로 Storage에 격리 저장합니다.\n  - 예: `gs://artifacts/{project_id}/{run_id}/bootstrap.tar.gz`\n- **Overwrite 금지**: 동일 프로젝트라도 실행 시점마다 새로운 Artifact를 생성하여 이력 추적과 롤백을 보장합니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 62, "total_chunks": null}}
{"id": "5d16d858-54e5-43cc-b5a5-3700b9e25bff", "content": "#### B. Bootstrapping & Hydration\n- **Init Artifact Upload**: `init_project` 완료 직후, 생성된 FluxLoop 자산(config, templates 등)을 압축하여 Storage에 업로드합니다.\n- **DB Pointer**: `projects` 테이블의 `active_bootstrap_run_id` (또는 메타데이터)가 최신 유효 설정이 담긴 Run ID를 가리키게 합니다.\n- **Hydration**: 이후 실험 실행 시, Runner는 DB가 가리키는 Artifact를 다운로드하여 Shared Root에 복원한 뒤 실행을 시작합니다.\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 63, "total_chunks": null}}
{"id": "e0cb41a3-e25b-4aab-8b88-82a734a38987", "content": "#### C. Shared Root Policy\n- **Ephemeral Local Path**: Runner 호스트/컨테이너의 로컬 경로는 **일시적인 캐시**로만 취급합니다.\n- **Source of Truth = Storage**: 로컬 파일이 유실되어도 Storage에서 언제든 복구 가능해야 합니다.\n- **Git Cleanliness**: 이 전략을 통해 원본 리포지토리에 FluxLoop 파일을 커밋하지 않고도(\"Clean Repo\"), 지속적인 실험 환경을 유지할 수 있습니다.\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 64, "total_chunks": null}}
{"id": "bca0cffa-d64c-49d2-bb6a-3e532d5ef49a", "content": "### Phase 2: Input & Configuration (3주)\n**\"테스트 데이터를 웹에서 관리\"**\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 65, "total_chunks": null}}
{"id": "eca7e1cf-768b-479b-a09a-7cb16dd09514", "content": "#### 2.1 기능 범위\n- **Input Studio UI**: Dataset CRUD 폼\n- **Dataset Versioning**: 불변 버전 관리\n- **Scripter Agent**: AI 시나리오 생성\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 66, "total_chunks": null}}
{"id": "635e7d96-1607-4bda-be8b-ba8cfcef560f", "content": "#### 2.2 상세 태스크\n\n| 태스크 | 설명 | 예상 공수 |\n|--------|------|-----------|\n| Input Studio 기본 UI | Dataset 목록, 생성, 편집 폼 | 4일 |\n| Version 관리 로직 | 수정 시 새 버전 생성, is_latest 관리 | 2일 |\n| Dataset 선택 UX | Run Modal에서 버전별 선택 | 2일 |\n| Generate Inputs 연동 | UI에서 AI 생성 트리거 | 2일 |\n| Scripter Agent v0 | 자연어 → Multi-turn 시나리오 변환 | 5일 |\n| Runtime Injection | DB 설정 → 워크스페이스 파일 주입 | 3일 |\n| Host Cache 구현 | 대용량 Dataset 캐싱 | 2일 |\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 67, "total_chunks": null}}
{"id": "fefe62f4-76bd-4548-9c08-98e2c87c0f89", "content": "#### 2.3 새 UI 컴포넌트\n```\n/project/[projectId]/\n├── datasets/           # NEW\n│   ├── page.tsx        # Dataset 목록\n│   └── [datasetId]/\n│       └── page.tsx    # Dataset 상세/편집\n└── experiments/\n    └── page.tsx        # 기존 (Run Modal에 Dataset 선택 추가)\n```\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 68, "total_chunks": null}}
{"id": "1f146c58-9431-4c98-bed8-a9dae01de6bd", "content": "### Phase 3: History & Insight (4주)\n**\"실험 비교와 인사이트 발견\"**\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 69, "total_chunks": null}}
{"id": "f2a3e216-1920-4e23-83df-cfa1e6d2e860", "content": "#### 3.1 기능 범위\n- **Experiment 상세 페이지**: Run 히스토리 뷰\n- **Comparison UI**: 두 Run 비교 (Diff View)\n- **Interactive Criteria Discovery (ICD)**\n- **Analyst Agent**\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 70, "total_chunks": null}}
{"id": "96a055e7-6dfa-4bb8-ba70-377b35830ad4", "content": "#### 3.2 상세 태스크\n\n| 태스크 | 설명 | 예상 공수 |\n|--------|------|-----------|\n| Experiment 상세 페이지 | `/experiments/[experimentId]` - Run 목록 | 3일 |\n| Run 선택 체크박스 | 다중 선택 UI | 1일 |\n| Comparison View | Side-by-side Diff 레이아웃 | 4일 |\n| 점수 Delta 하이라이트 | 평가 점수 차이 시각화 | 2일 |\n| Human Feedback UI | Thumb Up/Down, Annotation 폼 | 3일 |\n| Feedback 저장 API | `run_feedbacks` 테이블 + API | 2일 |\n| Criteria Extraction | 피드백 패턴 분석 프롬프트 | 3일 |\n| Analyst Agent v0 | 평가 결과 분석 → 개선안 제안 | 5일 |\n| Failure Diagnosis | 실패 Run 자동 분석 | 3일 |\n| Cost View | 예상 비용 표시 | 2일 |", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 71, "total_chunks": null}}
{"id": "3fb95447-44df-4d46-b4ec-972d6b4a9d56", "content": "#### 3.3 새 스키마\n```sql\n-- Human Feedback 저장\nCREATE TABLE public.run_feedbacks (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    run_id uuid NOT NULL REFERENCES public.runs(id) ON DELETE CASCADE,\n    feedback_type text NOT NULL, -- 'thumbs_up', 'thumbs_down', 'annotation', 'correction'\n    content text,\n    golden_response text,        -- correction인 경우\n    created_by uuid DEFAULT auth.uid(),\n    created_at timestamptz DEFAULT now()\n);\n\n-- Evaluator 버전 관리\nCREATE TABLE public.evaluator_configs (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 73, "total_chunks": null}}
{"id": "1dc75ead-285d-4e2c-9e95-2f33de75aad7", "content": "    project_id uuid NOT NULL REFERENCES public.projects(id),\n    name text NOT NULL,          -- 'Refund_Eval_v2'\n    version int NOT NULL DEFAULT 1,\n    prompt_template text NOT NULL,\n    criteria jsonb,              -- 추출된 기준들\n    parent_id uuid REFERENCES public.evaluator_configs(id),\n    created_at timestamptz DEFAULT now()\n);\n```\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 74, "total_chunks": null}}
{"id": "93d8e4fe-357f-4311-adfe-4dff31d8a46f", "content": "#### 3.4 새 UI 라우트\n```\n/project/[projectId]/\n├── experiments/\n│   ├── page.tsx                    # Experiment 목록 (기존 Run 테이블)\n│   ├── [experimentId]/\n│   │   ├── page.tsx                # NEW: Run 히스토리\n│   │   └── compare/\n│   │       └── page.tsx            # NEW: Run 비교 Diff View\n│   └── runs/\n│       └── [runId]/\n│           └── page.tsx            # NEW: Run 상세 + Feedback\n└── evaluators/                      # NEW\n    └── page.tsx                    # Evaluator 설정 관리\n```\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 75, "total_chunks": null}}
{"id": "144c645a-c03a-42b8-9ac3-ba1307248990", "content": "## 6. 구현 일정 요약\n\n| Phase | 기간 | 핵심 산출물 |\n|-------|------|-------------|\n| **Phase 0** | 1주 | Schema Migration, `runs` 테이블 |\n| **Phase 1** | 2주 | Project Init 안정화, Integrator Agent |\n| **Phase 2** | 3주 | Input Studio, Dataset Versioning |\n| **Phase 3** | 4주 | Comparison UI, ICD, Analyst Agent |\n| **총합** | **10주** | V4 Full Lifecycle |\n\n---\n", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 76, "total_chunks": null}}
{"id": "4b8bc6ee-57a1-4e67-adca-29216bf61ed8", "content": "## 7. Future Roadmap: V5 (Interactive Core)\n**\"Real-time Interaction & Zero Latency\"**\n- **Session ID** 활용 (스키마 V4 Phase 0에서 준비 완료 ✅)\n- **Hot Pool**: Session 기반 워크스페이스 재사용\n- **Interactive Console** (WebTTY)\n- **Live Human-in-the-loop**", "metadata": {"source": "docs/prd/web/v4/fluxloop_v4_concept.md", "chunk_index": 77, "total_chunks": null}}
{"id": "73f542a7-dd52-4697-b9b9-1da815c672b2", "content": "# FluxLoop Web Version Strategy & Planning\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 0, "total_chunks": null}}
{"id": "6f3c805d-b0fc-4212-aa06-04d1903cfd6f", "content": "## 1. Overview\nThis document outlines the strategic plan for the web version of FluxLoop.\n**Goal:** Transform FluxLoop from a developer-centric CLI tool into a collaborative platform for **Product Managers (PMs)** and domain experts to evaluate, iterate, and deploy AI agents without writing code.\n\n**Core Philosophy:**\n- **No-Code Interface:** Complex configurations (YAMLs) are replaced by visual editors.\n- **Git-Native:** Source of truth is always the Git repository.\n- **Cloud Execution:** Simulations run in scalable, parallelized cloud sandboxes.", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 1, "total_chunks": null}}
{"id": "f792bd56-9c79-447a-a4bf-7b15fe7070ef", "content": "- **Implicit Criteria Discovery:** Bridging the gap between human intuition and automated evaluation.\n\n---\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 2, "total_chunks": null}}
{"id": "88113268-7e99-4aad-919f-50841ba5fe10", "content": "## 2. Target Audience\n- **Primary:** Product Managers (PMs) who own the product quality but cannot modify agent code directly.\n- **Secondary:** Domain Experts (Subject Matter Experts) who define ground truth and \"Golden Datasets\".\n- **Tertiary:** Developers who set up the initial integration and review auto-generated PRs.\n\n---\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 3, "total_chunks": null}}
{"id": "287cb3a8-8e16-4a6c-8ef1-d278bc70f352", "content": "## 3. Core Features & User Flow\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 4, "total_chunks": null}}
{"id": "bbf41b18-01f4-4246-95db-5f8967781d9f", "content": "### 3.1. Source Integration (Git-Based)\n*The foundation of the web platform.*\n\n- **Connection:** GitHub/GitLab App integration.\n- **Mechanism:**\n    - User connects a repository.\n    - Platform detects `fluxloop` configuration (or prompts to initialize).\n    - **Read:** Pulls code for simulation from specific branches/commits.\n    - **Write:** All configuration changes (inputs, evaluation rules) made in the UI are committed back to the repo via **Pull Request (PR)**.\n    - **Sync:** Web UI always reflects the state of the selected branch.", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 5, "total_chunks": null}}
{"id": "235a8ad6-55e3-4cd1-b4e9-6a56192246bb", "content": "- **Conflict Resolution:**\n    - Since PMs modify state asynchronously from developers, merge conflicts may occur.\n    - **Strategy:** System attempts auto-rebase on write. If conflicts are detected (e.g., `inputs.yaml` was modified in `main`), the UI blocks the edit and prompts the user to \"Update from Master\" before reapplying changes.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 6, "total_chunks": null}}
{"id": "ebc02828-e252-4992-b664-67f4b4a7d62d", "content": "### 3.2. Integration & Onboarding\n*Solving the \"Code Access\" problem.*\n\n- **Scenario A (Existing Integration):** Repo already has `@fluxloop.agent` SDK instrumentation.\n- **Scenario B (Auto-Instrumentation Agent):**\n    - User authorizes the platform.\n    - **Agentic Workflow:** A specialized \"Integration Agent\" scans the repo, identifies the main agent loop, and automatically injects the SDK code.\n    - **Deliverable:** The Agent creates a PR (\"chore: integrate fluxloop sdk\").\n    - Once merged by a dev, the PM can start running simulations.", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 7, "total_chunks": null}}
{"id": "7659874d-d662-4efc-90e6-3a8b976dc03f", "content": "### 3.3. Cloud Simulation Engine\n*Replacing the local CLI runner.*\n\n- **Architecture:**\n    - **Sandbox Workers:** Ephemeral Docker containers or Firecracker microVMs.\n    - **Security & Isolation:**\n        - **Secrets Management:** API keys (OpenAI, DB) are injected at runtime via encrypted vault (never stored in repo).\n        - **Network Policy:** Strict egress filtering to prevent unauthorized data exfiltration.\n        - **Ephemeral Lifecycle:** Environments are destroyed immediately after execution to ensure no data persistence.", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 9, "total_chunks": null}}
{"id": "dc93ab03-04d3-4490-a733-36b31fbfd0ca", "content": "    - **Workflow:**\n        1.  Clone Repo (at selected commit).\n        2.  Install Dependencies (`pip install`, `poetry`, etc.).\n        3.  Inject Inputs (from UI config).\n        4.  Execute `fluxloop run` in parallel (scaling to 100s of concurrent traces).\n    - **Output:** Stream logs and traces back to the Web UI in real-time.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 10, "total_chunks": null}}
{"id": "c82a8288-2238-4096-8723-e7cc864befd1", "content": "### 3.4. The \"Experiment Interface\" (Product Core)\n*Iterative refinement loop.*\n\n**A. Design Phase:**\n- **Visual Input Editor:** Instead of editing `inputs.yaml`, PMs use a form to define Personas, User Intents, and Constraints.\n- **AI Generator:** \"Generate 50 test cases for a travel booking agent where the user changes their mind halfway.\"\n\n**B. Execution Phase:**\n- **Parallel Run:** One-click \"Run Simulation\".\n- **Progress Tracking:** Real-time status of running traces.\n\n**C. Evaluation & Implicit Criteria Discovery (Key Differentiator):**", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 11, "total_chunks": null}}
{"id": "da70c7a8-bbd6-45e8-acb5-154d0d168bfe", "content": "*Addressing the \"I know it when I see it\" problem.*\n\n- **The Problem:** PMs struggle to write explicit prompts for LLM Judges (e.g., \"Check if tone is polite\").\n- **The Solution (Discovery Workflow):**\n    1.  **Review:** PM reviews raw simulation outputs.\n    2.  **Label:** PM marks responses as 👍 / 👎 or edits them to a \"Golden Response\".\n    3.  **Inference:** The platform analyzes the labeled data and suggests:\n        - *\"It seems you prefer concise answers. Should we add a 'Conciseness' evaluator?\"*\n        - *\"You rejected responses that mentioned competitors. Add a 'Brand Safety' check?\"*", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 12, "total_chunks": null}}
{"id": "54bfbe6e-d7ed-461c-9e78-6234024e176f", "content": "    4.  **Codify:** The system generates the explicit `evaluation.yaml` configuration based on this interactive feedback.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 13, "total_chunks": null}}
{"id": "91217aa1-e45d-4a8b-8e30-9d973281a0e2", "content": "### 3.5. Advanced Report & Chat-Based Analysis\n*Synthesizing raw data into actionable insights.*\n\n**A. Interactive Dashboard:**\n- **Aggregated Metrics:** Success rates, latency distributions, token usage costs.\n- **Failure Clustering:** \"30% of failures happened when the user asked about 'Refunds'.\"\n- **Trend Analysis:** Compare current run vs. previous 5 runs (Pass rate trend line).\n\n**B. Chat-Based \"Analyst Agent\":**\n- **Interface:** A chat window embedded in the report page.\n- **Function:** The user converses with the experiment data.", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 14, "total_chunks": null}}
{"id": "5c1e66d8-9133-4a16-b58f-c45c14a38861", "content": "    - *User:* \"Why did the success rate drop compared to last week?\"\n    - *Analyst:* \"The 'Politeness' check failed in 15 cases. Most of these involved the new 'Angry Customer' persona.\"\n    - *User:* \"Show me the top 3 worst responses.\"\n    - *Analyst:* (Displays specific trace snippets)\n- **Goal:** Democratize data analysis. The PM doesn't need to query SQL or parse JSONL files.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 15, "total_chunks": null}}
{"id": "8d7ff812-d792-494c-82ca-97d5e24a3303", "content": "### 3.6. Closing the Loop: From Insight to Action\n*The complete feedback cycle.*\n\nThis is the most critical phase where analysis turns into code/configuration changes.\n\n1.  **Identify Issue:**\n    - Through the Analyst Agent or Dashboard, an issue is found (e.g., \"Agent hallucinates flight times\").\n2.  **Suggest Fix (AI-Powered):**\n    - The Analyst Agent proposes a solution based on the type of failure.\n    - **Provenance & Guardrails:** Every suggestion must cite specific trace IDs and evaluator failures. Code generation is constrained (e.g., mostly prompts/configs) and validated against syntax checkers.", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 16, "total_chunks": null}}
{"id": "67fdddfd-c73f-403a-bd5b-6f32f7099f9b", "content": "    - *Option A (Config):* \"Add a new constraint to `inputs.yaml` to test this edge case more thoroughly.\"\n    - *Option B (Evaluation):* \"Tighten the 'Fact Check' evaluator in `evaluation.yaml`.\"\n    - *Option C (Source Code):* \"I suggest modifying the system prompt in `agent.py` to emphasize checking the flight database.\"\n3.  **Apply & Commit:**\n    - **Config Changes:** Applied directly to the UI forms.\n    - **Code Changes:** The Analyst Agent generates a patch.\n    - **Action:** Click \"Create PR\".\n4.  **Re-Run:**", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 17, "total_chunks": null}}
{"id": "cda8448a-d8fd-4379-b599-102a0871d438", "content": "    - Once the PR is merged (or on a feature branch), a new simulation is triggered automatically to verify the fix.\n    - The cycle repeats.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 18, "total_chunks": null}}
{"id": "1a934394-d015-4d2c-88b6-8af24638af73", "content": "### 3.7. Efficiency & Regression Testing\n- **Smart Caching:** Don't re-run traces if the input and code haven't changed.\n- **Regression Suite:**\n    - Define a \"Golden Set\" of inputs that must always pass.\n    - Auto-run on every PR (CI/CD integration).\n    - Visual Diff: \"This change improved accuracy by 5% but increased latency by 200ms.\"\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 19, "total_chunks": null}}
{"id": "bcafe4ed-485e-4fe6-9d89-0f67637f7602", "content": "### 3.8. Enterprise Governance & Security\n*Ensuring trust and control.*\n\n- **Role-Based Access Control (RBAC):**\n    - **Viewer:** Can view reports and dashboards.\n    - **Runner:** Can trigger simulations (cost implications).\n    - **Editor:** Can modify configs and create PRs.\n    - **Admin:** Manages billing, secrets, and git connections.\n- **Audit Logs:**\n    - Full traceability of who ran an experiment, who labeled a dataset, and who authorized an AI-generated PR.\n- **Compliance:**\n    - SOC2/GDPR readiness for handling customer data in traces (option for PII redaction/masking before storage).", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 20, "total_chunks": null}}
{"id": "aba07d06-d57e-477e-bde3-e33422d3beed", "content": "### 3.9. Agent Ops (Future Roadmap)\n- **Gatekeeper:** If the \"Golden Set\" pass rate > 95%, automatically deploy to staging/production.\n- **Monitoring:** Connect to production logs (via SDK) to pull real-world failure cases back into the testing dataset (\"loop\" closure).\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 22, "total_chunks": null}}
{"id": "60077bda-a2d1-450d-88a1-5bb5544d9917", "content": "### 3.10. Production Feedback Loop (North Star)\n*Extending evaluation with real user behavior.*\n\n- **Telemetry Ingestion:** Post-deployment, the SDK streams anonymized conversation transcripts, user actions (clicks, abandonments), and system metrics back into FluxLoop.\n- **In-Flow Feedback Capture:** Users can rate responses in-line (👍/👎, short survey). These signals automatically label traces for evaluator tuning.\n- **Behavioral Signals:** Drop-off rates, conversion events, and retention metrics map to evaluation scores, exposing how quality impacts business KPIs.", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 23, "total_chunks": null}}
{"id": "48eca7e8-c525-457f-bc74-0c48f3f189f7", "content": "- **Auto-Enrichment:** Fresh production cases graduate into regression suites and scenario libraries, ensuring tests track real-world edge cases.\n- **Continuous Improvement Loop:** Analyst Agent highlights emerging issues, proposes fixes, triggers re-tests, and, once quality rebounds, recommends redeployments—closing the full Operate → Observe → Improve cycle.\n\n---\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 24, "total_chunks": null}}
{"id": "e3bd56a4-acd6-4785-ba51-30ca4e8f7d9b", "content": "## 4. Architecture Strategy\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 25, "total_chunks": null}}
{"id": "0f04c5f5-52f4-4461-b662-90e42118e589", "content": "### Frontend (Web Dashboard)\n- **Tech Stack:** Next.js (React), Tailwind CSS.\n- **Components:**\n    - **Trace Timeline:** Visual chat rendering (like the VSCode extension).\n    - **Diff Viewer:** Side-by-side comparison of two experiment runs.\n    - **Config Builder:** Form-based editors for YAML configurations.\n    - **Analyst Chat Interface:** Streaming chat UI for interacting with experiment data.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 26, "total_chunks": null}}
{"id": "54b4966b-bc08-42bb-a7e4-0c7885b88958", "content": "### Backend (Orchestrator)\n- **Tech Stack:** Python (FastAPI) or Node.js.\n- **Role:**\n    - **Auth & Security:** OAuth2/SAML integration, Secrets Vault (e.g., HashiCorp Vault) for managing API keys.\n    - Queue Management (RabbitMQ/Redis).\n    - Git Operations (go-git or GitHub API).\n    - Data Persistence (PostgreSQL for user data, S3/MinIO for large trace artifacts).\n    - **LLM Service:** For the Analyst Agent and Auto-Evaluators.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 27, "total_chunks": null}}
{"id": "3075eed6-4c3b-468a-af30-5c663cad7912", "content": "### Runner Service (The \"Worker\")\n- **Environment:** Isolated Sandboxes.\n- **Logic:**\n    - Wraps `fluxloop-cli`.\n    - Handles environment setup (`setup.sh` / `requirements.txt`).\n    - Executes `fluxloop run experiment`.\n\n---\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 28, "total_chunks": null}}
{"id": "d408fb63-d756-4ddd-9a63-4c35868ba2f2", "content": "## 5. Development Phases\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 29, "total_chunks": null}}
{"id": "cd929441-d729-40af-87d9-b4709bc22ab7", "content": "### Phase 1: The \"Viewer\" (MVP)\n- Connect GitHub Repo.\n- Read existing `experiments/` folder from repo.\n- Visualize traces and evaluation results on the web.\n- *Value:* Share experiment results with stakeholders via a URL.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 30, "total_chunks": null}}
{"id": "90c77c0d-870a-4664-af7b-f3e4a872c9a9", "content": "### Phase 2: The \"Runner\"\n- Cloud Sandbox integration.\n- Trigger `fluxloop run` from UI.\n- View live logs.\n- *Value:* PMs can run tests without installing Python/CLI.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 31, "total_chunks": null}}
{"id": "2cc26765-d1d5-4cbe-9672-5d5cb9e66a21", "content": "### Phase 3: The \"Editor\" & \"Evaluator\"\n- Visual config editing (Inputs/Personas).\n- Commit changes back to Git.\n- **Implicit Criteria Discovery** features (Interactive Grading).\n- *Value:* PMs take control of the quality definition.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 32, "total_chunks": null}}
{"id": "2943fb49-c3d3-4264-b4ed-a5080d71e512", "content": "### Phase 4: The \"Analyst\" & \"Loop Closure\"\n- **Chat-based Analyst Agent** implementation.\n- **Source Code Modification** capabilities (Agent -> PR).\n- Full \"Run -> Analyze -> Fix -> Re-run\" cycle automation.\n- *Value:* Drastically reduces the iteration time for agent improvement.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 33, "total_chunks": null}}
{"id": "f7f8f259-c2ab-487a-9c31-519038794d68", "content": "### Phase 5: Agent Ops\n- CI/CD pipelines.\n- Auto-deploy rules.\n- Production sampling.\n", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 34, "total_chunks": null}}
{"id": "42b3adfd-a45f-4181-836b-20a06132d48c", "content": "### Phase 6: Production Feedback Loop\n- Stream production telemetry (conversations, events) via SDK collectors.\n- Convert user feedback and behavioral signals into evaluator datasets.\n- Auto-promote fresh issues into regression suites and improvement tasks.\n- Maintain dashboards comparing production quality vs. lab tests.", "metadata": {"source": "docs/prd/web/web_version_plan.md", "chunk_index": 35, "total_chunks": null}}
{"id": "aa3a89d7-0178-4a55-b08e-71a48b70a0ef", "content": "# Subtree Release Workflow\n\nFluxLoop monorepo는 공개 OSS 패키지와 비공개 서비스 코드를 분리 배포하기 위해 `git subtree split`을 사용합니다. 이 문서는 릴리스 절차와 자동화 스크립트를 설명합니다.\n", "metadata": {"source": "docs/releases/subtree-workflow.md", "chunk_index": 0, "total_chunks": null}}
{"id": "d2438313-e48e-42ed-b8e6-8ae7079da3a9", "content": "## 1. 선행 조건\n\n- 원격 등록:\n  - `git remote add oss git@github.com:chuckgu/fluxloop.git`\n  - `git remote add svc git@github.com:chuckgu/fluxloop-service.git`\n- JSON 계약 문서 및 샘플 업데이트 (`docs/api/json-contract.md`)\n- 라이선스/README 업데이트 (`LICENSE`, `OSS_README.md`)\n", "metadata": {"source": "docs/releases/subtree-workflow.md", "chunk_index": 1, "total_chunks": null}}
{"id": "6c57b736-b7ad-4a7d-9874-17e8355a9379", "content": "## 2. 릴리스 단계\n\n1. 메인 브랜치에서 변경 사항 병합 및 테스트 통과 확인\n2. JSON 계약 버전 업데이트 시 태그 기록 (`schema_version`)\n3. `scripts/subtree-release.sh` 스크립트를 실행하여 split 및 push 수행\n\n```bash", "metadata": {"source": "docs/releases/subtree-workflow.md", "chunk_index": 2, "total_chunks": null}}
{"id": "aa54cf10-9c64-4b90-b7b8-058ddcdc5255", "content": "# OSS 패키지 릴리스 (packages/ → chuckgu/fluxloop)\nscripts/subtree-release.sh oss main\n", "metadata": {"source": "docs/releases/subtree-workflow.md", "chunk_index": 3, "total_chunks": null}}
{"id": "287e961c-7224-4907-a063-c925c9758580", "content": "# 서비스 코드 릴리스 (services/ → chuckgu/fluxloop-service)\nscripts/subtree-release.sh service main\n```\n\n4. 공개 저장소에서 PyPI/npm 배포 파이프라인 실행\n5. 서비스 저장소에서 배포(PaaS/K8s 등) 파이프라인 실행\n", "metadata": {"source": "docs/releases/subtree-workflow.md", "chunk_index": 4, "total_chunks": null}}
{"id": "be37dd4b-9ab5-48bc-ba81-f398b2de0c79", "content": "## 3. 주의 사항\n\n- `git subtree split`은 히스토리를 다시 계산하므로, 스크립트 실행 후 임시 브랜치를 삭제합니다 (`git branch -D`).\n- 원격 브랜치 네이밍 규칙을 맞춰야 합니다 (`main`, `release/*` 등).\n- 서비스 저장소는 비공개이므로 배포 파이프라인에서 비밀 관리(LLM 키 등)를 별도로 구성합니다.\n", "metadata": {"source": "docs/releases/subtree-workflow.md", "chunk_index": 5, "total_chunks": null}}
{"id": "6d981ef5-0fe8-4a9b-a77e-10a862a4a8da", "content": "## 4. 자동화 아이디어\n\n- GitHub Actions 워크플로에서 `subtree-release.sh` 호출\n- JSON 계약 변경 감지 시 자동으로 OSS 저장소 릴리스 생성\n- 서비스 저장소는 사내 CI에서 인증 토큰을 이용해 push 수행\n\n", "metadata": {"source": "docs/releases/subtree-workflow.md", "chunk_index": 6, "total_chunks": null}}
{"id": "42a4c5fb-cb2e-41db-9ead-e8288ef2785d", "content": "---\nsidebar_position: 6\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 0, "total_chunks": null}}
{"id": "d89b34c5-cd3c-4aa9-880d-783bc827e672", "content": "# config Command\n\nManage FluxLoop configuration settings.\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 1, "total_chunks": null}}
{"id": "2132af92-9be4-4e3c-b0d1-b442fdc5ed2d", "content": "## Overview\n\nThe `config` command provides utilities for viewing, updating, and validating FluxLoop configuration files. It supports both reading/writing YAML configs and managing environment variables.\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 2, "total_chunks": null}}
{"id": "f7acee13-c36f-40f4-af01-52cdc9bede71", "content": "## Subcommands\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 3, "total_chunks": null}}
{"id": "41712cf4-70c8-4424-a853-050af80e5a6f", "content": "### show\n\nDisplay configuration file contents.\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 4, "total_chunks": null}}
{"id": "53f3418b-7002-4ecd-ba98-f57428bbc7c4", "content": "# Show project configuration\nfluxloop config show --file configs/project.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 5, "total_chunks": null}}
{"id": "e4cb6635-43bb-4b4a-ad07-e4ad725cf737", "content": "# Show in JSON format\nfluxloop config show --file configs/simulation.yaml --format json\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 6, "total_chunks": null}}
{"id": "a29f64f8-fb06-4ec0-9803-695345035a2b", "content": "# Show with syntax highlighting and line numbers\nfluxloop config show\n```\n\n**Options:**\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--file`, `-f` | Configuration file to show | `configs/project.yaml` |\n| `--project` | Project name under FluxLoop root | Current directory |\n| `--root` | FluxLoop root directory | `./fluxloop` |\n| `--format` | Output format (`yaml` or `json`) | `yaml` |\n\n**Example:**\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 7, "total_chunks": null}}
{"id": "83bba51c-5a11-4e35-abea-4a76f03af7bf", "content": "# View simulation config\nfluxloop config show --file configs/simulation.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 8, "total_chunks": null}}
{"id": "acae59a3-1bfd-475b-8a2e-16fc5eb781b5", "content": "# View as JSON for parsing\nfluxloop config show --format json\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 9, "total_chunks": null}}
{"id": "c67029d6-53d6-4aa1-85b6-ab444360873c", "content": "### set\n\nUpdate a specific configuration value.\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 10, "total_chunks": null}}
{"id": "b5d2132d-f83e-423b-b2ca-472685ee377b", "content": "# Set a simple value\nfluxloop config set iterations 20\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 11, "total_chunks": null}}
{"id": "e90c2ace-7ae6-47d6-928e-e30e973c3b08", "content": "# Set nested value with dot notation\nfluxloop config set runner.timeout_seconds 300\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 12, "total_chunks": null}}
{"id": "041eeb92-59a4-4d51-b212-a046ba4de13d", "content": "# Set boolean value\nfluxloop config set multi_turn.enabled true\n```\n\n**Arguments:**\n\n| Argument | Description |\n|----------|-------------|\n| `key` | Configuration key to set (use dot notation for nested keys) |\n| `value` | Value to set (auto-detects type: int, float, bool, or string) |\n\n**Options:**\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--file`, `-f` | Configuration file to update | `configs/project.yaml` |\n| `--project` | Project name | Current |\n| `--root` | FluxLoop root directory | `./fluxloop` |", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 13, "total_chunks": null}}
{"id": "11043b77-2a2b-41f3-92ac-35ed74643bbe", "content": "\n**Type Detection:**\n\nThe command automatically detects value types:\n- **Integer**: `20`, `100`\n- **Float**: `0.5`, `3.14`\n- **Boolean**: `true`, `false` (case-insensitive)\n- **String**: Everything else\n\n**Examples:**\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 14, "total_chunks": null}}
{"id": "7b399909-b9fe-4777-8b19-9009e5bfdd30", "content": "# Update iteration count\nfluxloop config set iterations 50 --file configs/simulation.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 15, "total_chunks": null}}
{"id": "fbc6e3fe-ab94-43db-bed1-d3e477d4fc2c", "content": "# Set timeout in seconds\nfluxloop config set runner.timeout_seconds 180\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 16, "total_chunks": null}}
{"id": "19f656f5-20b8-45b8-8ef5-8067b9db2281", "content": "# Enable multi-turn mode\nfluxloop config set multi_turn.enabled true\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 17, "total_chunks": null}}
{"id": "c7c6704a-a216-4757-8e3b-99a867b89201", "content": "# Set temperature for variation\nfluxloop config set variation_temperature 0.9 --file configs/input.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 18, "total_chunks": null}}
{"id": "f1efab30-9049-42c8-b921-20fa70219d0a", "content": "# Set runner target\nfluxloop config set runner.target \"my_agent:run\"\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 19, "total_chunks": null}}
{"id": "5eef4db0-b329-4117-b28b-b395fcd2d581", "content": "### env\n\nDisplay environment variables used by FluxLoop.\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 20, "total_chunks": null}}
{"id": "f14704a1-37ce-4dd6-a3e8-ecda94d29b64", "content": "# Show environment variables (masks API keys)\nfluxloop config env\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 21, "total_chunks": null}}
{"id": "30f346c7-1895-47b5-8bc9-0159f4708fce", "content": "# Show all values including sensitive keys\nfluxloop config env --show-values\n```\n\n**Options:**\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--show-values`, `-s` | Show actual values (including secrets) | `false` |\n| `--project` | Project name | Current |\n| `--root` | FluxLoop root directory | `./fluxloop` |\n\n**Environment Variables Shown:**\n\n| Variable | Description | Default |\n|----------|-------------|---------|\n| `FLUXLOOP_COLLECTOR_URL` | Collector service URL | `http://localhost:8000` |", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 22, "total_chunks": null}}
{"id": "882930b0-9aca-44da-937c-3705e3217010", "content": "| `FLUXLOOP_API_KEY` | API key for authentication | None |\n| `FLUXLOOP_ENABLED` | Enable/disable tracing | `true` |\n| `FLUXLOOP_DEBUG` | Enable debug mode | `false` |\n| `FLUXLOOP_SAMPLE_RATE` | Trace sampling rate (0-1) | `1.0` |\n| `FLUXLOOP_SERVICE_NAME` | Service name for traces | None |\n| `FLUXLOOP_ENVIRONMENT` | Environment (dev/staging/prod) | `development` |\n| `OPENAI_API_KEY` | OpenAI API key | None |\n| `ANTHROPIC_API_KEY` | Anthropic API key | None |\n\n**Output:**\n\n```\n╭─ FluxLoop Environment Variables ──────────────────────────────────╮", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 23, "total_chunks": null}}
{"id": "b3d76340-66d3-4b4a-8dba-9a251e2be642", "content": "│ Variable                  Description             Current Value   │\n│ FLUXLOOP_COLLECTOR_URL    Collector service URL   Not set        │\n│ FLUXLOOP_ENABLED          Enable/disable tracing  true           │\n│ OPENAI_API_KEY            OpenAI API key          ****abc123     │\n╰────────────────────────────────────────────────────────────────────╯\n\nLoaded from: /path/to/.env\n```\n\n**Notes:**\n- API keys are masked by default (shows last 4 characters)\n- Use `--show-values` to see full keys (be careful with logs!)\n- Environment files are merged: root `.env` → project `.env`", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 24, "total_chunks": null}}
{"id": "12bf25b2-98e0-43eb-b6f2-8e5044e871c6", "content": "\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 25, "total_chunks": null}}
{"id": "25b599c3-6ca7-4417-8c07-6acffd30f18a", "content": "### set-llm\n\nConfigure LLM provider credentials and defaults.\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 26, "total_chunks": null}}
{"id": "56471e9e-2eb3-44ca-bff3-30818f0fc96e", "content": "# Set OpenAI as LLM provider\nfluxloop config set-llm openai sk-xxxxx\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 27, "total_chunks": null}}
{"id": "822dc13d-3820-472d-ba70-efe94f2389f7", "content": "# Set OpenAI with specific model\nfluxloop config set-llm openai sk-xxxxx --model gpt-4o\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 28, "total_chunks": null}}
{"id": "744da641-c48d-4fef-abed-ac00d5c690bd", "content": "# Set Anthropic provider\nfluxloop config set-llm anthropic sk-ant-xxxxx --model claude-3-5-sonnet-20241022\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 29, "total_chunks": null}}
{"id": "7ca5ca4e-acc1-4f3a-8e1f-8de2cee55cc3", "content": "# Overwrite existing API key\nfluxloop config set-llm openai sk-newkey --overwrite-env\n```\n\n**Arguments:**\n\n| Argument | Description |\n|----------|-------------|\n| `provider` | LLM provider (`openai`, `anthropic`, `gemini`) |\n| `api_key` | API key or token for the provider |\n\n**Options:**\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--model`, `-m` | Default model to use | Provider default |\n| `--overwrite-env` | Overwrite existing key in .env | `false` |\n| `--file`, `-f` | Config file to update | `configs/input.yaml` |", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 30, "total_chunks": null}}
{"id": "12651268-91a6-4228-a3c7-d2a72923080d", "content": "| `--env-file` | Path to environment file | `.env` |\n| `--project` | Project name | Current |\n| `--root` | FluxLoop root directory | `./fluxloop` |\n\n**Supported Providers:**\n\n| Provider | Environment Variable | Default Model |\n|----------|---------------------|---------------|\n| `openai` | `OPENAI_API_KEY` | `gpt-5` |\n| `anthropic` | `ANTHROPIC_API_KEY` | `claude-3-haiku-20240307` |\n| `gemini` | `GEMINI_API_KEY` | `gemini-2.5-flash` |\n\n**What This Command Does:**\n\n1. **Saves API key to `.env`:**\n   ```bash\n   OPENAI_API_KEY=sk-xxxxx", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 31, "total_chunks": null}}
{"id": "6c954cde-cfa3-4094-9b70-b24972ca4718", "content": "   ```\n\n2. **Updates `configs/input.yaml`:**\n   ```yaml\n   input_generation:\n     llm:\n       enabled: true\n       provider: openai\n       model: gpt-4o\n       api_key: null  # References OPENAI_API_KEY from .env\n   ```\n\n**Examples:**\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 32, "total_chunks": null}}
{"id": "c1d7c732-a3b7-432d-b4c3-ff852f4060fd", "content": "# Quick setup for OpenAI\nfluxloop config set-llm openai sk-proj-abc123\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 33, "total_chunks": null}}
{"id": "17ba250b-4e33-4265-8e34-4a7e5e34a02b", "content": "# Use specific Anthropic model\nfluxloop config set-llm anthropic sk-ant-xyz789 \\\n  --model claude-3-5-sonnet-20241022\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 34, "total_chunks": null}}
{"id": "570d5eaf-15c4-4e36-adca-04771d043f47", "content": "# Update existing key\nfluxloop config set-llm openai sk-new-key --overwrite-env\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 35, "total_chunks": null}}
{"id": "f82a448c-1339-4a9f-b26f-671a6bcee763", "content": "# Set for specific project\nfluxloop config set-llm openai sk-key --project my-agent\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 36, "total_chunks": null}}
{"id": "bf3608a2-6df5-40e8-8216-b770b3041233", "content": "### validate\n\nValidate configuration file structure and values.\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 37, "total_chunks": null}}
{"id": "0beea0fc-7eed-4f96-8f3f-885798257897", "content": "# Validate default project config\nfluxloop config validate\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 38, "total_chunks": null}}
{"id": "b8bcae15-9325-466e-8f98-d1d8a192ebc2", "content": "# Validate specific config file\nfluxloop config validate --file configs/simulation.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 39, "total_chunks": null}}
{"id": "d1fc5134-7504-4871-8040-6e835965db51", "content": "# Validate for specific project\nfluxloop config validate --project my-agent\n```\n\n**Options:**\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--file`, `-f` | Configuration file to validate | `configs/project.yaml` |\n| `--project` | Project name | Current |\n| `--root` | FluxLoop root directory | `./fluxloop` |\n\n**What Gets Validated:**\n\n- YAML syntax correctness\n- Required fields present\n- Field types match schema\n- Runner configuration valid\n- Persona definitions valid\n- Evaluator configurations valid", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 40, "total_chunks": null}}
{"id": "eb0f2135-42ba-4fa2-8bea-0b8736fb63bc", "content": "\n**Success Output:**\n\n```\n✓ Configuration is valid!\n\n╭──────────────────────────────────────╮\n│ Property      │ Value                │\n│ Experiment    │ my_agent_experiment  │\n│ Iterations    │ 10                   │\n│ Personas      │ 2                    │\n│ Variations    │ 5                    │\n│ Total Runs    │ 100                  │\n│ Runner Module │ examples.simple_agent│\n│ Evaluators    │ 3                    │\n╰──────────────────────────────────────╯\n```\n\n**Error Output:**\n\n```\n✗ Validation failed: Missing required field: runner.module_path", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 41, "total_chunks": null}}
{"id": "ccd57747-4220-42a0-841e-05f70893a13b", "content": "```\n\n**Common Validation Errors:**\n\n| Error | Cause | Solution |\n|-------|-------|----------|\n| Missing required field | Config missing mandatory key | Add the required field |\n| Invalid YAML syntax | Malformed YAML | Check indentation and quotes |\n| Type mismatch | Wrong value type | Use correct type (int, str, etc.) |\n| Runner module not found | Module path incorrect | Verify module exists |\n| Invalid persona | Malformed persona definition | Check persona structure |\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 42, "total_chunks": null}}
{"id": "8c6b87d8-0e78-49ac-95a0-63c153b67ec3", "content": "## Common Workflows\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 43, "total_chunks": null}}
{"id": "dfe3792c-1a3b-4911-a10c-761e4f19b367", "content": "### Initial Setup\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 44, "total_chunks": null}}
{"id": "b684748b-da04-4cdf-b6c0-46d3eb0522b6", "content": "# 1. Initialize project\nfluxloop init project --name my-agent\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 45, "total_chunks": null}}
{"id": "b333aa55-fe2a-4ddc-b085-177b40b56a5e", "content": "# 2. Set LLM provider\nfluxloop config set-llm openai sk-xxxxx --model gpt-4o\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 46, "total_chunks": null}}
{"id": "775796af-a4ef-4954-b0aa-ac935fb1aee9", "content": "# 3. Validate configuration\nfluxloop config validate\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 47, "total_chunks": null}}
{"id": "ad632c34-2c6b-4110-b39c-074ae3a1d328", "content": "# 4. Check environment\nfluxloop config env\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 48, "total_chunks": null}}
{"id": "de67fd66-5c11-4314-b1a9-52a547fd6175", "content": "### Tuning Experiment Settings\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 49, "total_chunks": null}}
{"id": "18410266-acc3-4784-a64b-822d68af70ae", "content": "# Increase iterations for more samples\nfluxloop config set iterations 50 --file configs/simulation.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 50, "total_chunks": null}}
{"id": "18847d7e-5c86-4ccf-89dd-ad580eab42a3", "content": "# Adjust variation temperature\nfluxloop config set variation_temperature 0.8 --file configs/input.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 51, "total_chunks": null}}
{"id": "8219118e-2764-4702-aad8-78513c44d2dc", "content": "# Enable multi-turn mode\nfluxloop config set multi_turn.enabled true --file configs/simulation.yaml\nfluxloop config set multi_turn.max_turns 10 --file configs/simulation.yaml\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 52, "total_chunks": null}}
{"id": "7bd6d65b-d7bb-4ca6-9341-761233a61451", "content": "### Switching LLM Providers\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 53, "total_chunks": null}}
{"id": "3d0177dc-100e-4e3b-8394-b20ac5082faa", "content": "# Switch from OpenAI to Anthropic\nfluxloop config set-llm anthropic sk-ant-xxxxx \\\n  --model claude-3-5-sonnet-20241022 \\\n  --overwrite-env\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 54, "total_chunks": null}}
{"id": "3909b456-fd5b-4f42-bf22-915fb202bb2e", "content": "### Verifying Configuration Before Running\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 55, "total_chunks": null}}
{"id": "1fc72fb5-1e3b-4992-93ff-f17d535485c1", "content": "# Full validation check\nfluxloop config validate --file configs/simulation.yaml\nfluxloop config validate --file configs/input.yaml\nfluxloop config validate --file configs/evaluation.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 56, "total_chunks": null}}
{"id": "43bb90ee-23bb-4cf0-bf27-0f21b7e6d28e", "content": "# Check environment setup\nfluxloop config env\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 57, "total_chunks": null}}
{"id": "9461f9ca-7c72-46a2-a174-6bc583e9a451", "content": "# Or use doctor command for complete diagnostics\nfluxloop doctor\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 58, "total_chunks": null}}
{"id": "e60308d4-1dc4-426e-b0b2-e456fa09131b", "content": "## Configuration File Locations\n\nDefault configuration structure:\n\n```\nfluxloop/my-agent/\n├── configs/\n│   ├── project.yaml       # Project metadata\n│   ├── input.yaml         # Personas and input generation\n│   ├── simulation.yaml    # Runner and experiment settings\n│   └── evaluation.yaml    # Evaluators and success criteria\n├── .env                   # Environment variables (gitignored)\n├── inputs/\n│   └── generated.yaml\n├── recordings/\n└── experiments/\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 59, "total_chunks": null}}
{"id": "7d4a5cc4-0ae5-4061-b32b-b3527d6cfc9a", "content": "## Tips\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 60, "total_chunks": null}}
{"id": "30e34b7a-f145-4e55-a32c-33f7c2ab3f53", "content": "### Dot Notation for Nested Keys\n\nUse dot notation to set deeply nested values:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 61, "total_chunks": null}}
{"id": "275041c9-44e1-4fa6-9703-0c12f9fe696f", "content": "# Set nested runner config\nfluxloop config set runner.timeout_seconds 300\nfluxloop config set runner.max_retries 5\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 62, "total_chunks": null}}
{"id": "e184e7a2-5601-47eb-b958-2f189f55b939", "content": "# Set multi-turn supervisor settings\nfluxloop config set multi_turn.supervisor.model gpt-4o\nfluxloop config set multi_turn.supervisor.provider openai\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 63, "total_chunks": null}}
{"id": "cc348b90-3036-47d0-82c8-e2a94079101d", "content": "### Viewing Before Modifying\n\nAlways check current values before changing:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 64, "total_chunks": null}}
{"id": "40f524e7-4440-430e-92be-ff902f30043e", "content": "# Show current config\nfluxloop config show --file configs/simulation.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 65, "total_chunks": null}}
{"id": "a9308441-c704-41b5-9371-6e6d3756413f", "content": "# Make change\nfluxloop config set iterations 20 --file configs/simulation.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 66, "total_chunks": null}}
{"id": "95d3f33c-a6db-4a01-8572-066bdb606607", "content": "# Verify change\nfluxloop config show --file configs/simulation.yaml\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 67, "total_chunks": null}}
{"id": "2efeda64-6099-4912-89c9-66c70e6913d0", "content": "### Project-Specific vs Global\n\nUse `--project` flag to manage multiple projects:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 68, "total_chunks": null}}
{"id": "adbd1adc-5681-4218-a505-dbcd3f09d09d", "content": "# Set config for specific project\nfluxloop config set iterations 100 --project production-agent\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 69, "total_chunks": null}}
{"id": "af121b48-0f96-49c3-962a-dc4873c64c62", "content": "# Different config for dev project\nfluxloop config set iterations 10 --project dev-agent\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 70, "total_chunks": null}}
{"id": "22a388d7-7036-4350-8e81-695f3506dca4", "content": "## See Also\n\n- [Project Configuration](/cli/configuration/project-config) - Detailed config reference\n- [Input Configuration](/cli/configuration/input-config) - Persona and input settings\n- [Simulation Configuration](/cli/configuration/simulation-config) - Runner and experiment settings\n- [Evaluation Configuration](/cli/configuration/evaluation-config) - Evaluator configuration\n- [doctor Command](/cli/commands/doctor) - Environment diagnostics\n- [status Command](/cli/commands/status) - System status checks", "metadata": {"source": "packages/website/docs-cli/commands/config.md", "chunk_index": 71, "total_chunks": null}}
{"id": "07e6dc31-8fff-43aa-bdd9-766541348ecf", "content": "---\nsidebar_position: 9\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 0, "total_chunks": null}}
{"id": "6a2d8080-dab3-48f3-91b1-62d826c18b89", "content": "# doctor Command\n\nDiagnose FluxLoop environment setup and detect common configuration issues.\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 1, "total_chunks": null}}
{"id": "4593582c-be16-42b6-9a2a-77073171eb90", "content": "## Overview\n\nThe `doctor` command performs a comprehensive health check of your FluxLoop installation, including:\n\n- **Python Environment**: Version, virtual environment detection, and executable path\n- **FluxLoop CLI**: Installation status and version\n- **FluxLoop MCP**: Installation status and availability\n- **MCP Index**: Knowledge base presence and integrity\n- **Project Configuration**: Config directory structure and files\n\nThis command is essential for troubleshooting installation issues and verifying that all FluxLoop components are correctly set up.", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 2, "total_chunks": null}}
{"id": "649953bc-c374-4b96-acd6-ecbff338f064", "content": "## Basic Usage\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 4, "total_chunks": null}}
{"id": "f32d8270-f338-43cf-ac83-42701904a9b3", "content": "# Run diagnostics for current environment\nfluxloop doctor\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 5, "total_chunks": null}}
{"id": "ca340b6c-9793-4867-aa97-5580adc028e4", "content": "# Specify a project\nfluxloop doctor --project my-agent\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 6, "total_chunks": null}}
{"id": "07e8b1bd-bb4b-4eee-8ce3-aa355b7d80ae", "content": "# Output as JSON for programmatic parsing\nfluxloop doctor --json\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 7, "total_chunks": null}}
{"id": "5df766a6-75b5-486a-b760-182b598506e4", "content": "## Command Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--project`, `-p` | Project name under the FluxLoop root directory | None (uses current) |\n| `--root` | FluxLoop root directory | `./fluxloop` |\n| `--index-dir` | Override FluxLoop MCP index directory | `~/.fluxloop/mcp/index/dev` |\n| `--json` | Output diagnostic information as JSON | `false` |\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 8, "total_chunks": null}}
{"id": "ca0a29c0-b6a4-440d-a6f4-4ce1a868b9fd", "content": "## What Gets Checked\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 9, "total_chunks": null}}
{"id": "d34d8ac4-b8e4-403c-9998-58e9dc53a96c", "content": "### 1. Python Environment\n\nVerifies:\n- Python executable path\n- Python version (requires 3.11+ for SDK/MCP, 3.8+ for CLI)\n- Platform information\n- Virtual environment detection (venv, conda, uv)\n\n**Environment Variables Checked:**\n- `VIRTUAL_ENV`\n- `CONDA_PREFIX`\n- `UV_PROJECT_ENV`\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 10, "total_chunks": null}}
{"id": "388e6edc-f8a3-4b0b-a93e-410bb49e5f70", "content": "### 2. FluxLoop CLI\n\nChecks:\n- `fluxloop` command availability on PATH\n- CLI version\n- Installation location\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 11, "total_chunks": null}}
{"id": "85085689-cd51-4b1c-84ee-a03c8801195d", "content": "### 3. FluxLoop MCP Server\n\nChecks:\n- `fluxloop-mcp` command availability\n- MCP server installation\n- Help output accessibility\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 12, "total_chunks": null}}
{"id": "cc4249c2-9f94-4ac6-984c-6ca4ee7349f2", "content": "### 4. MCP Knowledge Index\n\nVerifies:\n- Index directory existence\n- `chunks.jsonl` presence and size\n- Default location: `~/.fluxloop/mcp/index/dev`\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 13, "total_chunks": null}}
{"id": "96833ac9-8127-4796-b498-f5f0140ad41d", "content": "### 5. Project Configuration\n\nValidates:\n- Project root directory\n- `configs/` directory structure\n- `configs/project.yaml` existence\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 14, "total_chunks": null}}
{"id": "daee9b96-8de0-4e56-bebc-6d0d4cbacc01", "content": "## Output Examples\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 15, "total_chunks": null}}
{"id": "19fbca5a-4734-4ce4-9404-3bafb42a995f", "content": "### Successful Diagnosis\n\n```\n╭──────────────────────────────────╮\n│ FluxLoop Environment Doctor      │\n╰──────────────────────────────────╯\n\nComponent       Status  Details\nPython          ✓       3.11.5 (/Users/user/.venv/bin/python)\nVirtual Env     ✓       /Users/user/project/.venv\nFluxLoop CLI    ✓       /Users/user/.venv/bin/fluxloop\nFluxLoop MCP    ✓       /Users/user/.venv/bin/fluxloop-mcp\nMCP Index       ✓       ~/.fluxloop/mcp/index/dev • chunks.jsonl (1.2M bytes)\nProject Config  ✓       fluxloop/my-agent/configs/project.yaml", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 16, "total_chunks": null}}
{"id": "be5b7188-d978-4997-96dc-594e9a12f255", "content": "\n╭─ fluxloop --version ──────────────╮\n│ FluxLoop CLI v0.2.30              │\n╰───────────────────────────────────╯\n\n╭──────────────────╮\n│ Doctor completed │\n╰──────────────────╯\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 17, "total_chunks": null}}
{"id": "3a2861c3-0b9c-4994-822c-ecc86384edd0", "content": "### Issues Detected\n\n```\n╭──────────────────────────────────╮\n│ FluxLoop Environment Doctor      │\n╰──────────────────────────────────╯\n\nComponent       Status  Details\nPython          ✓       3.11.5 (/usr/bin/python3)\nVirtual Env     –       Global interpreter\nFluxLoop CLI    ✓       /usr/local/bin/fluxloop\nFluxLoop MCP    ✗       Not found\nMCP Index       –       ~/.fluxloop/mcp/index/dev\nProject Config  –       Run: fluxloop init project\n\nErrors\n• fluxloop-mcp: fluxloop-mcp not found on PATH\n\n╭──────────────────╮\n│ Doctor completed │", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 18, "total_chunks": null}}
{"id": "84a74ef6-e169-437a-a8b8-a909f1cd5f0a", "content": "╰──────────────────╯\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 19, "total_chunks": null}}
{"id": "be1a3204-b7e9-46a4-9e45-a268f71259cc", "content": "## JSON Output\n\nUse `--json` flag for machine-readable output:\n\n```bash\nfluxloop doctor --json\n```\n\n```json\n{\n  \"python\": {\n    \"executable\": \"/Users/user/.venv/bin/python\",\n    \"version\": \"3.11.5\",\n    \"platform\": \"macOS-14.0-arm64\",\n    \"command_output\": \"Python 3.11.5\"\n  },\n  \"virtual_environment\": {\n    \"python_executable\": \"/Users/user/.venv/bin/python\",\n    \"python_version\": \"3.11.5\",\n    \"platform\": \"macOS-14.0-arm64\",\n    \"virtual_env\": true,\n    \"virtual_env_path\": \"/Users/user/project/.venv\",\n    \"environment_variables\": {", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 20, "total_chunks": null}}
{"id": "c4377f6b-d9d6-4f73-b86b-065e4a548301", "content": "      \"VIRTUAL_ENV\": \"/Users/user/project/.venv\"\n    }\n  },\n  \"fluxloop_cli\": {\n    \"success\": true,\n    \"path\": \"/Users/user/.venv/bin/fluxloop\",\n    \"output\": \"FluxLoop CLI v0.2.30\",\n    \"error\": null\n  },\n  \"fluxloop_mcp\": {\n    \"success\": true,\n    \"path\": \"/Users/user/.venv/bin/fluxloop-mcp\",\n    \"output\": \"Usage: fluxloop-mcp [OPTIONS]\",\n    \"error\": null\n  },\n  \"project\": {\n    \"root\": \"/Users/user/project/fluxloop\",\n    \"config_directory\": \"/Users/user/project/fluxloop/my-agent/configs\",\n    \"project_yaml\": \"/Users/user/project/fluxloop/my-agent/configs/project.yaml\",", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 21, "total_chunks": null}}
{"id": "dcf1e4cb-1d1a-459b-8843-fb452910e4f6", "content": "    \"project_yaml_exists\": true,\n    \"config_directory_exists\": true\n  },\n  \"mcp_index\": {\n    \"exists\": true,\n    \"path\": \"/Users/user/.fluxloop/mcp/index/dev\",\n    \"chunks_exists\": true,\n    \"chunks_size\": 1245678\n  }\n}\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 22, "total_chunks": null}}
{"id": "424f2470-2346-479a-99b2-d3f2112c5006", "content": "## Common Issues and Solutions\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 23, "total_chunks": null}}
{"id": "6393bd32-10d0-44ba-8158-534a9988b688", "content": "### Issue: FluxLoop CLI Not Found\n\n**Symptom:**\n```\nFluxLoop CLI    ✗       fluxloop not found on PATH\n```\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 24, "total_chunks": null}}
{"id": "088c3cd3-1605-4e69-9b76-a9533e2fe075", "content": "# Install in active virtual environment\npip install fluxloop-cli\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 25, "total_chunks": null}}
{"id": "3b334677-03ce-47a3-97c6-ea67057f0c92", "content": "# Or install globally\npip install --user fluxloop-cli\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 26, "total_chunks": null}}
{"id": "486af22a-30d1-4987-9a15-a32f7a77a43e", "content": "# Or with uv\nuv pip install fluxloop-cli\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 27, "total_chunks": null}}
{"id": "c78a4cf4-a84a-4400-9ae5-35e3b90721b1", "content": "### Issue: FluxLoop MCP Not Found\n\n**Symptom:**\n```\nFluxLoop MCP    ✗       Not found\n```\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 28, "total_chunks": null}}
{"id": "68c42924-8736-4786-ad30-4246583681bd", "content": "# Install in active virtual environment\npip install fluxloop-mcp\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 29, "total_chunks": null}}
{"id": "571ed27c-e0b3-4c5f-bcbf-e537813755aa", "content": "# Rebuild the knowledge index\npackages/mcp/scripts/rebuild_index.sh\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 30, "total_chunks": null}}
{"id": "ed9e4c79-c775-4168-b81b-85b8a5c130d1", "content": "### Issue: Missing MCP Index\n\n**Symptom:**\n```\nMCP Index       –       ~/.fluxloop/mcp/index/dev\n```\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 31, "total_chunks": null}}
{"id": "ddb3f9b1-0c44-4e56-906a-279ae2121555", "content": "# Build the index manually\nfluxloop-mcp rebuild-index\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 32, "total_chunks": null}}
{"id": "d287e77f-9eae-4f38-8e66-47078c79550f", "content": "# Or run the build script from source\npackages/mcp/scripts/rebuild_index.sh\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 33, "total_chunks": null}}
{"id": "cf6ba277-2948-45b7-82b8-088e61db0dee", "content": "### Issue: No Virtual Environment\n\n**Symptom:**\n```\nVirtual Env     –       Global interpreter\n```\n\n**Recommendation:**\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 34, "total_chunks": null}}
{"id": "21e204f1-0a80-487e-8983-f6c38a03c076", "content": "# Create a virtual environment (recommended)\npython -m venv .venv\nsource .venv/bin/activate  # Windows: .venv\\Scripts\\activate\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 35, "total_chunks": null}}
{"id": "e8ebfe9d-a14a-4b4a-8ab0-6ecbac30e1aa", "content": "# Reinstall FluxLoop packages\npip install fluxloop-cli fluxloop fluxloop-mcp\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 36, "total_chunks": null}}
{"id": "b364e4d4-078d-41f9-9161-6c2a259fc171", "content": "### Issue: Missing Project Configuration\n\n**Symptom:**\n```\nProject Config  –       Run: fluxloop init project\n```\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 37, "total_chunks": null}}
{"id": "b9b4cdec-2872-4c54-85b5-1b64021370b2", "content": "# Initialize a new project\nfluxloop init project --name my-agent\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 38, "total_chunks": null}}
{"id": "462a82f9-e5e0-4a24-83f0-48608ce7ef6f", "content": "## Integration with VSCode Extension\n\nThe VSCode extension uses `fluxloop doctor` internally to:\n\n- Validate environment on startup\n- Display status in the Integration view\n- Provide actionable feedback when packages are missing\n\nYou can also run doctor from Command Palette:\n```\nFluxLoop: Run Doctor\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 39, "total_chunks": null}}
{"id": "5d6f2de3-8cd4-4da6-9f0a-d78141ac59f3", "content": "## When to Use Doctor\n\nRun `fluxloop doctor` in these scenarios:\n\n1. **After Fresh Installation**: Verify all components are correctly installed\n2. **Before Starting a Project**: Check that your environment is ready\n3. **Troubleshooting**: Diagnose why commands aren't working\n4. **CI/CD Setup**: Validate build environment configuration\n5. **Version Upgrades**: Confirm new versions are properly detected\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 40, "total_chunks": null}}
{"id": "98419a88-eeb9-4576-a44d-79ca3cc6e1de", "content": "## Exit Codes\n\n| Exit Code | Meaning |\n|-----------|---------|\n| 0 | Diagnostics completed successfully (doesn't mean all checks passed) |\n| 1 | Invalid arguments or runtime error |\n\nNote: `doctor` always exits with 0 if it completes the diagnostic scan, even if some components are missing. Check the output or JSON for actual status.\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 41, "total_chunks": null}}
{"id": "490bed3c-c645-4483-bfa6-35fb89aaf651", "content": "## See Also\n\n- [Installation Guide](/cli/getting-started/installation) - Initial setup\n- [status Command](/cli/commands/status) - Check experiment and recording status\n- [VSCode Environment Configuration](/vscode/getting-started/environment-configuration) - IDE-specific setup\n\n", "metadata": {"source": "packages/website/docs-cli/commands/doctor.md", "chunk_index": 42, "total_chunks": null}}
{"id": "6524e034-c14a-45a8-a8da-9fd606b865c2", "content": "---\nsidebar_position: 5\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 0, "total_chunks": null}}
{"id": "a6b302ed-24f5-4aa7-9110-2ce3f9a05d82", "content": "# evaluate Command\n\n`fluxloop evaluate experiment` 소비자는 파싱된 트레이스를 종합해서 **단일 HTML 대시보드**로 만들어 줍니다. 내부적으로 다음 다섯 단계를 자동으로 실행합니다:\n\n1. **LLM-PT (Per-Trace)** – GPT-5가 각 트레이스를 7개 메트릭(완수, 환각, 관련성, 도구 사용, 만족도, 명확성, 페르소나)으로 채점하고 이슈 타임라인/퀵픽스를 작성합니다.\n2. **Rule Aggregation** – 통계/패스율/성능 카드/페르소나 격차를 계산하고 FAIL・PARTIAL・REVIEW 케이스를 분류합니다.\n3. **LLM-OV (Overall)** – 집계 데이터를 다시 GPT-5에 전달하여 임원 요약, Response Quality 관찰, 우선순위 권장사항을 생성합니다.\n4. **Data Preparation** – `configs/project.yaml`, `configs/input.yaml`, `configs/evaluation.yaml`, `summary.json` 등을 하나의 페이로드로 합칩니다.", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 1, "total_chunks": null}}
{"id": "6eddd732-b975-4380-957c-6660020265d0", "content": "5. **HTML Rendering** – `evaluation_report/report.html` (기본값)을 생성합니다. 이 파일 하나만 브라우저로 열면 모든 지표를 볼 수 있습니다.\n\n> `fluxloop evaluate` 를 실행하기 전에 **반드시** `fluxloop parse experiment <experiment_dir>` 로 `per_trace_analysis/per_trace.jsonl`을 만들어 두세요. 파일을 옮겼다면 `--per-trace` 로 경로를 지정하십시오.\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 2, "total_chunks": null}}
{"id": "7117725e-5b91-4f72-822b-fe6aadf88ada", "content": "## Prerequisites\n\n1. `fluxloop run experiment`\n2. `fluxloop parse experiment <experiment_dir>`\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 3, "total_chunks": null}}
{"id": "4bdab336-a6e7-4695-8c90-eb3a526765f7", "content": "## Basic Usage\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 4, "total_chunks": null}}
{"id": "20a3b742-7893-4a1c-b2ee-d4e1206d3120", "content": "# Parse → Evaluate\nfluxloop parse experiment experiments/demo_run_20231215_123456\nfluxloop evaluate experiment experiments/demo_run_20231215_123456\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 5, "total_chunks": null}}
{"id": "037594d2-221f-4ccb-8d81-930a382f0f62", "content": "# 사용자 정의 evaluation.yaml 사용\nfluxloop evaluate experiment experiments/demo_run_20231215_123456 \\\n  --config configs/evaluation.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 6, "total_chunks": null}}
{"id": "f26d7670-00fe-4176-a68c-57605dfb0f63", "content": "# 출력 디렉터리 변경(기본값: evaluation_report)\nfluxloop evaluate experiment experiments/demo_run_20231215_123456 \\\n  --output dashboards/latest_eval \\\n  --overwrite\n```\n\n완료되면 다음과 같은 메시지가 출력됩니다.\n\n```\n📊 Evaluating experiment at experiments/demo_run_20231215_123456\n🧵 Per-trace data: …/per_trace_analysis/per_trace.jsonl\n📁 Output: …/evaluation_report\n…\n✅ Report ready: …/evaluation_report/report.html\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 7, "total_chunks": null}}
{"id": "ed9ebb38-c010-4d4d-a138-352a0d452b68", "content": "## Command Options\n\n| Option | Description | Default |\n| --- | --- | --- |\n| `experiment_dir` | 실험 디렉터리 경로 | 필수 |\n| `--config`, `-c` | `configs/evaluation.yaml` 위치 | `configs/evaluation.yaml` |\n| `--output`, `-o` | 대시보드를 생성할 디렉터리 | `evaluation_report` |\n| `--overwrite` | 기존 디렉터리를 삭제 후 재생성 | `false` |\n| `--llm-api-key` | GPT-5 호출에 사용할 API Key | `FLUXLOOP_LLM_API_KEY` 또는 `OPENAI_API_KEY` |\n| `--per-trace` | `per_trace_analysis/per_trace.jsonl` 경로 | 자동 감지 |\n| `--verbose` | 단계별 로그를 자세히 출력 | `false` |\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 8, "total_chunks": null}}
{"id": "49592c6a-4cfb-4c26-8767-fab051941db7", "content": "## Pipeline Output\n\n```\nexperiments/<run>/\n└── evaluation_report/\n    └── report.html\n```\n\n`report.html`에는 다음 섹션이 들어 있습니다.\n\n- Executive Summary + Pass Rate 게이지\n- Trace × Metric 매트릭스\n- 실패/마진/리뷰 케이스 타임라인 및 이슈 요약\n- 토큰/턴/지연시간 카드 + 이상치 목록 + 페르소나 격차 시각화\n- LLM-OV가 작성한 Response Quality 관찰, 패턴, Quick Wins, 추천조치\n\n별도의 정적 파일이 없으므로 `report.html` 하나만 공유하면 됩니다.\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 9, "total_chunks": null}}
{"id": "c625313a-6cd6-479a-a79c-0d46ea5cf212", "content": "## Configuration Highlights (`configs/evaluation.yaml`)\n\nCLI 0.2.30부터는 **메트릭 기반 스키마**를 사용합니다. 템플릿 예시는 다음과 같습니다.\n\n```yaml\nevaluation_goal: \"안전하게 취소/환불을 완료하는지 검증\"\n\nmetrics:\n  task_completion:\n      enabled: true\n    thresholds: {good: 80, fair: 60}\n  hallucination:\n    enabled: true\n    thresholds: {good: 5, fair: 15}\n  relevance:\n    enabled: true\n    thresholds: {good: 90, fair: 80}\n  tool_usage_appropriateness:\n    enabled: true\n    thresholds: {good: 90, fair: 80}\n  user_satisfaction:\n    enabled: true\n    thresholds: {good: 70, fair: 50}", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 10, "total_chunks": null}}
{"id": "04baff5d-dd4a-4278-a0c9-ca2f3f928178", "content": "  clarity:\n    enabled: true\n    thresholds: {good: 90, fair: 80}\n  persona_consistency:\n    enabled: true\n    thresholds: {good: 85, fair: 70}\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 11, "total_chunks": null}}
{"id": "b4e4b558-1763-4406-b7df-6b1fbe672fd9", "content": "# 효율성 카드 (토큰/턴/지연시간) 이상치 감지 방식\nefficiency:\n  output_tokens:\n    enabled: true\n    outlier_mode: statistical\n    std_multiplier: 2\n  conversation_depth:\n    enabled: true\n    outlier_mode: statistical\n  latency:\n    enabled: true\n    outlier_mode: statistical\n\nadvanced:\n  llm_judge:\n    model: \"gpt-5.1\"\n    temperature: 0.0\n```\n\n- `evaluation_goal` 은 리포트 상단과 LLM 프롬프트에 그대로 사용됩니다.\n- 각 `metrics.*.thresholds` 는 Pass/Fair/Poor 게이지 기준이자 LLM-OV 프롬프트에 포함됩니다.\n- `efficiency` 블록은 성능 카드의 이상치 감지 규칙을 지정합니다.\n- `advanced.llm_judge` 는 LLM-PT와 LLM-OV가 사용할 모델/파라미터입니다.", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 12, "total_chunks": null}}
{"id": "a0c499d4-0514-4d20-988c-5d4de44264b7", "content": "\n페르소나/변형 전략은 `configs/input.yaml` 에 정의되며, LLM-PT 시스템 프롬프트에 자동으로 주입됩니다.\n", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 13, "total_chunks": null}}
{"id": "325ffa9f-9f6d-4244-857a-f69a4e8b7b18", "content": "## Tips & Troubleshooting\n\n- `per_trace_analysis/per_trace.jsonl` 이 없으면 바로 종료합니다. 필요 시 `--per-trace` 로 절대경로를 넘기세요.\n- 반복 실행 시 `--overwrite` 를 추가하면 기존 `evaluation_report` 디렉터리를 삭제하고 새로 생성합니다.\n- `--output relative/path` 로 명시하면 실험 폴더 내부에 커스텀 대시보드를 여러 개 만들 수 있습니다 (예: `eval_model_a`, `eval_model_b`).\n- 보고서를 공유할 때는 `report.html` 파일만 전달하면 됩니다. 외부 CDN 요청이 없으므로 오프라인 뷰잉이 가능합니다.\n- 파이프라인 로그를 자세히 보고 싶을 때는 `--verbose` 로 실행하세요. Stage 1~5 진행 상황이 모두 출력됩니다.\n\n더 큰 워크플로우 예시는 [First Experiment Guide](/cli/getting-started/first-experiment) 와 [Basic Workflow](/cli/workflows/basic-workflow) 문서를 참고하세요.", "metadata": {"source": "packages/website/docs-cli/commands/evaluate.md", "chunk_index": 14, "total_chunks": null}}
{"id": "4b716d28-04f3-48b9-8d74-2af899c4ebd5", "content": "---\nsidebar_position: 2\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 0, "total_chunks": null}}
{"id": "b99fa3ca-f65d-4e27-83d1-341a1192facb", "content": "# generate Command\n\nGenerate input variations from base inputs using LLM or deterministic strategies.\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 1, "total_chunks": null}}
{"id": "fcaf82e8-1187-49b5-8703-1e648f6e8c40", "content": "## Usage\n\n```bash\nfluxloop generate inputs [OPTIONS]\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 2, "total_chunks": null}}
{"id": "94fb4fc8-2618-49e7-bdb1-e1e28283908c", "content": "## Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--limit` | Number of inputs to generate | 50 |\n| `--mode` | Generation mode: `llm` or `deterministic` | From config |\n| `--output` | Output file path | `inputs/generated.yaml` |\n| `--overwrite` | Overwrite existing file | `false` |\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 3, "total_chunks": null}}
{"id": "bad3556b-295b-4395-88c2-c3f6b67d9ff0", "content": "## Examples\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 4, "total_chunks": null}}
{"id": "bfeb585a-56fe-4753-84b6-b2cf388d27b3", "content": "### Basic Generation\n\nGenerate 50 inputs using LLM:\n\n```bash\nfluxloop generate inputs --limit 50\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 5, "total_chunks": null}}
{"id": "495158ad-fcc7-4319-a87f-99fc6ba7b4a5", "content": "### Deterministic Mode\n\nGenerate inputs without LLM:\n\n```bash\nfluxloop generate inputs --mode deterministic --limit 100\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 6, "total_chunks": null}}
{"id": "0df80cd3-39a6-47af-9969-b494f80cd16c", "content": "### Custom Output\n\nSave to custom location:\n\n```bash\nfluxloop generate inputs --output my-inputs.yaml --limit 30\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 7, "total_chunks": null}}
{"id": "7aa5948d-e9a4-4770-a513-1bcda85a04db", "content": "### Overwrite Existing\n\nReplace existing generated inputs:\n\n```bash\nfluxloop generate inputs --overwrite --limit 100\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 8, "total_chunks": null}}
{"id": "3e532d67-dfc2-449d-9df3-3f78c76ed537", "content": "## How It Works\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 9, "total_chunks": null}}
{"id": "af655f42-523b-4623-96bd-c8dd5860668e", "content": "### 1. Reads Configuration\n\nLoads personas and base inputs from `configs/input.yaml`:\n\n```yaml\npersonas:\n  - name: novice_user\n    description: New to the system\n\nbase_inputs:\n  - input: \"How do I start?\"\n    persona: novice_user\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 10, "total_chunks": null}}
{"id": "5cbe6027-9976-4a1d-a948-485469456549", "content": "### 2. Applies Generation Strategies\n\n**LLM Mode:**\n- Rephrase: Different wording, same meaning\n- Verbose: Longer, more detailed versions\n- Concise: Shorter, direct versions\n- Error-prone: Typos, grammar mistakes\n\n**Deterministic Mode:**\n- Pattern-based transformations\n- No LLM API calls required\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 11, "total_chunks": null}}
{"id": "bdb5bbfa-b39e-4aeb-8dc1-6683ac0b5570", "content": "### 3. Outputs Generated File\n\nCreates `inputs/generated.yaml`:\n\n```yaml\ngenerated_inputs:\n  - input: \"What are the steps to get started?\"\n    source: \"How do I start?\"\n    strategy: rephrase\n    persona: novice_user\n  \n  - input: \"how do i strt?\"\n    source: \"How do I start?\"\n    strategy: error_prone\n    persona: novice_user\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 12, "total_chunks": null}}
{"id": "15cffc6c-58c4-479f-8867-34017dc775b7", "content": "## Configuration\n\nSet LLM provider in `configs/input.yaml`:\n\n```yaml\ninput_generation:\n  mode: llm\n  llm:\n    provider: openai        # or anthropic\n    model: gpt-4o-mini\n    temperature: 0.7\n  strategies:\n    - rephrase\n    - verbose\n    - concise\n    - error_prone\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 13, "total_chunks": null}}
{"id": "3934b803-a508-4f9f-9008-f74648a4b9e5", "content": "## API Key Setup\n\nBefore generating with LLM:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 14, "total_chunks": null}}
{"id": "287468d0-2188-4116-a697-defa3225f49e", "content": "# Set API key\nfluxloop config set-llm openai sk-your-key --model gpt-4o-mini\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 15, "total_chunks": null}}
{"id": "e77f1e17-9ed3-490f-b5f3-9bfcfbbce0b5", "content": "# Or add to .env\necho \"OPENAI_API_KEY=sk-your-key\" >> .env\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 16, "total_chunks": null}}
{"id": "62a438fa-bfad-4207-ab14-ebed5f9997c3", "content": "## Best Practices\n\n1. **Start small**: Generate 10-20 inputs first to test\n2. **Review outputs**: Check quality before generating large batches\n3. **Mix strategies**: Use all strategies for diversity\n4. **Version control**: Commit generated inputs for reproducibility\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 17, "total_chunks": null}}
{"id": "b21aa7ce-9660-4216-ad4a-251f129fb3ad", "content": "## Troubleshooting\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 18, "total_chunks": null}}
{"id": "d5df1708-bb4b-40e2-a730-619b53306ca3", "content": "### \"No API key found\"\n\nSet your LLM provider API key:\n```bash\nfluxloop config set-llm openai sk-your-key\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 19, "total_chunks": null}}
{"id": "8f056816-3728-4c6c-8713-a5461caafe5e", "content": "### \"Generation failed\"\n\nCheck your internet connection and API key validity.\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 20, "total_chunks": null}}
{"id": "57b513c9-a9d1-45c3-8fed-6a8f8ca0f051", "content": "### \"File already exists\"\n\nUse `--overwrite` flag or delete existing file:\n```bash\nrm inputs/generated.yaml\nfluxloop generate inputs\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 21, "total_chunks": null}}
{"id": "b5da5a09-8cff-4c8a-9104-aff2a67388f3", "content": "## Next Steps\n\n- [Run Experiment](./run) - Run simulation with generated inputs\n- [Input Configuration](../configuration/input-config) - Configure generation settings", "metadata": {"source": "packages/website/docs-cli/commands/generate.md", "chunk_index": 22, "total_chunks": null}}
{"id": "40a52d60-1f0b-4938-92d3-3b9f67467bed", "content": "---\nsidebar_position: 1\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 0, "total_chunks": null}}
{"id": "2c42b899-c352-453f-89d3-c2cf71129770", "content": "# init Command\n\nInitialize FluxLoop projects, agents, and test templates.\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 1, "total_chunks": null}}
{"id": "4f2f8061-dc4a-49d8-a4fc-4d0bc5b5047d", "content": "## Subcommands\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 2, "total_chunks": null}}
{"id": "38448f02-95dc-4373-bb28-cd576e43e71a", "content": "### init project\n\nCreate a new FluxLoop project with complete configuration structure.\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 3, "total_chunks": null}}
{"id": "7a86467e-75ab-46e8-9f37-54486024b3e3", "content": "#### Usage\n\n```bash\nfluxloop init project [PATH] [OPTIONS]\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 4, "total_chunks": null}}
{"id": "cd05a1b2-63b6-4fad-afd7-1bba3f9e4ca6", "content": "#### Arguments\n\n| Argument | Description | Default |\n|----------|-------------|---------|\n| `path` | Root directory for FluxLoop projects | `./fluxloop` |\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 5, "total_chunks": null}}
{"id": "414378ca-16a3-43f2-8924-b9ba63c2460a", "content": "#### Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--name`, `-n` | Project name (required if not in project directory) | Current directory name |\n| `--with-example/--no-example` | Include example agent code | `true` |\n| `--force`, `-f` | Overwrite existing files without confirmation | `false` |\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 6, "total_chunks": null}}
{"id": "bd387226-518c-48dd-9875-68bae13494bd", "content": "#### Examples\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 7, "total_chunks": null}}
{"id": "81017f5d-8ba9-42d8-8d32-2e28c42ec913", "content": "# Create new project with default path\nfluxloop init project --name my-chatbot\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 8, "total_chunks": null}}
{"id": "9956001d-86ce-4f5f-a8ad-f8e5a475bfab", "content": "# Create in custom location\nfluxloop init project /path/to/projects --name my-agent\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 9, "total_chunks": null}}
{"id": "36981d69-d941-4245-9ad3-1385dc9cff44", "content": "# Skip example agent\nfluxloop init project --name my-agent --no-example\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 10, "total_chunks": null}}
{"id": "ef7dc1d1-db74-48de-9bd2-ee7517b7d080", "content": "# Force overwrite existing files\nfluxloop init project --name my-agent --force\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 11, "total_chunks": null}}
{"id": "35788a7d-6bc7-4ab3-abbb-8217b1116823", "content": "#### What Gets Created\n\n```\nfluxloop/my-chatbot/\n├── configs/\n│   ├── project.yaml       # Project metadata, collector settings\n│   ├── input.yaml         # Personas, base inputs, LLM settings\n│   ├── simulation.yaml    # Runner configuration, iterations\n│   └── evaluation.yaml    # Evaluators, success criteria\n├── .env                   # Environment variables (API keys)\n├── .gitignore            # Git ignore patterns\n├── recordings/           # Recorded arguments (for replay)\n└── examples/\n    └── simple_agent.py   # Sample instrumented agent", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 12, "total_chunks": null}}
{"id": "a9366f68-0900-4ce2-a52a-b997659b4fb5", "content": "```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 13, "total_chunks": null}}
{"id": "fd486037-d12d-4155-9e02-fc3bf8856f14", "content": "#### Configuration Files\n\nThe command creates four configuration files under `configs/`:\n\n1. **project.yaml**: Project metadata and collector settings\n2. **input.yaml**: Personas, base inputs, and input generation configuration\n3. **simulation.yaml**: Runner target, iterations, and multi-turn settings\n4. **evaluation.yaml**: Evaluator definitions and success criteria\n\nSee [Configuration Reference](/cli/configuration/project-config) for detailed schemas.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 14, "total_chunks": null}}
{"id": "23c5b876-2c97-4570-9fee-5138aa4a0b1f", "content": "### init pytest-template\n\nScaffold a pytest test file that uses FluxLoop's test fixtures.\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 15, "total_chunks": null}}
{"id": "550fb2f7-8cfd-47f4-b544-0cf0a4159607", "content": "#### Usage\n\n```bash\nfluxloop init pytest-template [PROJECT_ROOT] [OPTIONS]\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 16, "total_chunks": null}}
{"id": "8ccfd3e4-1ec9-45a1-a422-da024b5c372c", "content": "#### Arguments\n\n| Argument | Description | Default |\n|----------|-------------|---------|\n| `project_root` | Project root containing configs/ or setting.yaml | Current directory |\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 17, "total_chunks": null}}
{"id": "711aed25-44f4-4094-a450-3f1ef2269430", "content": "#### Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--tests-dir` | Directory for tests (relative to project root) | `tests` |\n| `--filename` | Test file name to create | `test_fluxloop_smoke.py` |\n| `--force` | Overwrite existing template without confirmation | `false` |\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 18, "total_chunks": null}}
{"id": "42284969-f899-4608-9238-a64cbb9b497e", "content": "#### Examples\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 19, "total_chunks": null}}
{"id": "18a12611-62ab-4a23-a50e-f4e9cea6e6a4", "content": "# Create test in default location (./tests/test_fluxloop_smoke.py)\nfluxloop init pytest-template\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 20, "total_chunks": null}}
{"id": "fd733416-f3dd-45b8-b9e9-4ea1ca9e3bed", "content": "# Custom test directory\nfluxloop init pytest-template --tests-dir integration_tests\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 21, "total_chunks": null}}
{"id": "66c3c50c-0168-411f-bc02-a6b5022684d5", "content": "# Custom filename\nfluxloop init pytest-template --filename test_agent_e2e.py\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 22, "total_chunks": null}}
{"id": "f82ec2fe-8b2f-4c49-b8a8-d779a04011f3", "content": "# Specify project root\nfluxloop init pytest-template /path/to/project --force\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 23, "total_chunks": null}}
{"id": "f85d411a-08b8-48cf-bfd3-6cf89a4eb546", "content": "#### Generated Test Template\n\nThe command creates a pytest test file that:\n\n- Imports FluxLoop test fixtures (`fluxloop_runner`, `fluxloop_runner_multi_turn`)\n- Includes a sample smoke test\n- References your project's simulation configuration\n- Demonstrates assertions on test results (`success_rate`, `total_runs`, etc.)\n\nExample generated test:\n\n```python\nimport pytest\nfrom fluxloop_cli.testing.pytest_plugin import fluxloop_runner\n\ndef test_fluxloop_smoke(fluxloop_runner):\n    \"\"\"Smoke test: verify agent runs without errors.\"\"\"", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 24, "total_chunks": null}}
{"id": "66caeba2-eb2b-4e9c-a20b-94333038a0f3", "content": "    result = fluxloop_runner(\n        config_path=\"configs/simulation.yaml\",\n        iterations=5,\n        input_text=\"Hello, test!\"\n    )\n    \n    # Assertions on result\n    assert result.success_rate > 0.8\n    assert result.total_runs == 5\n    \n    # Or use convenience method\n    result.require_success(threshold=0.8)\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 25, "total_chunks": null}}
{"id": "610caee9-f061-4feb-851f-9035799f67b2", "content": "#### Available Fixtures\n\n| Fixture | Description | Use Case |\n|---------|-------------|----------|\n| `fluxloop_runner` | Single-turn test runner | Basic agent tests |\n| `fluxloop_runner_multi_turn` | Multi-turn conversation runner | Multi-turn agent tests |\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 26, "total_chunks": null}}
{"id": "a27bd5bf-e7df-4e7a-8027-17a6fe7c59b2", "content": "#### Running Pytest Tests\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 27, "total_chunks": null}}
{"id": "d69d62a9-6cf1-4d13-90a1-9621e4d29ac1", "content": "# Install dev dependencies\npip install -e packages/cli[dev]\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 28, "total_chunks": null}}
{"id": "e1134052-77d5-4ad3-9934-78c667a22193", "content": "# Run FluxLoop tests\npytest -k fluxloop_smoke\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 29, "total_chunks": null}}
{"id": "6b82d199-b8d2-467c-bee0-5753a22f4f14", "content": "# Run with coverage\npytest --cov=. -k fluxloop\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 30, "total_chunks": null}}
{"id": "f9e4842f-b522-4e7d-acae-a28c93a69ae3", "content": "# Stop on first failure\npytest -k fluxloop_smoke --maxfail=1\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 31, "total_chunks": null}}
{"id": "af24d3d3-58f2-48f7-ae69-853ba0353885", "content": "#### CI Integration\n\nThe generated test works seamlessly in CI/CD pipelines:\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 32, "total_chunks": null}}
{"id": "91ae2b6a-a417-4847-8c27-a061506b1648", "content": "# .github/workflows/test.yml\nname: FluxLoop Tests\non: [push, pull_request]\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n      - run: pip install -e packages/cli[dev]\n      - run: pytest -k fluxloop_smoke\n        env:\n          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n```\n\nSee [CI/CD Integration Guide](/cli/workflows/ci-cd-integration) for complete examples.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 33, "total_chunks": null}}
{"id": "6b04f307-dc92-46fd-9363-62af2a44aac0", "content": "### init agent\n\nCreate a new agent from a template.\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 34, "total_chunks": null}}
{"id": "b54dea60-ea88-4f05-bd09-7d9ce3b613e3", "content": "#### Usage\n\n```bash\nfluxloop init agent <name> [OPTIONS]\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 35, "total_chunks": null}}
{"id": "50d9cbeb-dbd4-4c76-86e5-d5367c61c3cd", "content": "#### Arguments\n\n| Argument | Description |\n|----------|-------------|\n| `name` | Name of the agent module |\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 36, "total_chunks": null}}
{"id": "9c338d34-b9de-470b-885b-52035c25a6a0", "content": "#### Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--path`, `-p` | Directory to create agent in | Current directory |\n| `--template`, `-t` | Agent template (`simple`, `langchain`, `langgraph`) | `simple` |\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 37, "total_chunks": null}}
{"id": "c4bf5dd0-1afe-42da-a2e2-f68e75f38cd9", "content": "#### Examples\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 38, "total_chunks": null}}
{"id": "918bfa45-e7dc-4046-9d88-f11794d0f70f", "content": "# Create simple agent\nfluxloop init agent my_chatbot\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 39, "total_chunks": null}}
{"id": "f0c2933c-4a8d-4da2-afbf-2752c2e52cd7", "content": "# Create in specific directory\nfluxloop init agent support_agent --path ./agents\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 40, "total_chunks": null}}
{"id": "be28eda5-b2be-4fe2-8970-f03a9b201f4e", "content": "# Use different template (coming soon)\nfluxloop init agent complex_agent --template langgraph\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 41, "total_chunks": null}}
{"id": "1b8283c4-2096-4cb4-a3c6-21714ff9b202", "content": "#### Generated Agent\n\nCreates `agents/my_chatbot.py` with FluxLoop instrumentation:\n\n```python\nimport fluxloop\n\n@fluxloop.agent()\ndef run(input_text: str) -> str:\n    \"\"\"Agent logic here.\"\"\"\n    # Process the input\n    response = process_input(input_text)\n    return response\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 42, "total_chunks": null}}
{"id": "4d70a0c7-d5b6-4007-baea-a4a69acf55e1", "content": "#### Next Steps After Agent Creation\n\n1. Update `configs/simulation.yaml` to reference your agent:\n   ```yaml\n   runner:\n     target: \"agents.my_chatbot:run\"\n   ```\n\n2. Test your agent:\n   ```bash\n   fluxloop run experiment --iterations 1\n   ```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 43, "total_chunks": null}}
{"id": "16a1e04f-395f-4bfb-a0d3-585e7889eb75", "content": "## Common Workflows\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 44, "total_chunks": null}}
{"id": "af001647-9a64-4783-9abd-9b6adf573eaf", "content": "### Starting a New Project\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 45, "total_chunks": null}}
{"id": "ea30108f-89e3-4700-b98e-78e33552c4eb", "content": "# 1. Create project\nfluxloop init project --name my-agent\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 46, "total_chunks": null}}
{"id": "df928b70-5c49-4e72-b3ce-b1085eda0f07", "content": "# 2. Navigate to project\ncd fluxloop/my-agent\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 47, "total_chunks": null}}
{"id": "48d831b9-a25e-4d82-9795-488dcc253a91", "content": "# 3. Configure LLM\nfluxloop config set-llm openai sk-xxxxx\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 48, "total_chunks": null}}
{"id": "90c20a6d-478c-4723-9b4d-7e91fd3e4c84", "content": "# 4. Create pytest tests\nfluxloop init pytest-template\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 49, "total_chunks": null}}
{"id": "bad7c4a0-8373-4cbb-9ee8-aa52c61936be", "content": "# 5. Run diagnostics\nfluxloop doctor\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 50, "total_chunks": null}}
{"id": "01a9767c-085b-43c4-84b3-19bbe603a117", "content": "### Adding Tests to Existing Project\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 51, "total_chunks": null}}
{"id": "c84889a0-67ef-42b9-b8f2-a52bb7f29b33", "content": "# Create pytest template\nfluxloop init pytest-template\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 52, "total_chunks": null}}
{"id": "cb1da110-85bc-496e-a950-a4570aaa7b47", "content": "# Run tests\npytest -k fluxloop_smoke\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 53, "total_chunks": null}}
{"id": "846ca5eb-c6cc-4c8e-b95c-fdac51055bda", "content": "# Add to CI\ncp examples/ci/fluxloop_pytest.yml .github/workflows/\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 54, "total_chunks": null}}
{"id": "c037cba4-96ac-4e9e-8729-e48f013de8ac", "content": "### Creating Multiple Agents\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 55, "total_chunks": null}}
{"id": "abdf8d48-8806-432a-9cc7-71318cefc2bd", "content": "# Create agents directory\nmkdir agents\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 56, "total_chunks": null}}
{"id": "3ed975f4-eec9-4709-bf05-1abded482df1", "content": "# Create different agents\nfluxloop init agent chatbot --path agents\nfluxloop init agent summarizer --path agents\nfluxloop init agent classifier --path agents\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 57, "total_chunks": null}}
{"id": "e8065431-f29f-4fd5-be0d-6fe96dcecc04", "content": "# Test each agent\nfluxloop config set runner.target \"agents.chatbot:run\"\nfluxloop run experiment --iterations 5\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 58, "total_chunks": null}}
{"id": "b67b7405-8d96-406b-9d3f-9be78adbef18", "content": "## Troubleshooting\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 59, "total_chunks": null}}
{"id": "d466f169-c8fa-4a73-9c46-17a6f514c6b6", "content": "### \"Directory already exists\"\n\nUse `--force` to overwrite:\n```bash\nfluxloop init project --name my-agent --force\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 60, "total_chunks": null}}
{"id": "0a0f4d08-ab87-4539-8218-1b65380e9fdf", "content": "### \"Project name required\"\n\nProvide `--name` flag when not in project directory:\n```bash\nfluxloop init project --name my-agent\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 61, "total_chunks": null}}
{"id": "a2e549c6-86b3-4fc1-85da-0abefb395ab3", "content": "### \"Config not found\" for pytest-template\n\nEnsure you're in project root or specify path:\n```bash\nfluxloop init pytest-template /path/to/project\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 62, "total_chunks": null}}
{"id": "77b47e98-b11d-45b0-9c55-365b4821e398", "content": "## See Also\n\n- [Project Setup Guide](/cli/getting-started/project-setup) - Detailed setup walkthrough\n- [Pytest Bridge Guide](/cli/workflows/pytest-integration) - Complete pytest integration docs\n- [Generate Command](/cli/commands/generate) - Generate input variations\n- [Run Command](/cli/commands/run) - Execute experiments\n- [Configuration Reference](/cli/configuration/project-config) - Config file schemas", "metadata": {"source": "packages/website/docs-cli/commands/init.md", "chunk_index": 63, "total_chunks": null}}
{"id": "08da7bff-90ee-4359-812f-d0b31e1de4db", "content": "---\nsidebar_position: 4\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 0, "total_chunks": null}}
{"id": "ce0f8247-0d87-4862-9329-94b76855380e", "content": "# parse Command\n\nGenerate human-readable and machine-readable artifacts for each experiment trace.\n", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 1, "total_chunks": null}}
{"id": "ff4eb4af-22ee-4ee7-963c-c9be4fae5f69", "content": "## Overview\n\n`fluxloop parse experiment` processes the raw outputs produced by `fluxloop run experiment` and creates:\n\n- Markdown files under `per_trace_analysis/*.md` containing per-trace summaries, conversation transcripts, timelines, and observation details.\n- A structured JSONL file at `per_trace_analysis/per_trace.jsonl` that captures summary fields, normalized conversations, and observation timelines for every trace.  \n  This file is the canonical input for `fluxloop evaluate` starting with CLI v0.2.26.\n\nRunning `parse` is now a required step before evaluation unless you manually supply a compatible `--per-trace` path to the `evaluate` command.", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 2, "total_chunks": null}}
{"id": "ab343876-9595-47c8-81a5-797980761fd8", "content": "## Basic Usage\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c655fdc3-5ee5-47da-8e06-13832b8fa5fe", "content": "# Parse the latest experiment in ./experiments/demo_run\nfluxloop parse experiment experiments/demo_run\n", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 5, "total_chunks": null}}
{"id": "07ec69c7-ede3-4a51-abd9-c1007afa5532", "content": "# Overwrite an existing per_trace_analysis directory\nfluxloop parse experiment experiments/demo_run --overwrite\n```\n\nBy default the command creates/updates an output directory named `per_trace_analysis` within the experiment folder. Use `--output` to pick a different directory name.\n", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 6, "total_chunks": null}}
{"id": "5d3b360a-6bf6-4259-8057-37eb3478f1f1", "content": "## Command Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `experiment_dir` | Path to the experiment output directory | Required |\n| `--output`, `-o` | Directory name (relative to `experiment_dir`) where artifacts are written | `per_trace_analysis` |\n| `--format`, `-f` | Output format for human-readable files (currently only `md`) | `md` |\n| `--overwrite` | Replace the output directory if it already exists | `false` |\n", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 7, "total_chunks": null}}
{"id": "ec7e8278-4cd6-476a-b55f-8e3cf192a106", "content": "## Generated Files\n\n```\nper_trace_analysis/\n├── 00_trace-1.md          # Markdown summary with timeline, observations, and metadata\n├── 01_trace-2.md\n└── per_trace.jsonl        # Structured per-trace records consumed by `fluxloop evaluate`\n```\n\nEach JSONL entry includes:\n\n- Top-level trace metadata (`trace_id`, `iteration`, `persona`, `input`, `output`, `duration_ms`, `success`)\n- A `summary` object mirroring the original `trace_summary.jsonl` row\n- A `timeline` array with serialized observations (type, timestamps, inputs/outputs)", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 8, "total_chunks": null}}
{"id": "def4d39a-0299-4b03-906f-d7b3950110e7", "content": "- A `conversation` array with normalized `{turn_index, role, content, source, metadata}` entries used by the evaluation UI\n- Optional `conversation_state` and `termination_reason` fields for multi-turn runs that ended via supervisor intervention\n- Derived metrics such as `observation_count`\n\nThis structure allows downstream tooling to evaluate or analyze multi-turn traces without re-reading large observation logs.\n", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 9, "total_chunks": null}}
{"id": "436dbf22-09da-43ff-8e42-502c83714990", "content": "## Relationship to `fluxloop evaluate`\n\nAfter parsing, run:\n\n```bash\nfluxloop evaluate experiment experiments/demo_run\n```\n\n`evaluate` automatically looks for `per_trace_analysis/per_trace.jsonl`. If you store the structured file elsewhere, pass its path via `--per-trace`.", "metadata": {"source": "packages/website/docs-cli/commands/parse.md", "chunk_index": 10, "total_chunks": null}}
{"id": "6e30946d-4cfc-47d5-a5ce-0cda0a83190e", "content": "---\nsidebar_position: 5\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 0, "total_chunks": null}}
{"id": "0c144233-54a6-408b-a0e9-34ef5361a7e1", "content": "# record Command\n\nToggle FluxLoop argument recording across `.env` and `configs/simulation.yaml`.\n", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 1, "total_chunks": null}}
{"id": "d4b692cc-d8a5-455e-8fab-3e8d2abf1d15", "content": "## Summary\n\n```bash\nfluxloop record enable    # turn on recording\nfluxloop record disable   # turn it off\nfluxloop record status    # show current state\n```\n\nWhen you run `enable`/`disable`, the CLI updates:\n\n- Project `.env` → `FLUXLOOP_RECORD_ARGS`, `FLUXLOOP_RECORDING_FILE`\n- `configs/simulation.yaml` → `replay_args.enabled`, `replay_args.recording_file`\n\nAgents that call `fluxloop.load_env()` + `fluxloop.configure()` on startup should read these environment variables so that CLI toggles take effect.\n", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 2, "total_chunks": null}}
{"id": "002ae0a9-ac65-483d-9fc6-77696bad8e35", "content": "## Commands\n", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 3, "total_chunks": null}}
{"id": "bb1d5948-2b3a-40cd-a0fe-0665c4677654", "content": "### `fluxloop record enable`\n\n- Ensures the `recordings/` directory exists\n- Writes/updates `.env` with `FLUXLOOP_RECORD_ARGS=true`\n- Sets `replay_args.enabled: true` and `recording_file` in `configs/simulation.yaml`\n- Prints the resolved recording path\n", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 4, "total_chunks": null}}
{"id": "74c57624-13c1-4017-b554-31e404769f01", "content": "### `fluxloop record disable`\n\n- Sets `FLUXLOOP_RECORD_ARGS=false`\n- Sets `replay_args.enabled: false` in `configs/simulation.yaml`\n- Leaves the last `recording_file` path intact for future use\n", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 5, "total_chunks": null}}
{"id": "541e51e7-8c84-43ff-8e14-bb30ed92a6f5", "content": "### `fluxloop record status`\n\n- Reads the effective state from `.env` and `configs/simulation.yaml`\n- Warns if code is not configured to honor the environment values\n", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 6, "total_chunks": null}}
{"id": "ecc02774-aea2-473b-8727-c54908152272", "content": "## Best Practices\n\n- At service startup load your project `.env` (or pass the resolved values into `fluxloop.configure`).\n- Configure the SDK using environment values instead of hard-coding `record_args=True`, e.g.:\n\n```python\nimport os\nfrom pathlib import Path\nimport fluxloop\n\nproject_root = Path(__file__).resolve().parents[2]\nfluxloop.load_env(project_root / \".env\")        # ensures CLI toggles are visible\n\nrecord_on = os.getenv(\"FLUXLOOP_RECORD_ARGS\", \"false\").lower() == \"true\"\nrecord_file = os.getenv(\"FLUXLOOP_RECORDING_FILE\")", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 7, "total_chunks": null}}
{"id": "3da49d66-9c6e-43a6-bb32-985841b6ee25", "content": "\nfluxloop.configure(\n    debug=True,\n    record_args=record_on,\n    recording_file=record_file,\n)\n```\n- Verify the CLI output after `fluxloop record enable`—it should show the absolute path.\n- During local development you can still override the path manually via `.env`.\n", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 8, "total_chunks": null}}
{"id": "eff290d1-9e11-45a7-9440-a6db78fd142b", "content": "## Troubleshooting\n\n- **No `.jsonl` file appears** → Ensure the process read `.env` and configure was called before `fluxloop.record_call_args`.\n- **File created in unexpected directory** → Use an absolute path or ensure the service CWD is the project root.\n- **Recording stays on** → Remove hard-coded `record_args=True`; rely on environment toggles.", "metadata": {"source": "packages/website/docs-cli/commands/record.md", "chunk_index": 9, "total_chunks": null}}
{"id": "e5ff32e6-a605-4b43-8aea-5d58ae487160", "content": "---\nsidebar_position: 3\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 0, "total_chunks": null}}
{"id": "e4d47a47-ec3c-4ce4-bd43-15b668f27a0b", "content": "# run Command\n\nExecute simulation experiments with your agent.\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 1, "total_chunks": null}}
{"id": "7028c1b1-84d6-4fcc-9697-9aead031939c", "content": "## Usage\n\n```bash\nfluxloop run experiment [OPTIONS]\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 2, "total_chunks": null}}
{"id": "93f3cb16-1c2a-42d4-8988-853c173a9a23", "content": "## Options\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--config`, `-c` | Path to configuration file | `configs/simulation.yaml` |\n| `--project` | Project name under FluxLoop root | Current directory |\n| `--root` | FluxLoop root directory | `./fluxloop` |\n| `--iterations`, `-i` | Number of runs per input | From config |\n| `--personas`, `-p` | Comma-separated list of personas to use | All personas |\n| `--multi-turn/--no-multi-turn` | Enable/disable multi-turn conversations | From config |", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 3, "total_chunks": null}}
{"id": "258a22da-6f29-45a6-b4f6-4abaf751f669", "content": "| `--max-turns` | Maximum turns per conversation | From config |\n| `--auto-approve-tools/--manual-approve-tools` | Tool approval behavior | From config |\n| `--persona-override` | Force specific persona ID for multi-turn | None |\n| `--supervisor-provider` | Override supervisor provider (openai, anthropic, mock) | From config |\n| `--supervisor-model` | Override supervisor model | From config |\n| `--supervisor-temperature` | Override supervisor temperature | From config |\n| `--supervisor-api-key` | API key for supervisor calls | From env |", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 4, "total_chunks": null}}
{"id": "99ff5371-e16c-443d-bdfb-4de671e69b6c", "content": "| `--output-dir` | Output directory for results | `experiments/` |\n| `--experiment-name` | Custom experiment name | Auto-generated |\n| `--yes`, `-y` | Skip confirmation prompt (for CI/automation) | `false` |\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 5, "total_chunks": null}}
{"id": "1e3c8cde-f4ac-43e7-9545-3f785a696c06", "content": "## Examples\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 6, "total_chunks": null}}
{"id": "bcf6c967-87e0-4c8a-a94a-b3306e35bb6b", "content": "### Basic Experiment\n\nRun with default settings:\n\n```bash\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 7, "total_chunks": null}}
{"id": "32a6a677-1fba-4c71-8e0d-638c5223d8bb", "content": "### Custom Iterations\n\nOverride iteration count:\n\n```bash\nfluxloop run experiment --iterations 20\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 8, "total_chunks": null}}
{"id": "cbf18c6f-bf57-474c-a29b-042dbf46e408", "content": "### Named Experiment\n\nGive your experiment a name:\n\n```bash\nfluxloop run experiment --experiment-name \"baseline-test\"\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 9, "total_chunks": null}}
{"id": "6b420da8-dcfd-4e17-b4d9-8565f7e47062", "content": "### Skip Confirmation (CI Mode)\n\nRun without interactive prompt for automation:\n\n```bash\nfluxloop run experiment --yes\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 10, "total_chunks": null}}
{"id": "0503d111-9b68-4228-87b7-5e5a0fe2c2f1", "content": "# Or short form\nfluxloop run experiment -y\n```\n\nThis is ideal for CI/CD pipelines and pytest integration.\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 11, "total_chunks": null}}
{"id": "b778e1c9-73b2-43f4-985d-fdc601473448", "content": "## How It Works\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 12, "total_chunks": null}}
{"id": "0cd77e7f-4765-4ec3-87c7-2b8ddc6639d5", "content": "### 1. Load Configuration\n\nReads `configs/simulation.yaml`:\n\n```yaml\nrunner:\n  target: \"examples.my_agent:run\"\n  iterations: 10\n\noutput:\n  directory: \"experiments\"\n  format: jsonl\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4b2bbd2c-9937-4341-a5b4-ab9889b7ed18", "content": "### 2. Load Inputs\n\nLoads generated inputs from `inputs/generated.yaml`:\n\n```yaml\ngenerated_inputs:\n  - input: \"How do I start?\"\n    persona: novice_user\n  - input: \"What are advanced options?\"\n    persona: expert_user\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 14, "total_chunks": null}}
{"id": "8d627b17-f459-4a6e-b735-772067be6dde", "content": "### 3. Execute Agent\n\nFor each input, runs your agent `iterations` times:\n\n```python", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 15, "total_chunks": null}}
{"id": "9238755a-3b56-422d-8cd1-bb6c06cb83f7", "content": "# Your agent (examples/my_agent.py)\nimport fluxloop\n\n@fluxloop.agent()\ndef run(input_text: str) -> str:\n    return process(input_text)\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 16, "total_chunks": null}}
{"id": "7ca60b52-25b1-4ab3-89fe-cd80885a7768", "content": "### 4. Collect Traces\n\nCaptures:\n- Input/output pairs\n- Execution time\n- Observations\n- Errors (if any)\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 17, "total_chunks": null}}
{"id": "645506a6-7297-44c1-adee-df467c34ec97", "content": "### 5. Save Results\n\nOutputs to `experiments/exp_YYYYMMDD_HHMMSS/`:\n\n```\nexperiments/exp_20241101_143022/\n├── summary.json           # Aggregate stats\n├── trace_summary.jsonl    # Per-trace summaries\n├── traces.jsonl           # Detailed traces\n├── observations.jsonl     # Observation stream\n└── config.yaml            # Experiment config snapshot\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 18, "total_chunks": null}}
{"id": "fe3ad509-482f-4a89-8e92-d0092301e3d8", "content": "## Output Files\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 19, "total_chunks": null}}
{"id": "668a3f4a-63a7-49bc-a6c8-ea746a35167e", "content": "### summary.json\n\nAggregate statistics:\n\n```json\n{\n  \"experiment_name\": \"my_agent_experiment\",\n  \"total_traces\": 100,\n  \"successful\": 98,\n  \"failed\": 2,\n  \"avg_duration_ms\": 250.5,\n  \"started_at\": \"2024-11-01T14:30:22Z\",\n  \"completed_at\": \"2024-11-01T14:35:10Z\",\n  \"config_snapshot\": {...}\n}\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 20, "total_chunks": null}}
{"id": "7c9d2d32-8b7e-476e-b5b3-9860dd1bae7d", "content": "### trace_summary.jsonl\n\nOne line per trace with summary information:\n\n```jsonl\n{\"trace_id\": \"trace_001\", \"iteration\": 0, \"persona\": \"novice_user\", \"input\": \"How do I start?\", \"output\": \"...\", \"duration_ms\": 245, \"success\": true}\n{\"trace_id\": \"trace_002\", \"iteration\": 1, \"persona\": \"expert_user\", \"input\": \"What are options?\", \"output\": \"...\", \"duration_ms\": 267, \"success\": true}\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 21, "total_chunks": null}}
{"id": "ba3cd5d9-edcc-4fc1-992c-63a88d4043f9", "content": "### observations.jsonl (optional)\n\nDetailed observation stream with all events:\n\n```jsonl\n{\"trace_id\": \"trace_001\", \"type\": \"span_start\", \"timestamp\": \"...\", \"name\": \"agent_run\", ...}\n{\"trace_id\": \"trace_001\", \"type\": \"span_end\", \"timestamp\": \"...\", \"name\": \"agent_run\", ...}\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 22, "total_chunks": null}}
{"id": "43607ce7-7a7e-4922-ad28-56501964d536", "content": "## Multi-Turn Conversations\n\nFluxLoop supports extending single inputs into dynamic multi-turn conversations using a supervisor agent.\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 23, "total_chunks": null}}
{"id": "3aa2f990-9a31-4097-acf5-0d9302893a6d", "content": "### Enable Multi-Turn Mode\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 24, "total_chunks": null}}
{"id": "323c9895-d37f-4848-8bcf-4d5e552d0a92", "content": "# Enable multi-turn with defaults\nfluxloop run experiment --multi-turn\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 25, "total_chunks": null}}
{"id": "5aecee02-96e5-416a-912f-0977a1db785e", "content": "# Set maximum turns\nfluxloop run experiment --multi-turn --max-turns 12\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 26, "total_chunks": null}}
{"id": "40363cc7-3753-44cd-a778-3d9d5d508b62", "content": "# Auto-approve tools during conversation\nfluxloop run experiment --multi-turn --auto-approve-tools\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 27, "total_chunks": null}}
{"id": "72530609-c10c-414f-8f5d-160249ceb30f", "content": "### Supervisor Configuration\n\nThe supervisor decides when to continue the conversation and generates realistic follow-up questions.\n\n**LLM-Driven Supervisor (Dynamic):**\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 28, "total_chunks": null}}
{"id": "9a85c402-d355-4016-b669-f3fd97c69c82", "content": "# Use OpenAI for supervisor decisions\nfluxloop run experiment --multi-turn \\\n  --supervisor-provider openai \\\n  --supervisor-model gpt-4o \\\n  --supervisor-temperature 0.7\n```\n\n**Mock Supervisor (Scripted Playback):**\n\nFor deterministic testing, use scripted questions:\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 29, "total_chunks": null}}
{"id": "8615f0e5-7070-4edd-8eab-a00c791e03ed", "content": "# configs/simulation.yaml\nmulti_turn:\n  enabled: true\n  supervisor:\n    provider: mock\n    metadata:\n      scripted_questions:\n        - \"Can you explain more?\"\n        - \"What about edge cases?\"\n        - \"How does error handling work?\"\n```\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 30, "total_chunks": null}}
{"id": "55c6bb1f-d69e-452a-b827-2fd27b5553ef", "content": "# Run with scripted questions\nfluxloop run experiment --multi-turn --supervisor-provider mock\n```\n\nThe mock supervisor replays questions sequentially and terminates when the script ends.\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 31, "total_chunks": null}}
{"id": "62ebdd8b-5ec6-42d0-bb5f-f6a856e32427", "content": "### Multi-Turn Options\n\n| Option | Description | Use Case |\n|--------|-------------|----------|\n| `--multi-turn` | Enable multi-turn mode | Dynamic conversations |\n| `--max-turns` | Limit conversation depth | Prevent infinite loops |\n| `--auto-approve-tools` | Auto-approve tool calls | Reduce manual intervention |\n| `--persona-override` | Force specific persona | Consistent testing |\n| `--supervisor-provider` | Supervisor LLM provider | openai, anthropic, mock |\n| `--supervisor-model` | Supervisor model name | gpt-4o, claude-3-5-sonnet |", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 32, "total_chunks": null}}
{"id": "1f6677ee-429a-4951-8c07-ccf7625c474c", "content": "| `--supervisor-temperature` | Sampling temperature | 0.0-1.0 |\n| `--supervisor-api-key` | API key for supervisor | Override env var |\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 33, "total_chunks": null}}
{"id": "9531dd82-432f-4aeb-bc1e-521a58dc14b5", "content": "### Output for Multi-Turn\n\nMulti-turn experiments produce additional fields:\n\n- `conversation_state`: Current state (active, completed, terminated)\n- `termination_reason`: Why conversation ended (max_turns, supervisor_stop, error)\n- `turn_count`: Number of turns executed\n- `conversation_history`: Full dialogue transcript\n\nSee [Multi-Turn Workflow](/cli/workflows/multi-turn-workflow) for detailed guide.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 34, "total_chunks": null}}
{"id": "c7319485-db24-46f2-a4d2-78f64f1f0be0", "content": "## Configuration\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 35, "total_chunks": null}}
{"id": "df59686a-edd9-4a03-a04d-2d5475057e4c", "content": "### Runner Target\n\nPoint to your agent function:\n\n```yaml\nrunner:\n  target: \"examples.my_agent:run\"  # module:function\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 36, "total_chunks": null}}
{"id": "f0fee200-7330-45b6-8282-09d92d48174b", "content": "### Iterations\n\nNumber of times to run each input:\n\n```yaml\nrunner:\n  iterations: 10  # Run each input 10 times\n```\n\nWhy multiple iterations?\n- Measure consistency\n- Account for LLM randomness\n- Statistical significance\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 37, "total_chunks": null}}
{"id": "2e50d0d0-0bbc-41fa-9406-c5c836f0c9b4", "content": "## Argument Replay (Advanced)\n\nReplay recorded arguments:\n\n```yaml\nreplay_args:\n  enabled: true\n  recording_file: \"recordings/args.jsonl\"\n  override_param_path: \"data.content\"\n```\n\nSee [Recording Workflow](../workflows/recording-workflow) for details.\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 38, "total_chunks": null}}
{"id": "e1a3c857-9523-4283-819a-40de0e316d84", "content": "## Progress Tracking\n\nThe command shows real-time progress:\n\n```\n[INFO] Starting experiment...\n[INFO] Loaded 50 inputs\n[INFO] Running 10 iterations per input (500 total runs)\n[▓▓▓▓▓▓▓▓░░] 250/500 (50%) - ETA: 2m 15s\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 39, "total_chunks": null}}
{"id": "0632400e-4134-4e19-baa5-27ef4237917b", "content": "## Error Handling\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 40, "total_chunks": null}}
{"id": "8d99aa20-be81-4aea-8528-43643822161f", "content": "### Graceful Failures\n\nIf an agent run fails:\n- Error is captured in trace\n- Experiment continues with next input\n- Summary shows failure count\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 41, "total_chunks": null}}
{"id": "830d05aa-8838-4308-b2cf-a24f23d7eadc", "content": "### Critical Failures\n\nIf configuration is invalid:\n- Experiment stops immediately\n- Error message shows what to fix\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 42, "total_chunks": null}}
{"id": "6b6f3c7f-35ca-4524-8967-e50ab347a6c6", "content": "## Performance Tips\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 43, "total_chunks": null}}
{"id": "50520aba-bb76-4cc0-b861-b1c45e2e58ee", "content": "### Parallel Execution (Coming Soon)\n\n```bash\nfluxloop run experiment --parallel 4  # Run 4 agents in parallel\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 44, "total_chunks": null}}
{"id": "a6b90aa6-a244-40c2-8547-b37fb5337450", "content": "### Batch Processing\n\nFor large input sets, split into batches:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 45, "total_chunks": null}}
{"id": "c413e30d-86e5-478c-9e20-15dcbba9f7f0", "content": "# Generate in batches\nfluxloop generate inputs --limit 100 --output inputs/batch1.yaml\nfluxloop generate inputs --limit 100 --output inputs/batch2.yaml\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 46, "total_chunks": null}}
{"id": "f20a1884-ecba-4fe0-b073-b8c7d0cc271d", "content": "# Run separately\nfluxloop run experiment --inputs inputs/batch1.yaml --name batch1\nfluxloop run experiment --inputs inputs/batch2.yaml --name batch2\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 47, "total_chunks": null}}
{"id": "aa8d37e3-fa18-4dcb-a326-1fa47dafa6aa", "content": "## Next Steps\n\n- [Parse Command](./parse) - Convert results to readable format\n- [Simulation Config](../configuration/simulation-config) - Configure runner settings\n- [Workflows](../workflows/basic-workflow) - End-to-end examples", "metadata": {"source": "packages/website/docs-cli/commands/run.md", "chunk_index": 48, "total_chunks": null}}
{"id": "b94d0611-12a0-4c20-a719-784ac931e623", "content": "---\nsidebar_position: 7\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 0, "total_chunks": null}}
{"id": "1b57f6cf-ac76-4ff2-b3b4-860d9ef4409c", "content": "# status Command\n\nCheck FluxLoop system and experiment status.\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a140b461-bb69-48e5-8c60-e0a510813efd", "content": "## Overview\n\nThe `status` command provides utilities for checking FluxLoop installation status, configuration validity, and reviewing recent experiments. It's useful for quick health checks and browsing experiment history.\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 2, "total_chunks": null}}
{"id": "d32ec069-b4ee-4f96-a61c-5070111a7f1e", "content": "## Subcommands\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 3, "total_chunks": null}}
{"id": "8838b067-5ad9-415e-bde0-546a1078210f", "content": "### check\n\nVerify FluxLoop system status and configuration.\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 4, "total_chunks": null}}
{"id": "3029f02b-385b-4ae0-b1f9-60d3e830d7fd", "content": "# Quick status check\nfluxloop status check\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 5, "total_chunks": null}}
{"id": "b357b29b-c41b-42c0-8c9a-eecff6d5ad39", "content": "# Detailed status with verbose output\nfluxloop status check --verbose\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 6, "total_chunks": null}}
{"id": "f7679d43-5aba-406f-8d85-2252123aab9b", "content": "# Check specific project\nfluxloop status check --project my-agent\n```\n\n**Options:**\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--verbose`, `-v` | Show detailed information | `false` |\n| `--project` | Project name under FluxLoop root | Current directory |\n| `--root` | FluxLoop root directory | `./fluxloop` |\n\n**What Gets Checked:**\n\n1. **SDK Installation**: Verifies FluxLoop SDK is installed and shows version\n2. **Collector Connectivity**: Attempts to connect to collector service\n3. **Configuration Files**: Checks for required config files in `configs/`", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 7, "total_chunks": null}}
{"id": "facd6fee-d671-4327-8ed3-5a6e211980cc", "content": "4. **Environment Variables**: Verifies API keys and settings\n\n**Example Output:**\n\n```\nFluxLoop Status Check\n\n╭──────────────────────────────────────────────────────────╮\n│ Component  │ Status            │ Details                 │\n│ SDK        │ ✓ Installed       │ Version 0.1.6           │\n│ Collector  │ ? Unknown         │ URL: http://...         │\n│ Config     │ ✓ Found           │ /path/to/configs        │\n│ API Key    │ ✓ Set             │ Configured              │\n╰──────────────────────────────────────────────────────────╯", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 8, "total_chunks": null}}
{"id": "5622e752-ab31-4e6c-a1b9-57861f59bbfb", "content": "\nRecommendations:\n  • Set up API key in .env file\n```\n\n**Status Indicators:**\n\n| Symbol | Meaning |\n|--------|---------|\n| ✓ | Component working correctly |\n| ✗ | Component has errors |\n| - | Component not configured |\n| ? | Status unknown/uncertain |\n\n**Common Issues:**\n\n| Issue | Details | Recommendation |\n|-------|---------|----------------|\n| SDK not installed | FluxLoop SDK missing | `pip install fluxloop` |\n| Config incomplete | Missing config files | `fluxloop init project` |\n| API key not set | No `FLUXLOOP_API_KEY` | Set in `.env` file |", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 9, "total_chunks": null}}
{"id": "1a944bd9-2660-49c8-8cb7-facf3a6e6046", "content": "| Collector error | Cannot connect | Check collector URL |\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 10, "total_chunks": null}}
{"id": "7df87e37-a707-4762-8d23-d99e141779d5", "content": "### experiments\n\nList recent experiments and their results.\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 11, "total_chunks": null}}
{"id": "5ba99523-c850-4c91-863c-71564652fbe9", "content": "# List recent experiments (default: 10 most recent)\nfluxloop status experiments\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 12, "total_chunks": null}}
{"id": "1a900916-a851-4801-9874-1f5bac59b64b", "content": "# Show more experiments\nfluxloop status experiments --limit 20\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 13, "total_chunks": null}}
{"id": "e18d8ad6-6ef8-4917-8dea-83ebedcd922f", "content": "# Check specific output directory\nfluxloop status experiments --output ./my-experiments\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 14, "total_chunks": null}}
{"id": "47ecb364-7e8d-4f46-b1ad-9f636bb04a03", "content": "# Check for specific project\nfluxloop status experiments --project production-agent\n```\n\n**Options:**\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--output`, `-o` | Directory containing experiment results | `./experiments` |\n| `--project` | Project name | Current |\n| `--root` | FluxLoop root directory | `./fluxloop` |\n| `--limit`, `-l` | Number of experiments to show | `10` |\n\n**Example Output:**\n\n```\nRecent Experiments (showing 3 of 15)\n\n╭─ exp_20250117_143022 ───────────────────────────────╮", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 15, "total_chunks": null}}
{"id": "189725fb-3307-4972-9111-8dd5c07a06c0", "content": "│ Name: my_agent_experiment                            │\n│ Date: 2025-01-17 14:30:22                           │\n│ Runs: 50                                            │\n│ Success Rate: 94.0%                                  │\n│ Avg Duration: 234ms                                  │\n╰──────────────────────────────────────────────────────╯\n\n╭─ exp_20250117_120015 ───────────────────────────────╮\n│ Name: my_agent_experiment                            │\n│ Date: 2025-01-17 12:00:15                           │\n│ Runs: 100                                           │", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 16, "total_chunks": null}}
{"id": "eceda921-3b74-4855-8bac-ef2d6bb2bd03", "content": "│ Success Rate: 89.0%                                  │\n│ Avg Duration: 312ms                                  │\n╰──────────────────────────────────────────────────────╯\n\n📁 exp_20250116_093045 (no summary available)\n```\n\n**Experiment Information:**\n\nFor each experiment with a `summary.json` file, displays:\n- **Name**: Experiment name from configuration\n- **Date**: Timestamp when experiment ran\n- **Runs**: Total number of test runs executed\n- **Success Rate**: Percentage of successful completions\n- **Avg Duration**: Average execution time in milliseconds", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 17, "total_chunks": null}}
{"id": "9b5dfb7a-5b7b-470d-b26b-f910d86e4bef", "content": "\n**When No Experiments Found:**\n\n```\nNo experiments found in: ./experiments\n\nRun an experiment first: fluxloop run experiment\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 18, "total_chunks": null}}
{"id": "581ee603-1786-43fe-95fd-cf4ffb5bf332", "content": "### traces\n\nList recent traces from experiments.\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 19, "total_chunks": null}}
{"id": "77be765d-6446-43fd-a4d9-73c36bd73e35", "content": "# View recent traces (requires collector service)\nfluxloop status traces\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 20, "total_chunks": null}}
{"id": "b459f295-8767-46d6-878a-8f82c6e5c6ec", "content": "# View traces for specific experiment\nfluxloop status traces my_experiment_id\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 21, "total_chunks": null}}
{"id": "15641de2-7c0e-4fd5-8e68-44f3bbffb4f7", "content": "# Limit number of traces shown\nfluxloop status traces --limit 20\n```\n\n**Arguments:**\n\n| Argument | Description |\n|----------|-------------|\n| `experiment_id` | Optional experiment ID to filter traces |\n\n**Options:**\n\n| Option | Description | Default |\n|--------|-------------|---------|\n| `--limit`, `-l` | Number of traces to show | `10` |\n\n**Note:**\n\nThis feature requires a running collector service. When the collector is not available:\n\n```\nTrace viewing requires collector service\n\nThis feature will be available when the collector is running.", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 22, "total_chunks": null}}
{"id": "b7c7464e-5f44-46d7-9a6f-90035c320a2f", "content": "For now, check the experiment output directories for trace data.\n```\n\n**Alternative: View Traces Locally**\n\nUntil the collector service is running, view traces in experiment directories:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 23, "total_chunks": null}}
{"id": "384ce12f-3bd2-4dd2-9878-7163550dad62", "content": "# List trace files\nls experiments/exp_*/artifacts/\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 24, "total_chunks": null}}
{"id": "241fce4c-1680-4c06-b103-1258b8b4d4ea", "content": "# View trace summary\ncat experiments/exp_*/summary.json | jq\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 25, "total_chunks": null}}
{"id": "e60ab819-ec4e-4c75-afa5-0acea25d7f4e", "content": "# View individual traces\ncat experiments/exp_*/artifacts/traces.jsonl | head -n 5\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 26, "total_chunks": null}}
{"id": "4a8a1414-73fd-4ed6-ab16-8131cd7e0291", "content": "## Common Workflows\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 27, "total_chunks": null}}
{"id": "6a291576-451d-4b0c-940a-788b9606be53", "content": "### Pre-Experiment Health Check\n\nBefore running experiments, verify everything is configured:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 28, "total_chunks": null}}
{"id": "4efbf234-f2f5-4ed2-9a74-6a9de6473d8c", "content": "# Quick status check\nfluxloop status check\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 29, "total_chunks": null}}
{"id": "51b0270b-d113-496f-91ee-340cc58a2778", "content": "# Or use doctor for comprehensive diagnostics\nfluxloop doctor\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 30, "total_chunks": null}}
{"id": "2feaa680-3f13-4c67-8981-1cf193be6398", "content": "# Verify configuration\nfluxloop config validate\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 31, "total_chunks": null}}
{"id": "5c4248a5-97e4-457a-82d3-3c38b5b98f39", "content": "### Post-Experiment Review\n\nAfter running experiments, review results:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 32, "total_chunks": null}}
{"id": "e0ddd4ff-f81c-432b-94c2-ea7c703a2421", "content": "# List recent experiments\nfluxloop status experiments --limit 5\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 33, "total_chunks": null}}
{"id": "7f4272aa-37c8-46e2-9977-77591a14ac5c", "content": "# Parse latest experiment for detailed analysis\nfluxloop parse experiment experiments/latest_run_*/\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 34, "total_chunks": null}}
{"id": "daf82ed2-30ed-4a3b-b132-e3afef36c6bf", "content": "# Evaluate results\nfluxloop evaluate experiment experiments/latest_run_*/\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 35, "total_chunks": null}}
{"id": "3b2ec796-d73a-48e8-a3e3-635f7ee48fdf", "content": "### Monitoring Experiment History\n\nTrack experiment performance over time:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 36, "total_chunks": null}}
{"id": "f2daa8af-3d04-4c7a-b069-cd8287f9f1c8", "content": "# List all recent experiments\nfluxloop status experiments --limit 20\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 37, "total_chunks": null}}
{"id": "1b60af7e-ff76-4009-b433-595664c278ec", "content": "# Check specific project's experiments\nfluxloop status experiments --project production-agent\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 38, "total_chunks": null}}
{"id": "da417e1a-b987-44d2-a7e2-8ddb9486b486", "content": "# Compare with specific output directory\nfluxloop status experiments --output ./archived-experiments\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 39, "total_chunks": null}}
{"id": "d7c14164-ebdf-4d34-8ae6-d3fb44d5a4b0", "content": "### Troubleshooting Setup Issues\n\nWhen things aren't working, use status commands to diagnose:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 40, "total_chunks": null}}
{"id": "7ec30438-f8b0-4534-980d-bd4a971ab503", "content": "# 1. Check system status\nfluxloop status check --verbose\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 41, "total_chunks": null}}
{"id": "300e81cf-e412-49cb-a2cf-b4b4006b4137", "content": "# 2. Verify environment\nfluxloop config env\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 42, "total_chunks": null}}
{"id": "0fde8729-6aa7-4a5a-930b-70275772634f", "content": "# 3. Run full diagnostics\nfluxloop doctor\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 43, "total_chunks": null}}
{"id": "9b8ccefa-b855-4166-b969-40529a65e8e3", "content": "# 4. Validate configuration\nfluxloop config validate\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 44, "total_chunks": null}}
{"id": "ffa3f583-6ca4-4f6a-9130-0456e328c49f", "content": "## Status vs Doctor\n\nBoth `status check` and `doctor` verify system health, but with different focuses:\n\n| Aspect | `status check` | `doctor` |\n|--------|----------------|----------|\n| **Focus** | Quick health check | Comprehensive diagnostics |\n| **Checks** | SDK, Collector, Config, API Key | Python, CLI, SDK, MCP, Index, Config |\n| **Output** | Concise table | Detailed panels with recommendations |\n| **Speed** | Fast | Thorough |\n| **Use Case** | Quick verification | Deep troubleshooting |\n\n**When to Use Each:**\n\nUse `status check`:", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 45, "total_chunks": null}}
{"id": "87c49720-e426-4b79-8bbd-c399ba0207c3", "content": "- Quick health verification before running experiments\n- Checking if basic setup is complete\n- Verifying configuration after changes\n\nUse `doctor`:\n- Initial setup verification\n- Troubleshooting installation issues\n- Verifying MCP server and index\n- Complete environment diagnostics\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 46, "total_chunks": null}}
{"id": "8dd78520-8801-47b7-ab81-0655619236b5", "content": "## Output Interpretation\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 47, "total_chunks": null}}
{"id": "653f847d-6974-428e-96a8-95c71a5ba4d2", "content": "### SDK Status\n\n| Status | Meaning | Action |\n|--------|---------|--------|\n| ✓ Installed | SDK found and loaded | None needed |\n| ✗ Not installed | SDK missing | `pip install fluxloop` |\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 48, "total_chunks": null}}
{"id": "7428f6ee-83ec-4152-87ef-c2939378cd43", "content": "### Collector Status\n\n| Status | Meaning | Action |\n|--------|---------|--------|\n| ✓ Connected | Collector reachable | None needed |\n| ? Unknown | Cannot verify (offline mode OK) | Verify URL if needed |\n| ✗ Error | Connection failed | Check `FLUXLOOP_COLLECTOR_URL` |\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 49, "total_chunks": null}}
{"id": "908c65e6-0077-4bdb-965d-a0f45c9af610", "content": "### Config Status\n\n| Status | Meaning | Action |\n|--------|---------|--------|\n| ✓ Found | All required configs present | None needed |\n| - Incomplete | Missing config files | `fluxloop init project` |\n| ✗ Invalid | Config syntax errors | Fix YAML syntax |\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 50, "total_chunks": null}}
{"id": "ac39938c-080f-4c61-810d-ff4e4e49e4bf", "content": "### API Key Status\n\n| Status | Meaning | Action |\n|--------|---------|--------|\n| ✓ Set | API key configured | None needed |\n| - Not set | No API key found | Set in `.env` file |\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 51, "total_chunks": null}}
{"id": "20ceab88-1378-4c89-821c-c8b736045283", "content": "## Tips\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 52, "total_chunks": null}}
{"id": "1e552970-2a18-4ab9-9423-0920fd6adbaf", "content": "### Quick Status Alias\n\nCreate a shell alias for faster checks:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 53, "total_chunks": null}}
{"id": "aceac74b-4372-46d0-95a6-dafdd634a7d8", "content": "# Add to ~/.bashrc or ~/.zshrc\nalias fls='fluxloop status check'\nalias fle='fluxloop status experiments'\n```\n\nUsage:\n```bash\nfls         # Quick status check\nfle -l 20   # List 20 recent experiments\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 54, "total_chunks": null}}
{"id": "22d2ae56-309f-404c-88e6-17cb044d8707", "content": "### Automated Health Checks\n\nAdd status checks to scripts:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 55, "total_chunks": null}}
{"id": "24882174-0a38-411c-9826-15fb7c8cddc0", "content": "#!/bin/bash", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 56, "total_chunks": null}}
{"id": "6eb6590a-bf40-46a9-ab41-76fce17ecbd7", "content": "# run_experiment.sh\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 57, "total_chunks": null}}
{"id": "a8004e50-3e0d-4a82-b4b0-9dd0fa194226", "content": "# Verify system ready\nif ! fluxloop status check --verbose; then\n    echo \"System not ready!\"\n    exit 1\nfi\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 58, "total_chunks": null}}
{"id": "dcd92315-7b55-48bf-a456-5380a0426458", "content": "# Run experiment\nfluxloop run experiment\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 59, "total_chunks": null}}
{"id": "e920c7a8-bd78-40f6-bc44-b50fac3a3efe", "content": "# Show results\nfluxloop status experiments --limit 1\n```\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 60, "total_chunks": null}}
{"id": "cc7fd0c1-6586-412e-a3d8-11735fd3ba5f", "content": "### Monitoring Multiple Projects\n\nCheck status across different projects:\n\n```bash\nfor project in agent-v1 agent-v2 agent-v3; do\n    echo \"=== $project ===\"\n    fluxloop status check --project $project\n    echo\ndone\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 61, "total_chunks": null}}
{"id": "f39794c1-7101-4359-8d0e-003de18af306", "content": "## Exit Codes\n\nAll `status` subcommands follow consistent exit code patterns:\n\n| Exit Code | Meaning |\n|-----------|---------|\n| 0 | Status check completed (doesn't mean all checks passed) |\n| 1 | Invalid arguments or runtime error |\n\n**Note:** `status check` exits with 0 even if some components have issues. Check the output to see actual component status.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 62, "total_chunks": null}}
{"id": "5cbf3bb9-d74e-43fb-97b5-d8177fb6f38f", "content": "## See Also\n\n- [doctor Command](/cli/commands/doctor) - Comprehensive environment diagnostics\n- [config Command](/cli/commands/config) - Configuration management\n- [run Command](/cli/commands/run) - Execute experiments\n- [parse Command](/cli/commands/parse) - Parse experiment results\n- [evaluate Command](/cli/commands/evaluate) - Evaluate experiment outputs", "metadata": {"source": "packages/website/docs-cli/commands/status.md", "chunk_index": 63, "total_chunks": null}}
{"id": "af1abbdd-b8eb-4932-abbe-dfc5d27349d0", "content": "---\nsidebar_position: 4\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 0, "total_chunks": null}}
{"id": "1ede181a-9294-49de-b71f-61f8e59d0e9c", "content": "# Evaluation Configuration\n\nDefine evaluation criteria, success thresholds, and reporting in `configs/evaluation.yaml`.\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 1, "total_chunks": null}}
{"id": "28cea5bd-f165-4307-b838-3e5385f9ec6d", "content": "## Overview\n\nThe evaluation configuration controls how experiment results are scored and reported:\n\n- **Evaluation Goal**: High-level objective description\n- **Evaluators**: Rule-based checks and LLM judges that score each trace\n- **Aggregation**: How individual scores combine\n- **Limits**: Cost controls for LLM evaluations\n- **Success Criteria** (Phase 2): Performance, quality, and functionality thresholds\n- **Additional Analysis** (Phase 2): Persona breakdowns, outlier detection, trends\n- **Report Configuration** (Phase 2): Customizable Markdown and HTML reports", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 2, "total_chunks": null}}
{"id": "b718969a-ab3c-44f4-9f44-b7370000fe16", "content": "- **Advanced Settings** (Phase 2): Statistical tests, alerts\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 3, "total_chunks": null}}
{"id": "ace052ae-ea4a-4538-bbeb-dff585a6e9bc", "content": "## File Location\n\n```\nfluxloop/my-agent/\n└── configs/\n    └── evaluation.yaml    # ← This file\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 4, "total_chunks": null}}
{"id": "7585c9da-6a79-4340-a9c9-eea53f801d12", "content": "## Quick Start Example\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 5, "total_chunks": null}}
{"id": "2301f95a-a6dd-41e2-bf88-7e8f3f5c786e", "content": "# Minimal evaluation config\nevaluators:\n  - name: basic_checks\n    type: rule_based\n    enabled: true\n    weight: 1.0\n    rules:\n      - check: output_not_empty\n      - check: success\n\naggregate:\n  method: weighted_sum\n  threshold: 0.7\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 6, "total_chunks": null}}
{"id": "5ccab577-f3cf-4799-92ce-988a2f12f0b0", "content": "## Evaluation Goal\n\n**Type:** `object`  \n**Phase:** Phase 2\n\nHigh-level description of evaluation objectives.\n\n```yaml\nevaluation_goal:\n  text: |\n    Verify that the agent provides clear, persona-aware responses\n    while meeting latency and accuracy targets.\n```\n\n**Purpose:**\n- Appears in reports and dashboards\n- Guides evaluator selection\n- Communicates intent to stakeholders\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 7, "total_chunks": null}}
{"id": "1ab2d3fc-a1ef-49c8-b61a-6a4b499cc1ae", "content": "## Evaluators\n\nEvaluators score each trace based on specific criteria.\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 8, "total_chunks": null}}
{"id": "47e27643-1ce3-4944-9566-a1dce1387109", "content": "### Evaluator Types\n\n| Type | Description | Use Case |\n|------|-------------|----------|\n| `rule_based` | Predefined checks (latency, keywords, etc.) | Objective, deterministic criteria |\n| `llm_judge` | LLM scores subjective quality | Relevance, coherence, helpfulness |\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 9, "total_chunks": null}}
{"id": "89c0f614-bc98-4aea-985a-b359c9f9d002", "content": "### Rule-Based Evaluators\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 10, "total_chunks": null}}
{"id": "7c97a268-8b89-4bb7-bf1e-dd132f088485", "content": "#### Structure\n\n```yaml\nevaluators:\n  - name: string           # Unique evaluator identifier\n    type: rule_based\n    enabled: boolean       # Enable/disable\n    weight: number         # Importance weight (0.0-1.0)\n    rules:                 # List of checks\n      - check: string\n        ...parameters\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 11, "total_chunks": null}}
{"id": "f77d1d99-715f-4bbc-84ad-1a0c11cf06a9", "content": "#### Example\n\n```yaml\n- name: completeness\n  type: rule_based\n  enabled: true\n  weight: 0.3\n  rules:\n    - check: output_not_empty\n    - check: success\n    - check: latency_under\n      budget_ms: 1200\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 12, "total_chunks": null}}
{"id": "0a2f1cae-3b59-457f-ab8f-d9b0234b30dd", "content": "#### Available Rule Checks\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 13, "total_chunks": null}}
{"id": "8c939876-978d-4258-aec8-7c91c284b130", "content": "##### output_not_empty\n\nVerify output field is not empty.\n\n```yaml\n- check: output_not_empty\n```\n\n**Passes if:**\n- `output` field exists and is non-empty string/object\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 14, "total_chunks": null}}
{"id": "8bf00cb7-d744-4c0b-b5c6-032657044552", "content": "##### success\n\nVerify trace completed successfully.\n\n```yaml\n- check: success\n```\n\n**Passes if:**\n- Trace status is `SUCCESS`\n- No errors occurred\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 15, "total_chunks": null}}
{"id": "2c5cf49f-cfa7-416c-9ac1-09cefd1d79c7", "content": "##### latency_under\n\nCheck execution time under budget.\n\n```yaml\n- check: latency_under\n  budget_ms: 1000\n```\n\n**Parameters:**\n- `budget_ms`: Maximum duration in milliseconds\n\n**Passes if:**\n- `duration_ms` < `budget_ms`\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 16, "total_chunks": null}}
{"id": "939a928a-3c67-4bd5-b9e1-cf02e21776ee", "content": "##### token_usage_under\n\nCheck token consumption.\n\n```yaml\n- check: token_usage_under\n  max_total_tokens: 4000\n  max_prompt_tokens: 2000\n  max_completion_tokens: 2000\n```\n\n**Parameters:**\n- `max_total_tokens`: Total token budget\n- `max_prompt_tokens`: Input token budget (optional)\n- `max_completion_tokens`: Output token budget (optional)\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 17, "total_chunks": null}}
{"id": "f3270888-3128-43d7-b47e-a1f96d4f37da", "content": "##### contains\n\nCheck if target field contains keywords.\n\n```yaml\n- check: contains\n  target: output\n  keywords: [\"help\", \"assist\", \"support\"]\n```\n\n**Parameters:**\n- `target`: Field to check (`output`, `input`, `metadata.X`)\n- `keywords`: List of keywords (case-insensitive)\n\n**Passes if:**\n- Target contains ANY keyword\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 18, "total_chunks": null}}
{"id": "1743a4e6-dd3b-4250-8cac-49f253397529", "content": "##### not_contains\n\nCheck if target field does NOT contain keywords.\n\n```yaml\n- check: not_contains\n  target: output\n  keywords: [\"error\", \"sorry\", \"unavailable\"]\n```\n\n**Parameters:**\n- `target`: Field to check\n- `keywords`: List of forbidden keywords\n\n**Passes if:**\n- Target contains NONE of the keywords\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 19, "total_chunks": null}}
{"id": "fea5626b-1999-4e1f-920f-214b32a4f4f8", "content": "##### similarity\n\nCheck similarity between target and expected value.\n\n```yaml\n- check: similarity\n  target: output\n  expected_path: metadata.expected\n  method: difflib\n  threshold: 0.7\n```\n\n**Parameters:**\n- `target`: Field to compare\n- `expected_path`: Path to expected value\n- `method`: `difflib` | `levenshtein` | `embedding`\n- `threshold`: Minimum similarity (0.0-1.0)\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 20, "total_chunks": null}}
{"id": "21b7c565-a133-4e8b-86da-29203d8a60d5", "content": "### LLM Judge Evaluators\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 21, "total_chunks": null}}
{"id": "435a2f05-13e3-4072-a0ab-540aa77c56d2", "content": "#### Structure\n\n```yaml\nevaluators:\n  - name: string\n    type: llm_judge\n    enabled: boolean\n    weight: number\n    model: string\n    model_parameters: object  # Optional\n    prompt_template: string\n    max_score: number\n    parser: string\n    metadata: object  # Optional\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 22, "total_chunks": null}}
{"id": "41a63260-df74-40e1-8bfe-f38cdd1c752a", "content": "#### Example\n\n```yaml\n- name: response_quality\n  type: llm_judge\n  enabled: true\n  weight: 0.5\n  model: gpt-4o-mini\n  model_parameters:\n    reasoning:\n      effort: medium\n    text:\n      verbosity: medium\n  prompt_template: |\n    Score the assistant's response from 1-10.\n    \n    User Input: {input}\n    Assistant Output: {output}\n    \n    Consider:\n    - Relevance to the question\n    - Completeness of answer\n    - Clarity and conciseness\n    \n    Provide only a number from 1-10.\n  max_score: 10\n  parser: first_number_1_10\n  metadata:", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 23, "total_chunks": null}}
{"id": "8a720c6b-7e9d-4226-8f2d-5bac16d404bd", "content": "    sample_response: \"Score: 8\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 24, "total_chunks": null}}
{"id": "75f39f28-83fd-4c1d-9377-661710208b5a", "content": "#### Fields\n\n| Field | Type | Required | Description |\n|-------|------|----------|-------------|\n| `model` | `string` | Yes | LLM model name (e.g., `gpt-4o-mini`) |\n| `model_parameters` | `object` | No | Model-specific parameters |\n| `prompt_template` | `string` | Yes | Scoring prompt with placeholders |\n| `max_score` | `number` | Yes | Maximum possible score |\n| `parser` | `string` | Yes | How to extract score from LLM response |\n| `metadata` | `object` | No | Additional metadata (sample responses, etc.) |\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 25, "total_chunks": null}}
{"id": "0164058b-660b-4434-bccf-4f5856995ae3", "content": "#### Model Parameters\n\nFor models supporting structured outputs (e.g., OpenAI):\n\n```yaml\nmodel_parameters:\n  reasoning:\n    effort: medium  # low | medium | high\n  text:\n    verbosity: medium  # low | medium | high\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 26, "total_chunks": null}}
{"id": "f5f1c7e7-3bb0-43c8-addb-4e4cc903f2c9", "content": "#### Prompt Templates\n\nUse placeholders for trace data:\n\n| Placeholder | Description |\n|-------------|-------------|\n| `{input}` | User input text |\n| `{output}` | Agent output text |\n| `{persona}` | Persona name |\n| `{duration_ms}` | Execution time |\n| `{metadata.X}` | Custom metadata field |\n| `{observations}` | List of observations |\n\n**Example:**\n\n```yaml\nprompt_template: |\n  You are evaluating a customer support agent.\n  \n  Persona: {persona}\n  User Question: {input}\n  Agent Response: {output}\n  Response Time: {duration_ms}ms", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 27, "total_chunks": null}}
{"id": "073cdb13-78b9-4acd-9735-f980054ba92a", "content": "  \n  Rate the response quality from 1-10 considering:\n  1. Accuracy and correctness\n  2. Helpfulness and completeness\n  3. Appropriate tone for persona\n  4. Response time efficiency\n  \n  Output only a number 1-10.\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 28, "total_chunks": null}}
{"id": "2d906442-4fec-4e35-9655-edefefa7a2fe", "content": "#### Parsers\n\n| Parser | Description | Example Output |\n|--------|-------------|----------------|\n| `first_number_1_10` | Extract first number 1-10 | \"The score is 8\" → `8` |\n| `json_score` | Parse JSON `{\"score\": X}` | `{\"score\": 7}` → `7` |\n| `first_float` | Extract first floating point | \"Score: 8.5/10\" → `8.5` |\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 29, "total_chunks": null}}
{"id": "afb9322a-ea15-4cdb-9204-f7e4fa38dad7", "content": "## Pre-Built Evaluators\n\nFluxLoop provides pre-configured LLM judge evaluators:\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 30, "total_chunks": null}}
{"id": "28b41992-b1ba-4910-8ccb-884793837699", "content": "### intent_recognition\n\nScores how well the agent recognized user intent.\n\n```yaml\n- name: intent_recognition\n  type: llm_judge\n  enabled: true\n  weight: 0.25\n  model: gpt-4o-mini\n  prompt_template: |\n    # Automatically populated from built-in template\n  max_score: 10\n  parser: first_number_1_10\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 31, "total_chunks": null}}
{"id": "234fe616-8ef4-4c8a-bfa7-91771eafeb2f", "content": "### response_consistency\n\nChecks if the response is logically consistent.\n\n```yaml\n- name: response_consistency\n  type: llm_judge\n  enabled: true\n  weight: 0.25\n  model: gpt-4o-mini\n  max_score: 10\n  parser: first_number_1_10\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 32, "total_chunks": null}}
{"id": "8dd52ad1-b9e4-4b58-aab6-9424dc67b9e7", "content": "### response_clarity\n\nEvaluates clarity and conciseness.\n\n```yaml\n- name: response_clarity\n  type: llm_judge\n  enabled: true\n  weight: 0.2\n  model: gpt-4o-mini\n  max_score: 10\n  parser: first_number_1_10\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 33, "total_chunks": null}}
{"id": "7b2f5397-d34d-4835-8ab5-2ebf643fda54", "content": "### information_completeness\n\nChecks if all necessary information is provided.\n\n```yaml\n- name: information_completeness\n  type: llm_judge\n  enabled: false  # Disabled by default\n  weight: 0.1\n  model: gpt-4o-mini\n  max_score: 10\n  parser: first_number_1_10\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 34, "total_chunks": null}}
{"id": "4b02aaeb-c65c-461a-a0ca-bbbd26f62cf9", "content": "## Aggregation\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 35, "total_chunks": null}}
{"id": "c61b657f-f8d6-4afa-b202-e719139ca588", "content": "### aggregate.method\n\n**Type:** `string`  \n**Options:** `weighted_sum` | `average`  \n**Default:** `weighted_sum`\n\nHow to combine evaluator scores.\n\n```yaml\naggregate:\n  method: weighted_sum\n```\n\n**weighted_sum:**\n```\nfinal_score = Σ(evaluator_score × evaluator_weight) / Σ(evaluator_weight)\n```\n\n**average:**\n```\nfinal_score = Σ(evaluator_score) / count(evaluators)\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 36, "total_chunks": null}}
{"id": "4700f1d5-9365-4b53-8219-74064570b3f7", "content": "### aggregate.threshold\n\n**Type:** `number`  \n**Range:** `0.0-1.0`  \n**Default:** `0.7`\n\nPass/fail threshold.\n\n```yaml\naggregate:\n  threshold: 0.75  # 75% to pass\n```\n\n**Behavior:**\n- `final_score >= threshold` → PASS\n- `final_score < threshold` → FAIL\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 37, "total_chunks": null}}
{"id": "14319dac-9a65-41d6-ad4f-c4bc9415b3a7", "content": "### aggregate.by_persona\n\n**Type:** `boolean`  \n**Default:** `true`\n\nGroup statistics by persona.\n\n```yaml\naggregate:\n  by_persona: true\n```\n\n**Enables:**\n- Per-persona scores in reports\n- Persona-specific analysis\n- Identifying persona-specific issues\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 38, "total_chunks": null}}
{"id": "eb2dbd56-c6b9-45a8-8b78-8214d91dda47", "content": "## Limits (Cost Controls)\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 39, "total_chunks": null}}
{"id": "1a871219-22b4-474a-b452-45faef1cee7a", "content": "### limits.sample_rate\n\n**Type:** `number`  \n**Range:** `0.0-1.0`  \n**Default:** `1.0`\n\nFraction of traces to evaluate with LLM judges.\n\n```yaml\nlimits:\n  sample_rate: 0.3  # Evaluate 30% of traces\n```\n\n**Use Cases:**\n\n| Rate | Use Case |\n|------|----------|\n| `1.0` | Full evaluation, < 100 traces |\n| `0.5` | Moderate sampling, 100-500 traces |\n| `0.1-0.3` | Large experiments, 1000+ traces |\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 40, "total_chunks": null}}
{"id": "d5b8c54a-018a-4af8-9ec6-520eda70d013", "content": "### limits.max_llm_calls\n\n**Type:** `integer`  \n**Default:** `50`\n\nMaximum LLM API calls.\n\n```yaml\nlimits:\n  max_llm_calls: 100\n```\n\n**Stops evaluation after reaching limit to control costs.**\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 41, "total_chunks": null}}
{"id": "3f6cdc39-1157-4303-968e-fcfb0822e999", "content": "### limits.timeout_seconds\n\n**Type:** `integer`  \n**Default:** `60`\n\nTimeout per LLM evaluation call.\n\n```yaml\nlimits:\n  timeout_seconds: 30\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 42, "total_chunks": null}}
{"id": "55bbf54f-567f-4ea4-afec-1c316ca961ca", "content": "### limits.cache\n\n**Type:** `string | null`  \n**Default:** `evaluation_cache.jsonl`\n\nCache file for LLM responses.\n\n```yaml\nlimits:\n  cache: evaluation_cache.jsonl\n```\n\n**Benefits:**\n- Avoid re-evaluating same traces\n- Reduce API costs\n- Speed up re-runs\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 43, "total_chunks": null}}
{"id": "b802a90e-63f3-46c2-9056-9b2c43c52a27", "content": "## Success Criteria (Phase 2)\n\nDefine pass/fail thresholds across multiple dimensions.\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 44, "total_chunks": null}}
{"id": "4281cce7-0e88-41cb-b11c-1b9db1ace992", "content": "### Performance Criteria\n\n```yaml\nsuccess_criteria:\n  performance:\n    all_traces_successful: true\n    avg_response_time:\n      enabled: true\n      threshold_ms: 2000\n    max_response_time:\n      enabled: true\n      threshold_ms: 5000\n    error_rate:\n      enabled: true\n      threshold_percent: 5\n```\n\n| Criterion | Description |\n|-----------|-------------|\n| `all_traces_successful` | All traces must succeed (no errors) |\n| `avg_response_time` | Average latency under threshold |\n| `max_response_time` | Maximum latency under threshold |", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 45, "total_chunks": null}}
{"id": "9119bfa5-cb9d-4b8d-b072-ab4e349c62b0", "content": "| `error_rate` | Error percentage under threshold |\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 46, "total_chunks": null}}
{"id": "19de9cba-dda3-49d0-a970-9ba24c0cf895", "content": "### Quality Criteria\n\n```yaml\nsuccess_criteria:\n  quality:\n    intent_recognition: true\n    response_consistency: true\n    response_clarity: true\n    information_completeness: false\n```\n\n**Evaluator names that must pass their thresholds.**\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 47, "total_chunks": null}}
{"id": "098c9cdd-b877-408e-84fa-633e52647e98", "content": "### Functionality Criteria\n\n```yaml\nsuccess_criteria:\n  functionality:\n    tool_calling:\n      enabled: true\n      all_calls_successful: true\n      appropriate_selection: true\n      correct_parameters: true\n      proper_timing: true\n      handles_failures: true\n```\n\n**Tool calling requirements:**\n\n| Check | Description |\n|-------|-------------|\n| `all_calls_successful` | All tool calls succeed |\n| `appropriate_selection` | Correct tools chosen |\n| `correct_parameters` | Valid parameters passed |\n| `proper_timing` | Tools called in logical order |", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 48, "total_chunks": null}}
{"id": "7db63e19-22b4-43d9-88ed-0b8bbbb0a3d9", "content": "| `handles_failures` | Gracefully handles tool errors |\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 49, "total_chunks": null}}
{"id": "947b813f-1e13-464d-826b-d698d11941fc", "content": "## Additional Analysis (Phase 2)\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 50, "total_chunks": null}}
{"id": "0d124dda-8a6c-4373-9ea0-3b3765a9d029", "content": "### Persona Analysis\n\n```yaml\nadditional_analysis:\n  persona:\n    enabled: true\n    focus_personas: [\"expert_user\", \"novice_user\"]\n```\n\n**Generates:**\n- Per-persona performance breakdown\n- Persona-specific failure patterns\n- Comparative persona analysis\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 51, "total_chunks": null}}
{"id": "df7f1c99-9514-4727-b600-6fa785d28153", "content": "### Performance Analysis\n\n```yaml\nadditional_analysis:\n  performance:\n    detect_outliers: true\n    trend_analysis: true\n```\n\n**Features:**\n- Outlier detection (statistical anomalies)\n- Trend analysis over time\n- Performance distribution charts\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 52, "total_chunks": null}}
{"id": "abbc7420-eeba-4e8d-adfc-d24180935116", "content": "### Failure Analysis\n\n```yaml\nadditional_analysis:\n  failures:\n    enabled: true\n    categorize_causes: true\n```\n\n**Provides:**\n- Failure categorization\n- Root cause analysis\n- Common failure patterns\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 53, "total_chunks": null}}
{"id": "73fba872-fd77-42b5-84df-d23ea3e62a3d", "content": "### Baseline Comparison\n\n```yaml\nadditional_analysis:\n  comparison:\n    enabled: true\n    baseline_path: \"experiments/baseline_v1/evaluation/summary.json\"\n```\n\n**Compares:**\n- Score changes vs baseline\n- Performance regression detection\n- Improvement/degradation analysis\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 54, "total_chunks": null}}
{"id": "1ab4bc82-d5ff-4351-8bdf-e7f26abf39cc", "content": "## Report Configuration (Phase 2)\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 55, "total_chunks": null}}
{"id": "1ff9bb85-95eb-4411-81ec-1b9104ad3ba1", "content": "### report.style\n\n**Type:** `string`  \n**Options:** `quick` | `standard` | `detailed`  \n**Default:** `standard`\n\nReport detail level.\n\n```yaml\nreport:\n  style: standard\n```\n\n| Style | Sections | Use Case |\n|-------|----------|----------|\n| `quick` | Executive summary, key metrics | Quick checks, CI/CD |\n| `standard` | + Detailed results, recommendations | Regular testing |\n| `detailed` | + Statistical analysis, examples | Deep analysis |\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 56, "total_chunks": null}}
{"id": "676b9cf6-6b13-4f47-992b-93d540c4ca40", "content": "### report.sections\n\n```yaml\nreport:\n  sections:\n    executive_summary: true\n    key_metrics: true\n    detailed_results: true\n    statistical_analysis: false\n    failure_cases: true\n    success_examples: false\n    recommendations: true\n    action_items: true\n```\n\n**Available Sections:**\n\n| Section | Description |\n|---------|-------------|\n| `executive_summary` | High-level overview |\n| `key_metrics` | Core statistics |\n| `detailed_results` | Per-evaluator breakdown |\n| `statistical_analysis` | Advanced stats |\n| `failure_cases` | Failed trace examples |", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 57, "total_chunks": null}}
{"id": "c69827c7-e0a7-424f-b5e9-f0f899ef3675", "content": "| `success_examples` | Successful trace examples |\n| `recommendations` | Improvement suggestions |\n| `action_items` | Specific next steps |\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 58, "total_chunks": null}}
{"id": "33b6a1b2-5124-4b35-ad17-37b91ecfdde1", "content": "### report.visualizations\n\n```yaml\nreport:\n  visualizations:\n    charts_and_graphs: true\n    tables: true\n    interactive: true\n```\n\n**Options:**\n- `charts_and_graphs`: Include charts in HTML report\n- `tables`: Data tables\n- `interactive`: Interactive HTML elements\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 59, "total_chunks": null}}
{"id": "7a0a6aa6-f9c7-4b17-b392-618794cc14b5", "content": "### report.tone\n\n**Type:** `string`  \n**Options:** `technical` | `executive` | `balanced`  \n**Default:** `balanced`\n\nReport writing style.\n\n```yaml\nreport:\n  tone: executive\n```\n\n| Tone | Audience | Style |\n|------|----------|-------|\n| `technical` | Engineers | Detailed, metrics-focused |\n| `executive` | Leadership | High-level, business impact |\n| `balanced` | Mixed | Both technical and business |\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 60, "total_chunks": null}}
{"id": "04440cb4-327c-4d49-9319-0e9c89b9778d", "content": "### report.output\n\n**Type:** `string`  \n**Options:** `md` | `html` | `both`  \n**Default:** `both`\n\nReport format(s) to generate.\n\n```yaml\nreport:\n  output: both\n```\n\n**Generates:**\n- `md`: `report.md` (Markdown)\n- `html`: `report.html` (Interactive HTML)\n- `both`: Both formats\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 61, "total_chunks": null}}
{"id": "579a4dc2-06d3-4a29-8d3a-e6336a9e903c", "content": "### report.template_path\n\n**Type:** `string | null`  \n**Default:** `null`\n\nCustom HTML template path.\n\n```yaml\nreport:\n  template_path: \"templates/custom_report.html\"\n```\n\n**Use for:**\n- Company branding\n- Custom visualizations\n- Specific formatting requirements\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 62, "total_chunks": null}}
{"id": "bf1d204b-8e34-458e-b8e5-8bcf8c0055ac", "content": "## Advanced Settings (Phase 2)\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 63, "total_chunks": null}}
{"id": "53fe5a6a-dad2-4bca-a2d4-1ee252ef0c67", "content": "### Statistical Tests\n\n```yaml\nadvanced:\n  statistical_tests:\n    enabled: true\n    significance_level: 0.05\n    confidence_interval: 0.95\n```\n\n**Enables:**\n- Hypothesis testing\n- Confidence intervals\n- Statistical significance checks\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 64, "total_chunks": null}}
{"id": "04c228ae-7d86-4f64-a130-519fa957b28d", "content": "### Outlier Handling\n\n```yaml\nadvanced:\n  outliers:\n    detection: true\n    handling: analyze_separately  # remove | analyze_separately | include\n```\n\n| Handling | Description |\n|----------|-------------|\n| `remove` | Exclude outliers from aggregate stats |\n| `analyze_separately` | Include but call out in reports |\n| `include` | Treat as normal data points |\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 65, "total_chunks": null}}
{"id": "86642bad-8a5b-4cc7-9475-e345881d271a", "content": "### Alerts\n\n```yaml\nadvanced:\n  alerts:\n    enabled: true\n    conditions:\n      - metric: \"error_rate\"\n        threshold: 10\n        operator: \">\"\n      - metric: \"avg_score\"\n        threshold: 0.7\n        operator: \"<\"\n```\n\n**Alert Conditions:**\n- `metric`: Metric to monitor\n- `threshold`: Threshold value\n- `operator`: `>`, `<`, `>=`, `<=`, `==`\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 66, "total_chunks": null}}
{"id": "66c3492e-ca11-4825-ba4d-bd6ce604b338", "content": "## Complete Examples\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 67, "total_chunks": null}}
{"id": "68649bbe-7fb9-4f8d-b5d7-63050b6b7424", "content": "### Minimal (Quick Start)\n\n```yaml\nevaluators:\n  - name: basic\n    type: rule_based\n    enabled: true\n    weight: 1.0\n    rules:\n      - check: output_not_empty\n      - check: success\n\naggregate:\n  method: weighted_sum\n  threshold: 0.7\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 68, "total_chunks": null}}
{"id": "bbe65f87-04ae-4ef3-8857-0bce52ef2f8d", "content": "### Standard Testing\n\n```yaml\nevaluation_goal:\n  text: \"Validate agent provides accurate, helpful responses\"\n\nevaluators:\n  - name: completeness\n    type: rule_based\n    enabled: true\n    weight: 0.3\n    rules:\n      - check: output_not_empty\n      - check: success\n      - check: latency_under\n        budget_ms: 2000\n\n  - name: intent_recognition\n    type: llm_judge\n    enabled: true\n    weight: 0.35\n    model: gpt-4o-mini\n    max_score: 10\n    parser: first_number_1_10\n\n  - name: response_clarity\n    type: llm_judge\n    enabled: true", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 69, "total_chunks": null}}
{"id": "9fb2b7f7-61f1-41df-8feb-5ce8954331a9", "content": "    weight: 0.35\n    model: gpt-4o-mini\n    max_score: 10\n    parser: first_number_1_10\n\naggregate:\n  method: weighted_sum\n  threshold: 0.75\n  by_persona: true\n\nlimits:\n  sample_rate: 0.5\n  max_llm_calls: 100\n  cache: evaluation_cache.jsonl\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 70, "total_chunks": null}}
{"id": "45222948-bbd9-4f6d-8bc6-0044d6f19fb4", "content": "### Production Validation (Phase 2)\n\n```yaml\nevaluation_goal:\n  text: |\n    Comprehensive validation before production deployment.\n    Ensure quality, performance, and reliability targets.\n\nevaluators:\n  - name: not_empty\n    type: rule_based\n    enabled: true\n    weight: 0.2\n    rules:\n      - check: output_not_empty\n\n  - name: token_budget\n    type: rule_based\n    enabled: true\n    weight: 0.2\n    rules:\n      - check: token_usage_under\n        max_total_tokens: 4000\n\n  - name: intent_recognition\n    type: llm_judge\n    enabled: true", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 71, "total_chunks": null}}
{"id": "98db7f8c-7833-4360-8c44-1c437de6b874", "content": "    weight: 0.3\n    model: gpt-4o\n    max_score: 10\n    parser: first_number_1_10\n\n  - name: response_quality\n    type: llm_judge\n    enabled: true\n    weight: 0.3\n    model: gpt-4o\n    max_score: 10\n    parser: first_number_1_10\n\naggregate:\n  method: weighted_sum\n  threshold: 0.8\n  by_persona: true\n\nlimits:\n  sample_rate: 1.0\n  max_llm_calls: 500\n  cache: prod_eval_cache.jsonl\n\nsuccess_criteria:\n  performance:\n    all_traces_successful: true\n    avg_response_time:\n      enabled: true\n      threshold_ms: 1500\n    error_rate:\n      enabled: true", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 72, "total_chunks": null}}
{"id": "e578e48b-22a8-4ee3-8d58-5fb63b323f2a", "content": "      threshold_percent: 2\n\n  quality:\n    intent_recognition: true\n    response_quality: true\n\nadditional_analysis:\n  persona:\n    enabled: true\n  performance:\n    detect_outliers: true\n    trend_analysis: true\n  failures:\n    enabled: true\n    categorize_causes: true\n  comparison:\n    enabled: true\n    baseline_path: \"experiments/baseline/evaluation/summary.json\"\n\nreport:\n  style: detailed\n  sections:\n    executive_summary: true\n    key_metrics: true\n    detailed_results: true\n    statistical_analysis: true\n    failure_cases: true", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 73, "total_chunks": null}}
{"id": "09887c43-e8c2-41a3-8c61-19afd585be3e", "content": "    recommendations: true\n    action_items: true\n  visualizations:\n    charts_and_graphs: true\n    tables: true\n    interactive: true\n  tone: balanced\n  output: both\n\nadvanced:\n  statistical_tests:\n    enabled: true\n    significance_level: 0.05\n  outliers:\n    detection: true\n    handling: analyze_separately\n  alerts:\n    enabled: true\n    conditions:\n      - metric: \"error_rate\"\n        threshold: 5\n        operator: \">\"\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 74, "total_chunks": null}}
{"id": "5373822f-b3ed-4098-bbdf-d51ba01bdce5", "content": "## See Also\n\n- [evaluate Command](/cli/commands/evaluate) - Evaluation CLI reference\n- [Basic Workflow](/cli/workflows/basic-workflow) - Complete workflow guide\n- [Simulation Configuration](/cli/configuration/simulation-config) - Experiment settings\n- [Input Configuration](/cli/configuration/input-config) - Input generation", "metadata": {"source": "packages/website/docs-cli/configuration/evaluation-config.md", "chunk_index": 75, "total_chunks": null}}
{"id": "03a08d5f-a10b-4f72-96fc-628dfc9f9a5a", "content": "---\nsidebar_position: 2\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 0, "total_chunks": null}}
{"id": "6bd88b6e-3c23-4514-a473-2921b16ab7f4", "content": "# Input Configuration\n\nConfigure personas, base inputs, and input generation settings in `configs/input.yaml`.\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 1, "total_chunks": null}}
{"id": "542d4a62-b276-4c64-ad6a-de0926f161d3", "content": "## Overview\n\nThe input configuration file defines:\n\n- **Personas**: Different user types with characteristics and goals\n- **Base Inputs**: Core test inputs to generate variations from\n- **Generation Settings**: How to create input variations (LLM or deterministic)\n- **Variation Strategies**: Transformations to apply (rephrase, verbose, etc.)\n\nThis configuration drives the `fluxloop generate inputs` command.\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 2, "total_chunks": null}}
{"id": "27556c1a-d743-4079-8353-5ff7248f864a", "content": "## File Location\n\n```\nfluxloop/my-agent/\n└── configs/\n    └── input.yaml    # ← This file\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 3, "total_chunks": null}}
{"id": "96f15ebb-a9a2-4f7c-9799-12316ca9946d", "content": "## Complete Example\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 4, "total_chunks": null}}
{"id": "cabe89d8-2a96-447f-9da1-7f254741e244", "content": "# FluxLoop Input Configuration", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 5, "total_chunks": null}}
{"id": "3e872655-6b08-483d-9057-7aacb73a33fe", "content": "# ------------------------------------------------------------", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 6, "total_chunks": null}}
{"id": "9365ea95-3279-4e7b-88cf-cc35494daded", "content": "# Defines personas, base inputs, and generation modes.", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 7, "total_chunks": null}}
{"id": "a7cc6a71-d2e0-49c4-a203-93e8a72cca7c", "content": "# Adjust personas/goals/strategies based on your target scenarios.\npersonas:\n  - name: novice_user\n    description: A user new to the system\n    characteristics:\n      - Asks basic questions\n      - May use incorrect terminology\n      - Needs detailed explanations\n    language: en\n    expertise_level: novice\n    goals:\n      - Understand system capabilities\n      - Complete basic tasks\n    # Tip: Add persona-specific context that can be injected into prompts.\n\n  - name: expert_user\n    description: An experienced power user", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 8, "total_chunks": null}}
{"id": "14e5ea16-5651-4411-a785-0dfda980f404", "content": "    characteristics:\n      - Uses technical terminology\n      - Asks complex questions\n      - Expects efficient responses\n    language: en\n    expertise_level: expert\n    goals:\n      - Optimize workflows\n      - Access advanced features\n    # Tip: Include any tone/style expectations in characteristics.\n\nbase_inputs:\n  - input: \"How do I get started?\"\n    expected_intent: help\n    # Provide optional 'metadata' or 'expected' fields to guide evaluation.\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 9, "total_chunks": null}}
{"id": "27a9ae08-435e-415f-b730-a2394d1191d8", "content": "# ------------------------------------------------------------", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 10, "total_chunks": null}}
{"id": "9d435b56-8c28-42d5-84ed-612191d80f80", "content": "# Input generation settings", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 11, "total_chunks": null}}
{"id": "87be84b7-1bbe-420b-8590-b396741dcfa2", "content": "# - variation_strategies: transformations applied when synthesizing inputs.", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 12, "total_chunks": null}}
{"id": "a7a38c8e-9b7a-4002-a958-fb37c91213b5", "content": "# - variation_count / temperature: tune diversity of generated samples.", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 13, "total_chunks": null}}
{"id": "37e7824a-1806-4c7a-bb99-000071f72256", "content": "# - inputs_file: location where generated inputs will be saved/loaded.\nvariation_strategies:\n  - rephrase\n  - verbose\n  - error_prone\n\nvariation_count: 2\nvariation_temperature: 0.7\n\ninputs_file: inputs/generated.yaml\n\ninput_generation:\n  mode: llm\n  llm:\n    enabled: true\n    provider: openai\n    model: gpt-4o-mini\n    api_key: null\n    # Replace provider/model/api_key according to your LLM setup.\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 14, "total_chunks": null}}
{"id": "58d8c64c-a5ff-4e2e-be5c-510fbfff73aa", "content": "## Personas\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 15, "total_chunks": null}}
{"id": "6649b256-50c1-4580-8a24-0a6bf027af30", "content": "### Overview\n\nPersonas represent different user types that will interact with your agent. Each persona has:\n- Identity (name, description)\n- Characteristics (behavior patterns)\n- Expertise level\n- Goals and objectives\n- Language preferences\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 16, "total_chunks": null}}
{"id": "e9bd0055-d35c-4ba8-9d26-fd22e95bd71e", "content": "### Persona Structure\n\n```yaml\npersonas:\n  - name: string              # Required: unique identifier\n    description: string       # Required: human-readable description\n    characteristics: list     # Optional: behavioral traits\n    language: string          # Optional: ISO language code (default: \"en\")\n    expertise_level: string   # Optional: novice/intermediate/expert\n    goals: list              # Optional: user objectives\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 17, "total_chunks": null}}
{"id": "baa82286-b8f4-446f-8b5c-cae0f510f0b2", "content": "### Example Personas\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 18, "total_chunks": null}}
{"id": "7714f4d2-e22e-4c51-9400-1d1a85a8f142", "content": "#### Novice User\n\n```yaml\n- name: novice_user\n  description: A user new to the system\n  characteristics:\n    - Asks basic questions\n    - May use incorrect terminology\n    - Needs detailed explanations\n    - Prefers step-by-step guidance\n  language: en\n  expertise_level: novice\n  goals:\n    - Understand system capabilities\n    - Complete basic tasks\n    - Learn fundamental concepts\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 19, "total_chunks": null}}
{"id": "721daa7e-68b9-4091-917e-11b3d2eadff8", "content": "#### Expert User\n\n```yaml\n- name: expert_user\n  description: An experienced power user\n  characteristics:\n    - Uses technical terminology\n    - Asks complex questions\n    - Expects efficient responses\n    - Wants advanced features\n  language: en\n  expertise_level: expert\n  goals:\n    - Optimize workflows\n    - Access advanced features\n    - Automate repetitive tasks\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 20, "total_chunks": null}}
{"id": "c986d9dc-1954-497f-8463-aab9ad33a6ec", "content": "#### Non-Native Speaker\n\n```yaml\n- name: non_native_speaker\n  description: User with limited English proficiency\n  characteristics:\n    - Uses simple vocabulary\n    - May have grammatical errors\n    - Shorter sentences\n    - Literal interpretations\n  language: en\n  expertise_level: intermediate\n  goals:\n    - Get clear, simple answers\n    - Avoid complex terminology\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 21, "total_chunks": null}}
{"id": "99965453-4362-4955-a0f9-9a4fec1fe5ac", "content": "#### Frustrated User\n\n```yaml\n- name: frustrated_user\n  description: User experiencing issues or delays\n  characteristics:\n    - Expresses frustration or urgency\n    - May be impatient\n    - Wants quick solutions\n    - Previous attempts failed\n  language: en\n  expertise_level: intermediate\n  goals:\n    - Resolve issue quickly\n    - Get reassurance\n    - Understand what went wrong\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 22, "total_chunks": null}}
{"id": "ded32148-a64a-4d3f-befe-96bdf8e755d9", "content": "### Persona Fields\n\n| Field | Type | Required | Description |\n|-------|------|----------|-------------|\n| `name` | `string` | Yes | Unique persona identifier (snake_case) |\n| `description` | `string` | Yes | Human-readable persona description |\n| `characteristics` | `list[string]` | No | Behavioral traits and patterns |\n| `language` | `string` | No | ISO language code (e.g., `en`, `es`, `fr`) |\n| `expertise_level` | `string` | No | `novice`, `intermediate`, `expert` |\n| `goals` | `list[string]` | No | User objectives and motivations |", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 23, "total_chunks": null}}
{"id": "297f135f-6e1e-4c78-be83-a7989e08727a", "content": "### How Personas Are Used\n\n1. **Input Generation**: LLM uses persona characteristics to generate realistic variations\n2. **Multi-Turn**: Supervisor uses persona to craft follow-up questions\n3. **Evaluation**: Results can be grouped by persona for analysis\n4. **Reporting**: Dashboard shows performance per persona type\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 25, "total_chunks": null}}
{"id": "d7cf4362-066e-4701-8d57-1b0571552e69", "content": "## Base Inputs\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 26, "total_chunks": null}}
{"id": "7eb2adba-0670-4a67-8296-fd8b8525565c", "content": "### Overview\n\nBase inputs are the core test cases from which variations are generated. Each base input represents a distinct user intent or scenario.\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 27, "total_chunks": null}}
{"id": "3ad2f363-42bd-4ef1-b03d-69c73902227e", "content": "### Base Input Structure\n\n```yaml\nbase_inputs:\n  - input: string             # Required: the actual input text\n    expected_intent: string   # Optional: expected intent/category\n    metadata: object          # Optional: custom fields\n    persona: string           # Optional: default persona for this input\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 28, "total_chunks": null}}
{"id": "97faeb05-c3f6-45ea-b6cc-d2455345bbee", "content": "### Example Base Inputs\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 29, "total_chunks": null}}
{"id": "d8e04aeb-0301-4f8d-aae6-03577eaae6e7", "content": "#### Simple Base Inputs\n\n```yaml\nbase_inputs:\n  - input: \"How do I get started?\"\n    expected_intent: help\n    \n  - input: \"What are the pricing plans?\"\n    expected_intent: pricing_inquiry\n    \n  - input: \"I can't log in to my account\"\n    expected_intent: troubleshooting\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 30, "total_chunks": null}}
{"id": "24f2018d-dbc3-4473-b0ed-1de593b36a7b", "content": "#### With Metadata\n\n```yaml\nbase_inputs:\n  - input: \"How do I reset my password?\"\n    expected_intent: account_management\n    metadata:\n      category: authentication\n      priority: high\n      typical_persona: novice_user\n      \n  - input: \"Show me advanced filtering options\"\n    expected_intent: feature_inquiry\n    metadata:\n      category: features\n      complexity: high\n      typical_persona: expert_user\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 31, "total_chunks": null}}
{"id": "f3aeeaa1-832d-4e0a-aa94-6d6c9c0fdee2", "content": "#### With Expected Outputs\n\n```yaml\nbase_inputs:\n  - input: \"What's the status of order #12345?\"\n    expected_intent: order_inquiry\n    metadata:\n      expected_tool_calls: [\"get_order_status\"]\n      expected_response_type: \"structured_data\"\n      test_data:\n        order_id: \"12345\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 32, "total_chunks": null}}
{"id": "8d1e735a-a122-4e46-be73-80ce69b5678d", "content": "### Base Input Fields\n\n| Field | Type | Required | Description |\n|-------|------|----------|-------------|\n| `input` | `string` | Yes | The actual input text |\n| `expected_intent` | `string` | No | Expected intent/category (for evaluation) |\n| `metadata` | `object` | No | Any custom metadata |\n| `persona` | `string` | No | Default persona for this input |\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 33, "total_chunks": null}}
{"id": "cee344a8-7f21-42f1-9a21-b839f3e876ae", "content": "### Design Guidelines\n\n**Good Base Inputs:**\n- Cover diverse user intents\n- Represent real-world scenarios\n- Include edge cases (errors, ambiguity)\n- Vary in complexity\n- Test different features\n\n**Examples:**\n\n```yaml\nbase_inputs:\n  # Happy path\n  - input: \"How do I create a new project?\"\n    expected_intent: getting_started\n  \n  # Edge case - ambiguous\n  - input: \"Can you help me?\"\n    expected_intent: help_general\n  \n  # Edge case - error scenario\n  - input: \"Why isn't this working?!?\"\n    expected_intent: troubleshooting\n  ", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 34, "total_chunks": null}}
{"id": "40f3ec13-53e6-4040-9f0c-4909ae060a01", "content": "  # Complex multi-step\n  - input: \"I need to export my data, format it as CSV, and email it\"\n    expected_intent: complex_task\n  \n  # Non-English (if supported)\n  - input: \"¿Cómo puedo empezar?\"\n    expected_intent: help\n    metadata:\n      language: es\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 35, "total_chunks": null}}
{"id": "65b6a787-43a8-4491-a997-676aad56f350", "content": "## Variation Strategies\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 36, "total_chunks": null}}
{"id": "b76c85da-15bd-48d1-931f-dc6fd6887543", "content": "### Available Strategies\n\n| Strategy | Description | Use Case |\n|----------|-------------|----------|\n| `rephrase` | Reword input keeping same meaning | Test semantic understanding |\n| `verbose` | Add more details and context | Test handling of lengthy input |\n| `concise` | Shorten to minimal form | Test with terse users |\n| `error_prone` | Add typos, grammar errors | Test robustness |\n| `formal` | Use formal language | Test tone adaptation |\n| `casual` | Use casual/slang language | Test informal input |\n| `technical` | Add technical terminology | Test expert users |", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 37, "total_chunks": null}}
{"id": "118f200a-c697-4400-9117-fb60f61c814b", "content": "| `simple` | Simplify vocabulary | Test novice users |\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 38, "total_chunks": null}}
{"id": "b2e74e8a-49cf-461c-acc3-64ba71348f79", "content": "### Configuration\n\n```yaml\nvariation_strategies:\n  - rephrase     # Always useful\n  - verbose      # Test long-winded users\n  - error_prone  # Test robustness\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 39, "total_chunks": null}}
{"id": "9fa2ec7b-ed07-4c9f-8b39-458a42c29bc2", "content": "### Examples of Variations\n\n**Base Input:**\n```\n\"How do I get started?\"\n```\n\n**Variations:**\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 40, "total_chunks": null}}
{"id": "35869263-6d02-40c7-9037-8b9b59dd5828", "content": "# rephrase\n- \"What are the first steps to begin?\"\n- \"Where should I start?\"\n- \"How can I initiate the process?\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 41, "total_chunks": null}}
{"id": "c8768d51-8d42-4a0a-9361-f46d05b5be40", "content": "# verbose\n- \"Hello, I'm completely new to this system and I was wondering if you could help me understand how I should get started with using it?\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 42, "total_chunks": null}}
{"id": "b9f906d1-3781-439c-9591-85ebe47b8599", "content": "# error_prone\n- \"how do i get strated?\"\n- \"How do i gte started?\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 43, "total_chunks": null}}
{"id": "0ecf05ed-92ba-4dcd-aa14-640fbdf6796a", "content": "# casual\n- \"yo how do i get going with this?\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 44, "total_chunks": null}}
{"id": "af92211d-ec7e-4173-a9e2-21f865064ec3", "content": "# formal\n- \"I would like to inquire about the initial steps required to commence.\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 45, "total_chunks": null}}
{"id": "84cb52bf-5a2e-49dd-9ab0-c06253998199", "content": "# technical (if applicable)\n- \"What's the initialization procedure for the system?\"\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 46, "total_chunks": null}}
{"id": "1e91461b-fb13-4e24-9163-49d77472a24b", "content": "## Input Generation Settings\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 47, "total_chunks": null}}
{"id": "5bba14ee-f6d4-46f4-b70d-894e22b2bb1d", "content": "### variation_count\n\n**Type:** `integer`  \n**Default:** `2`  \n**Range:** `1-10`\n\nNumber of variations to generate per base input × persona combination.\n\n```yaml\nvariation_count: 2  # Generate 2 variations each\n```\n\n**Formula:**\n```\nTotal Inputs = base_inputs × personas × variation_count\n```\n\n**Example:**\n- 5 base inputs\n- 2 personas  \n- 3 variations\n- **Total: 30 generated inputs**\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 48, "total_chunks": null}}
{"id": "f4a9cdf1-51cc-4c6f-aa25-bdbe928be95b", "content": "### variation_temperature\n\n**Type:** `float`  \n**Default:** `0.7`  \n**Range:** `0.0-2.0`\n\nControls diversity of LLM-generated variations.\n\n```yaml\nvariation_temperature: 0.7  # Balanced diversity\n```\n\n| Temperature | Effect | Use Case |\n|-------------|--------|----------|\n| `0.0-0.3` | Very conservative, minimal changes | Subtle rephrasing |\n| `0.4-0.7` | Balanced diversity | General use (recommended) |\n| `0.8-1.2` | More creative variations | Stress testing |\n| `1.3-2.0` | Highly diverse, unpredictable | Edge case discovery |", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 49, "total_chunks": null}}
{"id": "ea2b1285-dbdd-4e37-8a8c-cae2997ea435", "content": "### inputs_file\n\n**Type:** `string`  \n**Default:** `inputs/generated.yaml`\n\nPath where generated inputs will be saved (relative to project root).\n\n```yaml\ninputs_file: inputs/generated.yaml\n```\n\n**File Structure:**\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 51, "total_chunks": null}}
{"id": "abd40eb1-aeac-428a-8f45-070fc1bec8a7", "content": "# inputs/generated.yaml\n- input: \"How can I begin?\"\n  persona: novice_user\n  metadata:\n    base_input: \"How do I get started?\"\n    variation_strategy: rephrase\n    variation_index: 0\n    generated_at: \"2025-01-17T14:30:22Z\"\n\n- input: \"Hello, I'm new and wondering how to get started...\"\n  persona: novice_user\n  metadata:\n    base_input: \"How do I get started?\"\n    variation_strategy: verbose\n    variation_index: 1\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 52, "total_chunks": null}}
{"id": "ef6e60b4-5224-44a7-9ca7-b78e41a3d836", "content": "## LLM Configuration\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 53, "total_chunks": null}}
{"id": "564460dc-b107-4c34-8943-d174dadcdd12", "content": "### input_generation.mode\n\n**Type:** `string`  \n**Options:** `llm` | `deterministic`  \n**Default:** `llm`\n\nGeneration mode to use.\n\n```yaml\ninput_generation:\n  mode: llm  # or deterministic\n```\n\n**LLM Mode:**\n- Uses language model to generate variations\n- More natural and diverse\n- Requires API key\n- Non-deterministic (different each run)\n\n**Deterministic Mode:**\n- Uses rule-based transformations\n- Reproducible results\n- No API key needed\n- Faster and cheaper\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 54, "total_chunks": null}}
{"id": "2c771a23-5b78-4813-8abc-770b6f0cbcc8", "content": "### LLM Settings\n\n```yaml\ninput_generation:\n  mode: llm\n  llm:\n    enabled: true\n    provider: openai\n    model: gpt-4o-mini\n    api_key: null  # Set via OPENAI_API_KEY env var\n```\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `enabled` | `boolean` | Enable LLM generation |\n| `provider` | `string` | `openai`, `anthropic`, `gemini` |\n| `model` | `string` | Model name (e.g., `gpt-4o-mini`) |\n| `api_key` | `string \\| null` | API key (use env var instead) |\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 55, "total_chunks": null}}
{"id": "e798a7e4-b528-4110-8bb2-abf3c23fe82f", "content": "### Supported Providers\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 56, "total_chunks": null}}
{"id": "9a6d0c2b-6935-4662-a992-dc448dc6f09e", "content": "#### OpenAI\n\n```yaml\nllm:\n  provider: openai\n  model: gpt-4o-mini  # or gpt-4o, gpt-4-turbo\n  api_key: null  # Set OPENAI_API_KEY\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 57, "total_chunks": null}}
{"id": "71850d9a-fbe0-4ed0-96ed-a392db9546e7", "content": "#### Anthropic\n\n```yaml\nllm:\n  provider: anthropic\n  model: claude-3-haiku-20240307  # or claude-3-5-sonnet-20241022\n  api_key: null  # Set ANTHROPIC_API_KEY\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 58, "total_chunks": null}}
{"id": "d142ac45-887b-4a1e-8170-5570005db46e", "content": "#### Google Gemini\n\n```yaml\nllm:\n  provider: gemini\n  model: gemini-2.0-flash-exp  # or gemini-2.5-flash\n  api_key: null  # Set GEMINI_API_KEY\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 59, "total_chunks": null}}
{"id": "21003452-b2f7-410b-a97a-d29a9c304958", "content": "### Setting API Keys\n\n**Via CLI:**\n```bash\nfluxloop config set-llm openai sk-your-key --model gpt-4o-mini\n```\n\n**Via .env file:**\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 60, "total_chunks": null}}
{"id": "ce110de2-e73d-4b2d-a07e-b504004f71be", "content": "# .env\nOPENAI_API_KEY=sk-your-key\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 61, "total_chunks": null}}
{"id": "48b71eaa-5513-4ec3-988c-63436935721c", "content": "## Complete Examples\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 62, "total_chunks": null}}
{"id": "1ba7a35a-058a-45b3-a104-de6b92b09413", "content": "### Minimal Configuration\n\n```yaml\npersonas:\n  - name: user\n    description: Regular user\n\nbase_inputs:\n  - input: \"Hello\"\n  - input: \"Help me\"\n\ninput_generation:\n  mode: deterministic\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 63, "total_chunks": null}}
{"id": "60126100-1fa4-4b44-86d9-653edde8539b", "content": "### Standard Configuration\n\n```yaml\npersonas:\n  - name: novice_user\n    description: New to the system\n    expertise_level: novice\n  \n  - name: expert_user\n    description: Experienced user\n    expertise_level: expert\n\nbase_inputs:\n  - input: \"How do I get started?\"\n    expected_intent: help\n  \n  - input: \"What are the advanced features?\"\n    expected_intent: features\n\nvariation_strategies:\n  - rephrase\n  - verbose\n\nvariation_count: 3\nvariation_temperature: 0.7\n\ninputs_file: inputs/generated.yaml\n\ninput_generation:\n  mode: llm\n  llm:", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 64, "total_chunks": null}}
{"id": "ca216772-597d-417e-95cb-e5e5fc6c1a2b", "content": "    provider: openai\n    model: gpt-4o-mini\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 65, "total_chunks": null}}
{"id": "92cf3d23-8fc8-4a9d-aa11-32f205a37ace", "content": "### Advanced Configuration\n\n```yaml\npersonas:\n  - name: novice_user\n    description: First-time user\n    characteristics:\n      - Asks basic questions\n      - Needs guidance\n      - May make mistakes\n    language: en\n    expertise_level: novice\n    goals:\n      - Learn the basics\n      - Complete first task\n  \n  - name: expert_user\n    description: Power user\n    characteristics:\n      - Uses shortcuts\n      - Expects efficiency\n      - Knows advanced features\n    language: en\n    expertise_level: expert\n    goals:\n      - Automate workflows", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 66, "total_chunks": null}}
{"id": "93e7f296-db87-47e3-be07-d6bb8b3bbfca", "content": "      - Optimize performance\n  \n  - name: non_english_user\n    description: ESL user\n    characteristics:\n      - Simple vocabulary\n      - Grammatical errors\n      - Direct questions\n    language: en\n    expertise_level: intermediate\n    goals:\n      - Clear communication\n      - Avoid confusion\n\nbase_inputs:\n  - input: \"How do I create a new project?\"\n    expected_intent: project_creation\n    metadata:\n      category: getting_started\n      complexity: easy\n  \n  - input: \"I need to bulk import 1000 items from CSV\"\n    expected_intent: data_import", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 67, "total_chunks": null}}
{"id": "dbf4d29c-912d-4994-88e9-9cb22e2e08d8", "content": "    metadata:\n      category: advanced\n      complexity: high\n  \n  - input: \"Error 500 when I click submit\"\n    expected_intent: error_report\n    metadata:\n      category: troubleshooting\n      priority: high\n\nvariation_strategies:\n  - rephrase\n  - verbose\n  - error_prone\n  - casual\n  - formal\n\nvariation_count: 5\nvariation_temperature: 0.8\n\ninputs_file: inputs/generated.yaml\n\ninput_generation:\n  mode: llm\n  llm:\n    enabled: true\n    provider: openai\n    model: gpt-4o\n    api_key: null\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 68, "total_chunks": null}}
{"id": "0c3cfc8d-9d7c-4bd8-81cd-238f70d2e5b5", "content": "## Usage\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 69, "total_chunks": null}}
{"id": "1b8a4d22-90c3-435f-ba61-778551d876bf", "content": "### Generate Inputs\n\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 70, "total_chunks": null}}
{"id": "ff8ffd76-7425-4bce-88b6-e057458dc04b", "content": "# Generate with default settings\nfluxloop generate inputs\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 71, "total_chunks": null}}
{"id": "86dc5141-786f-4b5d-951b-c51cbcc86467", "content": "# Generate specific number\nfluxloop generate inputs --limit 50\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 72, "total_chunks": null}}
{"id": "eb9d9333-87a0-47a6-b543-4540f2703251", "content": "# Use LLM mode\nfluxloop generate inputs --mode llm\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 73, "total_chunks": null}}
{"id": "4e652350-774c-45f0-b003-32ec247caa33", "content": "# Use deterministic mode\nfluxloop generate inputs --mode deterministic\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 74, "total_chunks": null}}
{"id": "0dfc1a31-d6c8-4dc4-922f-a071efa56437", "content": "# Overwrite existing\nfluxloop generate inputs --overwrite\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 75, "total_chunks": null}}
{"id": "227a70f0-1d5c-49ae-b161-5db87946c8e7", "content": "### View Generated Inputs\n\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 76, "total_chunks": null}}
{"id": "0f16ac41-33c7-490e-9e7f-d4beabc23649", "content": "# View in terminal\ncat inputs/generated.yaml\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 77, "total_chunks": null}}
{"id": "c4b6ee27-d771-4a62-9685-3e742086f8bf", "content": "# Count total\nwc -l inputs/generated.yaml\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 78, "total_chunks": null}}
{"id": "776c5620-0878-43a0-a8f1-1f4d05392223", "content": "# View with syntax highlighting\nbat inputs/generated.yaml\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 79, "total_chunks": null}}
{"id": "a619e777-fa4d-4b36-8894-b30e5243a27b", "content": "## Tips and Best Practices\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 80, "total_chunks": null}}
{"id": "4fd7bae5-8edb-4d03-a99b-e22b477b370e", "content": "### Persona Design\n\n1. **Start with 2-3 personas** - Don't overcomplicate initially\n2. **Make them distinct** - Clear differences in behavior\n3. **Based on real users** - Draw from actual user research\n4. **Document reasoning** - Add comments explaining choices\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 81, "total_chunks": null}}
{"id": "074db023-7dac-4d0a-b9d9-56190cbab98a", "content": "### Base Input Selection\n\n1. **Cover main user journeys** - Critical paths first\n2. **Include edge cases** - Errors, ambiguity, unusual requests\n3. **Test boundaries** - Very short, very long inputs\n4. **Real-world examples** - Use actual user queries if available\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 82, "total_chunks": null}}
{"id": "f6e09ded-e1a2-4b61-93d1-03589866f4c4", "content": "### Generation Strategy\n\nFor **Development:**\n```yaml\nmode: deterministic      # Fast, reproducible\nvariation_count: 2       # Minimal\nvariation_strategies:\n  - rephrase\n```\n\nFor **Testing:**\n```yaml\nmode: llm               # Diverse, realistic\nvariation_count: 3      # Moderate\nvariation_temperature: 0.7\nvariation_strategies:\n  - rephrase\n  - verbose\n  - error_prone\n```\n\nFor **Production Validation:**\n```yaml\nmode: llm               # Maximum coverage\nvariation_count: 5      # Extensive\nvariation_temperature: 0.9\nvariation_strategies:", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 83, "total_chunks": null}}
{"id": "ee891603-8d68-4538-aa09-668bcd5c4052", "content": "  - rephrase\n  - verbose\n  - error_prone\n  - casual\n  - formal\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 84, "total_chunks": null}}
{"id": "17dce709-09aa-464d-b43c-dbb75f63c3a6", "content": "## See Also\n\n- [Simulation Configuration](/cli/configuration/simulation-config) - Runner and experiment settings\n- [Evaluation Configuration](/cli/configuration/evaluation-config) - Evaluators configuration\n- [generate Command](/cli/commands/generate) - Input generation CLI\n- [Basic Workflow](/cli/workflows/basic-workflow) - Complete workflow guide", "metadata": {"source": "packages/website/docs-cli/configuration/input-config.md", "chunk_index": 85, "total_chunks": null}}
{"id": "4693952d-e67e-46e9-86cb-6c009f4a9888", "content": "---\nsidebar_position: 1\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 0, "total_chunks": null}}
{"id": "7c9e1aa8-e605-48e9-9eff-6d5069605c39", "content": "# Project Configuration\n\nConfigure project metadata and global defaults in `configs/project.yaml`.\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 1, "total_chunks": null}}
{"id": "36393bfc-a8af-4ed7-9544-df730e262e13", "content": "## Overview\n\nThe project configuration file describes global metadata and defaults shared across the entire FluxLoop project. It defines:\n\n- Project identity (name, version, description)\n- Source code location for VSCode extension\n- Collector service settings (optional)\n- Tags and metadata for categorization\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 2, "total_chunks": null}}
{"id": "cafdd642-3263-419f-a52a-bc8dbb6858c2", "content": "## File Location\n\n```\nfluxloop/my-agent/\n└── configs/\n    └── project.yaml    # ← This file\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 3, "total_chunks": null}}
{"id": "434d1bfd-1edc-4e06-b652-b82f050a2acd", "content": "## Complete Example\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 4, "total_chunks": null}}
{"id": "8e49bea9-1f4c-47cc-9630-f6e5e73c9fc1", "content": "# FluxLoop Project Configuration", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 5, "total_chunks": null}}
{"id": "5bd5d099-4020-4f04-8f9d-3f663bc9c713", "content": "# ------------------------------------------------------------", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 6, "total_chunks": null}}
{"id": "8c6a0e2c-3a24-4acd-a57c-2cc547db21b5", "content": "# Describes global metadata and defaults shared across the project.", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 7, "total_chunks": null}}
{"id": "43e25efa-1299-4b12-b35c-a4a171c4e5b5", "content": "# Update name/description/tags to suit your workspace.\nname: my_agent\ndescription: AI agent simulation project\nversion: 1.0.0\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 8, "total_chunks": null}}
{"id": "cfed05d7-dd61-4bb0-ae4c-2ab3aab94978", "content": "# FluxLoop VSCode extension will prompt to set this path\nsource_root: \"\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 9, "total_chunks": null}}
{"id": "91e8ee66-f85f-4b6c-8b38-c5394b833f84", "content": "# Optional collector settings (leave null if using offline mode only)\ncollector_url: null\ncollector_api_key: null\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 10, "total_chunks": null}}
{"id": "1d2b7f3d-ebe1-4f86-96c7-70155e973950", "content": "# Tags and metadata help downstream tooling categorize experiments\ntags:\n  - simulation\n  - testing\n\nmetadata:\n  team: development\n  environment: local\n  service_context: \"\"\n  # Describe the overall service scenario (used by multi-turn supervisor)\n  # Add any custom fields used by dashboards or automation tools.\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 11, "total_chunks": null}}
{"id": "a98eb3c3-253f-4f32-a656-01055af49aba", "content": "## Configuration Fields\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 12, "total_chunks": null}}
{"id": "b62749a4-d940-4f66-877f-00faeeb7eeaa", "content": "### Required Fields\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `name` | `string` | Project identifier (used in experiment names) |\n| `description` | `string` | Human-readable project description |\n| `version` | `string` | Project version (semantic versioning recommended) |\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 13, "total_chunks": null}}
{"id": "2357420a-6e31-4984-b00c-d2b782ce4f73", "content": "### Optional Fields\n\n| Field | Type | Default | Description |\n|-------|------|---------|-------------|\n| `source_root` | `string` | `\"\"` | Absolute path to agent source code root (for VSCode extension) |\n| `collector_url` | `string \\| null` | `null` | Remote collector service URL |\n| `collector_api_key` | `string \\| null` | `null` | API key for collector authentication |\n| `tags` | `list[string]` | `[]` | Tags for categorizing experiments |\n| `metadata` | `object` | `{}` | Custom metadata fields |\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 14, "total_chunks": null}}
{"id": "8752ea02-9911-4fe6-a20f-b1a02cdb5a32", "content": "## Field Details\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 15, "total_chunks": null}}
{"id": "9668642a-0274-4ae6-bda2-aec97f462815", "content": "### name\n\n**Type:** `string`  \n**Required:** Yes  \n**Example:** `my_agent`, `customer_support_bot`, `production_agent_v2`\n\nProject identifier used throughout FluxLoop:\n- Stored in experiment metadata and dashboards\n- Referenced by VSCode extension\n\n**Best Practices:**\n- Use snake_case for consistency\n- Keep it concise (under 30 characters)\n- Make it descriptive but not overly specific\n- Don't include version numbers (use `version` field instead)\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 16, "total_chunks": null}}
{"id": "0ca5d62e-0085-4976-8844-33b9be8de4ee", "content": "### description\n\n**Type:** `string`  \n**Required:** Yes  \n**Example:** `Customer support chatbot for e-commerce platform`\n\nHuman-readable description of the project purpose.\n\n**Best Practices:**\n- One sentence summary\n- Explain what the agent does\n- Mention primary use case or domain\n- Keep under 100 characters for dashboard display\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 17, "total_chunks": null}}
{"id": "7d246111-2bd9-4d1d-abeb-9e72b6c6db70", "content": "### version\n\n**Type:** `string`  \n**Required:** Yes  \n**Example:** `1.0.0`, `2.1.3`, `0.5.0-beta`\n\nProject version for tracking changes and comparing experiments across versions.\n\n**Best Practices:**\n- Follow semantic versioning (`MAJOR.MINOR.PATCH`)\n- Increment when agent behavior changes\n- Use in baseline comparisons\n- Tag git commits with same version\n\n**Versioning Strategy:**\n- **MAJOR**: Breaking changes to agent interface or behavior\n- **MINOR**: New features or significant improvements\n- **PATCH**: Bug fixes or minor tweaks", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 18, "total_chunks": null}}
{"id": "af3ef7a1-dc1a-495b-a026-493911a9fb81", "content": "\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 19, "total_chunks": null}}
{"id": "f582f97c-36ec-4864-ac3a-9a65e98f8ac2", "content": "### source_root\n\n**Type:** `string`  \n**Default:** `\"\"`  \n**Example:** `/Users/me/projects/my-agent/src`\n\nAbsolute path to the root directory containing agent source code.\n\n**Used By:**\n- VSCode extension for navigating to code\n- Integration assistant for repository analysis\n- Debugging tools\n\n**How to Set:**\n\n**Via VSCode Extension:**\n1. Open FluxLoop Activity Bar\n2. Go to Projects view\n3. Click \"Set Target Source Root…\"\n4. Select your source directory\n\n**Via CLI:**\n```bash\nfluxloop config set source_root \"/path/to/source\" --file configs/project.yaml", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 20, "total_chunks": null}}
{"id": "c89da89c-bedf-4aea-ad1b-9f92aaab1ccf", "content": "```\n\n**Notes:**\n- Must be absolute path\n- Should point to root, not specific files\n- VSCode extension can auto-detect from workspace\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 21, "total_chunks": null}}
{"id": "be903608-b7a9-4c24-be06-b58d736413dd", "content": "### collector_url\n\n**Type:** `string | null`  \n**Default:** `null`  \n**Example:** `http://localhost:8000`, `https://collector.example.com`\n\nURL of remote FluxLoop collector service for centralized trace storage.\n\n**When to Use:**\n- Running a shared collector service\n- Centralizing traces from multiple agents\n- Team dashboard and analytics\n\n**Offline Mode:**\n- Set to `null` to use offline/local-only mode\n- Traces saved to `experiments/` directory\n- No network calls made\n\n**Configuration:**\n```yaml", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 22, "total_chunks": null}}
{"id": "f6084172-4838-48b9-8cd0-055b87f0b2d9", "content": "# Remote collector\ncollector_url: \"https://collector.example.com\"\ncollector_api_key: \"your-api-key\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 23, "total_chunks": null}}
{"id": "3512fe8e-37b8-4323-b1e2-f01bf906c9da", "content": "# Offline mode (default)\ncollector_url: null\ncollector_api_key: null\n```\n\n**Environment Variable Override:**\n```bash\nexport FLUXLOOP_COLLECTOR_URL=\"http://localhost:8000\"\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 24, "total_chunks": null}}
{"id": "4a84c0d5-3311-47ab-bd9a-3290b297ee7b", "content": "### collector_api_key\n\n**Type:** `string | null`  \n**Default:** `null`  \n**Example:** `fl_sk_abc123...`\n\nAPI key for authenticating with remote collector service.\n\n**Security Best Practices:**\n- **Don't commit API keys to git!**\n- Store in `.env` file (gitignored)\n- Use environment variables in CI/CD\n\n**Recommended Setup:**\n\n**1. Store in .env:**\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 25, "total_chunks": null}}
{"id": "94143140-b28d-40b2-9f56-ce2f420682cf", "content": "# .env\nFLUXLOOP_API_KEY=fl_sk_abc123xyz789\n```\n\n**2. Reference in config:**\n```yaml", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 26, "total_chunks": null}}
{"id": "742d801a-0530-447a-812c-70dc4c420c11", "content": "# configs/project.yaml\ncollector_api_key: null  # Will use FLUXLOOP_API_KEY from env\n```\n\n**3. Or use environment variable directly:**\n```bash\nexport FLUXLOOP_API_KEY=\"fl_sk_abc123xyz789\"\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 27, "total_chunks": null}}
{"id": "6294d8f5-a17a-48a8-bc11-b04d782fe7a8", "content": "### tags\n\n**Type:** `list[string]`  \n**Default:** `[\"simulation\", \"testing\"]`  \n**Example:** `[\"production\", \"customer-support\", \"v2\"]`\n\nTags for categorizing and filtering experiments.\n\n**Use Cases:**\n- Filter experiments by environment (`dev`, `staging`, `prod`)\n- Categorize by feature (`authentication`, `payments`, `search`)\n- Track versions (`v1`, `v2-beta`)\n- Mark special runs (`baseline`, `regression`, `benchmark`)\n\n**Example:**\n```yaml\ntags:\n  - production\n  - customer-support\n  - gpt-4o\n  - multi-turn\n```\n\n**Best Practices:**", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 28, "total_chunks": null}}
{"id": "37002775-aae1-4897-96b2-415f3854dec1", "content": "- Use lowercase, kebab-case\n- Keep tags concise (1-2 words)\n- Establish tag taxonomy across team\n- Use in dashboards and reports for filtering\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 29, "total_chunks": null}}
{"id": "c0f11223-1e93-4444-a811-b62beda78f84", "content": "### metadata\n\n**Type:** `object`  \n**Default:** `{}`  \n**Example:**\n\n```yaml\nmetadata:\n  team: development\n  environment: local\n  service_context: \"Customer support chatbot for e-commerce\"\n  owner: \"alice@example.com\"\n  slack_channel: \"#agent-alerts\"\n  jira_epic: \"AGT-1234\"\n```\n\nCustom key-value pairs for any project-specific metadata.\n\n**Common Fields:**\n\n| Field | Description |\n|-------|-------------|\n| `team` | Team responsible for the agent |\n| `environment` | Deployment environment (`local`, `dev`, `staging`, `prod`) |\n| `service_context` | Overall service scenario description (used by multi-turn supervisor) |", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 30, "total_chunks": null}}
{"id": "6f3bbb89-b17d-436e-801f-10ab3474c657", "content": "| `owner` | Person or email responsible |\n| `repository` | Git repository URL |\n| `slack_channel` | Team communication channel |\n| `jira_epic` | Related ticket/epic |\n\n**Service Context:**\n\nThe `service_context` field is special - it's used by the multi-turn supervisor to understand the overall purpose of the agent:\n\n```yaml\nmetadata:\n  service_context: |\n    You are an AI assistant for a travel booking platform.\n    Help users search flights, book hotels, and manage reservations.\n```\n\nThis context helps the supervisor generate realistic follow-up questions.", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 31, "total_chunks": null}}
{"id": "d491cf92-c178-4e84-99c5-7a992597e73e", "content": "\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 32, "total_chunks": null}}
{"id": "c2934fc0-9be5-42a8-80f2-959650f3ff27", "content": "## Usage Examples\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 33, "total_chunks": null}}
{"id": "d8afae98-475f-48bb-9092-5f915c40ed4b", "content": "### Minimal Configuration\n\n```yaml\nname: simple_agent\ndescription: Basic agent for testing\nversion: 1.0.0\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 34, "total_chunks": null}}
{"id": "3c95873b-b3b1-4bce-a7c6-204b0e3a0c4e", "content": "### Full Production Configuration\n\n```yaml\nname: customer_support_bot\ndescription: AI-powered customer support chatbot for e-commerce platform\nversion: 2.3.1\n\nsource_root: \"/Users/alice/projects/support-bot/src\"\n\ncollector_url: \"https://collector.example.com\"\ncollector_api_key: null  # Set via FLUXLOOP_API_KEY env var\n\ntags:\n  - production\n  - customer-support\n  - gpt-4o\n  - multi-turn\n\nmetadata:\n  team: customer-success\n  environment: production\n  service_context: |\n    AI customer support assistant for an e-commerce platform.", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 35, "total_chunks": null}}
{"id": "663ee8e4-f9cf-40d1-9eec-de0a6d393a36", "content": "    Helps with orders, returns, product questions, and account issues.\n  owner: \"alice@example.com\"\n  repository: \"https://github.com/company/support-bot\"\n  slack_channel: \"#support-agent\"\n  deployment_region: \"us-east-1\"\n  cost_center: \"CS-001\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 36, "total_chunks": null}}
{"id": "1f545d00-d4bc-424f-9c47-2438767ab5df", "content": "### Development Configuration\n\n```yaml\nname: support_bot_dev\ndescription: Development instance of customer support bot\nversion: 2.4.0-dev\n\nsource_root: \"/Users/bob/dev/support-bot\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 37, "total_chunks": null}}
{"id": "f48b78f3-3a87-4efb-8f25-fd32d29690d6", "content": "# Offline mode for local development\ncollector_url: null\ncollector_api_key: null\n\ntags:\n  - development\n  - experimental\n  - local\n\nmetadata:\n  team: development\n  environment: local\n  service_context: \"Development instance for testing new features\"\n  owner: \"bob@example.com\"\n  notes: \"Testing GPT-4o integration\"\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 38, "total_chunks": null}}
{"id": "897cb9d4-4419-45cf-8561-a876ba06eaf7", "content": "## Updating Configuration\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 39, "total_chunks": null}}
{"id": "f79bafc5-61e6-4a75-a574-bcd163a761c0", "content": "### Via Config Command\n\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 40, "total_chunks": null}}
{"id": "259301b7-a02b-4bdd-a7e1-82e2041a97b2", "content": "# Set simple values\nfluxloop config set name \"my_new_agent\" --file configs/project.yaml\nfluxloop config set version \"2.0.0\" --file configs/project.yaml\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 41, "total_chunks": null}}
{"id": "af9d76c6-b3d0-4f91-bded-c825bc2680bf", "content": "# Set nested metadata\nfluxloop config set metadata.team \"data-science\" --file configs/project.yaml\nfluxloop config set metadata.environment \"production\" --file configs/project.yaml\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 42, "total_chunks": null}}
{"id": "3da944cd-d71e-412d-bfe7-1db7205c9018", "content": "### Via Direct Edit\n\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 43, "total_chunks": null}}
{"id": "b5f9045a-c704-4d50-be8c-f7b62edc5578", "content": "# Open in editor\ncode fluxloop/my-agent/configs/project.yaml\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 44, "total_chunks": null}}
{"id": "0ea615cb-55cd-4ddb-8509-96546f0febf3", "content": "# Or use your preferred editor\nvim fluxloop/my-agent/configs/project.yaml\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 45, "total_chunks": null}}
{"id": "83162106-2816-44c8-a077-a38cc646fbd5", "content": "### Validate After Changes\n\n```bash\nfluxloop config validate --file configs/project.yaml\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 46, "total_chunks": null}}
{"id": "1f4fe590-9d40-48c9-a7af-029704e03b32", "content": "## Environment Variables\n\nThese environment variables can override config values:\n\n| Variable | Overrides | Example |\n|----------|-----------|---------|\n| `FLUXLOOP_COLLECTOR_URL` | `collector_url` | `http://localhost:8000` |\n| `FLUXLOOP_API_KEY` | `collector_api_key` | `fl_sk_abc123...` |\n| `FLUXLOOP_SERVICE_NAME` | `name` | `my_agent` |\n\n**Precedence:**\n1. Environment variables (highest priority)\n2. Project `.env` file\n3. `configs/project.yaml`\n4. Defaults (lowest priority)\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 47, "total_chunks": null}}
{"id": "ff40e866-04a0-402f-a170-87e8fadad873", "content": "## Tips\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 48, "total_chunks": null}}
{"id": "48f0778b-afbd-4d2c-9e3f-35c3cdce9d4d", "content": "### Version Management\n\nTrack project versions in git:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 49, "total_chunks": null}}
{"id": "08e92eee-56e2-4290-ba9e-2d5d6049efc7", "content": "# Update version in config\nfluxloop config set version \"1.2.0\" --file configs/project.yaml\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 50, "total_chunks": null}}
{"id": "8e3c0256-099d-4363-8ed8-a8ae014ada2d", "content": "# Commit with version tag\ngit add configs/project.yaml\ngit commit -m \"Bump version to 1.2.0\"\ngit tag v1.2.0\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 51, "total_chunks": null}}
{"id": "385c3165-dac2-4254-91af-87e32f933873", "content": "### Multiple Environments\n\nCreate environment-specific configs:\n\n```bash\nconfigs/\n├── project.yaml            # Base config\n├── project.dev.yaml        # Development overrides\n├── project.staging.yaml    # Staging overrides\n└── project.prod.yaml       # Production overrides\n```\n\nUse environment-specific config:\n\n```bash\ncp configs/project.prod.yaml configs/project.yaml\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 52, "total_chunks": null}}
{"id": "c80e76e2-0bd0-43d5-9a74-16b4dc350984", "content": "### Team Conventions\n\nEstablish conventions for:\n- Tag taxonomy (`environment:prod`, `feature:auth`)\n- Metadata fields (required vs optional)\n- Versioning strategy\n- Naming patterns\n\nDocument in team wiki or `README.md`.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 53, "total_chunks": null}}
{"id": "ec431fb4-c7a9-44c9-a9d2-4d54451b1342", "content": "## See Also\n\n- [Input Configuration](/cli/configuration/input-config) - Personas and input generation\n- [Simulation Configuration](/cli/configuration/simulation-config) - Runner and experiment settings\n- [Evaluation Configuration](/cli/configuration/evaluation-config) - Evaluators and success criteria\n- [config Command](/cli/commands/config) - Configuration management CLI\n- [Basic Workflow](/cli/workflows/basic-workflow) - Complete workflow guide", "metadata": {"source": "packages/website/docs-cli/configuration/project-config.md", "chunk_index": 54, "total_chunks": null}}
{"id": "d16c094d-60df-485f-abda-5b847ed0897c", "content": "---\ntitle: Runner Targets Overview\nsidebar_position: 20\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 0, "total_chunks": null}}
{"id": "39bead86-6490-4098-844b-7fc036022bf3", "content": "## Overview\n\nConnect your agent code to FluxLoop by configuring the `runner` section in `configs/simulation.yaml`. Multiple integration patterns support different languages, frameworks, and execution environments.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 1, "total_chunks": null}}
{"id": "b5142d0a-cc71-4aae-83f5-c25f369da4bf", "content": "## Pattern Categories\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 2, "total_chunks": null}}
{"id": "e3717eb5-43d7-452a-aef6-1b954e8d3a0a", "content": "### 🟢 P0: Production-Ready\n\n| Pattern | When to Use | Documentation |\n|---------|-------------|---------------|\n| **Python Function/Method** | Direct sync/async function calls | [python-function](./runners/python-function) |\n| **Python Class** | Class instance methods (with factory support) | _Coming soon_ |\n| **Python Async Generator** | Streaming responses (OpenAI/Anthropic SDKs) | _Coming soon_ |\n| **HTTP REST/SSE** | Remote APIs or local servers (with streaming) | [http-sse](./runners/http-sse) |\n| **WebSocket** | Bidirectional streaming (real-time chat) | _Coming soon_ |", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 3, "total_chunks": null}}
{"id": "a3b67c5b-a22a-478e-b957-c2467bf98708", "content": "| **Subprocess (JSONL)** | Cross-language runtimes (Node/Go/etc) | [subprocess-jsonl](./runners/subprocess-jsonl) |\n| **Step Loop** | Multi-turn conversations (`step()` iterations) | _Coming soon_ |\n| **Resource Guards** | Timeout/output limits safety net | _Coming soon_ |\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 4, "total_chunks": null}}
{"id": "cde85385-63af-4161-b0d2-7b4100a603fa", "content": "### 🟡 P1: Beta Features\n\n| Pattern | When to Use | Documentation |\n|---------|-------------|---------------|\n| **Batch Execution** | Parallel evaluation on JSONL/CSV datasets | _Coming soon_ |\n| **Advanced Streaming** | Custom event paths for tool/function calls | _Coming soon_ |\n| **Input/Output Adapters** | Signature transformations between frameworks | _Coming soon_ |\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 5, "total_chunks": null}}
{"id": "9dbe7b92-9c5f-4220-880e-b7217e46a46b", "content": "### 🔴 P2: Experimental (Roadmap)\n\n| Pattern | When to Use | Documentation |\n|---------|-------------|---------------|\n| **Docker Container** | Isolated, reproducible execution | _Coming soon_ |\n| **Redis/SQS Queue** | Production-scale async workers | _Coming soon_ |\n| **Multi-Target Composite** | Sequential/parallel/ensemble agents | _Coming soon_ |\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 6, "total_chunks": null}}
{"id": "9867c226-c9de-4781-a9f8-24c433a41200", "content": "## Quick Start\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 7, "total_chunks": null}}
{"id": "9b91c050-d151-4762-b0aa-a0f8299b45de", "content": "### 1) Python Function (Simplest)\n\n```yaml\nrunner:\n  target: \"app.agent:run\"\n  working_directory: .\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 8, "total_chunks": null}}
{"id": "f7298c04-5e00-4497-be41-f63e24ae369c", "content": "### 2) HTTP API (Remote Service)\n\n```yaml\nrunner:\n  http:\n    method: POST\n    url: \"http://localhost:8000/chat\"\n    stream: sse\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 9, "total_chunks": null}}
{"id": "e01d1f1a-feae-497d-b2c6-c2b05524bb12", "content": "### 3) Subprocess (Node.js Agent)\n\n```yaml\nrunner:\n  process:\n    command: [\"node\", \"agent.mjs\"]\n    protocol: jsonl\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 10, "total_chunks": null}}
{"id": "6c81c5db-5a32-4dde-abad-1e06ed4094ec", "content": "## Common Options\n\nAvailable across all runners:\n\n```yaml\nrunner:\n  # ... pattern-specific config ...\n  \n  # Common options\n  working_directory: .\n  python_path: [\"src\", \"lib\"]           # Python patterns only\n  stream_output_path: \"message.delta\"   # Streaming runners\n  \n  # Resource guards (optional)\n  guards:\n    max_duration: 120s\n    output_char_limit: 20000\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 11, "total_chunks": null}}
{"id": "68447d05-2cf0-4316-94cb-f7246554ec7d", "content": "## Argument Replay (Optional)\n\nReuse complex kwargs:\n\n```yaml\nrunner:\n  target: \"app.agent:run\"\n  \nreplay_args:\n  enabled: true\n  recording_file: recordings/args_recording.jsonl\n  # override_param_path: \"item.content.0.text\"\n```\n\nSee simulation configuration for details.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 12, "total_chunks": null}}
{"id": "8cb71e44-81d0-4c81-8878-ef094a2d7b52", "content": "## Next Steps\n\n- Explore pattern-specific docs for full options and examples\n- [Simulation Config](./simulation-config) for complete structure\n- [Run Command](../commands/run) for CLI usage\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 13, "total_chunks": null}}
{"id": "fb9c1a7d-849c-4803-9397-10687970b3d8", "content": "## MCP Server Integration\n\nThese docs serve as FluxLoop MCP server's knowledge base:\n- `analyze_repository` → framework detection → pattern recommendations\n- `generate_integration_steps` → pattern-specific checklists\n- `faq` → troubleshooting/example search across all patterns\n\nMCP Server Plan: [docs/prd/mcp_server_plan.md](https://github.com/your-org/fluxloop/blob/main/docs/prd/mcp_server_plan.md)\n\n", "metadata": {"source": "packages/website/docs-cli/configuration/runner-targets.md", "chunk_index": 14, "total_chunks": null}}
{"id": "f89fd0d4-d087-49ff-83f2-3440b19a8cde", "content": "---\ntitle: HTTP Server-Sent Events (SSE)\nsidebar_position: 5\ntags: [http, streaming, sse, p0]\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 0, "total_chunks": null}}
{"id": "baa1adf6-befb-4d39-808f-8d0ec9d95686", "content": "## Overview\n\n- **When to Use**: Receive streaming responses via HTTP SSE endpoints\n- **Difficulty**: ⭐⭐ Intermediate\n- **Priority**: P0 (Production-Ready)\n- **Dependencies**: HTTP server (local/remote), SSE protocol support\n\nCollect real-time streaming responses via Server-Sent Events protocol. Useful for OpenAI/Anthropic streaming APIs, custom chat servers, etc.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 1, "total_chunks": null}}
{"id": "535e708d-a2c9-4842-9685-394b7210d281", "content": "## Basic Configuration\n\n```yaml\nrunner:\n  http:\n    method: POST\n    url: \"http://localhost:8000/chat\"\n    stream: sse\n    stream_output_path: \"delta\"        # Text path within SSE data field\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 2, "total_chunks": null}}
{"id": "25509198-15df-4f36-bf7c-7eb9c90cb6ae", "content": "## Full Options\n\n```yaml\nrunner:\n  http:\n    method: POST                        # GET/POST/PUT/PATCH\n    url: \"http://localhost:8000/chat\"\n    headers:\n      Content-Type: application/json\n      Authorization: \"Bearer ${OPENAI_API_KEY}\"  # Environment variable substitution\n    timeout: 60s                        # Overall request timeout\n    retry:\n      attempts: 2                       # Number of retries\n      backoff: 200ms                    # Retry interval\n      status_codes: [502, 503, 504]     # Status codes to retry", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 3, "total_chunks": null}}
{"id": "66bdb53b-3489-4ea2-b9bf-4a256ee807f5", "content": "    \n    stream: sse                         # SSE mode\n    stream_output_path: \"delta\"         # JSONPath to text in each SSE event data\n    stream_event_filter: \"message\"      # Optional: only collect specific event types\n    \n    body_template:                      # Request body mapping\n      type: json\n      mapping:\n        input: \"$.messages[-1].content\" # Simulation input → request field\n        model: \"gpt-4\"                  # Static value\n    \n  guards:\n    max_duration: 120s\n    output_char_limit: 20000\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c56ca563-7a13-4b63-99dd-b48b4b9b0937", "content": "## SSE Protocol Example\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 5, "total_chunks": null}}
{"id": "fc1fd51f-73cf-4e01-94a4-9878987dd4aa", "content": "### Server Response Stream\n\n```\nevent: message\ndata: {\"delta\": \"Hello\"}\n\nevent: message\ndata: {\"delta\": \" world\"}\n\nevent: message\ndata: {\"delta\": \"!\"}\n\nevent: done\ndata: {\"finish_reason\": \"stop\"}\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 6, "total_chunks": null}}
{"id": "ab4c8bdc-95ad-4d4d-8c06-323fa50e0caf", "content": "### Text Aggregation\n\nWith `stream_output_path: \"delta\"`:\n1. Parse each `data` JSON\n2. Extract text via `$.delta` path\n3. Join in order → final result: `\"Hello world!\"`\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 7, "total_chunks": null}}
{"id": "5c74a145-1d30-4f32-9c9d-b2d47e86d854", "content": "## Examples\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 8, "total_chunks": null}}
{"id": "f26e83dd-d3d1-4978-929a-7fb4dfeef23f", "content": "### Example 1: OpenAI Streaming API\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  http:\n    method: POST\n    url: \"https://api.openai.com/v1/chat/completions\"\n    headers:\n      Content-Type: application/json\n      Authorization: \"Bearer ${OPENAI_API_KEY}\"\n    timeout: 60s\n    stream: sse\n    stream_output_path: \"choices[0].delta.content\"\n    body_template:\n      type: json\n      mapping:\n        model: \"gpt-4\"\n        messages: [{\"role\": \"user\", \"content\": \"$.input\"}]\n        stream: true\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 9, "total_chunks": null}}
{"id": "a7590ea8-781f-4f83-8437-966fe8a59b3f", "content": "### Example 2: Custom FastAPI SSE Server\n\n**server.py** (run separately)\n```python\nfrom fastapi import FastAPI\nfrom fastapi.responses import StreamingResponse\nimport asyncio\nimport json\n\napp = FastAPI()\n\nasync def generate_sse(input: str):\n    words = f\"Response to: {input}\".split()\n    for word in words:\n        yield f\"event: message\\ndata: {json.dumps({'delta': word + ' '})}\\n\\n\"\n        await asyncio.sleep(0.1)\n    yield f\"event: done\\ndata: {json.dumps({'status': 'complete'})}\\n\\n\"\n\n@app.post(\"/chat\")\nasync def chat(request: dict):", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 10, "total_chunks": null}}
{"id": "4202ab06-0eb9-4089-a333-9536efd9c864", "content": "    input_text = request.get(\"input\", \"\")\n    return StreamingResponse(\n        generate_sse(input_text),\n        media_type=\"text/event-stream\"\n    )\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  http:\n    method: POST\n    url: \"http://localhost:8000/chat\"\n    stream: sse\n    stream_output_path: \"delta\"\n    body_template:\n      type: json\n      mapping:\n        input: \"$.input\"\n```\n\n**Execution**\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 11, "total_chunks": null}}
{"id": "d7906425-f997-4eab-8ac7-cd4f30c7123b", "content": "# Terminal 1: Run server\nuvicorn server:app --port 8000\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 12, "total_chunks": null}}
{"id": "4223b24a-787b-4837-ab9b-79e6bea57cc4", "content": "# Terminal 2: Run FluxLoop\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 13, "total_chunks": null}}
{"id": "cb069023-fa8c-4652-a6ae-3464d25c6563", "content": "### Example 3: Anthropic Claude Streaming\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  http:\n    method: POST\n    url: \"https://api.anthropic.com/v1/messages\"\n    headers:\n      Content-Type: application/json\n      x-api-key: \"${ANTHROPIC_API_KEY}\"\n      anthropic-version: \"2023-06-01\"\n    stream: sse\n    stream_output_path: \"delta.text\"\n    stream_event_filter: \"content_block_delta\"  # Only text delta events\n    body_template:\n      type: json\n      mapping:\n        model: \"claude-3-opus-20240229\"\n        messages: [{\"role\": \"user\", \"content\": \"$.input\"}]", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 14, "total_chunks": null}}
{"id": "205aec23-4712-4158-9f7a-ec0adf63e520", "content": "        max_tokens: 1024\n        stream: true\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 15, "total_chunks": null}}
{"id": "7d65d59b-28e3-4a71-a257-33c050b315e4", "content": "## Troubleshooting\n\n| Problem | Cause | Solution |\n|---------|-------|----------|\n| Connection timeout | Server not running or wrong URL | Verify with `curl [url]` |\n| SSE parsing failure | Data format mismatch | Check `stream_output_path`, review server logs |\n| Empty response | `stream_event_filter` mismatch | Remove filter or verify actual event types |\n| Text loss | Network interruption | Increase `retry.attempts`, check server stability |\n| Environment vars not substituted | `${}` syntax error | Check `.env` file, verify variable names |", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 16, "total_chunks": null}}
{"id": "00b4fb00-722a-4150-8afb-60156d70bc82", "content": "| Excessive retries | Server 500 errors | Consider excluding 500 from `retry.status_codes` |\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 17, "total_chunks": null}}
{"id": "68f5f685-b2a4-4aa8-b574-ba5aa5377875", "content": "## Advanced Topics\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 18, "total_chunks": null}}
{"id": "3a5cab6e-521c-43cf-9992-f60303d19418", "content": "### Complex JSONPath Mapping\n\nTransform to OpenAI format:\n\n```yaml\nrunner:\n  http:\n    body_template:\n      type: json\n      mapping:\n        model: \"gpt-4-turbo\"\n        messages: |\n          [\n            {\"role\": \"system\", \"content\": \"You are a helpful assistant.\"},\n            {\"role\": \"user\", \"content\": \"$.input\"}\n          ]\n        temperature: 0.7\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 19, "total_chunks": null}}
{"id": "f05a1989-b524-4e21-bcae-e69b1913e0f1", "content": "### Event Type Filtering\n\nProcess only specific events:\n\n```yaml\nrunner:\n  http:\n    stream: sse\n    stream_event_filter: \"text_delta\"   # Only collect \"event: text_delta\"\n    stream_output_path: \"content\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 20, "total_chunks": null}}
{"id": "6522af40-2571-4221-a077-a837c2827728", "content": "### Retry Strategy\n\nHandle transient network errors:\n\n```yaml\nrunner:\n  http:\n    retry:\n      attempts: 3\n      backoff: 500ms\n      status_codes: [429, 502, 503, 504]  # Rate limit + server errors\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 21, "total_chunks": null}}
{"id": "d81e3654-a543-4268-92d3-8384bf3b42f6", "content": "## Performance Optimization\n\n- **Timeout Adjustment**: Increase `timeout` for long responses (default 60s)\n- **Connection Reuse**: HTTP/1.1 Keep-Alive automatically used for same host\n- **Parallel Execution**: Use `simulation.parallelism` for concurrent requests (mind API rate limits)\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 22, "total_chunks": null}}
{"id": "e3dfeec3-5601-4c2e-8e3a-c3154656c91e", "content": "## Security\n\n- **API Key Management**: Use `.env` file + `.gitignore` required\n- **HTTPS Usage**: Use `https://` URLs in production\n- **Header Logging**: FluxLoop automatically masks `Authorization` headers\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 23, "total_chunks": null}}
{"id": "4897ccb5-db0b-4799-881d-bc707ea426ef", "content": "## Related Documentation\n\n- HTTP REST (Coming soon) – non-streaming HTTP requests\n- WebSocket (Coming soon) – bidirectional streaming\n- Streaming Schema (Coming soon) – advanced event path configuration\n- Guards (Coming soon) – timeout/output limits\n- [Simulation Config](../simulation-config) – full configuration structure\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 24, "total_chunks": null}}
{"id": "c278fde3-02cd-4726-89a2-095ed101f439", "content": "## MCP Metadata\n\n```json\n{\n  \"pattern\": \"http-sse\",\n  \"tags\": [\"http\", \"streaming\", \"sse\", \"p0\", \"openai\", \"anthropic\"],\n  \"examples\": [\n    \"examples/openai-streaming/\",\n    \"samples/sse-fastapi.md\",\n    \"samples/anthropic-claude.md\"\n  ],\n  \"faq\": [\n    \"How to handle SSE reconnection?\",\n    \"OpenAI streaming configuration?\",\n    \"Rate limiting best practices?\",\n    \"Environment variable interpolation?\"\n  ],\n  \"related_patterns\": [\n    \"http-rest\",\n    \"http-websocket\",\n    \"streaming-schema\"\n  ],\n  \"dependencies\": [\n    \"httpx (CLI internal)\",", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 25, "total_chunks": null}}
{"id": "856ffac0-46bb-4c6f-9c10-6a6e2611384b", "content": "    \"SSE-compatible server\"\n  ]\n}\n```", "metadata": {"source": "packages/website/docs-cli/configuration/runners/http-sse.md", "chunk_index": 26, "total_chunks": null}}
{"id": "f9c23a9a-9dba-4bd8-89ec-cf56de032fc1", "content": "---\ntitle: Python Function & Method\nsidebar_position: 1\ntags: [python, sync, async, p0]\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 0, "total_chunks": null}}
{"id": "fa996a1f-fcea-4494-b4f7-bd444ed3d7f6", "content": "## Overview\n\n- **When to Use**: Directly call Python module functions or methods\n- **Difficulty**: ⭐ Beginner\n- **Priority**: P0 (Production-Ready)\n- **Dependencies**: Python 3.8+, FluxLoop SDK (optional)\n\nThe simplest and most common integration pattern. Supports both sync and async functions.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 1, "total_chunks": null}}
{"id": "cb7b1be5-6fef-45c9-b230-77663cca473d", "content": "## Basic Configuration\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 2, "total_chunks": null}}
{"id": "9d5a45cb-7d58-405d-aad8-f6f24ee38b30", "content": "### Pattern 1: Module + Function (Concise)\n\n```yaml\nrunner:\n  target: \"app.agent:run\"\n  working_directory: .\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 3, "total_chunks": null}}
{"id": "015927c8-3005-4c01-af9c-698e2f65fbd7", "content": "### Pattern 2: Module + Function (Explicit)\n\n```yaml\nrunner:\n  module_path: \"app.agent\"\n  function_name: \"run\"\n  working_directory: .\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 4, "total_chunks": null}}
{"id": "63590da4-18e1-4304-98ff-5642584837e4", "content": "## Full Options\n\n```yaml\nrunner:\n  target: \"app.agent:run\"           # or module_path + function_name\n  working_directory: .               # module import base directory\n  python_path:                       # additional paths to sys.path (optional)\n    - \"src\"\n    - \"lib\"\n  \n  # Resource guards (optional)\n  guards:\n    max_duration: 120s\n    output_char_limit: 20000\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 5, "total_chunks": null}}
{"id": "6614d013-2ef9-4310-abb8-78711cd83fbb", "content": "## Function Signature Requirements\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 6, "total_chunks": null}}
{"id": "a8bdfc94-5390-439b-ba88-c3734b3f1b5d", "content": "### Basic Signature (Recommended)\n\n```python\ndef run(input: str) -> str:\n    \"\"\"\n    Args:\n        input: Simulation input text\n    Returns:\n        Response text\n    \"\"\"\n    return f\"Response to: {input}\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 7, "total_chunks": null}}
{"id": "5d59608f-dda0-4360-a01a-55bf489f4818", "content": "### Async Function\n\n```python\nasync def run(input: str) -> str:\n    await asyncio.sleep(0.1)\n    return f\"Async response to: {input}\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 8, "total_chunks": null}}
{"id": "2c93bdc5-9623-4d40-9a98-779723555784", "content": "### With Context (Advanced)\n\n```python\ndef run(input: str, context: dict = None) -> str:\n    \"\"\"\n    Args:\n        input: Simulation input\n        context: Additional metadata (persona, iteration, etc)\n    \"\"\"\n    persona = context.get(\"persona\", \"default\") if context else \"default\"\n    return f\"[{persona}] Response to: {input}\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 9, "total_chunks": null}}
{"id": "65708aba-fc26-436a-bd25-34d36a98379a", "content": "## Examples\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 10, "total_chunks": null}}
{"id": "78069397-3d17-40b3-b10e-aab0c6c8ce60", "content": "### Example 1: Simple Echo Agent\n\n**app/agent.py**\n```python\ndef run(input: str) -> str:\n    return f\"Echo: {input}\"\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  target: \"app.agent:run\"\n  working_directory: .\n\noutput:\n  directory: \"experiments\"\n```\n\n**Execution**\n```bash\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 11, "total_chunks": null}}
{"id": "25d852fd-9a8e-4fab-aae6-975f8a6b28bd", "content": "### Example 2: OpenAI Call (Async)\n\n**app/openai_agent.py**\n```python\nimport os\nfrom openai import AsyncOpenAI\n\nclient = AsyncOpenAI(api_key=os.getenv(\"OPENAI_API_KEY\"))\n\nasync def chat(input: str) -> str:\n    response = await client.chat.completions.create(\n        model=\"gpt-4\",\n        messages=[{\"role\": \"user\", \"content\": input}]\n    )\n    return response.choices[0].message.content\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  target: \"app.openai_agent:chat\"\n  working_directory: .\n  guards:\n    max_duration: 60s\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 12, "total_chunks": null}}
{"id": "a9d0721a-6be6-4867-ae4b-06a346f07c3f", "content": "### Example 3: FluxLoop SDK Integration (Tracing)\n\n**app/traced_agent.py**\n```python\nfrom fluxloop_sdk import fluxloop\n\n@fluxloop.trace()\ndef run(input: str) -> str:\n    # SDK automatically records input/output/timing\n    result = process_request(input)\n    return result\n\ndef process_request(input: str) -> str:\n    # Business logic\n    return f\"Processed: {input}\"\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  target: \"app.traced_agent:run\"\n  working_directory: .\n```\n\nSDK automatically propagates context for trace/span recording.", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 13, "total_chunks": null}}
{"id": "6f0ececa-45fd-4aff-8c9f-3e1d2c77a397", "content": "## Troubleshooting\n\n| Problem | Cause | Solution |\n|---------|-------|----------|\n| `ModuleNotFoundError` | Module path mismatch | Adjust `working_directory` or `python_path` |\n| Function not called | Typo in function name | Verify `target` string (`module:function`) |\n| Async function error | Event loop conflict | FluxLoop handles automatically, but may need `nest_asyncio` for nested loops |\n| Output is `None` | Missing `return` | Ensure function explicitly returns string |\n| Timeout | Long-running execution | Increase `guards.max_duration` or optimize function |", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 15, "total_chunks": null}}
{"id": "062d078d-8280-441d-abba-d06936cacc5b", "content": "## Advanced Topics\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 17, "total_chunks": null}}
{"id": "c1e56746-cde3-431b-9449-25be2771cac1", "content": "### Module-Scoped Instance Method (Bound Method)\n\nCall a method on an instance already created at module level:\n\n**app/server.py**\n```python\nclass SupportServer:\n    def __init__(self, model: str):\n        self.model = model\n    \n    def respond(self, input: str) -> str:\n        return f\"[{self.model}] Response: {input}\"\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 18, "total_chunks": null}}
{"id": "76f2933f-662f-48b0-b23f-3331b41f6986", "content": "# Create instance at module level\nsupport_server = SupportServer(model=\"gpt-4\")\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  target: \"app.server:support_server.respond\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 19, "total_chunks": null}}
{"id": "5d6f8131-ce69-44f8-943f-532d6cae819b", "content": "### Class Method (Zero-Arg Constructor)\n\nInstantiate class at runtime (constructor requires no args):\n\n**app/handler.py**\n```python\nclass Handler:\n    def __init__(self):\n        # Zero-arg constructor\n        self.config = load_config()\n    \n    def handle(self, input: str) -> str:\n        return f\"Handled: {input}\"\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  target: \"app.handler:Handler.handle\"\n```\n\nFor constructors requiring arguments, use Python Factory pattern (docs coming soon).\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 20, "total_chunks": null}}
{"id": "e6c5ff48-f261-4f6a-9c70-d2618fb39153", "content": "## Related Documentation\n\n- Python Class with Factory (Coming soon) – complex constructor dependencies\n- Python Async Generator (Coming soon) – streaming responses\n- Guards (Coming soon) – resource limits\n- [Simulation Config](../simulation-config) – full configuration structure\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 21, "total_chunks": null}}
{"id": "30325f43-84a2-4acc-9485-c48150b6c57a", "content": "## MCP Metadata\n\n```json\n{\n  \"pattern\": \"python-function\",\n  \"tags\": [\"python\", \"sync\", \"async\", \"p0\", \"basic\"],\n  \"examples\": [\n    \"examples/simple-agent/\",\n    \"samples/openai-basic.md\"\n  ],\n  \"faq\": [\n    \"How to pass context to function?\",\n    \"Can I use async functions?\",\n    \"ModuleNotFoundError troubleshooting\"\n  ],\n  \"related_patterns\": [\n    \"python-class\",\n    \"python-factory\",\n    \"python-async-generator\"\n  ]\n}\n```", "metadata": {"source": "packages/website/docs-cli/configuration/runners/python-function.md", "chunk_index": 22, "total_chunks": null}}
{"id": "1bef99af-9815-4694-a0d6-be2da309bbe9", "content": "---\ntitle: Subprocess (JSONL Protocol)\nsidebar_position: 7\ntags: [subprocess, jsonl, node, go, p0]\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 0, "total_chunks": null}}
{"id": "aedbd7c1-532a-4ca6-a703-7fb887be2bcd", "content": "## Overview\n\n- **When to Use**: Integrate agents in other languages (Node.js, Go, Rust, etc)\n- **Difficulty**: ⭐⭐ Intermediate\n- **Priority**: P0 (Production-Ready)\n- **Dependencies**: Executable binary/script, JSONL protocol implementation\n\nExecute local processes and exchange JSONL (JSON Lines) messages via STDIN/STDOUT. Use when integrating agents written in languages other than Python.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 1, "total_chunks": null}}
{"id": "ecf7b55f-80bf-4f97-9548-f1bfee60f3c8", "content": "## Basic Configuration\n\n```yaml\nrunner:\n  process:\n    command: [\"node\", \"agent.mjs\"]\n    protocol: jsonl\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 2, "total_chunks": null}}
{"id": "8c970e6f-eea6-4844-96e1-197f9722a908", "content": "## Full Options\n\n```yaml\nrunner:\n  process:\n    command: [\"node\", \"agent.mjs\"]      # Command array\n    cwd: .                              # Working directory\n    env:                                # Environment variables (optional)\n      NODE_ENV: production\n      API_KEY: \"${API_KEY}\"             # Environment variable substitution\n    protocol: jsonl                     # Currently only jsonl supported\n    \n    stream_output_path: \"delta\"         # Delta path within JSONL events\n    ready_pattern: \"^READY$\"            # Optional: startup ready signal (regex)", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 3, "total_chunks": null}}
{"id": "fa08adfd-8ad2-4c36-8429-05f73e1083fa", "content": "    timeout: 120s                       # Overall execution timeout\n    \n    # Process management\n    kill_signal: SIGTERM                # Termination signal (default)\n    kill_timeout: 5s                    # Force kill wait time\n    \n  guards:\n    max_duration: 180s\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 4, "total_chunks": null}}
{"id": "c5ef89c8-899b-48e1-add0-2cd4285a5898", "content": "## JSONL Protocol Convention\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 5, "total_chunks": null}}
{"id": "a009e7ad-9c6b-4afa-a6e9-de16e13602a5", "content": "### FluxLoop → Process (STDIN)\n\n**Input Message**\n```json\n{\"type\": \"input\", \"input\": \"User query here\", \"context\": {\"persona\": \"expert_user\", \"iteration\": 1}}\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 6, "total_chunks": null}}
{"id": "176cfda3-12ad-471d-88d7-d38ed55ce7c1", "content": "### Process → FluxLoop (STDOUT)\n\n**Streaming Delta** (optional)\n```json\n{\"type\": \"delta\", \"delta\": \"First chunk\"}\n{\"type\": \"delta\", \"delta\": \" second chunk\"}\n```\n\n**Final Response**\n```json\n{\"type\": \"final\", \"output\": \"Complete response text\"}\n```\n\n**Error Reporting** (optional)\n```json\n{\"type\": \"error\", \"error\": \"Something went wrong\", \"code\": \"INTERNAL_ERROR\"}\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 7, "total_chunks": null}}
{"id": "4b38abf3-f0f1-4682-97a0-53010008ddcb", "content": "### Ready Signal (Optional)\n\nProcess outputs to STDOUT after initialization:\n```\nREADY\n```\n\nFluxLoop sends input message after detecting this line.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 8, "total_chunks": null}}
{"id": "a93043b7-cb5c-4e6b-8402-a7f003d2a682", "content": "## Examples\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 9, "total_chunks": null}}
{"id": "58a8dd64-f1f1-4d37-a7a0-8081f707e625", "content": "### Example 1: Node.js Echo Agent\n\n**agent.mjs**\n```javascript\nimport readline from 'readline';\n\nconst rl = readline.createInterface({\n  input: process.stdin,\n  output: process.stdout,\n  terminal: false\n});\n\n// Ready signal\nconsole.log('READY');\n\nrl.on('line', (line) => {\n  const msg = JSON.parse(line);\n  \n  if (msg.type === 'input') {\n    const response = `Echo from Node.js: ${msg.input}`;\n    console.log(JSON.stringify({ type: 'final', output: response }));\n  }\n});\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  process:\n    command: [\"node\", \"agent.mjs\"]", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 10, "total_chunks": null}}
{"id": "9b839182-9fb4-4038-b072-4bce99016b4c", "content": "    protocol: jsonl\n    ready_pattern: \"^READY$\"\n```\n\n**Execution**\n```bash\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 11, "total_chunks": null}}
{"id": "6524a445-23de-4315-a6c4-57545b4e5f98", "content": "### Example 2: Node.js Streaming Agent (OpenAI)\n\n**streaming_agent.mjs**\n```javascript\nimport OpenAI from 'openai';\nimport readline from 'readline';\n\nconst client = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\nconst rl = readline.createInterface({\n  input: process.stdin,\n  output: process.stdout,\n  terminal: false\n});\n\nconsole.log('READY');\n\nrl.on('line', async (line) => {\n  const msg = JSON.parse(line);\n  \n  if (msg.type === 'input') {\n    const stream = await client.chat.completions.create({\n      model: 'gpt-4',\n      messages: [{ role: 'user', content: msg.input }],", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 12, "total_chunks": null}}
{"id": "001e3b66-5440-44b6-b745-b0e90e3b6f8d", "content": "      stream: true,\n    });\n    \n    for await (const chunk of stream) {\n      const delta = chunk.choices[0]?.delta?.content || '';\n      if (delta) {\n        console.log(JSON.stringify({ type: 'delta', delta }));\n      }\n    }\n    \n    console.log(JSON.stringify({ type: 'final', output: '[STREAM_END]' }));\n  }\n});\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  process:\n    command: [\"node\", \"streaming_agent.mjs\"]\n    protocol: jsonl\n    stream_output_path: \"delta\"\n    ready_pattern: \"^READY$\"\n    timeout: 120s\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 13, "total_chunks": null}}
{"id": "a90e4678-0eac-4dac-a82f-9f78ca985c29", "content": "### Example 3: Go Agent\n\n**agent.go**\n```go\npackage main\n\nimport (\n    \"bufio\"\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\ntype InputMessage struct {\n    Type    string                 `json:\"type\"`\n    Input   string                 `json:\"input\"`\n    Context map[string]interface{} `json:\"context\"`\n}\n\ntype OutputMessage struct {\n    Type   string `json:\"type\"`\n    Output string `json:\"output\"`\n}\n\nfunc main() {\n    fmt.Println(\"READY\")\n    \n    scanner := bufio.NewScanner(os.Stdin)\n    for scanner.Scan() {\n        var msg InputMessage", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 14, "total_chunks": null}}
{"id": "e660b58d-1087-464b-8c60-3ea9c67d71bf", "content": "        if err := json.Unmarshal(scanner.Bytes(), &msg); err != nil {\n            continue\n        }\n        \n        if msg.Type == \"input\" {\n            response := OutputMessage{\n                Type:   \"final\",\n                Output: \"Response from Go: \" + msg.Input,\n            }\n            data, _ := json.Marshal(response)\n            fmt.Println(string(data))\n        }\n    }\n}\n```\n\n**Build & Configure**\n```bash\ngo build -o agent agent.go\n```\n\n**configs/simulation.yaml**\n```yaml\nrunner:\n  process:\n    command: [\"./agent\"]", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 15, "total_chunks": null}}
{"id": "6109d2a7-b581-4b7d-9a7f-f13d2b36abda", "content": "    protocol: jsonl\n    ready_pattern: \"^READY$\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 16, "total_chunks": null}}
{"id": "4f5461c5-81c5-442a-9b78-5e89ab40efe2", "content": "## Troubleshooting\n\n| Problem | Cause | Solution |\n|---------|-------|----------|\n| Process fails to start | Command path error | Use absolute path in `command` or adjust `cwd` |\n| JSONL parsing failure | Invalid JSON format | Check STDERR logs, debug process |\n| Timeout | Slow response or infinite wait | Increase `timeout`, verify `ready_pattern` |\n| Ready signal not detected | Pattern mismatch | Test regex, disable STDOUT buffering |\n| Missing output | STDOUT buffering | Node: `console.log`, Go: `fmt.Println` (auto-flush) |", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 17, "total_chunks": null}}
{"id": "d2c40ed6-e3a9-4f1d-ab42-921f353bb0a5", "content": "| Zombie process | Termination failure | Adjust `kill_signal`/`kill_timeout` |\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 18, "total_chunks": null}}
{"id": "72b69eb4-057d-4b7c-bfc9-c084bc016cda", "content": "## Advanced Topics\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 19, "total_chunks": null}}
{"id": "c830cae2-8d6d-4021-bf52-0480336ff145", "content": "### Environment Variable Isolation\n\n```yaml\nrunner:\n  process:\n    command: [\"node\", \"agent.mjs\"]\n    env:\n      NODE_ENV: production\n      API_KEY: \"${OPENAI_API_KEY}\"      # Load from .env file\n    # System environment variables inherited by default\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 20, "total_chunks": null}}
{"id": "1172a320-7be8-47fa-82ca-23cd9cb11bfd", "content": "### Error Handling\n\nProcess reports error:\n\n```json\n{\"type\": \"error\", \"error\": \"API rate limit exceeded\", \"code\": \"RATE_LIMIT\"}\n```\n\nFluxLoop records as experiment failure and proceeds to next input.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 21, "total_chunks": null}}
{"id": "0465f306-6ee8-459d-aaf2-e1f6d24d029a", "content": "### Run Without Ready Signal\n\nSimple processes can omit `ready_pattern`:\n\n```yaml\nrunner:\n  process:\n    command: [\"python\", \"simple_agent.py\"]\n    protocol: jsonl\n    # ready_pattern omitted → send input immediately\n```\n\nNote: Processes with long initialization may lose first input.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 22, "total_chunks": null}}
{"id": "f236b88d-f54d-4a90-93bc-39397ca9d9bd", "content": "### Multiple Input Processing (Reuse)\n\nBy default, FluxLoop spawns a new process per input. For reuse, implement multi-input handling:\n\n```javascript\n// Node.js reuse example\nrl.on('line', async (line) => {\n  const msg = JSON.parse(line);\n  if (msg.type === 'input') {\n    const output = await process_input(msg.input);\n    console.log(JSON.stringify({ type: 'final', output }));\n  }\n});\n```\n\nConfigure reuse mode (P1 roadmap):\n\n```yaml\nrunner:\n  process:\n    command: [\"node\", \"agent.mjs\"]\n    protocol: jsonl\n    reuse: true                         # Process reuse (P1 roadmap)", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 23, "total_chunks": null}}
{"id": "9f01c3aa-164a-4a46-adba-aac72b680757", "content": "```\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 24, "total_chunks": null}}
{"id": "69b17532-a23e-4040-8cb2-7a36710fe11a", "content": "## Performance\n\n- **Startup Overhead**: Process creation (~10-100ms). Accumulates in repeated experiments.\n- **Parallel Execution**: Use `simulation.parallelism` for concurrent processes.\n- **Memory**: Each process uses independent memory space.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 25, "total_chunks": null}}
{"id": "72511433-64b2-40c5-af57-17e42a34b36f", "content": "## Security\n\n- **Input Validation**: Processes should consider malicious input possibilities.\n- **Sandboxing**: Recommend running in container environment (P2: Docker pattern).\n- **Log Sensitive Info**: Ensure API keys not exposed in STDOUT/STDERR.\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 26, "total_chunks": null}}
{"id": "c5b08066-c786-4f4a-8e6c-e8050c1e32a7", "content": "## Related Documentation\n\n- HTTP REST (Coming soon) – remote service integration\n- Container Docker (Coming soon) – isolated process execution\n- Streaming Schema (Coming soon) – advanced delta path configuration\n- Guards (Coming soon) – timeout/resource limits\n- [Simulation Config](../simulation-config) – full configuration structure\n", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 27, "total_chunks": null}}
{"id": "676d8232-b8e3-4da4-9187-e6106a8108f2", "content": "## MCP Metadata\n\n```json\n{\n  \"pattern\": \"subprocess-jsonl\",\n  \"tags\": [\"subprocess\", \"jsonl\", \"node\", \"go\", \"rust\", \"p0\", \"cross-language\"],\n  \"examples\": [\n    \"examples/node-agent/\",\n    \"samples/go-jsonl.md\",\n    \"samples/rust-stdio.md\"\n  ],\n  \"faq\": [\n    \"How to debug JSONL parsing errors?\",\n    \"Process reuse vs per-input spawn?\",\n    \"Environment variable passing?\",\n    \"Ready signal best practices?\"\n  ],\n  \"related_patterns\": [\n    \"http-rest\",\n    \"container-docker\",\n    \"streaming-schema\"\n  ],\n  \"dependencies\": [\n    \"Node.js/Go/Rust runtime\",", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 28, "total_chunks": null}}
{"id": "91bf9f2f-9a83-4bf7-89c5-4fc287ef1d5e", "content": "    \"JSONL protocol implementation\"\n  ]\n}\n```", "metadata": {"source": "packages/website/docs-cli/configuration/runners/subprocess-jsonl.md", "chunk_index": 29, "total_chunks": null}}
{"id": "17092ce8-d6fe-4bba-bd1b-d44d03a6ec91", "content": "---\nsidebar_position: 3\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 0, "total_chunks": null}}
{"id": "66ae94bd-020d-4a76-8fea-2519cd9f479b", "content": "# Simulation Configuration\n\nConfigure experiment execution settings in `configs/simulation.yaml`.\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 1, "total_chunks": null}}
{"id": "5bd09b5e-8b85-4304-8c55-e3fa3ec64816", "content": "## Overview\n\nThe simulation configuration controls how experiments execute:\n\n- **Experiment Identity**: Name and description\n- **Execution Settings**: Iterations, parallelism, delays\n- **Runner Configuration**: How to call your agent code\n- **Recording/Replay**: Argument capture and playback\n- **Multi-Turn Mode**: Dynamic conversation extension\n- **Output Settings**: Where and what to save\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 2, "total_chunks": null}}
{"id": "9eb1638b-a67d-45eb-b72b-ae0213469c5e", "content": "## File Location\n\n```\nfluxloop/my-agent/\n└── configs/\n    └── simulation.yaml    # ← This file\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 3, "total_chunks": null}}
{"id": "a3624d28-3290-46e7-8124-9964c22fafb7", "content": "## Complete Example\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 4, "total_chunks": null}}
{"id": "47413579-b01c-4134-89a8-1aee83efb97d", "content": "# FluxLoop Simulation Configuration", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 5, "total_chunks": null}}
{"id": "5d78a4c1-5937-4e71-a237-253688f1de2e", "content": "# ------------------------------------------------------------", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 6, "total_chunks": null}}
{"id": "b4cae783-ca8d-4848-96e2-1a54b3347b69", "content": "# Controls how experiments execute (iterations, runner target, output paths).", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 7, "total_chunks": null}}
{"id": "704c515e-6c3a-43fb-bc1d-5f7d71152cae", "content": "# Adjust runner module/function to point at your agent entry point.\nname: my_agent_experiment\ndescription: AI agent simulation experiment\n\niterations: 1           # Number of times to cycle through inputs/personas\nparallel_runs: 1          # Increase for concurrent execution (ensure thread safety)\nrun_delay_seconds: 0      # Optional delay between runs to avoid rate limits\nseed: 42                  # Set for reproducibility; remove for randomness\n\nrunner:\n  module_path: \"examples.simple_agent\"\n  function_name: \"run\"", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 8, "total_chunks": null}}
{"id": "07485e96-a779-4cdd-9776-eaeb61223815", "content": "  target: \"examples.simple_agent:run\"\n  working_directory: .    # Relative to project root; adjust if agent lives elsewhere\n  python_path:            # Optional custom PYTHONPATH entries\n  timeout_seconds: 120   # Abort long-running traces\n  max_retries: 3         # Automatic retry attempts on error\n\nreplay_args:\n  enabled: false\n  recording_file: recordings/args_recording.jsonl\n  override_param_path: data.content\n\nmulti_turn:\n  enabled: false              # Enable to drive conversations via supervisor\n  max_turns: 8                # Safety cap on total turns per conversation", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 9, "total_chunks": null}}
{"id": "db8dbdd7-caf8-4575-abb3-f4425af78137", "content": "  auto_approve_tools: true    # Automatically approve tool calls when supported\n  persona_override: null      # Force a specific persona id (optional)\n  supervisor:\n    provider: openai          # openai (LLM generated) | mock (scripted playback)\n    model: gpt-4o-mini\n    system_prompt: |\n      You supervise an AI assistant supporting customers.\n      Review the entire transcript and decide whether to continue.\n      When continuing, craft the next user message consistent with the persona.\n      When terminating, explain the reason and provide any closing notes.", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 10, "total_chunks": null}}
{"id": "c50c4aa4-aace-4688-a491-eebbbb36aa46", "content": "    metadata:\n      scripted_questions: []  # Array of user utterances for sequential playback\n      mock_decision: terminate        # Fallback when no scripted questions remain\n      mock_reason: script_complete    # Termination reason for scripted runs\n      mock_closing: \"Thanks for the help. I have no further questions.\"\n\noutput_directory: experiments\nsave_traces: true\nsave_aggregated_metrics: true\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 11, "total_chunks": null}}
{"id": "8b585c4b-de59-473e-901c-3faa364aee28", "content": "## Experiment Settings\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 12, "total_chunks": null}}
{"id": "3cb53f50-3263-4944-b239-e0c60a6cafc7", "content": "### name\n\n**Type:** `string`  \n**Required:** Yes  \n**Example:** `my_agent_experiment`, `customer_support_test`\n\nExperiment name stored in experiment metadata and reports (output directories now use `exp_<timestamp>` for brevity).\n\n```yaml\nname: my_agent_experiment\n```\n\n**Output Directory:**\n```\nexperiments/exp_20250117_143022/\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 13, "total_chunks": null}}
{"id": "90ee12e7-cef0-4ac1-8143-106d77afb050", "content": "### description\n\n**Type:** `string`  \n**Required:** Yes  \n**Example:** `Testing customer support agent with various personas`\n\nHuman-readable description of the experiment.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 14, "total_chunks": null}}
{"id": "cb8bc6cc-28b1-47d9-a910-7c0bb26fb2c9", "content": "## Execution Control\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 15, "total_chunks": null}}
{"id": "4062f63f-ec1e-4836-8690-b57fc2ab3a06", "content": "### iterations\n\n**Type:** `integer`  \n**Default:** `1`  \n**Range:** `1-1000`\n\nNumber of times to cycle through all inputs.\n\n```yaml\niterations: 10\n```\n\n**Formula:**\n```\nTotal Runs = inputs × personas × iterations\n```\n\n**Example:**\n- 50 inputs\n- 2 personas\n- 5 iterations\n- **Total: 500 runs**\n\n**Use Cases:**\n\n| Iterations | Use Case |\n|------------|----------|\n| `1` | Quick validation, CI/CD |\n| `5-10` | Standard testing |\n| `20-50` | Statistical analysis |\n| `100+` | Benchmarking, stress testing |\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 16, "total_chunks": null}}
{"id": "bdb193fc-cc1f-406d-8c5e-ff2769a15d66", "content": "### parallel_runs\n\n**Type:** `integer`  \n**Default:** `1`  \n**Range:** `1-20`\n\nNumber of experiments to run concurrently.\n\n```yaml\nparallel_runs: 4  # Run 4 experiments simultaneously\n```\n\n**Important:**\n- Ensure your agent code is **thread-safe**\n- Watch for rate limits from external APIs\n- Monitor system resources (CPU, memory)\n\n**Recommended Values:**\n\n| Value | Use Case |\n|-------|----------|\n| `1` | Default, safest option |\n| `2-4` | I/O-bound agents (API calls) |\n| `5-10` | CPU-bound agents on multi-core machines |\n| `10+` | Distributed systems, cluster environments |", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 17, "total_chunks": null}}
{"id": "7441c724-461e-4b25-8e01-801d39fd319e", "content": "### run_delay_seconds\n\n**Type:** `number`  \n**Default:** `0`  \n**Range:** `0-60`\n\nDelay between runs (in seconds) to avoid rate limits.\n\n```yaml\nrun_delay_seconds: 0.5  # 500ms delay between runs\n```\n\n**When to Use:**\n- Avoid API rate limits (OpenAI, external services)\n- Prevent overwhelming downstream systems\n- Simulate realistic user pacing\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 19, "total_chunks": null}}
{"id": "5a8cc632-7451-4676-b794-edccb4f08de5", "content": "### seed\n\n**Type:** `integer | null`  \n**Default:** `42`  \n**Example:** `42`, `null`\n\nRandom seed for reproducibility.\n\n```yaml\nseed: 42      # Deterministic\nseed: null    # Random each run\n```\n\n**Effects:**\n- Input shuffling order\n- Sampling decisions\n- Any random behavior in your agent\n\n**Use Cases:**\n\n| Value | Use Case |\n|-------|----------|\n| Fixed (`42`) | Regression testing, CI/CD, reproducible experiments |\n| `null` | Discovering edge cases, stress testing |\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 20, "total_chunks": null}}
{"id": "210dc805-80b7-4320-a2d3-23e1abf3a30c", "content": "## Runner Configuration\n\nThe runner defines how FluxLoop calls your agent code.\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 21, "total_chunks": null}}
{"id": "77971e35-7209-44bd-ba26-b0e01114cf1e", "content": "### target (Recommended)\n\n**Type:** `string`  \n**Format:** `module:function` or `module:Class.method`  \n**Example:** `examples.simple_agent:run`\n\nUnified target specification (recommended over separate module_path/function_name).\n\n```yaml\nrunner:\n  target: \"examples.simple_agent:run\"\n```\n\n**Patterns:**\n\n| Pattern | Example | Description |\n|---------|---------|-------------|\n| `module:function` | `my_agent:run` | Call module-level function |\n| `module:Class.method` | `my_agent:Agent.process` | Call static/class method (zero-arg constructor) |", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 22, "total_chunks": null}}
{"id": "b84cb18f-4d35-4efa-b71a-c073fba7f08d", "content": "| `module:instance.method` | `my_agent:agent.handle` | Call method on module-level instance |\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 23, "total_chunks": null}}
{"id": "d60af518-5105-4412-a499-1ee27bd0f611", "content": "### module_path\n\n**Type:** `string`  \n**Example:** `examples.simple_agent`, `src.agents.customer_support`\n\nPython module path (alternative to `target`).\n\n```yaml\nrunner:\n  module_path: \"examples.simple_agent\"\n  function_name: \"run\"\n```\n\n**Import Behavior:**\n```python\nfrom examples.simple_agent import run\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 24, "total_chunks": null}}
{"id": "a02e5559-9f70-4498-8ada-f6930e128392", "content": "### function_name\n\n**Type:** `string`  \n**Example:** `run`, `process_message`, `handle_request`\n\nFunction name to call (used with `module_path`).\n\n```yaml\nrunner:\n  module_path: \"examples.simple_agent\"\n  function_name: \"run\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 25, "total_chunks": null}}
{"id": "3d26df07-7b76-4537-ac65-018e04857294", "content": "### working_directory\n\n**Type:** `string`  \n**Default:** `.`  \n**Example:** `.`, `src/`, `../agent-code`\n\nWorking directory relative to project root.\n\n```yaml\nrunner:\n  working_directory: .\n```\n\n**Use Cases:**\n\n| Path | Scenario |\n|------|----------|\n| `.` | Agent code in project root |\n| `src/` | Agent code in subdirectory |\n| `../agent-code` | Agent code outside project |\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 26, "total_chunks": null}}
{"id": "2cfb37a3-3565-4d67-952b-3974d1f29f4e", "content": "### python_path\n\n**Type:** `list[string] | null`  \n**Default:** `null`  \n**Example:** `[\"src\", \"../shared\"]`\n\nAdditional directories to add to `PYTHONPATH`.\n\n```yaml\nrunner:\n  python_path:\n    - src\n    - ../shared-libs\n```\n\n**Equivalent to:**\n```bash\nexport PYTHONPATH=\"src:../shared-libs:$PYTHONPATH\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 27, "total_chunks": null}}
{"id": "4f704215-e646-40b3-b399-0808d529baf0", "content": "### timeout_seconds\n\n**Type:** `integer`  \n**Default:** `120`  \n**Range:** `10-3600`\n\nMaximum execution time per run (in seconds).\n\n```yaml\nrunner:\n  timeout_seconds: 180  # 3 minutes\n```\n\n**Behavior:**\n- If agent exceeds timeout, run is aborted\n- Trace marked as `TIMEOUT` status\n- Error details captured in observations\n\n**Recommended Values:**\n\n| Timeout | Use Case |\n|---------|----------|\n| `30` | Simple agents, fast APIs |\n| `120` | Standard agents (default) |\n| `300-600` | Complex multi-step agents |\n| `1800+` | Long-running batch operations |", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 28, "total_chunks": null}}
{"id": "7614fe4f-9da0-4678-b39a-799081283bbe", "content": "### max_retries\n\n**Type:** `integer`  \n**Default:** `3`  \n**Range:** `0-10`\n\nNumber of automatic retry attempts on transient errors.\n\n```yaml\nrunner:\n  max_retries: 5\n```\n\n**Retry Logic:**\n- Exponential backoff between retries\n- Only retries on specific error types (network, timeout)\n- Does not retry on business logic errors\n\n**Recommended:**\n\n| Value | Use Case |\n|-------|----------|\n| `0` | No retries, fail fast |\n| `3` | Standard (default) |\n| `5-10` | Unstable external APIs |\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 30, "total_chunks": null}}
{"id": "9b6a56ae-61a9-4586-8d9b-d27389a2473c", "content": "## Recording and Replay\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 31, "total_chunks": null}}
{"id": "36371dc3-b3c3-47e6-b3c8-2543a72b5c3f", "content": "### Overview\n\nRecording mode captures actual function arguments during live operation, then replays them during experiments. Useful for:\n- Complex signatures (WebSocket handlers, callbacks)\n- Non-standard argument passing\n- Integration testing with real data\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 32, "total_chunks": null}}
{"id": "68b0ef65-abd7-45be-be18-0b910a7e7973", "content": "### replay_args.enabled\n\n**Type:** `boolean`  \n**Default:** `false`\n\nEnable argument replay mode.\n\n```yaml\nreplay_args:\n  enabled: true\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 33, "total_chunks": null}}
{"id": "da0cb6b5-c231-48ec-988e-9a0e8c809b2b", "content": "### replay_args.recording_file\n\n**Type:** `string`  \n**Default:** `recordings/args_recording.jsonl`\n\nPath to JSONL file containing recorded arguments.\n\n```yaml\nreplay_args:\n  recording_file: recordings/args_recording.jsonl\n```\n\n**File Format:**\n```jsonl\n{\"args\": [], \"kwargs\": {\"data\": {\"content\": \"user message\"}}, \"timestamp\": \"2025-01-17T14:30:22Z\"}\n{\"args\": [], \"kwargs\": {\"data\": {\"content\": \"another message\"}}, \"timestamp\": \"2025-01-17T14:30:25Z\"}\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 34, "total_chunks": null}}
{"id": "524edf30-0a14-452a-b3c8-a96484d830a6", "content": "### replay_args.override_param_path\n\n**Type:** `string`  \n**Default:** `data.content`\n\nDot-notation path to override with generated input variation.\n\n```yaml\nreplay_args:\n  override_param_path: data.content\n```\n\n**Example:**\n\nOriginal recorded argument:\n```python\nkwargs = {\"data\": {\"content\": \"original message\"}}\n```\n\nWith override path `data.content` and generated input `\"test input\"`:\n```python\nkwargs = {\"data\": {\"content\": \"test input\"}}  # Overridden\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 35, "total_chunks": null}}
{"id": "ac64e75d-2774-466d-99dd-16fb0c777f26", "content": "### Recording Workflow\n\n**1. Enable recording in .env:**\n```bash\nFLUXLOOP_RECORD_ARGS=true\nFLUXLOOP_RECORDING_FILE=recordings/args_recording.jsonl\n```\n\n**2. Run your application normally:**\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 36, "total_chunks": null}}
{"id": "4d55e258-ce9b-46a2-bfbd-e0f01be79708", "content": "# Your agent will record arguments\npython my_app.py\n```\n\n**3. Configure replay:**\n```yaml\nreplay_args:\n  enabled: true\n  recording_file: recordings/args_recording.jsonl\n  override_param_path: data.content\n```\n\n**4. Run experiment:**\n```bash\nfluxloop run experiment\n```\n\nSee [Recording Workflow](/cli/workflows/recording-workflow) for details.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 37, "total_chunks": null}}
{"id": "3f08a0b1-c531-4b1e-9951-002f9919a57c", "content": "## Multi-Turn Conversations\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 38, "total_chunks": null}}
{"id": "ee2a72a2-7aac-49ab-8571-3f9fcd3854fa", "content": "### Overview\n\nMulti-turn mode extends single-input experiments into dynamic conversations. Instead of one question and one answer, FluxLoop:\n\n1. Sends initial user message\n2. Gets agent response\n3. Asks AI supervisor: \"Should we continue?\"\n4. If yes, supervisor generates next realistic user message\n5. Repeats until natural completion or `max_turns`\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 39, "total_chunks": null}}
{"id": "7373debc-7c54-423b-be2b-fa680656df43", "content": "### multi_turn.enabled\n\n**Type:** `boolean`  \n**Default:** `false`\n\nEnable multi-turn conversation mode.\n\n```yaml\nmulti_turn:\n  enabled: true\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 40, "total_chunks": null}}
{"id": "6043c9fb-f2ab-4a18-a467-2d53a556e35e", "content": "### multi_turn.max_turns\n\n**Type:** `integer`  \n**Default:** `8`  \n**Range:** `2-50`\n\nMaximum conversation turns (safety cap).\n\n```yaml\nmulti_turn:\n  max_turns: 12\n```\n\n**What Counts as a Turn:**\n- One user message + one agent response = 1 turn\n\n**Recommended:**\n\n| Turns | Use Case |\n|-------|----------|\n| `3-5` | Quick exchanges |\n| `8-12` | Standard conversations (default) |\n| `15-30` | Complex troubleshooting |\n| `30+` | Extended sessions |\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 41, "total_chunks": null}}
{"id": "eee6082a-fa62-4bb1-970a-41a86a3a4a52", "content": "### multi_turn.auto_approve_tools\n\n**Type:** `boolean`  \n**Default:** `true`\n\nAutomatically approve tool calls (vs prompting user).\n\n```yaml\nmulti_turn:\n  auto_approve_tools: true\n```\n\n**Effects:**\n- `true`: Tool calls execute automatically\n- `false`: Prompt user for approval (not practical in experiments)\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 42, "total_chunks": null}}
{"id": "8658b71f-0a70-478a-a666-c665e795d4f0", "content": "### multi_turn.persona_override\n\n**Type:** `string | null`  \n**Default:** `null`\n\nForce a specific persona (override input metadata).\n\n```yaml\nmulti_turn:\n  persona_override: expert_user  # All conversations use expert_user\n```\n\n**Use Cases:**\n- Testing specific persona behavior\n- Debugging persona-specific issues\n- Controlled experiments\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 43, "total_chunks": null}}
{"id": "68476cfd-4356-4784-8402-36523cc79269", "content": "## Supervisor Configuration\n\nThe supervisor is an LLM that decides when to continue conversations and generates realistic follow-up messages.\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 44, "total_chunks": null}}
{"id": "bc937578-8ca0-40e5-9894-ec40ef251cb6", "content": "### supervisor.provider\n\n**Type:** `string`  \n**Options:** `openai` | `mock`  \n**Default:** `openai`\n\nSupervisor implementation.\n\n```yaml\nsupervisor:\n  provider: openai  # LLM-driven (dynamic)\n  # or\n  provider: mock    # Scripted playback (deterministic)\n```\n\n**OpenAI Provider:**\n- Uses LLM to decide continuation\n- Generates contextual follow-ups\n- Non-deterministic, realistic\n\n**Mock Provider:**\n- Plays back scripted questions\n- Deterministic, reproducible\n- Perfect for regression testing\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 45, "total_chunks": null}}
{"id": "a0f534e4-9a22-4616-bec0-57733257934a", "content": "### supervisor.model\n\n**Type:** `string`  \n**Default:** `gpt-4o-mini`  \n**Example:** `gpt-4o`, `gpt-4o-mini`, `gpt-4-turbo`\n\nLLM model for supervision (OpenAI provider only).\n\n```yaml\nsupervisor:\n  provider: openai\n  model: gpt-4o  # More capable, higher cost\n  # or\n  model: gpt-4o-mini  # Faster, cheaper\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 46, "total_chunks": null}}
{"id": "206953f9-162d-49c7-9dd6-51db73ddf32e", "content": "### supervisor.system_prompt\n\n**Type:** `string | null`  \n**Default:** Built-in prompt\n\nCustom system prompt for supervisor.\n\n```yaml\nsupervisor:\n  system_prompt: |\n    You supervise a customer support AI for an e-commerce platform.\n    \n    Review the conversation and decide:\n    1. Should we continue? (customer needs more help)\n    2. What should the customer say next? (realistic follow-up)\n    \n    Termination reasons:\n    - Issue resolved\n    - All questions answered\n    - Customer satisfied\n    \n    When generating follow-ups:", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 47, "total_chunks": null}}
{"id": "dd7ef941-2436-4b9f-91ea-ddf180d4d026", "content": "    - Match the persona characteristics\n    - Build on conversation history\n    - Stay in the service domain\n```\n\n**Prompt Guidelines:**\n- Explain supervisor role\n- Define termination conditions\n- Describe follow-up generation strategy\n- Reference persona and service context\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 48, "total_chunks": null}}
{"id": "bd733e81-d573-48be-bb6e-527f8457efb6", "content": "### supervisor.metadata\n\n**Type:** `object`\n\nAdditional supervisor configuration.\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 49, "total_chunks": null}}
{"id": "7f9a8d21-925d-42a1-a5ee-a29949031623", "content": "#### For Mock Provider (Scripted Playback):\n\n```yaml\nsupervisor:\n  provider: mock\n  metadata:\n    scripted_questions:\n      - \"What are your hours?\"\n      - \"Do you offer refunds?\"\n      - \"Thanks, that's all I need.\"\n    mock_decision: terminate\n    mock_reason: script_complete\n    mock_closing: \"Thanks for the help. I have no further questions.\"\n```\n\n**Fields:**\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `scripted_questions` | `list[string]` | Ordered list of user messages |\n| `mock_decision` | `string` | What to do when script ends (`terminate`) |", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 50, "total_chunks": null}}
{"id": "fcab7574-3846-48f8-a984-964ea21b55cc", "content": "| `mock_reason` | `string` | Termination reason |\n| `mock_closing` | `string` | Final user message |\n\n**Behavior:**\n1. Plays questions in order\n2. When list exhausted, terminates with `mock_decision`\n3. Adds `mock_closing` as final message\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 51, "total_chunks": null}}
{"id": "a2fcf112-5ac3-46bc-82e1-1dacbd8f300f", "content": "## Output Settings\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 52, "total_chunks": null}}
{"id": "fb89bb66-82ac-4e1d-8f03-3b06840dbf4c", "content": "### output_directory\n\n**Type:** `string`  \n**Default:** `experiments`\n\nDirectory for experiment outputs (relative to project root).\n\n```yaml\noutput_directory: experiments\n```\n\n**Structure:**\n```\nexperiments/\n└── exp_20250117_143022/\n    ├── summary.json\n    ├── metadata.json\n    ├── artifacts/\n    │   ├── traces.jsonl\n    │   └── observations.jsonl\n    └── logs/\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 53, "total_chunks": null}}
{"id": "29cbb856-5ff7-482c-b7c7-3889a30e5292", "content": "### save_traces\n\n**Type:** `boolean`  \n**Default:** `true`\n\nSave detailed trace data.\n\n```yaml\nsave_traces: true\n```\n\n**Output:**\n- `artifacts/traces.jsonl` - Complete trace data\n- `artifacts/observations.jsonl` - Observation stream\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 54, "total_chunks": null}}
{"id": "36df5fc4-9d04-4813-bfea-47e26ec401ad", "content": "### save_aggregated_metrics\n\n**Type:** `boolean`  \n**Default:** `true`\n\nSave summary statistics.\n\n```yaml\nsave_aggregated_metrics: true\n```\n\n**Output:**\n- `summary.json` - Aggregate metrics\n- `metadata.json` - Experiment configuration\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 55, "total_chunks": null}}
{"id": "78adb764-26c4-4fa0-aa78-0b622954c229", "content": "## Complete Examples\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 56, "total_chunks": null}}
{"id": "0c42dfcb-3144-4d8f-94d3-647958ae336c", "content": "### Minimal Configuration\n\n```yaml\nname: quick_test\ndescription: Quick validation test\niterations: 1\n\nrunner:\n  target: \"my_agent:run\"\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 57, "total_chunks": null}}
{"id": "78f1b0da-5984-4c97-8a9c-0557304ca3e5", "content": "### Standard Configuration\n\n```yaml\nname: agent_test\ndescription: Standard agent testing\niterations: 10\nseed: 42\n\nrunner:\n  target: \"examples.simple_agent:run\"\n  timeout_seconds: 120\n  max_retries: 3\n\noutput_directory: experiments\nsave_traces: true\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 58, "total_chunks": null}}
{"id": "bbb5186a-5d40-473b-9bdf-028d5570b5ff", "content": "### Multi-Turn LLM Supervisor\n\n```yaml\nname: conversation_test\ndescription: Multi-turn conversation testing\niterations: 5\n\nrunner:\n  target: \"my_agent:run\"\n  timeout_seconds: 300\n\nmulti_turn:\n  enabled: true\n  max_turns: 12\n  auto_approve_tools: true\n  supervisor:\n    provider: openai\n    model: gpt-4o-mini\n    system_prompt: |\n      You supervise an AI assistant for a travel booking platform.\n      Continue if customer needs more help with flights, hotels, or bookings.\n      Terminate when reservation is complete or all questions answered.", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 59, "total_chunks": null}}
{"id": "c75eec52-ff33-4708-a9b7-b53b40a5baa2", "content": "```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 60, "total_chunks": null}}
{"id": "b1d9ad75-7ae8-48c7-a3ef-cc65e91f1611", "content": "### Multi-Turn Scripted (Deterministic)\n\n```yaml\nname: scripted_conversation\ndescription: Deterministic multi-turn testing\niterations: 1\nseed: 42\n\nrunner:\n  target: \"my_agent:run\"\n\nmulti_turn:\n  enabled: true\n  max_turns: 5\n  supervisor:\n    provider: mock\n    metadata:\n      scripted_questions:\n        - \"What are your business hours?\"\n        - \"Do you have weekend availability?\"\n        - \"Great, thanks for the info!\"\n      mock_decision: terminate\n      mock_reason: script_complete\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 61, "total_chunks": null}}
{"id": "2ece2d0e-abaa-4483-bc4a-e5b71fc2fb60", "content": "### With Recording Replay\n\n```yaml\nname: replay_test\ndescription: Test with recorded arguments\niterations: 3\n\nrunner:\n  target: \"my_handler:handle_request\"\n  timeout_seconds: 60\n\nreplay_args:\n  enabled: true\n  recording_file: recordings/production_args.jsonl\n  override_param_path: request.body.message\n\noutput_directory: experiments\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 62, "total_chunks": null}}
{"id": "83f1fcdb-9dfb-4ed6-8d1b-fa5e0e81d79c", "content": "### Production Stress Test\n\n```yaml\nname: production_stress_test\ndescription: High-volume production simulation\niterations: 100\nparallel_runs: 5\nrun_delay_seconds: 0.1\nseed: null  # Random for diversity\n\nrunner:\n  target: \"my_agent:run\"\n  timeout_seconds: 180\n  max_retries: 5\n\nmulti_turn:\n  enabled: true\n  max_turns: 15\n  supervisor:\n    provider: openai\n    model: gpt-4o\n\noutput_directory: stress_tests\nsave_traces: true\nsave_aggregated_metrics: true\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 63, "total_chunks": null}}
{"id": "63ed1f34-b254-4158-b922-8cca1cabe683", "content": "## CLI Overrides\n\nOverride configuration from command line:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 64, "total_chunks": null}}
{"id": "b3c6c03f-d225-431f-b3eb-97b84a9892c3", "content": "# Basic overrides\nfluxloop run experiment --iterations 20\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 65, "total_chunks": null}}
{"id": "5c5f087a-1f12-4b5f-b596-e6dd14f37e57", "content": "# Multi-turn overrides\nfluxloop run experiment \\\n  --multi-turn \\\n  --max-turns 15 \\\n  --auto-approve \\\n  --supervisor-model gpt-4o \\\n  --supervisor-temperature 0.3\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 66, "total_chunks": null}}
{"id": "75c42b00-bd79-46be-87b4-7177361bc372", "content": "# Persona override\nfluxloop run experiment --persona expert_user\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 67, "total_chunks": null}}
{"id": "5d1fce8d-77bb-4987-8d8e-10d1e061ff86", "content": "## Tips and Best Practices\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 68, "total_chunks": null}}
{"id": "ccd14853-d841-4af0-bc9d-595fb0fe0dc3", "content": "### Development\n\n```yaml\niterations: 1\nparallel_runs: 1\nsave_traces: true\nmulti_turn:\n  enabled: false\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 69, "total_chunks": null}}
{"id": "232b83ca-4388-4f1a-9d0c-39d36ed2d9db", "content": "### Testing\n\n```yaml\niterations: 5-10\nseed: 42  # Reproducible\nparallel_runs: 2-4\nmulti_turn:\n  enabled: true\n  max_turns: 8\n  supervisor:\n    provider: mock  # Deterministic\n```\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 70, "total_chunks": null}}
{"id": "c5819695-a8d3-4057-9739-284c0cd30301", "content": "### Production Validation\n\n```yaml\niterations: 50-100\nseed: null  # Explore variations\nparallel_runs: 5-10\nmulti_turn:\n  enabled: true\n  supervisor:\n    provider: openai\n    model: gpt-4o\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 71, "total_chunks": null}}
{"id": "dd9a19bd-8844-427c-aee8-26f742c73a70", "content": "## See Also\n\n- [Runner Targets](/cli/configuration/runner-targets) - Detailed runner patterns\n- [Multi-Turn Workflow](/cli/workflows/multi-turn-workflow) - Complete guide\n- [Recording Workflow](/cli/workflows/recording-workflow) - Recording mode\n- [run Command](/cli/commands/run) - CLI reference\n- [Project Configuration](/cli/configuration/project-config) - Project settings", "metadata": {"source": "packages/website/docs-cli/configuration/simulation-config.md", "chunk_index": 72, "total_chunks": null}}
{"id": "beeb565f-f819-4fe2-9e9f-b54efbb9a631", "content": "---\nsidebar_position: 3\n---\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 0, "total_chunks": null}}
{"id": "9a953c9c-4084-4fc7-a00c-6a06a02b59bf", "content": "# First Experiment\n\nRun your first FluxLoop experiment end-to-end.\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 1, "total_chunks": null}}
{"id": "a33056e1-6c62-4538-a615-379d7af579a4", "content": "## Prerequisites\n\n- FluxLoop CLI installed (`pip install fluxloop-cli`)\n- Python 3.8+ environment\n- OpenAI or Anthropic API key (for input generation)\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 2, "total_chunks": null}}
{"id": "d808691e-5226-46b7-83ef-c2175c418bf5", "content": "## Step 1: Create Your Project\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 3, "total_chunks": null}}
{"id": "84cccdf5-a5f9-431e-a1d0-3102e7dde052", "content": "# Create a new FluxLoop project\nfluxloop init project --name my-first-agent\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 4, "total_chunks": null}}
{"id": "9d9045b1-3c5c-47aa-9eab-4c7ee603b80a", "content": "# Navigate to project directory\ncd fluxloop/my-first-agent\n```\n\n**What you get:**\n\n```\nfluxloop/my-first-agent/\n├── configs/\n│   ├── project.yaml       # Project metadata\n│   ├── input.yaml         # Personas and base inputs\n│   ├── simulation.yaml    # Runner configuration\n│   └── evaluation.yaml    # Evaluators\n├── .env                   # Environment variables\n├── examples/\n│   └── simple_agent.py    # Sample agent code\n└── experiments/           # Results will go here\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 5, "total_chunks": null}}
{"id": "9c1acfda-b9cf-41f9-8934-947a8d38a431", "content": "## Step 2: Configure LLM Provider\n\nSet up your API key for input generation:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 6, "total_chunks": null}}
{"id": "91336e3e-0a20-4f24-92b2-38cde03ef730", "content": "# For OpenAI\nfluxloop config set-llm openai sk-your-api-key-here --model gpt-4o-mini\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 7, "total_chunks": null}}
{"id": "e5869c82-48b8-4cac-903d-c8795853dbf0", "content": "# Or for Anthropic\nfluxloop config set-llm anthropic sk-ant-your-key --model claude-3-5-sonnet-20241022\n```\n\nThis updates:\n- `.env` file with your API key\n- `configs/input.yaml` with provider settings\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 8, "total_chunks": null}}
{"id": "2157a31f-4049-4c5c-8f8c-1cc18e268477", "content": "## Step 3: Review Sample Agent\n\nOpen `examples/simple_agent.py` to see a basic agent:\n\n```python\nimport fluxloop\n\n@fluxloop.agent(name=\"SimpleAgent\")\ndef run(input_text: str) -> str:\n    \"\"\"A simple echo agent that responds to user input.\"\"\"\n    return f\"Echo: {input_text}\"\n```\n\n**For this tutorial, we'll use the provided example as-is.**\n\nThe agent is already configured in `configs/simulation.yaml`:\n\n```yaml\nrunner:\n  target: \"examples.simple_agent:run\"\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 9, "total_chunks": null}}
{"id": "73ba14c8-0490-4b71-83c8-04aec099cec6", "content": "## Step 4: Verify Setup\n\nRun diagnostics to ensure everything is ready:\n\n```bash\nfluxloop doctor\n```\n\n**Expected output:**\n\n```\n╭──────────────────────────────────╮\n│ FluxLoop Environment Doctor      │\n╰──────────────────────────────────╯\n\nComponent       Status  Details\nPython          ✓       3.11.5\nFluxLoop CLI    ✓       0.2.30\nFluxLoop SDK    ✓       Installed\nProject Config  ✓       configs/project.yaml\n\n╭──────────────────╮\n│ Doctor completed │\n╰──────────────────╯\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 10, "total_chunks": null}}
{"id": "7d5b59b9-326f-4ec2-b6a3-cc4bda6d25d4", "content": "## Step 5: Generate Test Inputs\n\nCreate variations of base inputs for testing:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 11, "total_chunks": null}}
{"id": "9a32e774-75d3-4bda-9033-2acacca1b04a", "content": "# Generate 10 input variations\nfluxloop generate inputs --limit 10 --mode llm\n```\n\n**Output:**\n\n```\nGenerating inputs with LLM mode...\n\n✓ Generated 10 input variations\n  - Base inputs: 2\n  - Personas: 2\n  - Strategies: rephrase, verbose\n  - Saved to: inputs/generated.yaml\n\nTotal inputs ready: 10\n```\n\n**View generated inputs:**\n\n```bash\ncat inputs/generated.yaml\n```\n\nYou'll see variations like:\n\n```yaml\n- input: \"Hey, how would I get started with this?\"\n  persona: novice_user\n  metadata:\n    base_input: \"How do I get started?\"\n    variation_strategy: rephrase", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 12, "total_chunks": null}}
{"id": "e40b9e60-d7f8-4410-bf23-057da1d305f8", "content": "\n- input: \"Hello, I'm new here and wondering how to begin...\"\n  persona: novice_user\n  metadata:\n    base_input: \"How do I get started?\"\n    variation_strategy: verbose\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 13, "total_chunks": null}}
{"id": "d4590f26-05c3-48a0-b5cf-3245d0e17a50", "content": "## Step 6: Run Your First Experiment\n\nExecute the experiment with all generated inputs:\n\n```bash\nfluxloop run experiment --iterations 1\n```\n\n**What happens:**\n\n1. Loads 10 inputs from `inputs/generated.yaml`\n2. Calls your agent function for each input\n3. Captures traces and observations\n4. Saves results to `experiments/exp_<timestamp>/`\n\n**Output:**\n\n```\n╭─ Experiment: my_first_agent_experiment ───────────╮\n│ Iterations: 1                                     │\n│ Input Source: inputs/generated.yaml               │\n│ Total Runs: 10                                    │", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 14, "total_chunks": null}}
{"id": "142868f3-e393-46d4-ae00-0a5f52702d69", "content": "╰───────────────────────────────────────────────────╯\n\nRunning experiments...\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 10/10 [00:05]\n\n✓ Experiment completed!\n\nResults saved to: experiments/exp_20250117_143022/\n  - trace_summary.jsonl (10 traces)\n  - observations.jsonl (30 observations)\n  - summary.json\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 15, "total_chunks": null}}
{"id": "a051371a-aa0d-4453-80ec-39e4a0d57de5", "content": "## Step 7: View Results\n\nCheck the experiment summary:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 16, "total_chunks": null}}
{"id": "94d56bc8-16a5-4410-b755-3a465f934cfd", "content": "# View summary JSON\ncat experiments/exp_*/summary.json | jq\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 17, "total_chunks": null}}
{"id": "93636f7f-e0da-4223-990b-c4d0308ff001", "content": "# Or use fluxloop status\nfluxloop status experiments\n```\n\n**Summary output:**\n\n```json\n{\n  \"experiment_name\": \"my_first_agent_experiment\",\n  \"total_traces\": 10,\n  \"successful\": 10,\n  \"failed\": 0,\n  \"avg_duration_ms\": 42.3,\n  \"started_at\": \"2025-01-17T14:30:22Z\",\n  \"completed_at\": \"2025-01-17T14:30:27Z\"\n}\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 18, "total_chunks": null}}
{"id": "45d78228-4fd9-4fcb-9804-75f0bb04fc90", "content": "## Step 8: Parse Results (Optional)\n\nConvert raw outputs into human-readable format:\n\n```bash\nfluxloop parse experiment experiments/exp_*/\n```\n\nThis creates:\n- Markdown files for each trace\n- `per_trace.jsonl` with structured data\n\n**View parsed trace:**\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 19, "total_chunks": null}}
{"id": "36b6db92-c2bb-4c09-ae0d-b16097421aee", "content": "# Open first trace\ncat experiments/exp_*/per_trace_analysis/00_*.md\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 20, "total_chunks": null}}
{"id": "33d07622-e06e-4cf8-84f3-f539cc033134", "content": "## Step 9: Evaluate Results (Optional)\n\nScore your agent's performance and generate the interactive dashboard:\n\n```bash\nfluxloop evaluate experiment experiments/exp_*/\n```\n\nThe command runs the built-in 5단계 파이프라인(Per-Trace LLM 평가 → 통계 집계 → LLM 해석 → 데이터 준비 → HTML 렌더링) and writes `evaluation_report/report.html` under the experiment directory (override with `--output`). Open that file in your browser to explore:\n\n- Executive summary + pass-rate 게이지\n- Trace × Metric 매트릭스\n- 실패/리뷰 케이스 타임라인\n- 성능 카드(토큰/턴/지연시간)와 페르소나 비교\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 21, "total_chunks": null}}
{"id": "a3981064-8295-44d9-a6d7-6a0f4e548827", "content": "## Congratulations! 🎉\n\nYou've successfully:\n\n✅ Created a FluxLoop project  \n✅ Configured LLM provider  \n✅ Generated test inputs  \n✅ Run an experiment  \n✅ Viewed results  \n✅ Parsed and evaluated outputs  \n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 22, "total_chunks": null}}
{"id": "bf7dede5-7f4d-4f46-b459-30ca22d6c1db", "content": "## What's Next?\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 23, "total_chunks": null}}
{"id": "9f04f170-c437-4caf-b3cb-1246ae22f858", "content": "### Customize Your Agent\n\nReplace the example agent with your actual code:\n\n```python", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 24, "total_chunks": null}}
{"id": "bf3b8276-52cb-4761-b095-e58d51626d79", "content": "# my_agent.py\nimport fluxloop\n\n@fluxloop.agent(name=\"MyCustomAgent\")\ndef run(input_text: str) -> str:\n    # Your agent logic here\n    result = process_input(input_text)\n    return result\n```\n\nUpdate `configs/simulation.yaml`:\n\n```yaml\nrunner:\n  target: \"my_agent:run\"\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 25, "total_chunks": null}}
{"id": "466d7bcf-0127-49d9-97b2-09e737756729", "content": "### Add More Personas\n\nEdit `configs/input.yaml` to test different user types:\n\n```yaml\npersonas:\n  - name: expert_user\n    description: Technical power user\n    expertise_level: expert\n  \n  - name: frustrated_user\n    description: User experiencing issues\n    characteristics:\n      - Expresses frustration\n      - Wants quick resolution\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 26, "total_chunks": null}}
{"id": "ae31481d-e480-4ae6-bec0-55403bd1e927", "content": "### Try Multi-Turn Conversations\n\nEnable multi-turn mode for dynamic dialogues:\n\n```bash\nfluxloop run experiment --multi-turn --max-turns 8\n```\n\nSee [Multi-Turn Workflow](/cli/workflows/multi-turn-workflow) for details.\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 27, "total_chunks": null}}
{"id": "287efd4e-9f62-4920-8c1b-8b8632dd30ee", "content": "### Run in CI/CD\n\nAdd FluxLoop to your testing pipeline:\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 28, "total_chunks": null}}
{"id": "4a6cb0e3-7199-47ce-944b-eb3b22311bdd", "content": "# .github/workflows/test.yml\n- name: Run FluxLoop Tests\n  run: |\n    fluxloop generate inputs --limit 20\n    fluxloop run experiment --yes --iterations 3\n    fluxloop evaluate experiment experiments/latest_*/\n```\n\nSee [CI/CD Integration](/cli/workflows/ci-cd-integration) for examples.\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 29, "total_chunks": null}}
{"id": "57a4e4c5-2e2c-48b7-9dcb-4942cab66e5f", "content": "## Troubleshooting\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 30, "total_chunks": null}}
{"id": "d8e5a97b-6e04-4194-8201-aec2f1813754", "content": "### \"API key not found\"\n\nSet your LLM API key:\n\n```bash\nfluxloop config set-llm openai sk-your-key\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 31, "total_chunks": null}}
{"id": "a505d7b5-34b5-4c22-ac37-569ecd537411", "content": "### \"Module not found\"\n\nEnsure your agent module is importable:\n\n```bash\nexport PYTHONPATH=\"${PYTHONPATH}:$(pwd)\"\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 32, "total_chunks": null}}
{"id": "40e56b66-ed1d-49a9-942c-0557c78ec91f", "content": "### \"No inputs generated\"\n\nCheck input generation succeeded:\n\n```bash\nls -la inputs/generated.yaml\ncat inputs/generated.yaml\n```\n\nIf empty, regenerate:\n\n```bash\nfluxloop generate inputs --limit 10 --overwrite\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 33, "total_chunks": null}}
{"id": "d9b3592c-8141-49d9-8149-600f3aea1318", "content": "## Quick Reference\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 34, "total_chunks": null}}
{"id": "2d92b9cd-270d-49d7-b53e-f3fe2e2d1126", "content": "# Complete workflow\nfluxloop init project --name my-agent\ncd fluxloop/my-agent\nfluxloop config set-llm openai sk-xxxxx\nfluxloop generate inputs --limit 10\nfluxloop run experiment\nfluxloop parse experiment experiments/latest_*/\nfluxloop evaluate experiment experiments/latest_*/\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 35, "total_chunks": null}}
{"id": "89e34fd2-5774-451e-b319-121aa4032770", "content": "# Check status\nfluxloop doctor\nfluxloop status experiments\nfluxloop config env\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 36, "total_chunks": null}}
{"id": "dec3aee7-6643-4b92-a4b3-70ec9c42e355", "content": "## Next Steps\n\n- **[Basic Workflow](/cli/workflows/basic-workflow)** - Complete guide with more details\n- **[Commands Reference](/cli/commands/init)** - Full command documentation\n- **[Configuration](/cli/configuration/project-config)** - Detailed config reference\n- **[Multi-Turn Workflow](/cli/workflows/multi-turn-workflow)** - Dynamic conversations", "metadata": {"source": "packages/website/docs-cli/getting-started/first-experiment.md", "chunk_index": 37, "total_chunks": null}}
{"id": "09479310-8912-4326-a966-08a907916c88", "content": "---\nsidebar_position: 1\n---\n\n# CLI Installation\n\nInstall the FluxLoop CLI for Python.\n\n## Requirements\n\n- Python 3.8 or higher\n- pip\n\n## Install via pip\n\n```bash\npip install fluxloop-cli\n```\n\n## Verify Installation\n\n```bash\nfluxloop --version\n```\n\nYou should see:\n```\nFluxLoop CLI version 0.2.30\n```\n\n## Next Steps\n\n- [Project Setup](./project-setup)\n- [First Experiment](./first-experiment)\n", "metadata": {"source": "packages/website/docs-cli/getting-started/installation.md", "chunk_index": 0, "total_chunks": null}}
{"id": "795ec4e4-551a-425b-9706-16f8021a9b2e", "content": "---\nsidebar_position: 2\n---\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 0, "total_chunks": null}}
{"id": "7dc753b9-e9ea-435a-a48d-3c2a416bf55a", "content": "# Project Setup\n\nCreate and configure your first FluxLoop project.\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 1, "total_chunks": null}}
{"id": "739cfa8f-599d-4f7f-a551-e44d6c6e363e", "content": "## Initialize a New Project\n\nCreate a new project with the CLI:\n\n```bash\nfluxloop init project --name my-agent\ncd fluxloop/my-agent\n```\n\nThis generates a complete project structure:\n\n```\nfluxloop/my-agent/\n├── configs/\n│   ├── project.yaml          # Project metadata\n│   ├── input.yaml            # Input generation settings\n│   ├── simulation.yaml       # Experiment configuration\n│   └── evaluation.yaml       # Evaluation rules\n├── .env                      # Environment variables\n├── examples/\n│   └── simple_agent.py       # Sample instrumented agent", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 2, "total_chunks": null}}
{"id": "86d701f0-923b-401f-b59a-b5b3d25572c6", "content": "├── experiments/              # Results output directory\n├── inputs/                   # Generated inputs directory\n└── recordings/               # Recorded arguments (optional)\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 3, "total_chunks": null}}
{"id": "1e582966-b5de-4d01-9809-fefae5762b64", "content": "## Project Configuration Files\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 4, "total_chunks": null}}
{"id": "aee199b0-97ad-4ca1-88ba-db06a1a3b546", "content": "###  `configs/project.yaml`\n\nProject-level metadata and collector settings:\n\n```yaml\nproject:\n  name: my-agent\n  version: \"1.0.0\"\n  description: \"My AI agent simulation project\"\n\ncollector:\n  enabled: false\n  url: \"http://localhost:8000\"\n  api_key: \"\"\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 5, "total_chunks": null}}
{"id": "3a20cd17-400a-4a12-bfe1-7d440ab356bd", "content": "### `configs/input.yaml`\n\nPersonas, base inputs, and input generation settings:\n\n```yaml\npersonas:\n  - name: novice_user\n    description: A user new to the system\n    traits:\n      - Asks basic questions\n      - May not know terminology\n  \n  - name: expert_user\n    description: An experienced power user\n    traits:\n      - Uses technical jargon\n      - Expects advanced features\n\nbase_inputs:\n  - input: \"How do I get started?\"\n    expected_intent: help\n    persona: novice_user\n  \n  - input: \"What are the advanced configuration options?\"", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 6, "total_chunks": null}}
{"id": "32cb2ddd-fabb-43fd-b145-9dcc6b1fb9f3", "content": "    expected_intent: configuration\n    persona: expert_user\n\ninput_generation:\n  mode: llm                    # or \"deterministic\"\n  llm:\n    provider: openai           # or \"anthropic\"\n    model: gpt-4o-mini\n    temperature: 0.7\n  strategies:\n    - rephrase\n    - verbose\n    - concise\n    - error_prone\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 7, "total_chunks": null}}
{"id": "be7aa8b6-8479-43c1-9569-ac28fb87fd4b", "content": "### `configs/simulation.yaml`\n\nExperiment runtime configuration:\n\n```yaml\nrunner:\n  target: \"examples.simple_agent:run\"   # Your agent function\n  iterations: 10                         # Runs per input\n\nreplay_args:\n  enabled: false\n  recording_file: \"recordings/args.jsonl\"\n  callable_providers: {}\n  override_param_path: \"\"\n\noutput:\n  directory: \"experiments\"\n  format: jsonl\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 8, "total_chunks": null}}
{"id": "70dc0694-1a01-4d4b-981f-ad8c51394e9b", "content": "### `configs/evaluation.yaml`\n\nEvaluator definitions (optional):\n\n```yaml\nevaluators:\n  - name: response_quality\n    type: rule_based\n    rules:\n      - check: response_length_min\n        value: 10\n      - check: no_errors\n        value: true\n\n  - name: llm_judge\n    type: llm\n    model: gpt-4o-mini\n    prompt: \"Rate this response quality from 1-10\"\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 9, "total_chunks": null}}
{"id": "3ce612d2-8ebb-4e1d-99e7-40c639e4d16d", "content": "## Environment Variables\n\nThe `.env` file stores sensitive configuration:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 10, "total_chunks": null}}
{"id": "975161dc-f9d3-4059-8cda-f91a27c2d53b", "content": "# LLM Provider API Keys\nOPENAI_API_KEY=sk-your-key-here\nANTHROPIC_API_KEY=sk-ant-your-key-here\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 11, "total_chunks": null}}
{"id": "b3e74cee-2a9b-4e42-8998-811e80bc7a6c", "content": "# Collector Configuration\nFLUXLOOP_COLLECTOR_URL=http://localhost:8000\nFLUXLOOP_COLLECTOR_API_KEY=your-api-key\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 12, "total_chunks": null}}
{"id": "8a1fae24-9eeb-4678-98cf-93b30f1bec22", "content": "# Recording Mode\nFLUXLOOP_RECORD_ARGS=false\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 13, "total_chunks": null}}
{"id": "0a85f3b2-f8e1-4793-b37c-bfae83996221", "content": "# Project Settings\nFLUXLOOP_PROJECT_NAME=my-agent\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 14, "total_chunks": null}}
{"id": "ab7ee9c1-0d8f-40ef-88b0-7eaf1a81ff3e", "content": "## Configure LLM Provider\n\nSet your API key for input generation:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 15, "total_chunks": null}}
{"id": "ec5b1e4f-53e7-4147-8b4f-17ea0a528e55", "content": "# Using CLI helper\nfluxloop config set-llm openai sk-your-api-key --model gpt-4o-mini\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 16, "total_chunks": null}}
{"id": "227410cf-a0ce-4e6b-aa7e-0de4ef389d0c", "content": "# Or manually edit .env\necho \"OPENAI_API_KEY=sk-your-key\" >> .env\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 17, "total_chunks": null}}
{"id": "16fcb96e-f8d0-455a-9744-fabd0a26895c", "content": "## Add Your Agent Code\n\nReplace the example agent with your actual agent:\n\n```python", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 18, "total_chunks": null}}
{"id": "a26d0c77-4840-4bc9-9040-740691073ca1", "content": "# examples/my_agent.py\nimport fluxloop\n\n@fluxloop.agent()\ndef run(input_text: str) -> str:\n    \"\"\"Your agent logic here\"\"\"\n    # Process the input\n    response = process_input(input_text)\n    return response\n```\n\nUpdate `configs/simulation.yaml` to point to your agent:\n\n```yaml\nrunner:\n  target: \"examples.my_agent:run\"\n  iterations: 10\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 19, "total_chunks": null}}
{"id": "03ebc3e1-4d18-4161-a70f-ff9b1549fb31", "content": "## Define Personas and Base Inputs\n\nEdit `configs/input.yaml` to match your use case:\n\n```yaml\npersonas:\n  - name: customer_support\n    description: A customer seeking help\n    traits:\n      - Polite but frustrated\n      - Wants quick resolution\n  \n  - name: technical_user\n    description: A developer using the API\n    traits:\n      - Technical language\n      - Needs documentation\n\nbase_inputs:\n  - input: \"My order hasn't arrived yet\"\n    expected_intent: order_status\n    persona: customer_support\n  \n  - input: \"What's the rate limit for the API?\"", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 20, "total_chunks": null}}
{"id": "119b934e-5cff-4d61-b3e0-bd2f8cd98655", "content": "    expected_intent: api_docs\n    persona: technical_user\n```\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 21, "total_chunks": null}}
{"id": "52a9b64a-f78f-4e17-a60a-8b9d1ecc178e", "content": "## Verify Configuration\n\nCheck your project status:\n\n```bash\nfluxloop status\n```\n\nThis shows:\n- ✅ CLI version\n- ✅ SDK installation\n- ✅ Project configuration\n- ✅ Environment variables\n- ✅ Recording mode status\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 22, "total_chunks": null}}
{"id": "97106969-b8ac-4251-b8d8-d33950d859fd", "content": "## Multiple Projects\n\nFluxLoop supports multiple projects:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 23, "total_chunks": null}}
{"id": "dfbe9e6f-9f4f-48bb-b763-131ef62bc86e", "content": "# Create another project\nfluxloop init project --name chatbot-v2\ncd fluxloop/chatbot-v2\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 24, "total_chunks": null}}
{"id": "24dda886-ed53-46b5-8d84-e588664568b4", "content": "# Switch between projects\ncd ../my-agent\n```\n\nEach project has independent configuration and results.\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 25, "total_chunks": null}}
{"id": "ee4ef5e5-c1b7-4394-9fe2-24cd110eddc0", "content": "## Best Practices\n\n1. **Version control your configs**\n   ```bash\n   git add configs/\n   git commit -m \"Add project configuration\"\n   ```\n\n2. **Keep .env out of version control**\n   ```bash\n   echo \".env\" >> .gitignore\n   ```\n\n3. **Use descriptive base inputs**\n   - Cover different personas\n   - Include edge cases\n   - Add expected outcomes\n\n4. **Start small**\n   - Begin with 5-10 base inputs\n   - Generate 50-100 variations\n   - Run 10 iterations per input\n\n5. **Iterate on configuration**\n   - Review results\n   - Adjust personas", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 26, "total_chunks": null}}
{"id": "82bc2db5-490b-45b6-8614-9f1887322abc", "content": "   - Refine generation strategies\n", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 27, "total_chunks": null}}
{"id": "1fac5fdd-4309-4064-8802-fc57bd7301bf", "content": "## Next Steps\n\n- [First Experiment](./first-experiment) - Run your first experiment\n- [Command Reference](/cli/commands/init) - Detailed command docs\n- [Configuration Reference](/cli/configuration/project-config) - Full config specs", "metadata": {"source": "packages/website/docs-cli/getting-started/project-setup.md", "chunk_index": 28, "total_chunks": null}}
{"id": "18996fbc-34e3-477c-8c7e-872d9bcc6e64", "content": "---\nsidebar_position: 1\nslug: /\n---\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 0, "total_chunks": null}}
{"id": "90449639-65f6-4cb6-a1e0-a699f01f29db", "content": "# FluxLoop CLI\n\nCommand-line interface for managing FluxLoop projects, generating inputs, and running agent simulations.\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 1, "total_chunks": null}}
{"id": "98a69be9-2688-43ab-8a41-d95354eeec5f", "content": "## Installation\n\n```bash\npip install fluxloop-cli\n```\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 2, "total_chunks": null}}
{"id": "1f5cd528-6e95-4647-b068-23ed67017179", "content": "## Version\n\nCurrent version: **0.2.30**\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 3, "total_chunks": null}}
{"id": "72de6313-b189-412c-8dbc-a2d5a5bbc826", "content": "## Features\n\n- 🎯 **Project Management**: Initialize and configure simulation projects\n- 📝 **Input Generation**: Create test input variations using LLM or deterministic strategies\n- 🧪 **Experiment Execution**: Run batch simulations with configurable iterations\n- 💬 **Multi-Turn Conversations**: Automatically extend experiments into dynamic dialogues with AI supervisor\n- 📊 **Result Parsing & Evaluation**: Convert raw artifacts to human-readable formats and score with evaluators\n- 🔴 **Recording Mode**: Capture and replay complex function arguments", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 4, "total_chunks": null}}
{"id": "dee241a2-f629-4591-90ff-d37f68e7d92c", "content": "- ⚙️ **Configuration**: Structured YAML-based configuration system\n- 🩺 **Environment Diagnostics**: Verify installation and detect configuration issues\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 5, "total_chunks": null}}
{"id": "5ea39deb-6704-46d2-a612-c5e5416ef3f0", "content": "## Quick Example\n\n```bash", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 6, "total_chunks": null}}
{"id": "6e36d431-8611-4892-a905-2fc5b140587b", "content": "# Initialize a new project\nfluxloop init project --name my-agent\ncd fluxloop/my-agent\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 7, "total_chunks": null}}
{"id": "856671a6-3aa8-498a-9bf3-5ad5e655f7a0", "content": "# Generate 50 input variations\nfluxloop generate inputs --limit 50\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 8, "total_chunks": null}}
{"id": "d0afc946-b6ce-4c81-8dd1-049a84d3b99f", "content": "# Run experiment\nfluxloop run experiment\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 9, "total_chunks": null}}
{"id": "57f3162c-2c55-4ab6-8433-8de5eca68058", "content": "# Parse results\nfluxloop parse experiment experiments/exp_*/\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 10, "total_chunks": null}}
{"id": "42e69041-f8fc-42b6-9617-d365663573ec", "content": "# Evaluate results (writes evaluation_report/report.html by default)\nfluxloop evaluate experiment experiments/exp_*/\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 11, "total_chunks": null}}
{"id": "73be9a2e-7445-411c-8a15-8423e451bf9b", "content": "# Check environment\nfluxloop doctor\n```\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 12, "total_chunks": null}}
{"id": "9c7cb4f3-8525-4aa5-a401-4c0364866280", "content": "## Key Commands\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4d2b4d65-0b32-4c25-b04b-54d95a6375ff", "content": "### Project Initialization\n\n```bash\nfluxloop init project --name <project-name>\n```\n\nCreates a new FluxLoop project with:\n- `configs/` directory (project, input, simulation, evaluation configs)\n- `.env` file for environment variables\n- `examples/` with sample agent code\n- `inputs/`, `recordings/`, `experiments/` directories\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 14, "total_chunks": null}}
{"id": "5cfafe70-d123-4926-89ce-50e90dd19d2f", "content": "### Input Generation\n\n```bash\nfluxloop generate inputs [--limit 100] [--mode llm]\n```\n\nGenerate input variations from base inputs defined in `configs/input.yaml`.\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 15, "total_chunks": null}}
{"id": "388f5179-a62c-4ec5-acf7-3f81246afe8f", "content": "### Experiment Execution\n\n```bash\nfluxloop run experiment [--iterations 10]\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 16, "total_chunks": null}}
{"id": "ef8cb59a-d0de-4da3-8bfb-dc11cd7d236e", "content": "# Multi-turn conversations (LLM-driven)\nfluxloop run experiment --multi-turn --max-turns 12 --auto-approve\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 17, "total_chunks": null}}
{"id": "ee31bee6-d7a3-4e70-bccc-10484c40b8b9", "content": "# Multi-turn scripted playback (deterministic)", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 18, "total_chunks": null}}
{"id": "8e2127a0-52ac-4169-950e-e83a6dffa32d", "content": "# Set supervisor.provider to 'mock' and supply scripted_questions in simulation.yaml\nfluxloop run experiment --multi-turn --supervisor-provider mock\n```\n\nRun simulation experiment using configuration from `configs/simulation.yaml`. Enable multi-turn mode to automatically extend single inputs into dynamic conversations. Use `provider: openai` for AI-driven follow-ups or `provider: mock` for scripted question playback.\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 19, "total_chunks": null}}
{"id": "a5450210-b977-48b6-b537-6d05b151fbd1", "content": "### Recording Mode\n\n```bash\nfluxloop record enable   # Enable argument recording\nfluxloop record disable  # Disable recording\nfluxloop record status   # Check recording state\n```\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 20, "total_chunks": null}}
{"id": "2656c312-c17b-4960-b458-263e80277591", "content": "### Configuration\n\n```bash\nfluxloop config set-llm <provider> <api-key> [--model <model>]\n```\n\nUpdate LLM provider settings in `configs/input.yaml`.\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 21, "total_chunks": null}}
{"id": "01141207-d196-4555-b895-09aaf8a3dc2f", "content": "## Configuration Files (v0.2.0)\n\nFluxLoop CLI uses a multi-file configuration structure:\n\n| File | Purpose |\n|------|---------|\n| `configs/project.yaml` | Project metadata, service context, collector settings |\n| `configs/input.yaml` | Personas, base inputs, LLM settings |\n| `configs/simulation.yaml` | Runner, iterations, multi-turn settings |\n| `configs/evaluation.yaml` | Evaluator definitions |\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 22, "total_chunks": null}}
{"id": "6ec86529-6585-4317-9e76-46fc483a47ca", "content": "## What's Next?\n\n- **[Installation](/cli/getting-started/installation)** - Detailed installation guide\n- **[Project Setup](/cli/getting-started/project-setup)** - Initialize your first project\n- **[Commands Reference](/cli/commands/init)** - Full command documentation\n- **[Doctor Command](/cli/commands/doctor)** - Diagnose environment and configuration\n- **[Configuration](/cli/configuration/project-config)** - Config file reference\n- **[Multi-Turn Workflow](/cli/workflows/multi-turn-workflow)** - Run dynamic conversations", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 23, "total_chunks": null}}
{"id": "a0cd1e52-a38d-4da8-ad28-84fe2c2803ae", "content": "- **[Runner Targets](/cli/configuration/runner-targets)** - Connect your code to simulations\n\n---\n\nNeed help? Run `fluxloop --help` or check [GitHub Issues](https://github.com/chuckgu/fluxloop/issues).\n", "metadata": {"source": "packages/website/docs-cli/intro.md", "chunk_index": 24, "total_chunks": null}}
{"id": "5ea6ff48-348c-43b0-b662-a0ad92e1ffda", "content": "---\nsidebar_position: 1\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 0, "total_chunks": null}}
{"id": "aa06623e-a3b1-4caa-928b-b0ebdea1bea2", "content": "# Basic Workflow\n\nComplete guide to the standard FluxLoop CLI workflow from setup to evaluation.\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 1, "total_chunks": null}}
{"id": "2b3664c7-1561-4df5-bcbf-bcdcc2a858cc", "content": "## Overview\n\nThe FluxLoop workflow consists of five main phases:\n\n1. **Initialize** - Create project structure and configuration\n2. **Generate** - Create input variations for testing\n3. **Run** - Execute experiments and collect traces\n4. **Parse** - Convert raw outputs into readable formats\n5. **Evaluate** - Score results and generate reports\n\nThis guide walks through each phase with practical examples.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 2, "total_chunks": null}}
{"id": "aff6dcc8-9560-4e56-a81b-3327d542af3f", "content": "## Phase 1: Initialize Project\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 3, "total_chunks": null}}
{"id": "54694a80-1882-44cd-8da3-7b684cd9f160", "content": "### Create New Project\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 4, "total_chunks": null}}
{"id": "f21380bf-a688-4a00-99d0-dc64e117e90f", "content": "# Initialize a new FluxLoop project\nfluxloop init project --name my-agent\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 5, "total_chunks": null}}
{"id": "96be583c-5892-4552-a55a-13561653f791", "content": "# Navigate to project directory\ncd fluxloop/my-agent\n```\n\n**What Gets Created:**\n\n```\nfluxloop/my-agent/\n├── configs/\n│   ├── project.yaml       # Project metadata\n│   ├── input.yaml         # Personas and input settings\n│   ├── simulation.yaml    # Runner and experiment config\n│   └── evaluation.yaml    # Evaluators and success criteria\n├── .env                   # Environment variables (gitignored)\n├── .gitignore\n├── examples/\n│   └── simple_agent.py    # Sample agent implementation\n├── inputs/                # Generated inputs stored here", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 6, "total_chunks": null}}
{"id": "050381ae-1cb7-4f65-907e-149eaae9dea5", "content": "├── recordings/            # Recorded arguments (if using recording mode)\n└── experiments/           # Experiment outputs\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 7, "total_chunks": null}}
{"id": "7d722dda-9198-48fb-a37e-42985661f917", "content": "### Verify Installation\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 8, "total_chunks": null}}
{"id": "b1356068-8769-49e1-a8a5-1ea323424a28", "content": "# Check system status\nfluxloop doctor\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 9, "total_chunks": null}}
{"id": "867db8ee-93ba-4ff6-995f-57e2f0af639c", "content": "# Verify configuration\nfluxloop config validate\n```\n\n**Expected Output:**\n\n```\n╭──────────────────────────────────╮\n│ FluxLoop Environment Doctor      │\n╰──────────────────────────────────╯\n\nComponent       Status  Details\nPython          ✓       3.11.5\nFluxLoop CLI    ✓       0.2.30\nFluxLoop SDK    ✓       0.1.6\nFluxLoop MCP    ✓       /path/to/fluxloop-mcp\nMCP Index       ✓       ~/.fluxloop/mcp/index/dev\nProject Config  ✓       configs/project.yaml\n\n╭──────────────────╮\n│ Doctor completed │\n╰──────────────────╯\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 10, "total_chunks": null}}
{"id": "51db6223-8e35-462e-a476-e8167ab3c5f6", "content": "## Phase 2: Configure Your Agent\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 11, "total_chunks": null}}
{"id": "08eb0617-fdc5-4fa1-a2e8-7dd2d05c225a", "content": "### Set Up LLM Provider\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 12, "total_chunks": null}}
{"id": "d7fea77d-9f34-42cd-9622-7ead1cb1f869", "content": "# Configure OpenAI (for input generation)\nfluxloop config set-llm openai sk-your-api-key --model gpt-4o\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 13, "total_chunks": null}}
{"id": "5657aad3-cdb3-4050-9711-7524d57d2e9f", "content": "# Or Anthropic\nfluxloop config set-llm anthropic sk-ant-your-key --model claude-3-5-sonnet-20241022\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 14, "total_chunks": null}}
{"id": "a9d4d3ac-f96c-4ddd-8af8-5d55ba0a69bc", "content": "### Point to Your Agent Code\n\nEdit `configs/simulation.yaml`:\n\n```yaml\nrunner:\n  target: \"my_agent:run\"              # Point to your agent entry point\n  working_directory: .                # Project root\n  timeout_seconds: 120\n  max_retries: 3\n```\n\n**Agent Entry Point Example:**\n\n```python", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 15, "total_chunks": null}}
{"id": "6ff9b468-04c3-4e1a-affc-a457ee4997ce", "content": "# my_agent.py\nimport fluxloop\n\n@fluxloop.agent(name=\"MyAgent\")\ndef run(input_text: str) -> str:\n    \"\"\"Main agent entry point.\"\"\"\n    # Your agent logic here\n    return f\"Response to: {input_text}\"\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 16, "total_chunks": null}}
{"id": "d09b0e3f-184a-42c7-8d47-b76c46c3d6e0", "content": "### Configure Personas\n\nEdit `configs/input.yaml` to define user personas:\n\n```yaml\npersonas:\n  - name: novice_user\n    description: A user new to the system\n    characteristics:\n      - Asks basic questions\n      - May use incorrect terminology\n      - Needs detailed explanations\n    language: en\n    expertise_level: novice\n    goals:\n      - Understand system capabilities\n      - Complete basic tasks\n\n  - name: expert_user\n    description: An experienced power user\n    characteristics:\n      - Uses technical terminology\n      - Asks complex questions", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 17, "total_chunks": null}}
{"id": "6f658574-ced8-4a9a-a82d-f6728e3625c1", "content": "      - Expects efficient responses\n    language: en\n    expertise_level: expert\n    goals:\n      - Optimize workflows\n      - Access advanced features\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 18, "total_chunks": null}}
{"id": "dbff8f2b-2364-4aad-85fd-35dc381b3cc4", "content": "### Define Base Inputs\n\nStill in `configs/input.yaml`:\n\n```yaml\nbase_inputs:\n  - input: \"How do I get started?\"\n    expected_intent: help\n    metadata:\n      category: onboarding\n      \n  - input: \"What are the advanced features?\"\n    expected_intent: capabilities\n    metadata:\n      category: features\n\n  - input: \"Can you help me with error code 404?\"\n    expected_intent: troubleshooting\n    metadata:\n      category: support\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 19, "total_chunks": null}}
{"id": "074b5c68-e59a-4bc0-b82e-aabcafc82ad8", "content": "## Phase 3: Generate Inputs\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 20, "total_chunks": null}}
{"id": "61da65c4-12dd-4cc2-8104-0cc1465879d7", "content": "### Generate Input Variations\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 21, "total_chunks": null}}
{"id": "f956d052-5645-4e39-b2d1-a28e006b8c9e", "content": "# Generate variations using LLM\nfluxloop generate inputs --limit 50 --mode llm\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 22, "total_chunks": null}}
{"id": "3746c726-b2d4-4f81-8836-489e1ea3a218", "content": "# Or deterministic variations\nfluxloop generate inputs --limit 30 --mode deterministic\n```\n\n**What Happens:**\n\n1. FluxLoop reads `configs/input.yaml`\n2. For each base input × persona combination\n3. Generates variations using specified strategies\n4. Saves to `inputs/generated.yaml`\n\n**Output:**\n\n```\nGenerating inputs with LLM mode...\n\n✓ Generated 50 input variations\n  - Base inputs: 3\n  - Personas: 2\n  - Strategies: rephrase, verbose, error_prone\n  - Saved to: inputs/generated.yaml\n\nTotal inputs ready: 50\n```\n\n**View Generated Inputs:**", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 23, "total_chunks": null}}
{"id": "06a5b265-34cb-4122-bd45-1f181a16701f", "content": "\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 24, "total_chunks": null}}
{"id": "c8a22156-9055-4ed8-b9e8-0933c458283a", "content": "# Check generated inputs\ncat inputs/generated.yaml\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 25, "total_chunks": null}}
{"id": "f711ad04-b33d-4ef4-b619-e39c64b0b544", "content": "# Or view in editor\ncode inputs/generated.yaml\n```\n\n**Example Generated Input:**\n\n```yaml\n- input: \"Hey, how would I go about getting started with this thing?\"\n  persona: novice_user\n  metadata:\n    base_input: \"How do I get started?\"\n    variation_strategy: rephrase\n    variation_index: 0\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 26, "total_chunks": null}}
{"id": "e4a89f57-3ec6-4067-9755-48d7ca85281b", "content": "## Phase 4: Run Experiment\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 27, "total_chunks": null}}
{"id": "51a0ecf9-099d-4e32-b0e5-dfef7f2301f4", "content": "### Execute Simulation\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 28, "total_chunks": null}}
{"id": "54ef8889-9886-493e-ade1-b68415d20987", "content": "# Run experiment with default settings\nfluxloop run experiment\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 29, "total_chunks": null}}
{"id": "67d32555-9eac-42f9-afd3-fac5fc58b2cd", "content": "# Run with custom iterations\nfluxloop run experiment --iterations 5\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 30, "total_chunks": null}}
{"id": "7805065a-92d0-4860-8b2e-320a458a1c76", "content": "# Run with multi-turn enabled\nfluxloop run experiment --multi-turn --max-turns 10\n```\n\n**What Happens:**\n\n1. Loads configuration from `configs/simulation.yaml`\n2. Loads inputs from `inputs/generated.yaml`\n3. For each input × iteration:\n   - Calls your agent function\n   - Captures traces via FluxLoop SDK\n   - Records observations\n4. Saves results to `experiments/exp_<timestamp>/`\n\n**Output:**\n\n```\n╭─ Experiment: my_agent_experiment ─────────────────────╮\n│ Iterations: 1                                         │\n│ Input Source: inputs/generated.yaml                   │", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 31, "total_chunks": null}}
{"id": "67f59c68-6790-4ea5-8c50-7900efcfa2d7", "content": "│ Total Runs: 50                                        │\n╰───────────────────────────────────────────────────────╯\n\nRunning experiments...\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 50/50 [00:45]\n\n✓ Experiment completed!\n\nResults saved to: experiments/exp_20250117_143022/\n  - traces.jsonl (50 traces)\n  - observations.jsonl (150 observations)\n  - summary.json\n  - metadata.json\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 32, "total_chunks": null}}
{"id": "6fc410c4-e5d0-4173-ada2-68bcf7102ef1", "content": "### Check Results Immediately\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 33, "total_chunks": null}}
{"id": "cb5d274a-04c9-433f-923d-f354ce75d032", "content": "# View summary\ncat experiments/exp_*/summary.json | jq\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 34, "total_chunks": null}}
{"id": "7cc8a772-517c-4c80-8a31-3682741049a9", "content": "# List recent experiments\nfluxloop status experiments\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 35, "total_chunks": null}}
{"id": "92cefbfb-dd8f-4cce-b742-092f1472851e", "content": "## Phase 5: Parse Results\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 36, "total_chunks": null}}
{"id": "da9a013b-b601-42ea-a2bb-c04b3c7ca769", "content": "### Convert to Human-Readable Format\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 37, "total_chunks": null}}
{"id": "526a41e6-fd65-4a75-bd8f-56ac144bdeff", "content": "# Parse experiment outputs\nfluxloop parse experiment experiments/exp_20250117_143022/\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 38, "total_chunks": null}}
{"id": "0ec3806f-c535-42d0-b452-fa36ad20a370", "content": "# Or use glob pattern for latest\nfluxloop parse experiment experiments/exp_*/\n```\n\n**What Happens:**\n\n1. Reads `traces.jsonl` and `observations.jsonl`\n2. Reconstructs conversation flow for each trace\n3. Generates Markdown timeline for each trace\n4. Creates `per_trace.jsonl` with structured data\n\n**Output:**\n\n```\nParsing experiment: experiments/exp_20250117_143022/\n\n✓ Parsed 50 traces\n  - Total observations: 150\n  - Average trace length: 3 observations\n  - Saved to: experiments/.../per_trace_analysis/\n\nGenerated Files:\n  - per_trace_analysis/00_<trace_id>.md (50 files)", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 39, "total_chunks": null}}
{"id": "bbdce571-198e-4dde-b35f-31f38060389e", "content": "  - per_trace_analysis/per_trace.jsonl\n```\n\n**View Parsed Trace:**\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 40, "total_chunks": null}}
{"id": "eefd8d45-6b9b-45b7-a944-d341a9f4db09", "content": "# Open first trace in editor\ncode experiments/exp_*/per_trace_analysis/00_*.md\n```\n\n**Example Parsed Trace (Markdown):**\n\n```markdown", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 41, "total_chunks": null}}
{"id": "ca03fb52-22e8-4922-9c25-367f8bad355a", "content": "# Trace Analysis: 00_7f39c11-1eac-423b-96b9-09aa8a8f588a\n\n**Experiment**: my_agent_experiment\n**Persona**: novice_user\n**Input**: \"Hey, how would I go about getting started with this thing?\"\n**Status**: SUCCESS\n**Duration**: 234ms\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 42, "total_chunks": null}}
{"id": "55129b07-9e1b-448d-a54e-57ebf8d898f1", "content": "## Timeline\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 43, "total_chunks": null}}
{"id": "e764ca97-a4c0-4fe0-b491-c066b48fddef", "content": "### 1. AGENT: SimpleAgent\n**Start**: 14:30:22.123\n**Duration**: 234ms\n\n**Input:**\n```json\n{\n  \"input_text\": \"Hey, how would I go about getting started with this thing?\"\n}\n```\n\n**Output:**\n```json\n{\n  \"response\": \"Hello! To get started, first visit our documentation...\"\n}\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 44, "total_chunks": null}}
{"id": "2fe39277-2f47-43f7-8595-e7a89024364f", "content": "### 2. TOOL: process_input\n**Start**: 14:30:22.145\n**Duration**: 12ms\n\n**Input:**\n```json\n{\n  \"text\": \"Hey, how would I go about getting started with this thing?\"\n}\n```\n\n**Output:**\n```json\n{\n  \"intent\": \"help\",\n  \"word_count\": 11,\n  \"has_question\": true\n}\n```\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 45, "total_chunks": null}}
{"id": "052ef45a-9c3e-426b-b72d-c9156bcf6ad7", "content": "## Phase 6: Evaluate Results\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 46, "total_chunks": null}}
{"id": "5ae1cf81-9988-45fa-ac52-80aa71e7767f", "content": "### Generate the Interactive Report\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 47, "total_chunks": null}}
{"id": "5358abc4-a3de-461d-87dd-8ba9e6b22b7c", "content": "# Run evaluation\nfluxloop evaluate experiment experiments/exp_20250117_143022/\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 48, "total_chunks": null}}
{"id": "4a9f06ed-97da-4e6a-9d45-dc025ef173e3", "content": "# With custom config\nfluxloop evaluate experiment experiments/exp_*/ \\\n  --config configs/evaluation.yaml\n```\n\n**What Happens:**\n\n1. Loads `per_trace_analysis/per_trace.jsonl` generated by `fluxloop parse`.\n2. Runs the 5단계 파이프라인:\n   - **LLM-PT**: LLM judges each trace on 7 metrics (task completion, hallucination, relevance, tool usage, satisfaction, clarity, persona)\n   - **Rule aggregation**: 통계, 메트릭 패스율, 성능 카드, 케이스 분류\n   - **LLM-OV**: LLM이 전반적인 인사이트·추천을 작성\n   - **Data preparation + HTML 렌더링**: `evaluation_report/report.html` 생성", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 49, "total_chunks": null}}
{"id": "cb8363e2-2ea4-4932-91f8-dcf12a17ce1b", "content": "3. Outputs progress logs plus a final path to the generated dashboard.\n\n**Output:**\n\n```\n📊 Evaluating experiment at experiments/exp_20250117_143022\n🧵 Per-trace data: experiments/.../per_trace_analysis/per_trace.jsonl\n📁 Output: experiments/.../evaluation_report\n\nStage 1: LLM-PT (10 traces) ...\nStage 2: Aggregation ...\nStage 3: LLM-OV ...\nStage 4 & 5: Rendering HTML report...\n\n✅ Report ready: experiments/.../evaluation_report/report.html\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 50, "total_chunks": null}}
{"id": "e5324f1c-1231-408c-a36f-7f0c741fa221", "content": "### View Evaluation Reports\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 51, "total_chunks": null}}
{"id": "1d60a1ea-68a0-40c8-9814-843de666e65f", "content": "# Open HTML report in browser\nopen experiments/exp_*/evaluation_report/report.html\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 52, "total_chunks": null}}
{"id": "3c8d24a0-eaf8-4337-af26-4c15c2517a80", "content": "# Check the structured traces (input to the pipeline)\ncat experiments/exp_*/per_trace_analysis/per_trace.jsonl | jq\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 53, "total_chunks": null}}
{"id": "f828bf44-601b-40bb-946f-72c79ea66d11", "content": "## Complete Workflow Script\n\nPut it all together in one script:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 54, "total_chunks": null}}
{"id": "8efc5b16-86dc-403b-98b3-9a5112e04b0b", "content": "#!/bin/bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 55, "total_chunks": null}}
{"id": "9ba7f1eb-547a-42a1-91fb-2c6a90a5a57b", "content": "# run_full_workflow.sh\n\nset -e  # Exit on error\n\nPROJECT=\"my-agent\"\nITERATIONS=5\n\necho \"=== FluxLoop Complete Workflow ===\"\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 56, "total_chunks": null}}
{"id": "c916d504-8ce8-4424-8df7-d75a95093255", "content": "# 1. Initialize (if needed)\nif [ ! -d \"fluxloop/$PROJECT\" ]; then\n    echo \"1. Initializing project...\"\n    fluxloop init project --name \"$PROJECT\"\nfi\n\ncd \"fluxloop/$PROJECT\"\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 57, "total_chunks": null}}
{"id": "6a78f960-9e79-42c2-bd84-0ef4e6deeab8", "content": "# 2. Verify setup\necho \"2. Verifying setup...\"\nfluxloop doctor\nfluxloop config validate\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 58, "total_chunks": null}}
{"id": "72fc0c49-2fce-42ec-a138-8d05cc640e2d", "content": "# 3. Generate inputs\necho \"3. Generating inputs...\"\nfluxloop generate inputs --limit 50 --mode llm\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 59, "total_chunks": null}}
{"id": "1a52527e-7d9e-4f5b-be17-b4f659ae3550", "content": "# 4. Run experiment\necho \"4. Running experiment...\"\nfluxloop run experiment --iterations \"$ITERATIONS\"\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 60, "total_chunks": null}}
{"id": "9ffe4d4d-dfe5-4930-b433-63d86dc9bfa1", "content": "# 5. Find latest experiment\nLATEST_EXP=$(ls -td experiments/*/ | head -1)\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 61, "total_chunks": null}}
{"id": "d1c154e3-a6f8-47f3-a5b4-c5875b7c6101", "content": "# 6. Parse results\necho \"5. Parsing results...\"\nfluxloop parse experiment \"$LATEST_EXP\"\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 62, "total_chunks": null}}
{"id": "8793b6b7-9252-4e6b-b067-ed2ef208507e", "content": "# 7. Evaluate\necho \"6. Evaluating...\"\nfluxloop evaluate experiment \"$LATEST_EXP\"\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 63, "total_chunks": null}}
{"id": "9773d4f2-f332-47ed-955a-16c38c078285", "content": "# 8. Summary\necho \"\"\necho \"=== Workflow Complete ===\"\necho \"Results in: $LATEST_EXP\"\necho \"\"\necho \"View reports:\"\necho \"  HTML: open ${LATEST_EXP}evaluation_report/report.html\"\n```\n\nMake it executable and run:\n\n```bash\nchmod +x run_full_workflow.sh\n./run_full_workflow.sh\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 64, "total_chunks": null}}
{"id": "28308622-4031-4b91-a4f5-87b40b98a7bb", "content": "## Tips and Best Practices\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 65, "total_chunks": null}}
{"id": "f4a9ba5a-7aea-436a-a620-02f7065ef081", "content": "### Start Small\n\nBegin with a minimal setup to verify everything works:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 66, "total_chunks": null}}
{"id": "fc2f37ba-0ae7-4333-bba3-3c9fd7622b19", "content": "# Generate just 10 inputs\nfluxloop generate inputs --limit 10\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 67, "total_chunks": null}}
{"id": "252fed5e-ff82-47ed-a19f-993e1112c2a3", "content": "# Run 1 iteration\nfluxloop run experiment --iterations 1\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 68, "total_chunks": null}}
{"id": "28c6fd24-4930-4b6f-96dc-b3090b0bca58", "content": "# Verify results\nfluxloop status experiments\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 69, "total_chunks": null}}
{"id": "81964d80-81b7-4d95-8453-29bc46426a82", "content": "### Iterate on Configuration\n\nTune your setup incrementally:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 70, "total_chunks": null}}
{"id": "f8f4968e-d05d-4d6d-905f-4bfb0d346dbf", "content": "# Try different variation strategies\nfluxloop config set variation_strategies \"[rephrase, verbose]\" --file configs/input.yaml\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 71, "total_chunks": null}}
{"id": "4b06bd22-6202-4e7f-b3bb-eb1f2ca419e1", "content": "# Adjust iteration count\nfluxloop config set iterations 20 --file configs/simulation.yaml\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 72, "total_chunks": null}}
{"id": "680558ce-eea2-4b73-9955-bd4b58253faf", "content": "# Re-run and compare\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 73, "total_chunks": null}}
{"id": "33fcfa1c-3bd6-470a-99cb-3f5683e31f14", "content": "### Version Control Your Configs\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 74, "total_chunks": null}}
{"id": "32df469f-60dc-4cbe-8892-e771dab81fd1", "content": "# Track configuration changes\ngit add configs/\ngit commit -m \"Tune evaluation thresholds\"\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 75, "total_chunks": null}}
{"id": "90baee67-f967-47e2-a768-521eab657483", "content": "# Compare experiment results across git branches\ngit checkout experiment-v1\nfluxloop run experiment\ngit checkout experiment-v2\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 76, "total_chunks": null}}
{"id": "8bc07543-1514-49d6-ad16-24d3375f779e", "content": "### Use Multi-Turn for Deeper Testing\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 77, "total_chunks": null}}
{"id": "47f89229-40bf-4380-9015-2028eb1f852b", "content": "# Enable multi-turn conversations\nfluxloop config set multi_turn.enabled true --file configs/simulation.yaml\nfluxloop config set multi_turn.max_turns 10 --file configs/simulation.yaml\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 78, "total_chunks": null}}
{"id": "c1d137fe-0a21-4c44-a8ca-0008c8ada13e", "content": "# Run with supervisor\nfluxloop run experiment --multi-turn --auto-approve\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 79, "total_chunks": null}}
{"id": "d909feca-15d5-4820-8d3d-206ef70ce8cc", "content": "## Troubleshooting\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 80, "total_chunks": null}}
{"id": "bfb9bbd9-142e-4bf6-acc0-aa6acba487a3", "content": "### Agent Not Found\n\n**Error:** `ModuleNotFoundError: No module named 'my_agent'`\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 81, "total_chunks": null}}
{"id": "94de495a-fb6c-40f3-bd75-5584b10fc27b", "content": "# Verify runner.target points to correct module\nfluxloop config show --file configs/simulation.yaml | grep target\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 82, "total_chunks": null}}
{"id": "61c7acf7-256b-4e71-938f-bd804c8dbfea", "content": "# Ensure module is in PYTHONPATH\nexport PYTHONPATH=\"${PYTHONPATH}:$(pwd)\"\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 83, "total_chunks": null}}
{"id": "5577e461-2896-4a21-adb9-fcd652c74373", "content": "### No Inputs Generated\n\n**Error:** `No inputs found in inputs/generated.yaml`\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 84, "total_chunks": null}}
{"id": "61081a1e-285a-4ec7-9895-f9516100c904", "content": "# Check input config\nfluxloop config show --file configs/input.yaml\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 85, "total_chunks": null}}
{"id": "91f322ca-7ae2-4e28-93f7-3dbc12349ea3", "content": "# Verify LLM API key\nfluxloop config env | grep API_KEY\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 86, "total_chunks": null}}
{"id": "23d86d8a-d21e-4e93-993a-4401d26438c4", "content": "# Re-generate\nfluxloop generate inputs --limit 10 --mode deterministic\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 87, "total_chunks": null}}
{"id": "e7d2c6ae-866a-4d9f-9149-09edc6471e3c", "content": "### Evaluation Fails\n\n**Error:** `Missing per_trace.jsonl`\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 88, "total_chunks": null}}
{"id": "a46a3fc8-68be-473e-852a-abd46d216f65", "content": "# Must parse before evaluating\nfluxloop parse experiment experiments/exp_*/\nfluxloop evaluate experiment experiments/exp_*/\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 89, "total_chunks": null}}
{"id": "510b1e55-d90f-435a-86eb-5c418a6120aa", "content": "## Next Steps\n\n- **[Multi-Turn Workflow](/cli/workflows/multi-turn-workflow)** - Dynamic conversations\n- **[Recording Workflow](/cli/workflows/recording-workflow)** - Capture and replay arguments\n- **[CI/CD Integration](/cli/workflows/ci-cd-integration)** - Automate in pipelines\n- **[Commands Reference](/cli/commands/init)** - Detailed command documentation\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 90, "total_chunks": null}}
{"id": "9fffe38a-fbd3-41b4-9327-4d25e3dd5067", "content": "## Quick Reference\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 91, "total_chunks": null}}
{"id": "1329e7e3-316f-44b8-84af-08c78dde3ed7", "content": "# Setup\nfluxloop init project --name my-agent\nfluxloop config set-llm openai sk-xxxxx\nfluxloop doctor\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 92, "total_chunks": null}}
{"id": "bbf89cf1-201a-468d-af68-8dfe9800c591", "content": "# Workflow\nfluxloop generate inputs --limit 50\nfluxloop run experiment\nfluxloop parse experiment experiments/latest_*/\nfluxloop evaluate experiment experiments/latest_*/\n", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 93, "total_chunks": null}}
{"id": "3d7ab9de-155f-4a5d-9b10-cf1cc07b4d23", "content": "# Monitoring\nfluxloop status check\nfluxloop status experiments\nfluxloop config env\n```", "metadata": {"source": "packages/website/docs-cli/workflows/basic-workflow.md", "chunk_index": 94, "total_chunks": null}}
{"id": "9c28ce63-b600-487d-b417-bfed1212ba21", "content": "---\nsidebar_position: 3\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 0, "total_chunks": null}}
{"id": "ae571e08-0299-4fd4-9105-5955ede455b7", "content": "# CI/CD Integration\n\nIntegrate FluxLoop into CI/CD pipelines for automated agent testing and regression detection.\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 1, "total_chunks": null}}
{"id": "cbd5b956-3a07-44e5-8206-d67ba1e946a4", "content": "## Overview\n\nFluxLoop can be integrated into CI/CD pipelines to:\n\n- **Automate regression testing** after code changes\n- **Validate agent quality** before deployment\n- **Track performance trends** over time\n- **Enforce quality gates** based on evaluation scores\n- **Generate test reports** for stakeholders\n\nThis guide covers GitHub Actions, GitLab CI, and generic CI/CD setup.\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 2, "total_chunks": null}}
{"id": "cc5b0905-cee7-4141-997f-d57d6c7a888a", "content": "## Quick Setup\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 3, "total_chunks": null}}
{"id": "b3dfdd1b-c575-4c54-8ce0-8ca01f566c06", "content": "### Prerequisites\n\n1. FluxLoop project with configuration in `configs/`\n2. Agent code instrumented with FluxLoop SDK\n3. Base inputs defined in `configs/input.yaml`\n4. Evaluators configured in `configs/evaluation.yaml`\n5. API keys (OpenAI, Anthropic, etc.) stored as secrets\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 4, "total_chunks": null}}
{"id": "7a956901-248c-4546-b5e8-34f7407a8696", "content": "### Key Principles\n\n**For CI/CD environments:**\n\n1. **Use deterministic mode** for input generation (or commit pre-generated inputs)\n2. **Set fixed seed** in `configs/simulation.yaml` for reproducibility\n3. **Cache dependencies** (Python packages, MCP index)\n4. **Store API keys as secrets**, not in code\n5. **Generate artifacts** (reports, traces) for review\n6. **Fail pipeline** if evaluation scores below threshold\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 5, "total_chunks": null}}
{"id": "8987e558-fc28-4676-8cc7-68ccc2e4a60c", "content": "## GitHub Actions\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 6, "total_chunks": null}}
{"id": "ff9ada51-5cac-4181-b76c-9f9ab21d7cb6", "content": "### Basic Workflow\n\nCreate `.github/workflows/fluxloop-test.yml`:\n\n```yaml\nname: FluxLoop Agent Tests\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main]\n\njobs:\n  test-agent:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n      \n      - name: Set up Python\n        uses: actions/setup-python@v5\n        with:\n          python-version: '3.11'\n          cache: 'pip'\n      \n      - name: Install dependencies\n        run: |\n          pip install fluxloop-cli fluxloop", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 7, "total_chunks": null}}
{"id": "3b991787-57f8-4653-b0c3-e8fa9f1a357b", "content": "          pip install -r requirements.txt\n      \n      - name: Verify setup\n        run: fluxloop doctor\n      \n      - name: Generate inputs (deterministic)\n        run: |\n          cd fluxloop/my-agent\n          fluxloop generate inputs --limit 20 --mode deterministic\n      \n      - name: Run experiment\n        env:\n          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n          FLUXLOOP_ENABLED: 'true'\n        run: |\n          cd fluxloop/my-agent\n          fluxloop run experiment --iterations 1\n      \n      - name: Parse results", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 8, "total_chunks": null}}
{"id": "8cc569f1-dffe-41f1-9f85-63e2149814dc", "content": "        run: |\n          cd fluxloop/my-agent\n          LATEST_EXP=$(ls -td experiments/*/ | head -1)\n          fluxloop parse experiment \"$LATEST_EXP\"\n      \n      - name: Evaluate results\n        run: |\n          cd fluxloop/my-agent\n          LATEST_EXP=$(ls -td experiments/*/ | head -1)\n          fluxloop evaluate experiment \"$LATEST_EXP\"\n      \n      - name: Check evaluation threshold\n        run: |\n          cd fluxloop/my-agent\n          LATEST_EXP=$(ls -td experiments/*/ | head -1)\n          python3 << 'EOF'\n          import json", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 9, "total_chunks": null}}
{"id": "c9cf1b35-9b2a-429d-9ac1-b895761cf84f", "content": "          import sys\n          \n          with open(f\"${LATEST_EXP}/evaluation/summary.json\") as f:\n              summary = json.load(f)\n          \n          score = summary.get(\"overall_score\", 0)\n          threshold = 0.7\n          \n          print(f\"Score: {score:.2f}, Threshold: {threshold}\")\n          \n          if score < threshold:\n              print(f\"FAIL: Score {score:.2f} below threshold {threshold}\")\n              sys.exit(1)\n          else:\n              print(f\"PASS: Score {score:.2f} meets threshold {threshold}\")", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 10, "total_chunks": null}}
{"id": "71235c7c-b16e-4dd2-9b51-753c9c786f77", "content": "          EOF\n      \n      - name: Upload test artifacts\n        if: always()\n        uses: actions/upload-artifact@v4\n        with:\n          name: fluxloop-results\n          path: |\n            fluxloop/my-agent/experiments/\n            fluxloop/my-agent/inputs/\n          retention-days: 30\n      \n      - name: Comment on PR (if PR)\n        if: github.event_name == 'pull_request' && always()\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const fs = require('fs');\n            const expDir = 'fluxloop/my-agent/experiments/';", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 11, "total_chunks": null}}
{"id": "ce5c4f07-5362-4809-80a8-5b0276785099", "content": "            const latest = fs.readdirSync(expDir)\n              .filter(f => fs.statSync(expDir + f).isDirectory())\n              .sort()\n              .reverse()[0];\n            \n            const summary = JSON.parse(\n              fs.readFileSync(`${expDir}${latest}/evaluation/summary.json`)\n            );\n            \n            const body = `\n            ## FluxLoop Evaluation Results\n            \n            **Overall Score:** ${summary.overall_score.toFixed(2)} / 1.00\n            **Status:** ${summary.pass_fail_status}", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 12, "total_chunks": null}}
{"id": "408f454e-9df9-4dd0-b73a-d73915b18066", "content": "            **Traces:** ${summary.total_traces}\n            \n            ### Evaluator Scores\n            ${Object.entries(summary.by_evaluator || {}).map(([name, data]) => \n              `- **${name}**: ${data.score.toFixed(2)}`\n            ).join('\\n')}\n            \n            [View Full Report](../actions/runs/${context.runId})\n            `;\n            \n            github.rest.issues.createComment({\n              issue_number: context.issue.number,\n              owner: context.repo.owner,\n              repo: context.repo.repo,", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 13, "total_chunks": null}}
{"id": "d58220ed-4971-4792-9d42-f56e1bb583ff", "content": "              body: body\n            });\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 14, "total_chunks": null}}
{"id": "dc353e03-e3ed-42c7-9307-faa56c398715", "content": "### Advanced: Comparison with Baseline\n\nCompare results against a baseline:\n\n```yaml\n      - name: Download baseline results\n        uses: dawidd6/action-download-artifact@v3\n        with:\n          workflow: fluxloop-test.yml\n          branch: main\n          name: baseline-summary\n          path: baseline/\n        continue-on-error: true\n      \n      - name: Compare with baseline\n        run: |\n          cd fluxloop/my-agent\n          LATEST_EXP=$(ls -td experiments/*/ | head -1)\n          \n          if [ -f \"baseline/summary.json\" ]; then", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 15, "total_chunks": null}}
{"id": "d6e30f12-3869-4549-bf82-4de04e78f78c", "content": "            fluxloop evaluate experiment \"$LATEST_EXP\" \\\n              --baseline baseline/summary.json\n          fi\n      \n      - name: Save new baseline (on main)\n        if: github.ref == 'refs/heads/main'\n        uses: actions/upload-artifact@v4\n        with:\n          name: baseline-summary\n          path: fluxloop/my-agent/experiments/*/evaluation/summary.json\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 16, "total_chunks": null}}
{"id": "852daea4-21b8-438c-abc7-ea0543aee092", "content": "### Scheduled Regression Testing\n\nRun tests on a schedule:\n\n```yaml\non:\n  schedule:\n    - cron: '0 2 * * *'  # Daily at 2 AM UTC\n  workflow_dispatch:      # Manual trigger\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 17, "total_chunks": null}}
{"id": "3c582ae5-18b2-48da-8858-416fabe88d58", "content": "## GitLab CI\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 18, "total_chunks": null}}
{"id": "5c143d96-7493-4466-ba4d-817c06f99927", "content": "### Basic Pipeline\n\nCreate `.gitlab-ci.yml`:\n\n```yaml\nimage: python:3.11\n\nvariables:\n  PIP_CACHE_DIR: \"$CI_PROJECT_DIR/.cache/pip\"\n\ncache:\n  paths:\n    - .cache/pip\n    - venv/\n\nstages:\n  - setup\n  - test\n  - evaluate\n  - report\n\nbefore_script:\n  - python -m venv venv\n  - source venv/bin/activate\n  - pip install fluxloop-cli fluxloop\n  - pip install -r requirements.txt\n\nsetup:\n  stage: setup\n  script:\n    - cd fluxloop/my-agent\n    - fluxloop doctor\n    - fluxloop config validate\n  artifacts:\n    reports:\n      dotenv: build.env\n\ngenerate_inputs:", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 19, "total_chunks": null}}
{"id": "b8d9007d-944a-4d13-8d55-66528d2d1e7b", "content": "  stage: setup\n  script:\n    - cd fluxloop/my-agent\n    - fluxloop generate inputs --limit 20 --mode deterministic\n  artifacts:\n    paths:\n      - fluxloop/my-agent/inputs/\n    expire_in: 1 week\n\nrun_experiment:\n  stage: test\n  dependencies:\n    - generate_inputs\n  script:\n    - cd fluxloop/my-agent\n    - fluxloop run experiment --iterations 1\n  artifacts:\n    paths:\n      - fluxloop/my-agent/experiments/\n    expire_in: 1 month\n\nparse_results:\n  stage: evaluate\n  dependencies:\n    - run_experiment\n  script:\n    - cd fluxloop/my-agent", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 20, "total_chunks": null}}
{"id": "c32eea1a-62e9-4fbf-a943-ffd17883079a", "content": "    - LATEST_EXP=$(ls -td experiments/*/ | head -1)\n    - fluxloop parse experiment \"$LATEST_EXP\"\n  artifacts:\n    paths:\n      - fluxloop/my-agent/experiments/*/per_trace_analysis/\n    expire_in: 1 month\n\nevaluate_results:\n  stage: evaluate\n  dependencies:\n    - parse_results\n  script:\n    - cd fluxloop/my-agent\n    - LATEST_EXP=$(ls -td experiments/*/ | head -1)\n    - fluxloop evaluate experiment \"$LATEST_EXP\"\n    - |\n      python3 << 'EOF'\n      import json, sys\n      with open(f\"${LATEST_EXP}/evaluation/summary.json\") as f:", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 21, "total_chunks": null}}
{"id": "9e0bf725-4727-4998-a4d4-23ae6eb12f6b", "content": "          summary = json.load(f)\n      score = summary.get(\"overall_score\", 0)\n      if score < 0.7:\n          print(f\"FAIL: Score {score:.2f} below 0.7\")\n          sys.exit(1)\n      EOF\n  artifacts:\n    paths:\n      - fluxloop/my-agent/experiments/*/evaluation/\n    expire_in: 1 month\n    reports:\n      junit: fluxloop/my-agent/experiments/*/evaluation/junit.xml\n\ngenerate_report:\n  stage: report\n  dependencies:\n    - evaluate_results\n  script:\n    - cd fluxloop/my-agent\n    - LATEST_EXP=$(ls -td experiments/*/ | head -1)\n    - cp \"$LATEST_EXP/evaluation/report.html\" public/index.html", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 22, "total_chunks": null}}
{"id": "23420ff9-3984-4700-bfac-c2906bde624b", "content": "  artifacts:\n    paths:\n      - public\n  only:\n    - main\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 23, "total_chunks": null}}
{"id": "3b8322d0-3016-41ed-a69f-17bd19f83f9f", "content": "## Jenkins\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 24, "total_chunks": null}}
{"id": "fc72343a-cd08-4124-a2dc-6a68585ef866", "content": "### Jenkinsfile\n\n```groovy\npipeline {\n    agent any\n    \n    environment {\n        OPENAI_API_KEY = credentials('openai-api-key')\n        FLUXLOOP_ENABLED = 'true'\n    }\n    \n    stages {\n        stage('Setup') {\n            steps {\n                sh '''\n                    python3 -m venv venv\n                    . venv/bin/activate\n                    pip install fluxloop-cli fluxloop\n                    pip install -r requirements.txt\n                '''\n            }\n        }\n        \n        stage('Verify') {\n            steps {", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 25, "total_chunks": null}}
{"id": "88cc2b2a-0d43-411d-9c8a-fe91d2a2b97c", "content": "                sh '''\n                    . venv/bin/activate\n                    cd fluxloop/my-agent\n                    fluxloop doctor\n                    fluxloop config validate\n                '''\n            }\n        }\n        \n        stage('Generate Inputs') {\n            steps {\n                sh '''\n                    . venv/bin/activate\n                    cd fluxloop/my-agent\n                    fluxloop generate inputs --limit 20 --mode deterministic\n                '''\n            }\n        }\n        \n        stage('Run Experiment') {", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 26, "total_chunks": null}}
{"id": "0d26fbb0-7de0-4a40-96f3-9b0c703a35d1", "content": "            steps {\n                sh '''\n                    . venv/bin/activate\n                    cd fluxloop/my-agent\n                    fluxloop run experiment --iterations 1\n                '''\n            }\n        }\n        \n        stage('Evaluate') {\n            steps {\n                sh '''\n                    . venv/bin/activate\n                    cd fluxloop/my-agent\n                    LATEST_EXP=$(ls -td experiments/*/ | head -1)\n                    fluxloop parse experiment \"$LATEST_EXP\"\n                    fluxloop evaluate experiment \"$LATEST_EXP\"", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 27, "total_chunks": null}}
{"id": "b0a38155-1ea1-4a1a-b2a6-971a2ec073c9", "content": "                '''\n            }\n        }\n        \n        stage('Quality Gate') {\n            steps {\n                script {\n                    def summary = readJSON file: \"fluxloop/my-agent/experiments/*/evaluation/summary.json\"\n                    def score = summary.overall_score\n                    \n                    if (score < 0.7) {\n                        error(\"Quality gate failed: score ${score} below 0.7\")\n                    }\n                }\n            }\n        }\n    }\n    \n    post {\n        always {", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 28, "total_chunks": null}}
{"id": "72fd63ca-5668-4d2c-b835-dde9421dfa80", "content": "            archiveArtifacts artifacts: 'fluxloop/my-agent/experiments/**/*', \n                             allowEmptyArchive: true\n            \n            publishHTML([\n                reportDir: 'fluxloop/my-agent/experiments/*/evaluation/',\n                reportFiles: 'report.html',\n                reportName: 'FluxLoop Evaluation Report'\n            ])\n        }\n    }\n}\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 29, "total_chunks": null}}
{"id": "095e392d-86b2-48d2-8952-be7471f00499", "content": "## Docker Integration\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 30, "total_chunks": null}}
{"id": "334bae27-7f94-487c-b410-afdfa882473c", "content": "### Dockerfile\n\n```dockerfile\nFROM python:3.11-slim\n\nWORKDIR /app\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 31, "total_chunks": null}}
{"id": "87173b7a-3c7c-4491-9bed-015d3a079c52", "content": "# Install dependencies\nCOPY requirements.txt .\nRUN pip install --no-cache-dir \\\n    fluxloop-cli \\\n    fluxloop \\\n    -r requirements.txt\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 32, "total_chunks": null}}
{"id": "c9dd12e9-a462-4f41-849a-106eb8e70b00", "content": "# Copy project\nCOPY . .\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 33, "total_chunks": null}}
{"id": "03a31cb2-9a11-4b07-9839-f181d625deaa", "content": "# Set up FluxLoop\nRUN cd fluxloop/my-agent && \\\n    fluxloop doctor\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 34, "total_chunks": null}}
{"id": "f5eb6990-74e5-4141-9132-8b9f35ef7dde", "content": "# Default command\nCMD [\"bash\", \"-c\", \"cd fluxloop/my-agent && fluxloop run experiment\"]\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 35, "total_chunks": null}}
{"id": "8d4bf6d1-ac4e-442d-b9d0-9232dd95eaff", "content": "### Docker Compose for Testing\n\n```yaml\nversion: '3.8'\n\nservices:\n  fluxloop-test:\n    build: .\n    environment:\n      - OPENAI_API_KEY=${OPENAI_API_KEY}\n      - FLUXLOOP_ENABLED=true\n    volumes:\n      - ./fluxloop:/app/fluxloop\n      - test-results:/app/fluxloop/my-agent/experiments\n    command: |\n      bash -c \"\n        cd fluxloop/my-agent &&\n        fluxloop generate inputs --limit 20 --mode deterministic &&\n        fluxloop run experiment --iterations 1 &&\n        fluxloop parse experiment experiments/*/ &&\n        fluxloop evaluate experiment experiments/*/", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 36, "total_chunks": null}}
{"id": "a92e397e-daf3-4fdb-a7e5-bb24896deee0", "content": "      \"\n\nvolumes:\n  test-results:\n```\n\nRun tests:\n\n```bash\ndocker-compose run fluxloop-test\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 37, "total_chunks": null}}
{"id": "d81d0e05-1769-475f-af95-936330a7478e", "content": "## Best Practices\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 38, "total_chunks": null}}
{"id": "1d4b766a-15b4-4cd6-b300-ac848fa7f4d0", "content": "### 1. Use Deterministic Mode in CI\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 39, "total_chunks": null}}
{"id": "60a2e008-ac8b-450b-9d57-f3402701aed9", "content": "# configs/input.yaml (for CI)\ninput_generation:\n  mode: deterministic  # or commit pre-generated inputs\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 40, "total_chunks": null}}
{"id": "46afd2d4-9f79-45e9-a16e-33192b01ce48", "content": "# configs/simulation.yaml\nseed: 42  # Fixed seed for reproducibility\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 41, "total_chunks": null}}
{"id": "af0bc379-43ad-4c5c-89b0-162d2123b559", "content": "### 2. Separate Test Configs from Production\n\n```bash\nfluxloop/my-agent/\n├── configs/              # Production configs\n│   ├── project.yaml\n│   ├── input.yaml\n│   ├── simulation.yaml\n│   └── evaluation.yaml\n└── configs-ci/           # CI-specific configs\n    ├── input.yaml        # Deterministic, fewer inputs\n    ├── simulation.yaml   # Lower iterations, fixed seed\n    └── evaluation.yaml   # Stricter thresholds\n```\n\nRun with CI configs:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 42, "total_chunks": null}}
{"id": "6cb07185-7992-4684-9683-0ea3638254f4", "content": "# Override config directory\ncp -r configs-ci/* configs/\nfluxloop run experiment\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 43, "total_chunks": null}}
{"id": "2f6e3415-8428-495e-84fd-1fa8dba9b7f6", "content": "### 3. Cache Wisely\n\n**Cache these:**\n- Python packages (`pip cache`)\n- Generated inputs (if deterministic)\n- MCP index (`~/.fluxloop/mcp/index/`)\n\n**Don't cache:**\n- Experiment outputs\n- Traces\n- Evaluation results\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 44, "total_chunks": null}}
{"id": "8463fdb2-1749-474e-a006-638b5dcb6b5c", "content": "### 4. Store Secrets Securely\n\n**GitHub Actions:**\n```yaml\nenv:\n  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n```\n\n**GitLab CI:**\n```yaml\nvariables:\n  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n```\n\n**Jenkins:**\n```groovy\nenvironment {\n    OPENAI_API_KEY = credentials('openai-api-key')\n}\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 45, "total_chunks": null}}
{"id": "711433cb-281f-44f0-bdb6-b329456c147a", "content": "### 5. Set Quality Gates\n\n```python", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 46, "total_chunks": null}}
{"id": "a1a5f42c-60ec-4118-82af-b2d8cb39d9fb", "content": "# check_quality.py\nimport json\nimport sys\n\nwith open(\"experiments/latest/evaluation/summary.json\") as f:\n    summary = json.load(f)\n\nscore = summary[\"overall_score\"]\nthreshold = 0.7\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 47, "total_chunks": null}}
{"id": "22de1253-4688-416d-b84a-40bde0724fa3", "content": "# Can also check individual evaluators\nintent_score = summary[\"by_evaluator\"][\"intent_recognition\"][\"score\"]\nlatency_score = summary[\"by_evaluator\"][\"token_budget\"][\"score\"]\n\nif score < threshold:\n    print(f\"❌ FAIL: Overall score {score:.2f} < {threshold}\")\n    sys.exit(1)\n\nif intent_score < 0.8:\n    print(f\"❌ FAIL: Intent recognition {intent_score:.2f} < 0.8\")\n    sys.exit(1)\n\nprint(f\"✅ PASS: All quality gates passed\")\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 48, "total_chunks": null}}
{"id": "23fac720-549e-4bca-9d83-91be5bf35d41", "content": "## Monitoring and Reporting\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 49, "total_chunks": null}}
{"id": "ebfebd1c-9e94-46ea-8ed3-a8f35662d9a7", "content": "### Track Metrics Over Time\n\nStore evaluation results in a time-series database:\n\n```python", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 50, "total_chunks": null}}
{"id": "5812fa20-a8ce-4ee2-ae4e-410ccd82ae30", "content": "# upload_metrics.py\nimport json\nimport requests\nfrom datetime import datetime\n\nwith open(\"experiments/latest/evaluation/summary.json\") as f:\n    summary = json.load(f)\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 51, "total_chunks": null}}
{"id": "9d2ddb90-2a46-485a-b7fc-6843e199ac26", "content": "# Send to monitoring system\nrequests.post(\"https://metrics.example.com/fluxloop\", json={\n    \"timestamp\": datetime.now().isoformat(),\n    \"project\": \"my-agent\",\n    \"branch\": os.getenv(\"CI_COMMIT_BRANCH\"),\n    \"overall_score\": summary[\"overall_score\"],\n    \"by_evaluator\": summary[\"by_evaluator\"],\n    \"total_traces\": summary[\"total_traces\"],\n})\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 52, "total_chunks": null}}
{"id": "13970b12-2411-4e8e-ad4b-378127cf02a8", "content": "### Generate Trend Reports\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 53, "total_chunks": null}}
{"id": "84c61ad6-0f51-4268-92dd-79d79af52350", "content": "# Compare last N runs\npython3 << 'EOF'\nimport json\nimport glob\n\nexperiments = sorted(glob.glob(\"experiments/*/evaluation/summary.json\"))[-10:]\n\nfor exp in experiments:\n    with open(exp) as f:\n        summary = json.load(f)\n    print(f\"{exp}: {summary['overall_score']:.2f}\")\nEOF\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 54, "total_chunks": null}}
{"id": "d67466cb-3f2f-4f40-a120-e58152272c7f", "content": "## Troubleshooting CI/CD\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 55, "total_chunks": null}}
{"id": "4dd231f4-8ada-449b-84ea-8fcfd2646395", "content": "### Tests Pass Locally but Fail in CI\n\n**Common causes:**\n\n1. **Missing environment variables**\n   ```bash\n   # Check what's set\n   fluxloop config env\n   ```\n\n2. **Different Python version**\n   ```yaml\n   # Pin Python version\n   python-version: '3.11'\n   ```\n\n3. **Non-deterministic inputs**\n   ```yaml\n   # Use fixed seed\n   seed: 42\n   mode: deterministic\n   ```\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 56, "total_chunks": null}}
{"id": "e0265d3a-1182-4ab3-a099-f69be066c56b", "content": "### Slow CI Runs\n\n**Optimizations:**\n\n1. **Reduce test scope**\n   ```bash\n   # Fewer inputs\n   fluxloop generate inputs --limit 10\n   \n   # Single iteration\n   fluxloop run experiment --iterations 1\n   ```\n\n2. **Sample LLM evaluations**\n   ```yaml\n   # configs/evaluation.yaml\n   limits:\n     sample_rate: 0.2  # Only 20% of traces\n     max_llm_calls: 10\n   ```\n\n3. **Cache dependencies**\n   ```yaml\n   - uses: actions/cache@v4\n     with:\n       path: ~/.cache/pip\n       key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 57, "total_chunks": null}}
{"id": "465d116c-4cb2-48c8-825a-7e085b6c9439", "content": "   ```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 58, "total_chunks": null}}
{"id": "fb6a94b4-3736-4523-ae63-840d9d7c77e2", "content": "## Example: Full GitHub Actions Workflow\n\nComprehensive example with all best practices:\n\n```yaml\nname: FluxLoop CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n  schedule:\n    - cron: '0 2 * * *'  # Daily at 2 AM\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        python-version: ['3.11', '3.12']\n    \n    steps:\n      - uses: actions/checkout@v4\n      \n      - name: Set up Python ${{ matrix.python-version }}\n        uses: actions/setup-python@v5\n        with:\n          python-version: ${{ matrix.python-version }}", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 59, "total_chunks": null}}
{"id": "844629e9-a68b-4848-9fe2-3f9f249f4029", "content": "          cache: 'pip'\n      \n      - name: Cache MCP index\n        uses: actions/cache@v4\n        with:\n          path: ~/.fluxloop/mcp/index\n          key: mcp-index-v1\n      \n      - name: Install dependencies\n        run: |\n          pip install fluxloop-cli fluxloop fluxloop-mcp\n          pip install -r requirements.txt\n      \n      - name: Verify installation\n        run: fluxloop doctor\n      \n      - name: Prepare test environment\n        run: |\n          cd fluxloop/my-agent\n          cp -r configs-ci/* configs/\n          fluxloop config validate", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 60, "total_chunks": null}}
{"id": "f410fd40-91e6-4e57-b13b-2f61c3575825", "content": "      \n      - name: Run tests\n        env:\n          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n        run: |\n          cd fluxloop/my-agent\n          fluxloop generate inputs --limit 20 --mode deterministic\n          fluxloop run experiment --iterations 1\n          \n          LATEST=$(ls -td experiments/*/ | head -1)\n          fluxloop parse experiment \"$LATEST\"\n          fluxloop evaluate experiment \"$LATEST\"\n      \n      - name: Quality gate\n        run: |\n          cd fluxloop/my-agent\n          python3 scripts/check_quality.py", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 61, "total_chunks": null}}
{"id": "62ab4b3d-5ffa-4698-a887-9aa351f67aeb", "content": "      \n      - name: Upload artifacts\n        if: always()\n        uses: actions/upload-artifact@v4\n        with:\n          name: results-py${{ matrix.python-version }}\n          path: fluxloop/my-agent/experiments/\n      \n      - name: Report to PR\n        if: github.event_name == 'pull_request'\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const fs = require('fs');\n            // ... (PR comment script from earlier)\n```\n\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 62, "total_chunks": null}}
{"id": "c4436052-1295-45e2-b693-9acee625bf7f", "content": "## See Also\n\n- [Basic Workflow](/cli/workflows/basic-workflow) - Standard FluxLoop workflow\n- [Multi-Turn Workflow](/cli/workflows/multi-turn-workflow) - Dynamic conversations\n- [Commands Reference](/cli/commands/run) - CLI command documentation\n- [Evaluation Configuration](/cli/configuration/evaluation-config) - Success criteria and thresholds", "metadata": {"source": "packages/website/docs-cli/workflows/ci-cd-integration.md", "chunk_index": 63, "total_chunks": null}}
{"id": "3e6faee9-854f-4741-919d-c14ec9ad5f78", "content": "---\nsidebar_position: 4\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 0, "total_chunks": null}}
{"id": "c416e7d8-6846-4785-a32d-ef0604443b89", "content": "# Multi-Turn Workflow\n\nRun multi-turn conversational experiments with AI-supervised dialogues.\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 1, "total_chunks": null}}
{"id": "5ea3ee86-1d87-43ec-bcf0-0431468b48c1", "content": "## Overview\n\nMulti-turn mode extends single-input experiments into dynamic conversations. Instead of running one agent call per input, FluxLoop:\n\n1. Feeds the initial user message to your agent\n2. Captures the agent's response\n3. Consults an AI supervisor to decide if the conversation is complete\n4. Generates the next user message (if continuing) based on persona and service context\n5. Repeats until natural completion or maximum turns\n\nThis enables realistic testing of conversational agents without manual scripting.", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 2, "total_chunks": null}}
{"id": "f18c4b4d-1a03-4af8-b410-cf6fc4a865e9", "content": "## Quick Start\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 4, "total_chunks": null}}
{"id": "f6d8907f-9134-478c-b0c2-8dfaa0efebda", "content": "### 1. Enable Multi-Turn in Configuration\n\nEdit `configs/simulation.yaml`:\n\n```yaml\nmulti_turn:\n  enabled: true\n  max_turns: 12\n  auto_approve_tools: true\n  \n  supervisor:\n    provider: openai\n    model: gpt-4o-mini\n    temperature: 0.2\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 5, "total_chunks": null}}
{"id": "0da8d4fc-9dc8-4b18-ab88-6c56fc24de27", "content": "### 2. Set Service Context\n\nAdd service description to `configs/project.yaml`:\n\n```yaml\nmetadata:\n  team: development\n  environment: local\n  service_context: >\n    Customer support assistant for SWISS Airlines.\n    Handles flight changes, cancellations, seat upgrades, and baggage inquiries.\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 6, "total_chunks": null}}
{"id": "58f49829-6d1e-4947-ba73-c4577be92986", "content": "### 3. Ensure Input Has Persona\n\nYour `inputs/generated.yaml` should include persona metadata:\n\n```yaml\ninputs:\n  - input: \"Hi, I need to change my flight\"\n    metadata:\n      persona: business_traveler\n      persona_description: \"Frequent business traveler who values efficiency\"\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 7, "total_chunks": null}}
{"id": "175283bd-6aed-47ab-8485-7d7660c8ef8d", "content": "### 4. Run Experiment\n\n```bash\nfluxloop run experiment\n```\n\nFluxLoop will now run multi-turn conversations automatically.\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 8, "total_chunks": null}}
{"id": "d3f74126-8259-48d4-bbfb-91ac803196a1", "content": "## How It Works\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 9, "total_chunks": null}}
{"id": "a776df77-d1db-494f-891a-f6ad28ab1c9c", "content": "### Conversation Flow\n\n```\n[Initial Input] → [Agent Response] → [Supervisor Decision]\n                                           ↓\n                        ┌──────────────────┴──────────────────┐\n                        ↓                                     ↓\n               [Continue: Generate Next User Msg]    [Terminate: Save & Exit]\n                        ↓\n               [Agent Response] → [Supervisor Decision] → ...\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 10, "total_chunks": null}}
{"id": "94ad8225-b0e5-4b14-b363-c43cd2d940d2", "content": "### Supervisor Decision Format\n\nThe supervisor LLM returns JSON:\n\n```json\n{\n  \"decision\": \"continue\",\n  \"next_user_message\": \"Thanks! Can you also help me upgrade my seat?\",\n  \"termination_reason\": null,\n  \"closing_user_message\": null\n}\n```\n\nOr when complete:\n\n```json\n{\n  \"decision\": \"terminate\",\n  \"next_user_message\": null,\n  \"termination_reason\": \"user_satisfied\",\n  \"closing_user_message\": \"Perfect, thank you for your help!\"\n}\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 11, "total_chunks": null}}
{"id": "80652faf-4b94-4a8c-8af1-6218eb26c897", "content": "## Configuration Reference\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 12, "total_chunks": null}}
{"id": "dfdcd3a2-ecf7-45aa-9573-43b40f3e4278", "content": "### Multi-Turn Settings\n\n| Field | Type | Default | Description |\n|-------|------|---------|-------------|\n| `enabled` | boolean | `false` | Enable multi-turn mode |\n| `max_turns` | integer | `8` | Maximum conversation turns |\n| `auto_approve_tools` | boolean | `true` | Auto-approve agent tool calls |\n| `persona_override` | string | `null` | Override persona from input |\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 13, "total_chunks": null}}
{"id": "19c001e1-b5c4-49b6-8303-38129afeaf5d", "content": "### Supervisor Settings\n\n| Field | Type | Default | Description |\n|-------|------|---------|-------------|\n| `provider` | string | `\"openai\"` | LLM provider (openai, mock) |\n| `model` | string | `\"gpt-4o-mini\"` | Model for supervision |\n| `temperature` | float | `0.2` | Sampling temperature |\n| `api_key` | string | `null` | API key override (uses env by default) |\n| `system_prompt` | string | `null` | Custom supervisor prompt |\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 14, "total_chunks": null}}
{"id": "d0b149e5-d4a4-40c0-861a-3c708050539e", "content": "## CLI Overrides\n\nOverride multi-turn settings from the command line:\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 15, "total_chunks": null}}
{"id": "877841ba-abce-4b0a-9ac7-0a1c1ff12141", "content": "# Enable multi-turn with custom settings\nfluxloop run experiment \\\n  --multi-turn \\\n  --max-turns 15 \\\n  --auto-approve \\\n  --supervisor-model gpt-4o-mini\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 16, "total_chunks": null}}
{"id": "f346a842-c4db-4cab-9a3a-4716af8386a2", "content": "# Disable multi-turn for single-turn testing\nfluxloop run experiment --no-multi-turn\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 17, "total_chunks": null}}
{"id": "a28cba1d-6194-48b5-a41b-7793c44bf2d4", "content": "# Override persona\nfluxloop run experiment --multi-turn --persona expert_user\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 18, "total_chunks": null}}
{"id": "25f6c35c-ff57-4243-b13f-a0a2fdddfa7a", "content": "## Advanced Usage\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 19, "total_chunks": null}}
{"id": "26da9e9f-9003-4f13-bd00-24fcabfcaf57", "content": "### Custom Supervisor Prompt\n\nProvide a custom system prompt for the supervisor:\n\n```yaml\nmulti_turn:\n  supervisor:\n    system_prompt: |\n      You supervise a technical support bot for SaaS products.\n      Generate concise, technical user messages.\n      End the conversation when the issue is resolved or escalated.\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 20, "total_chunks": null}}
{"id": "b48b6d31-fe3c-4002-8ea7-9b563add61b2", "content": "### Mock Supervisor for Testing\n\nUse deterministic mock responses during development:\n\n```yaml\nmulti_turn:\n  supervisor:\n    provider: mock\n    metadata:\n      mock_decision: terminate\n      mock_reason: \"Mock conversation complete\"\n```\n\nThe mock provider can operate in two modes:\n\n**Simple fallback mode** (no scripted questions):\n- Returns `terminate` by default with `mock_reason` and `mock_closing` from metadata\n- Set `mock_decision: continue` + `mock_next_user_message` for simple test loops\n\n**Scripted playback mode** (with question list):", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 21, "total_chunks": null}}
{"id": "08c4e65f-5d6d-4aa2-a537-f5baddae045d", "content": "```yaml\nmulti_turn:\n  supervisor:\n    provider: mock\n    metadata:\n      scripted_questions:\n        - \"Hi there, what time is my flight?\"\n        - \"Am I allowed to update my flight to something sooner?\"\n        - \"Update my flight to sometime next week then\"\n        - \"What about lodging and transportation?\"\n        - \"Yeah I think I'd like an affordable hotel for my week-long stay.\"\n      mock_reason: \"script_complete\"\n      mock_closing: \"Thanks for your help. I have no further questions.\"\n```\n\nIn scripted mode, the supervisor replays questions in order and terminates when the list is exhausted. This is ideal for regression testing, demos, and reproducible benchmarks.", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 22, "total_chunks": null}}
{"id": "b2ddefd1-923b-4f3d-b47f-e5e688e524df", "content": "### Access Conversation State in Agent\n\nIf your agent accepts `conversation_state`, you can inspect the full dialogue:\n\n```python\n@fluxloop.agent()\ndef my_agent(\n    input_text: str,\n    conversation_state: dict | None = None,\n    auto_approve: bool = False,\n) -> str:\n    if conversation_state:\n        turn_count = len(conversation_state.get(\"turns\", []))\n        print(f\"Processing turn {turn_count}\")\n    \n    # Your agent logic...\n    return response\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 24, "total_chunks": null}}
{"id": "7a8c9cce-1440-42ac-96f2-2dc75c581eec", "content": "## Output Structure\n\nMulti-turn runs produce enriched trace entries:\n\n```json\n{\n  \"trace_id\": \"...\",\n  \"iteration\": 0,\n  \"persona\": \"business_traveler\",\n  \"input\": \"Hi, I need to change my flight\",\n  \"output\": \"Perfect, thank you!\",\n  \"duration_ms\": 8432,\n  \"success\": true,\n  \"multi_turn\": {\n    \"enabled\": true,\n    \"turn_count\": 4,\n    \"termination_reason\": \"user_satisfied\"\n  },\n  \"conversation_state\": {\n    \"turns\": [\n      {\"role\": \"user\", \"content\": \"Hi, I need to change my flight\"},\n      {\"role\": \"assistant\", \"content\": \"I can help with that...\"},", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 25, "total_chunks": null}}
{"id": "353a4ffc-8741-40a8-80d6-9a595e0ee281", "content": "      {\"role\": \"user\", \"content\": \"Can you also upgrade my seat?\"},\n      {\"role\": \"assistant\", \"content\": \"Sure, let me check availability...\"},\n      ...\n    ],\n    \"metadata\": { ... },\n    \"context\": {\n      \"persona\": \"business_traveler\",\n      \"service_context\": \"SWISS Airlines customer support...\"\n    }\n  }\n}\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 26, "total_chunks": null}}
{"id": "7abbbcee-4421-4601-8388-983411ffd171", "content": "## Best Practices\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 27, "total_chunks": null}}
{"id": "6af60fa3-dd2f-4bb1-aba9-679c2a0a0daf", "content": "### 1. Set Realistic Max Turns\n- Customer support: 8-12 turns\n- Technical troubleshooting: 10-15 turns\n- Simple Q&A: 3-5 turns\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 28, "total_chunks": null}}
{"id": "249f1838-230d-4fe3-9b94-4640cf06d4fa", "content": "### 2. Use Lower Temperature for Reproducibility\n- `0.0-0.3`: More consistent, predictable conversations\n- `0.4-0.7`: Balanced variety and coherence\n- `0.8-1.0`: Higher variety, less reproducibility\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 29, "total_chunks": null}}
{"id": "bc6976c6-7742-4a47-aae1-28cf4f725dc6", "content": "### 3. Define Clear Service Context\nA well-defined service context helps the supervisor generate realistic user messages:\n\n```yaml\nmetadata:\n  service_context: |\n    E-commerce customer support chatbot.\n    Handles: order tracking, returns, product questions, account issues.\n    Cannot: process payments, change passwords, access private data.\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 30, "total_chunks": null}}
{"id": "57b66275-f939-4719-ae42-f5f10154aae5", "content": "### 4. Monitor Costs\nMulti-turn mode makes additional LLM calls (supervisor decisions). Use:\n- Mock provider for development\n- Lower `max_turns` for cost control\n- Track supervisor usage in traces\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 31, "total_chunks": null}}
{"id": "1a1efde6-a0fa-42c7-9779-d81a34cd592f", "content": "## Troubleshooting\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 32, "total_chunks": null}}
{"id": "db0c6946-3b62-4bd9-867c-24138b3505b0", "content": "### Conversations End Too Early\n- Increase `max_turns`\n- Review `service_context` – ensure it's clear and detailed\n- Check supervisor temperature (try 0.3-0.5 for more variety)\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 33, "total_chunks": null}}
{"id": "72b0e46e-330c-46a1-aaab-de33e10a7309", "content": "### Conversations Don't Terminate\n- Lower `max_turns` as safety limit\n- Review supervisor prompt – ensure termination criteria are clear\n- Check that agent responses indicate task completion\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 34, "total_chunks": null}}
{"id": "442e4faa-8271-43fc-b139-1b6ed5e4495d", "content": "### Supervisor API Errors\n- Verify API key is set (`OPENAI_API_KEY` env or `supervisor.api_key`)\n- Check model name is valid for your provider\n- Review error logs in trace output\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 35, "total_chunks": null}}
{"id": "6a325d37-74f4-49b1-a486-95ffe0fc0dca", "content": "## Next Steps\n\n- [Runner Targets](../configuration/runner-targets) – detailed runner integration patterns\n- [Run Command](../commands/run) – command-line reference\n- [Project Configuration](../configuration/project-config) – metadata setup\n", "metadata": {"source": "packages/website/docs-cli/workflows/multi-turn-workflow.md", "chunk_index": 36, "total_chunks": null}}
{"id": "8dbd3b7e-bb08-473e-9768-a2d7c622c4af", "content": "---\nsidebar_position: 5\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 0, "total_chunks": null}}
{"id": "a1f85617-4267-462e-9fa5-475f9f301468", "content": "# Pytest Integration\n\nIntegrate FluxLoop experiments into your pytest test suite for CI/CD pipelines.\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 1, "total_chunks": null}}
{"id": "7db9f598-317b-4d09-918e-bb1a67c0dbca", "content": "## Overview\n\nStarting with FluxLoop 0.2.29, you can run FluxLoop experiments as part of your pytest tests using specialized fixtures. This enables:\n\n- **Familiar Testing Workflow**: Use `pytest` commands developers already know\n- **CI/CD Integration**: Run experiments in GitHub Actions, GitLab CI, etc.\n- **Assertion Support**: Use pytest assertions on experiment results\n- **Test Discovery**: Automatically discover and run FluxLoop tests\n- **Parallel Execution**: Run multiple experiment tests in parallel\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 2, "total_chunks": null}}
{"id": "b32ab7fc-9fb5-40a5-8b9b-87749eb0da6b", "content": "## Quick Start\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 3, "total_chunks": null}}
{"id": "9daebc46-49f8-412c-95fa-6b9bfc0a50ce", "content": "### 1. Install with Dev Dependencies\n\n```bash\npip install -e packages/cli[dev]", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 4, "total_chunks": null}}
{"id": "1e5cc170-9356-4229-8ef9-017caed7a949", "content": "# or for published package\npip install fluxloop-cli[dev]\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 5, "total_chunks": null}}
{"id": "de31f4d6-b6e5-43ea-a750-5cb40110788a", "content": "### 2. Generate Test Template\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 6, "total_chunks": null}}
{"id": "1d5119a6-d1fe-45f9-ada0-ec5d32565c6d", "content": "# Generate pytest template in default location (tests/)\nfluxloop init pytest-template\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 7, "total_chunks": null}}
{"id": "fd2b1488-c9ef-4fac-aace-8bd4dafea32d", "content": "# Custom location\nfluxloop init pytest-template --tests-dir integration_tests\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 8, "total_chunks": null}}
{"id": "0ae62847-7c09-487f-afdc-1edfe49b3bf9", "content": "# Custom filename\nfluxloop init pytest-template --filename test_agent_smoke.py\n```\n\n**What gets created:**\n\n```python", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 9, "total_chunks": null}}
{"id": "ffee8e10-a9cc-4acf-983e-f784445ffb5f", "content": "# tests/test_fluxloop_smoke.py\nimport pytest\nfrom pathlib import Path\nfrom fluxloop_cli.testing.pytest_plugin import fluxloop_runner\n\nPROJECT_ROOT = Path(__file__).resolve().parents[1]\n\ndef test_fluxloop_smoke(fluxloop_runner):\n    \"\"\"Smoke test: verify agent runs without errors.\"\"\"\n    result = fluxloop_runner(\n        project_root=PROJECT_ROOT,\n        simulation_config=PROJECT_ROOT / \"configs\" / \"simulation.yaml\",\n        overrides={\"iterations\": 1},\n        env={\"PYTHONPATH\": str(PROJECT_ROOT)},\n    )\n    \n    # Assert on results", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 10, "total_chunks": null}}
{"id": "43d7b526-c981-4647-9697-a195eadcffab", "content": "    assert result.total_runs > 0\n    assert result.success_rate >= 0.8\n    \n    # Or use convenience method\n    result.require_success(threshold=0.8)\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 11, "total_chunks": null}}
{"id": "4ff53b40-cab5-4dea-a066-3bd7dd9c987c", "content": "### 3. Run Tests\n\n```bash", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 12, "total_chunks": null}}
{"id": "6a95d0d3-b888-4bbc-a0ab-104c5cb8c369", "content": "# Run FluxLoop tests only\npytest -k fluxloop_smoke\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 13, "total_chunks": null}}
{"id": "18698921-80ec-4a6a-a1ea-071a950d101c", "content": "# Run with verbose output\npytest -k fluxloop -v\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 14, "total_chunks": null}}
{"id": "bce7ef69-fea2-4d9b-8e68-daad082728c6", "content": "# Stop on first failure\npytest -k fluxloop --maxfail=1\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 15, "total_chunks": null}}
{"id": "e9736cd5-bd89-4478-9103-9fefbf7b889c", "content": "# Run all tests including FluxLoop\npytest\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 16, "total_chunks": null}}
{"id": "ecc23f94-083f-4dd6-a0e2-ef9aede8bf4f", "content": "## Adapter Workflow for Existing Agents\n\nUse the pytest bridge as an *adapter layer* when your AI agent already lives inside another repository (e.g., a LangGraph tutorial project) and FluxLoop needs to drive that code end-to-end.\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 17, "total_chunks": null}}
{"id": "a2a8337a-3253-4084-9b06-6ba89ea3101b", "content": "### 1. Expose a FluxLoop Runner Entry Point\n\nCreate a module such as `customer_support/runner.py` and define a `run` function. The FluxLoop python-function runner imports and calls this entry point directly.\n\n```python\n\"\"\"FluxLoop simulation runner entry point.\"\"\"\nfrom __future__ import annotations\n\nimport uuid\nfrom typing import Any, Dict, Optional\n\nfrom dotenv import load_dotenv\nfrom langchain_anthropic import ChatAnthropic\nfrom langchain_openai import ChatOpenAI\n\nfrom customer_support import prepare_database\nfrom customer_support.data.travel_db import get_default_storage_dir", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 18, "total_chunks": null}}
{"id": "3285df3f-4595-455b-9e11-24d2d03eabec", "content": "from customer_support.graphs import build_part4_graph\nfrom customer_support.tracing import init_tracing, trace_graph_execution\n\nDEFAULT_PROVIDER = \"anthropic\"\n\n@trace_graph_execution\ndef run(input_payload: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:\n    load_dotenv()\n    init_tracing()\n\n    payload = input_payload or {}\n    user_message = payload.get(\"message\", \"Hello, I need help with my flight.\")\n    passenger_id = payload.get(\"passenger_id\", \"3442 587242\")\n    provider = payload.get(\"provider\", DEFAULT_PROVIDER).lower()", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 19, "total_chunks": null}}
{"id": "6dd81306-7731-4fcc-9a59-835f2d917245", "content": "    thread_id = payload.get(\"thread_id\") or str(uuid.uuid4())\n\n    data_dir = get_default_storage_dir()\n    data_dir.mkdir(parents=True, exist_ok=True)\n    db_path = prepare_database(target_dir=data_dir, overwrite=False)\n\n    if provider == \"openai\":\n        llm = ChatOpenAI(model=\"gpt-4o-mini\", temperature=1)\n    else:\n        llm = ChatAnthropic(model=\"claude-haiku-4-5-20251001\", temperature=1)\n\n    graph = build_part4_graph(str(db_path), llm=llm)\n    result = graph.invoke({\"messages\": [(\"user\", user_message)]}, config={", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 20, "total_chunks": null}}
{"id": "52316b40-b4df-40de-b482-aad6f8a15923", "content": "        \"configurable\": {\"passenger_id\": passenger_id, \"thread_id\": thread_id}\n    })\n\n    messages = result.get(\"messages\", [])\n    response = \"\"\n    if messages and hasattr(messages[-1], \"content\"):\n        response = messages[-1].content\n\n    return {\n        \"response\": response,\n        \"messages\": [\n            {\"role\": getattr(m, \"type\", \"unknown\"), \"content\": getattr(m, \"content\", str(m))}\n            for m in messages\n        ],\n        \"thread_id\": thread_id,\n    }\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 21, "total_chunks": null}}
{"id": "3420e33e-f32c-4e26-8e51-232467fba790", "content": "### 2. Align `simulation.yaml`\n\nPoint the runner section at the entry point you just created. If you need additional import paths, add them to `python_path` and FluxLoop will extend `sys.path` for you.\n\n```yaml\nrunner:\n  module_path: \"customer_support.runner\"\n  function_name: \"run\"\n  working_directory: /Users/you/projects/customer-support\n  python_path:\n    - src\n  timeout_seconds: 120\n  max_retries: 3\n```\n\nEven if the tutorial removes metrics such as `task_completion`, FluxLoop CLI now injects default thresholds so the evaluation report keeps rendering.", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 22, "total_chunks": null}}
{"id": "b777eaa6-9054-4ffe-83ec-05fab799b10c", "content": "### 3. Write a Pytest Adapter Test\n\nThe pytest file itself acts as the adapter that launches the FluxLoop experiment.\n\n```python", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 24, "total_chunks": null}}
{"id": "d7b555cb-24b8-41e6-815a-39125a8f9d88", "content": "# tests/test_customer_support.py\nfrom pathlib import Path\n\nPROJECT_ROOT = Path(__file__).resolve().parents[1]\n\ndef test_customer_support_agent(fluxloop_runner):\n    result = fluxloop_runner(\n        project_root=PROJECT_ROOT,\n        simulation_config=PROJECT_ROOT / \"configs\" / \"simulation.yaml\",\n        overrides={\n            \"iterations\": 1,\n            \"runner.working_directory\": str(PROJECT_ROOT / \"langgraph\" / \"customer-support\"),\n            \"runner.python_path.0\": \"src\",\n        },\n        env={\n            \"PYTHONPATH\": str(PROJECT_ROOT / \"langgraph\" / \"customer-support\"),", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 25, "total_chunks": null}}
{"id": "3b351099-9b1a-4d95-bd2c-ebbb237b40a0", "content": "            \"OPENAI_API_KEY\": \"...\",\n            \"ANTHROPIC_API_KEY\": \"...\",\n        },\n        timeout=180,\n    )\n    result.require_success(\"customer support agent\")\n```\n\nBefore running the test for the first time, install the SDK locally (`pip install -e packages/sdk`) and verify `python -c \"import fluxloop; print(fluxloop.__version__)\"`. Use `env={\"PYTHONPATH\": ...}` to append extra agent source folders whenever imports would otherwise fail.\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 26, "total_chunks": null}}
{"id": "f20435fb-20ed-419c-9909-08c2bfc084df", "content": "### 4. Run from Pytest or CI\n\n```bash\npytest tests/test_customer_support.py -k customer_support_agent -v\n```\n\nUse the same command inside GitHub Actions or GitLab CI (`pytest -k customer_support_agent --maxfail=1`). Upload `result.output_dir / report.html` as an artifact to share the regression report with the rest of your team.\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 27, "total_chunks": null}}
{"id": "f9abc8d9-c72a-4101-9932-4f05ab4c5d31", "content": "## Available Fixtures\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 28, "total_chunks": null}}
{"id": "6a4668cf-dada-45b5-9da2-10d9a91fec1a", "content": "### fluxloop_runner\n\nExecutes experiments using FluxLoop's `ExperimentRunner` directly (SDK mode).\n\n**Signature:**\n\n```python\ndef fluxloop_runner(\n    project_root: Path,\n    simulation_config: Path,\n    overrides: dict | None = None,\n    env: dict | None = None,\n    timeout: int = 600,\n) -> FluxLoopTestResult:\n    ...\n```\n\n**Parameters:**\n\n| Parameter | Type | Description | Default |\n|-----------|------|-------------|---------|\n| `project_root` | `Path` | Project root directory | Required |\n| `simulation_config` | `Path` | Path to simulation.yaml | Required |", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 29, "total_chunks": null}}
{"id": "7920a53b-4b58-4e28-b90e-fbec594e0f6a", "content": "| `overrides` | `dict` | Override config values | `None` |\n| `env` | `dict` | Environment variables | `None` |\n| `timeout` | `int` | Timeout in seconds | `600` |\n\n**Example:**\n\n```python\ndef test_basic_run(fluxloop_runner):\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": 5},\n        env={\"PYTHONPATH\": str(Path.cwd())},\n    )\n    \n    assert result.total_runs == 5\n    result.require_success()\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 30, "total_chunks": null}}
{"id": "996b4773-7e7c-4780-af91-5a6697c623dd", "content": "### fluxloop_runner_multi_turn\n\nConvenience fixture for multi-turn experiments (auto-enables multi-turn mode).\n\n**Example:**\n\n```python\ndef test_multi_turn(fluxloop_runner_multi_turn):\n    result = fluxloop_runner_multi_turn(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\n            \"iterations\": 2,\n            \"multi_turn\": {\n                \"max_turns\": 8,\n                \"auto_approve_tools\": True,\n            }\n        },\n    )\n    \n    assert result.total_runs == 2", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 31, "total_chunks": null}}
{"id": "ee182ebf-8332-486b-bc14-b164f857f1bd", "content": "    result.require_success(threshold=0.7)\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 32, "total_chunks": null}}
{"id": "bf4299fb-894a-48c7-a56a-4404b708094a", "content": "### fluxloop_cli (Advanced)\n\nExecutes experiments by calling `fluxloop run experiment` as a subprocess (CLI mode).\n\n**When to Use:**\n\n- Testing actual CLI commands\n- Verifying command-line behavior\n- Debugging CLI output\n- Integration testing with full CLI stack\n\n**Example:**\n\n```python\ndef test_cli_execution(fluxloop_cli):\n    result = fluxloop_cli(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        cli_args=[\"--iterations\", \"3\", \"--yes\"],\n    )\n    \n    # Check CLI execution", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 33, "total_chunks": null}}
{"id": "618d93a7-eac0-4171-93d5-03e22a656b7f", "content": "    assert result.success_rate > 0.8\n    \n    # Access CLI-specific info\n    print(f\"Command: {result.cli_command}\")\n    print(f\"Stdout: {result.stdout_path}\")\n    print(f\"Stderr: {result.stderr_path}\")\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 34, "total_chunks": null}}
{"id": "b4bf381c-a194-43d8-9237-549131ffe534", "content": "## FluxLoopTestResult API\n\nAll fixtures return a `FluxLoopTestResult` object with test metrics and paths.\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 35, "total_chunks": null}}
{"id": "20e625bf-3200-492b-990d-447d7affd68a", "content": "### Properties\n\n```python\nclass FluxLoopTestResult:\n    # Metrics\n    total_runs: int              # Total experiment runs\n    success_rate: float          # Success rate (0.0-1.0)\n    avg_duration_ms: float       # Average duration in ms\n    \n    # File Paths\n    experiment_dir: Path         # Experiment output directory\n    trace_summary_path: Path     # trace_summary.jsonl path\n    per_trace_path: Path | None  # per_trace.jsonl (if parsed)\n    \n    # CLI-specific (fluxloop_cli fixture only)\n    cli_command: str | None      # Full CLI command", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 36, "total_chunks": null}}
{"id": "4b394503-c30c-4fc8-82b4-84c676174ce8", "content": "    stdout_path: Path | None     # Stdout log file\n    stderr_path: Path | None     # Stderr log file\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 37, "total_chunks": null}}
{"id": "3fcb5921-5218-41f0-b5f1-6e5e5434ef25", "content": "### Methods\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 38, "total_chunks": null}}
{"id": "485970b3-9a85-4eb1-b75f-d79807ac3e71", "content": "#### require_success()\n\nAssert that success rate meets threshold.\n\n```python\nresult.require_success(threshold=0.8)", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 39, "total_chunks": null}}
{"id": "7e36fd1e-605d-4d67-b21e-2ce6d5536e19", "content": "# Raises AssertionError if success_rate < 0.8\n```\n\n**Parameters:**\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `threshold` | `float` | `1.0` | Minimum success rate (0.0-1.0) |\n| `message` | `str` | Auto-generated | Custom error message |\n\n**Examples:**\n\n```python", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 40, "total_chunks": null}}
{"id": "a5f69958-ff87-49c6-a828-a756ef3120ba", "content": "# Require 100% success\nresult.require_success()\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 41, "total_chunks": null}}
{"id": "9349e729-f3c7-461c-8758-528d2fc334f7", "content": "# Require at least 80% success\nresult.require_success(threshold=0.8)\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 42, "total_chunks": null}}
{"id": "707cc006-bb1a-454f-85a1-03b449989554", "content": "# Custom error message\nresult.require_success(\n    threshold=0.9,\n    message=\"Agent quality below 90%\"\n)\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 43, "total_chunks": null}}
{"id": "14f6eb7b-766c-4a94-8f24-d14eacab64ad", "content": "#### require_min_runs()\n\nAssert minimum number of runs.\n\n```python\nresult.require_min_runs(min_runs=10)", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 44, "total_chunks": null}}
{"id": "b8fbd537-93e0-4444-ad9b-ceb9e5ef0ceb", "content": "# Raises AssertionError if total_runs < 10\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 45, "total_chunks": null}}
{"id": "5a112545-aadf-4f48-8ed7-af29c087127b", "content": "#### require_max_duration()\n\nAssert average duration is below threshold.\n\n```python\nresult.require_max_duration(max_ms=500)", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 46, "total_chunks": null}}
{"id": "a0886f8e-e786-4f39-ac36-273cc4eef724", "content": "# Raises AssertionError if avg_duration_ms > 500\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 47, "total_chunks": null}}
{"id": "4bb94ece-05c0-4f29-b48a-5f4faff033a5", "content": "## Complete Examples\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 48, "total_chunks": null}}
{"id": "3da8318b-7da4-47b6-97c4-3d81d6b61b81", "content": "### Basic Smoke Test\n\n```python\ndef test_agent_smoke(fluxloop_runner):\n    \"\"\"Quick validation that agent runs.\"\"\"\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": 1},\n    )\n    \n    # Just verify it completes\n    assert result.total_runs > 0\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 49, "total_chunks": null}}
{"id": "f34600c7-51eb-4049-9f47-a6e45d06a276", "content": "### Regression Test\n\n```python\ndef test_agent_regression(fluxloop_runner):\n    \"\"\"Ensure agent maintains quality standards.\"\"\"\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": 10},\n    )\n    \n    # Strict success requirements\n    result.require_success(threshold=0.95)\n    result.require_max_duration(max_ms=1000)\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 50, "total_chunks": null}}
{"id": "3846fb7f-d7f1-418c-ad2b-4411f7f6251c", "content": "### Performance Test\n\n```python\ndef test_agent_performance(fluxloop_runner):\n    \"\"\"Verify agent meets latency SLAs.\"\"\"\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": 50},\n    )\n    \n    # Check latency\n    assert result.avg_duration_ms < 500, \\\n        f\"Agent too slow: {result.avg_duration_ms}ms\"\n    \n    # Still require reasonable quality\n    result.require_success(threshold=0.85)\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 51, "total_chunks": null}}
{"id": "02ee1649-f400-4f88-bd87-bf7502beeaa3", "content": "### Multi-Turn Conversation Test\n\n```python\ndef test_multi_turn_conversation(fluxloop_runner_multi_turn):\n    \"\"\"Test agent handles multi-turn dialogues.\"\"\"\n    result = fluxloop_runner_multi_turn(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\n            \"iterations\": 5,\n            \"multi_turn\": {\n                \"max_turns\": 10,\n                \"auto_approve_tools\": True,\n            }\n        },\n    )\n    \n    result.require_success(threshold=0.80)\n    result.require_min_runs(min_runs=5)", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 52, "total_chunks": null}}
{"id": "1b6a8c02-dbfc-464c-917f-d051edf1852c", "content": "```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 53, "total_chunks": null}}
{"id": "695794db-9e1e-40aa-9e00-788a98d54023", "content": "### Persona-Specific Test\n\n```python\ndef test_expert_persona(fluxloop_runner):\n    \"\"\"Test agent with expert user persona.\"\"\"\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\n            \"iterations\": 10,\n            \"personas\": [\"expert_user\"],  # Filter to specific persona\n        },\n    )\n    \n    # Expert users should get faster responses\n    result.require_max_duration(max_ms=300)\n    result.require_success(threshold=0.90)\n```", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 54, "total_chunks": null}}
{"id": "8260ae1d-6a4f-4ba9-9f19-9814509cb1a4", "content": "### Custom Assertions\n\n```python\ndef test_custom_metrics(fluxloop_runner):\n    \"\"\"Test with custom evaluation logic.\"\"\"\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": 20},\n    )\n    \n    # Read per-trace data for custom checks\n    import json\n    with open(result.trace_summary_path) as f:\n        traces = [json.loads(line) for line in f]\n    \n    # Custom assertions\n    long_traces = [t for t in traces if t[\"duration_ms\"] > 1000]", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 56, "total_chunks": null}}
{"id": "44f3208c-fbd0-4a8e-9d14-d85e69291d95", "content": "    assert len(long_traces) < 2, \"Too many slow responses\"\n    \n    failed_traces = [t for t in traces if not t.get(\"success\")]\n    assert len(failed_traces) == 0, \"Found failed traces\"\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 57, "total_chunks": null}}
{"id": "ae3f1ec2-6b6e-469e-8807-4874d9076714", "content": "## CI/CD Integration\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 58, "total_chunks": null}}
{"id": "e9a4fa65-299c-4edd-967f-f14e93330f87", "content": "### GitHub Actions\n\nCreate `.github/workflows/fluxloop-tests.yml`:\n\n```yaml\nname: FluxLoop Tests\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - uses: actions/checkout@v4\n      \n      - uses: actions/setup-python@v5\n        with:\n          python-version: '3.11'\n      \n      - name: Install dependencies\n        run: |\n          python -m venv .venv\n          source .venv/bin/activate\n          pip install -U pip\n          pip install -e packages/cli[dev]", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 59, "total_chunks": null}}
{"id": "203e7065-a4c2-4629-b280-6972076da221", "content": "      \n      - name: Run FluxLoop tests\n        env:\n          PYTHONPATH: ${{ github.workspace }}\n          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n        run: |\n          source .venv/bin/activate\n          pytest -k fluxloop --maxfail=1 -v\n      \n      - name: Upload results\n        if: always()\n        uses: actions/upload-artifact@v3\n        with:\n          name: fluxloop-results\n          path: experiments/\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 60, "total_chunks": null}}
{"id": "8f6beb4c-516c-4f35-9e6e-acd3a8836e2e", "content": "### GitLab CI\n\nCreate `.gitlab-ci.yml`:\n\n```yaml\ntest:fluxloop:\n  stage: test\n  image: python:3.11\n  \n  before_script:\n    - python -m venv .venv\n    - source .venv/bin/activate\n    - pip install -U pip\n    - pip install -e packages/cli[dev]\n  \n  script:\n    - export PYTHONPATH=$CI_PROJECT_DIR\n    - pytest -k fluxloop --maxfail=1 -v\n  \n  artifacts:\n    when: always\n    paths:\n      - experiments/\n    expire_in: 1 week\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 61, "total_chunks": null}}
{"id": "eb8591e9-bca7-4c9c-91eb-b656547b1fba", "content": "### Example Workflow\n\nFull example at `examples/ci/fluxloop_pytest.yml`:\n\n```yaml\nname: fluxloop-pytest\n\non:\n  workflow_dispatch:\n  workflow_call:\n\njobs:\n  smoke:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - uses: actions/checkout@v4\n      \n      - uses: actions/setup-python@v5\n        with:\n          python-version: \"3.11\"\n      \n      - name: Install deps\n        run: |\n          python -m venv .venv\n          source .venv/bin/activate\n          pip install -U pip\n          pip install -e packages/cli[dev]\n      \n      - name: Run FluxLoop Pytest suite", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 62, "total_chunks": null}}
{"id": "be8678df-1271-4342-a096-476fb1c4a083", "content": "        env:\n          PYTHONPATH: ${{ github.workspace }}\n        run: |\n          source .venv/bin/activate\n          pytest -k fluxloop_smoke --maxfail=1 --disable-warnings\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 63, "total_chunks": null}}
{"id": "1bdfbac8-06af-467d-acaa-9b1aa2aafc22", "content": "## Best Practices\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 64, "total_chunks": null}}
{"id": "ee546ed7-39cf-443a-8bc0-7f196d610124", "content": "### 1. Start with Minimal Iterations\n\nUse low iteration counts for fast feedback:\n\n```python\ndef test_quick_smoke(fluxloop_runner):\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": 1},  # Fast validation\n    )\n    result.require_success()\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 65, "total_chunks": null}}
{"id": "2e1ee577-05e2-4ece-bdd6-cb22eece90f7", "content": "### 2. Use Fixtures for Setup\n\nShare common configuration:\n\n```python\nimport pytest\nfrom pathlib import Path\n\n@pytest.fixture\ndef project_root():\n    return Path(__file__).parents[1]\n\n@pytest.fixture\ndef simulation_config(project_root):\n    return project_root / \"configs\" / \"simulation.yaml\"\n\ndef test_agent(fluxloop_runner, project_root, simulation_config):\n    result = fluxloop_runner(\n        project_root=project_root,\n        simulation_config=simulation_config,\n        overrides={\"iterations\": 5},\n    )\n    result.require_success()", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 66, "total_chunks": null}}
{"id": "0a9d2ab8-79cc-4d51-a1dc-8e622ef824a1", "content": "```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 67, "total_chunks": null}}
{"id": "6c5dd6b6-4148-4973-9fe3-598a6ff25293", "content": "### 3. Set PYTHONPATH\n\nEnsure agent modules are importable:\n\n```python\ndef test_agent(fluxloop_runner):\n    project_root = Path.cwd()\n    result = fluxloop_runner(\n        project_root=project_root,\n        simulation_config=project_root / \"configs/simulation.yaml\",\n        env={\"PYTHONPATH\": str(project_root)},  # Important!\n    )\n    result.require_success()\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 68, "total_chunks": null}}
{"id": "f55c96c9-1ea4-4bb5-966b-0ae8d05b9c29", "content": "### 4. Use Timeouts\n\nPrevent hanging tests:\n\n```python\ndef test_agent(fluxloop_runner):\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        timeout=300,  # 5 minute timeout\n    )\n    result.require_success()\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 69, "total_chunks": null}}
{"id": "e188d894-46f4-49d4-9bf3-14041ebfce87", "content": "### 5. Organize Tests by Category\n\n```python", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 70, "total_chunks": null}}
{"id": "1c473268-dc78-41eb-846e-2601ab6c45ee", "content": "# tests/test_fluxloop_smoke.py\ndef test_smoke(fluxloop_runner):\n    \"\"\"Quick validation.\"\"\"\n    ...\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 71, "total_chunks": null}}
{"id": "766aefe3-c985-4438-9cad-8ed96f6f32eb", "content": "# tests/test_fluxloop_regression.py\ndef test_regression(fluxloop_runner):\n    \"\"\"Quality regression tests.\"\"\"\n    ...\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 72, "total_chunks": null}}
{"id": "88e5a84e-908e-43f2-9ef9-20d2def961c9", "content": "# tests/test_fluxloop_performance.py\ndef test_performance(fluxloop_runner):\n    \"\"\"Latency and throughput tests.\"\"\"\n    ...\n```\n\nRun by category:\n\n```bash\npytest tests/test_fluxloop_smoke.py  # Fast smoke tests\npytest tests/test_fluxloop_regression.py  # Quality checks\npytest -k fluxloop  # All FluxLoop tests\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 73, "total_chunks": null}}
{"id": "7a0e733d-9127-4cdf-9748-1ff950f4c003", "content": "## Advanced Usage\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 74, "total_chunks": null}}
{"id": "71cf0977-ae16-42a9-8efa-d44de1defc55", "content": "### Parameterized Tests\n\nTest multiple configurations:\n\n```python\nimport pytest\n\n@pytest.mark.parametrize(\"iterations\", [1, 5, 10])\ndef test_varying_iterations(fluxloop_runner, iterations):\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": iterations},\n    )\n    result.require_success(threshold=0.8)\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 75, "total_chunks": null}}
{"id": "11fc6006-180b-4de0-9d7e-066bdf472794", "content": "### Custom Result Processing\n\n```python\ndef test_with_custom_processing(fluxloop_runner):\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": 10},\n    )\n    \n    # Parse per-trace results\n    import json\n    traces = []\n    with open(result.trace_summary_path) as f:\n        for line in f:\n            traces.append(json.loads(line))\n    \n    # Custom analysis\n    durations = [t[\"duration_ms\"] for t in traces]\n    p95 = sorted(durations)[int(len(durations) * 0.95)]", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 76, "total_chunks": null}}
{"id": "87f0b601-8e1d-4677-b0fb-e8e3c52928c7", "content": "    \n    assert p95 < 1000, f\"P95 latency too high: {p95}ms\"\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 77, "total_chunks": null}}
{"id": "444b282a-3d6d-481b-b009-66b618fd35b8", "content": "### Integration with Other Tools\n\nCombine with other testing tools:\n\n```python\ndef test_with_deepeval(fluxloop_runner):\n    \"\"\"Integrate with DeepEval for LLM evaluation.\"\"\"\n    result = fluxloop_runner(\n        project_root=Path.cwd(),\n        simulation_config=Path(\"configs/simulation.yaml\"),\n        overrides={\"iterations\": 5},\n    )\n    \n    # Use per_trace_path with DeepEval\n    from deepeval import evaluate\n    from deepeval.metrics import AnswerRelevancyMetric\n    \n    # Read traces and evaluate\n    with open(result.per_trace_path) as f:", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 78, "total_chunks": null}}
{"id": "0c09554e-5e8e-436d-816c-4741c7d2f209", "content": "        traces = [json.loads(line) for line in f]\n    \n    metric = AnswerRelevancyMetric()\n    scores = [metric.measure(t[\"input\"], t[\"output\"]) for t in traces]\n    \n    avg_score = sum(scores) / len(scores)\n    assert avg_score > 0.7\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 79, "total_chunks": null}}
{"id": "f581e4fe-bd5e-4534-8351-c3d6d8407e63", "content": "## Troubleshooting\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 80, "total_chunks": null}}
{"id": "b7b06ab0-3cc7-4757-bac7-0bff680e2c46", "content": "### Tests Hang or Timeout\n\n**Issue:** Tests don't complete.\n\n**Solutions:**\n\n1. Set explicit timeout:\n   ```python\n   result = fluxloop_runner(..., timeout=300)\n   ```\n\n2. Use `pytest-timeout`:\n   ```bash\n   pip install pytest-timeout\n   pytest -k fluxloop --timeout=600\n   ```\n\n3. Add `--maxfail=1` to stop early:\n   ```bash\n   pytest -k fluxloop --maxfail=1\n   ```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 81, "total_chunks": null}}
{"id": "9421cae3-78f7-42b7-a37b-e333918ad679", "content": "### Module Not Found\n\n**Issue:** `ModuleNotFoundError: No module named 'my_agent'`\n\n**Solution:** Set PYTHONPATH:\n\n```python\nresult = fluxloop_runner(\n    ...,\n    env={\"PYTHONPATH\": str(project_root)},\n)\n```\n\nOr in CI:\n\n```yaml\nenv:\n  PYTHONPATH: ${{ github.workspace }}\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 82, "total_chunks": null}}
{"id": "547fe221-2afc-4e55-89f7-569c48dc2671", "content": "### API Key Not Found\n\n**Issue:** LLM provider errors.\n\n**Solution:** Set API keys in environment:\n\n```yaml", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 83, "total_chunks": null}}
{"id": "4f954e91-879e-4de1-8bda-6c096e7db2c7", "content": "# CI configuration\nenv:\n  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n```\n\nOr locally:\n\n```bash\nexport OPENAI_API_KEY=sk-your-key\npytest -k fluxloop\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 84, "total_chunks": null}}
{"id": "75f8acbe-5bd5-4f40-9723-11c187bc1176", "content": "## See Also\n\n- [CI/CD Integration](/cli/workflows/ci-cd-integration) - Full CI/CD guide\n- [Run Command](/cli/commands/run) - CLI reference\n- [Basic Workflow](/cli/workflows/basic-workflow) - Complete workflow\n- [init pytest-template](/cli/commands/init#init-pytest-template) - Template generation\n", "metadata": {"source": "packages/website/docs-cli/workflows/pytest-integration.md", "chunk_index": 85, "total_chunks": null}}
{"id": "80e46efa-4f65-4148-ad5d-d1d6bd9c99a3", "content": "---\nsidebar_position: 2\n---\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 0, "total_chunks": null}}
{"id": "c1b0f1b7-ae7a-45d9-ba04-91bb17d27356", "content": "# Recording Workflow\n\nCapture real-world arguments from running services and replay them inside FluxLoop experiments.\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 1, "total_chunks": null}}
{"id": "c1709769-65b1-437d-b560-a804670c0706", "content": "## 1. Prerequisites\n\n- FluxLoop project initialized (`configs/` + `.env`)\n- Application code uses `fluxloop.record_call_args(...)` at the points you want to capture\n- Startup code calls `fluxloop.load_env(...)` and `fluxloop.configure(...)` to read recording environment variables (see [record command](../commands/record))\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 2, "total_chunks": null}}
{"id": "5e926382-49b4-4460-8d01-58bb9bfeb803", "content": "## 2. Enable Recording\n\n```bash\nfluxloop record enable\n```\n\nThis toggles `.env` and `configs/simulation.yaml` to point at `recordings/args_recording.jsonl` (or your custom path). The CLI prints the resolved absolute path.\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 3, "total_chunks": null}}
{"id": "21bd43de-0bf1-4a93-8814-87430e114679", "content": "## 3. Restart / Run Your Service\n\nEnsure the service reloads configuration so the SDK sees `FLUXLOOP_RECORD_ARGS=true`.\n\nOptional sanity check in code:\n\n```python\nfrom pathlib import Path\nfluxloop.load_env(Path(__file__).resolve().parents[2] / \".env\")\nconfig = fluxloop.get_config()\nprint(\"Recording?\", config.record_args, config.recording_file)\n```\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 4, "total_chunks": null}}
{"id": "afde7dc0-f5b1-4ea1-a5a7-b38a27b06e8c", "content": "## 4. Exercise Real Traffic\n\n- Interact with your application (web UI, API calls, etc.)\n- Each call to `fluxloop.record_call_args` appends a JSONL entry with the kwargs\n- Sensitive keys are automatically masked (token/key/secret…)\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 5, "total_chunks": null}}
{"id": "96e6f63e-a2c1-4127-aa54-7b3d07e18c55", "content": "## 5. Verify Output\n\n```bash\ntail -f recordings/args_recording.jsonl\n```\n\nYou should see `_version`, `target`, `kwargs`, and `timestamp` fields. If the file is empty, confirm the service imported `.env` before configure.\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 6, "total_chunks": null}}
{"id": "0ddb5407-5991-4091-8901-e8ff57784cba", "content": "## 6. Disable Recording\n\n```bash\nfluxloop record disable\n```\n\nRecords stop appending, but the last file path remains for re-use. Keep the file under version control ignore rules.\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 7, "total_chunks": null}}
{"id": "50673256-bb7b-4c6f-9033-754fd4c40501", "content": "## 7. Configure Replay for Experiments\n\nEdit `configs/simulation.yaml` to enable `replay_args`:\n\n```yaml\nrunner:\n  target: \"app.main:support_server.respond\"\n  stream_output_path: \"message.delta\"\n\nreplay_args:\n  enabled: true\n  recording_file: recordings/args_recording.jsonl\n  override_param_path: \"item.content.0.text\"   # optional override of the user message\n```\n\nDuring experiments the CLI will:\n\n1. Load recorded kwargs\n2. Inject the runtime input at `override_param_path`\n3. Restore callable placeholders (collector callbacks)", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 8, "total_chunks": null}}
{"id": "2ec8dac1-b624-4570-8d7a-2a0043d59057", "content": "4. Execute your real code with the recorded structure\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 9, "total_chunks": null}}
{"id": "93fa5a58-e64c-4d86-b55d-8f3c7c44191a", "content": "## 8. Run Experiment\n\n```bash\nfluxloop generate inputs --limit 10   # optional refresher\nfluxloop run experiment\n```\n\nEach generated input is replayed against the recorded argument skeleton, producing reproducible artifacts.\n", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 10, "total_chunks": null}}
{"id": "cbf3f134-a80e-4e80-9654-81cf4c7a8968", "content": "## Tips\n\n- Keep separate recording files per scenario (`recordings/login.jsonl`, `recordings/support.jsonl`, …)\n- Use versioned naming (e.g., `args_2024-11-02.jsonl`) for audit trails\n- If recordings are large, prune or sample before committing\n- Coordinate with CI/CD: disable recording in automated environments (`FLUXLOOP_RECORD_ARGS=false`)", "metadata": {"source": "packages/website/docs-cli/workflows/recording-workflow.md", "chunk_index": 11, "total_chunks": null}}
{"id": "be0b2c27-a6ca-4be4-8370-a7a44c78d9ca", "content": "---\nsidebar_position: 2\n---\n\n# Client API\n\nFluxLoopClient API reference.\n\n## Class: FluxLoopClient\n\nMain client for FluxLoop SDK.\n\n```python\nfrom fluxloop import FluxLoopClient\n\nclient = FluxLoopClient()\n```\n\n## Coming Soon\n\nComplete API documentation is in progress.\n\n", "metadata": {"source": "packages/website/docs-sdk/api/client.md", "chunk_index": 0, "total_chunks": null}}
{"id": "5a9b95d1-568d-4193-816f-e4eb7d1b734a", "content": "---\nsidebar_position: 3\n---\n\n# Context API\n\nTrace context management.\n\n## Coming Soon\n\nContext API documentation is in development.\n\n", "metadata": {"source": "packages/website/docs-sdk/api/context.md", "chunk_index": 0, "total_chunks": null}}
{"id": "e45acb8b-8482-4fd7-a42f-de4bad7b3a0e", "content": "---\nsidebar_position: 1\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 0, "total_chunks": null}}
{"id": "5f621d26-6879-4325-aedc-3151211ef5d3", "content": "# Decorators API\n\nFluxLoop SDK provides decorators for instrumenting agent code with automatic observation collection.\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 1, "total_chunks": null}}
{"id": "55d2cf84-72a7-4db8-928b-800143b70ca6", "content": "## Overview\n\nFluxLoop decorators wrap your functions to automatically capture:\n- Execution timing (start/end timestamps)\n- Input arguments\n- Output values\n- Errors and stack traces\n- Metadata and context\n\nAll decorators support both **sync** and **async** functions.\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 2, "total_chunks": null}}
{"id": "bbb1fe5e-594a-401d-ad72-29b47c9f3338", "content": "## @fluxloop.agent()\n\nMark agent entry points for tracing. Creates observations with `ObservationType.AGENT`.\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 3, "total_chunks": null}}
{"id": "21a3e26e-209a-49df-a4e7-1113968062ae", "content": "### Signature\n\n```python\ndef agent(\n    name: Optional[str] = None,\n    metadata: Optional[Dict[str, Any]] = None,\n    capture_input: bool = True,\n    capture_output: bool = True,\n) -> Callable\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 4, "total_chunks": null}}
{"id": "8c6dc56b-8bdb-42cb-a16f-c8562292f8b1", "content": "### Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `name` | `str \\| None` | Function name | Display name for the agent trace |\n| `metadata` | `dict \\| None` | `None` | Additional metadata to attach to observation |\n| `capture_input` | `bool` | `True` | Whether to capture function arguments |\n| `capture_output` | `bool` | `True` | Whether to capture return value |\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 5, "total_chunks": null}}
{"id": "edc45963-626e-4928-872d-169eecc0f1e9", "content": "### Example\n\n```python\nimport fluxloop\n\n@fluxloop.agent(name=\"ChatBot\", metadata={\"version\": \"1.0\"})\ndef process_message(message: str) -> str:\n    \"\"\"Process user message and generate response.\"\"\"\n    response = generate_response(message)\n    return response\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 6, "total_chunks": null}}
{"id": "01d33687-1599-4bae-a1c7-0362e8abb10e", "content": "# Async variant\n@fluxloop.agent()\nasync def async_agent(prompt: str) -> dict:\n    \"\"\"Async agent entry point.\"\"\"\n    result = await process_async(prompt)\n    return {\"response\": result}\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 7, "total_chunks": null}}
{"id": "ce734617-f4f0-4b70-bc5e-9ca085718837", "content": "### When to Use\n\n- Main entry point of your agent\n- Top-level agent orchestration functions\n- Functions representing complete agent interactions\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 8, "total_chunks": null}}
{"id": "35bd7828-9003-43ac-b2c8-e11a9010a180", "content": "## @fluxloop.trace()\n\nGeneral-purpose decorator for recording observations around any function call. Creates observations with configurable `ObservationType`.\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 9, "total_chunks": null}}
{"id": "f0cdd4c9-728a-4173-b74a-5b5b2c64c660", "content": "### Signature\n\n```python\ndef trace(\n    name: Optional[str] = None,\n    observation_type: Union[ObservationType, str] = ObservationType.SPAN,\n    metadata: Optional[Dict[str, Any]] = None,\n    capture_input: bool = True,\n    capture_output: bool = True,\n) -> Callable\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 10, "total_chunks": null}}
{"id": "cf5b5cf2-c2f6-4d7f-9fde-152952cacd4f", "content": "### Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `name` | `str \\| None` | Function name | Display name for the observation |\n| `observation_type` | `ObservationType \\| str` | `SPAN` | Type of observation (`SPAN`, `EVENT`, etc.) |\n| `metadata` | `dict \\| None` | `None` | Additional metadata to attach |\n| `capture_input` | `bool` | `True` | Whether to store function arguments |\n| `capture_output` | `bool` | `True` | Whether to store return value |\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 11, "total_chunks": null}}
{"id": "989a0060-6bde-4a1c-9cdb-538061db9031", "content": "### Observation Types\n\nAvailable `ObservationType` values:\n\n- `SPAN` — Generic timing span (default)\n- `AGENT` — Agent-level operation\n- `TOOL` — Tool/function call\n- `GENERATION` — LLM completion\n- `EVENT` — Point-in-time event\n- `RETRIEVAL` — Document/data retrieval\n- `EMBEDDING` — Embedding generation\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 12, "total_chunks": null}}
{"id": "dd71c48f-9c0a-4b19-be97-85d5363bab55", "content": "### Example\n\n```python\nfrom fluxloop import trace\nfrom fluxloop.schemas import ObservationType\n\n@trace(name=\"data_processor\", observation_type=ObservationType.SPAN)\ndef process_data(data: list) -> dict:\n    \"\"\"Process raw data into structured format.\"\"\"\n    return {\"processed\": transform(data)}\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 13, "total_chunks": null}}
{"id": "b97e4e4e-7f31-4579-b554-45d131888841", "content": "# String type also works\n@trace(observation_type=\"retrieval\")\ndef fetch_documents(query: str) -> list:\n    \"\"\"Fetch relevant documents.\"\"\"\n    return database.search(query)\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 14, "total_chunks": null}}
{"id": "388f50d7-d2fc-477f-9fd1-b0227223e312", "content": "# Minimal usage\n@trace()\ndef helper_function(x: int, y: int) -> int:\n    return x + y\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 15, "total_chunks": null}}
{"id": "5b1563bf-4961-44df-ba41-d7245412be34", "content": "### When to Use\n\n- Internal helper functions\n- Data processing steps\n- Document retrieval operations\n- Any function you want to time/trace\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 16, "total_chunks": null}}
{"id": "5fea68aa-1536-45e0-a5a0-7972a1c1a7e0", "content": "## @fluxloop.prompt()\n\nDecorator for LLM prompt/generation functions. Creates observations with `ObservationType.GENERATION`.\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 17, "total_chunks": null}}
{"id": "e6410a92-5f62-4790-b0ab-44683e55828e", "content": "### Signature\n\n```python\ndef prompt(\n    name: Optional[str] = None,\n    model: Optional[str] = None,\n    capture_tokens: bool = True,\n) -> Callable\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 18, "total_chunks": null}}
{"id": "5cbec6f6-e4a0-4347-8849-5f9a2797a14c", "content": "### Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `name` | `str \\| None` | Function name | Name for the generation observation |\n| `model` | `str \\| None` | `None` | Model name being used (e.g., `\"gpt-4o\"`) |\n| `capture_tokens` | `bool` | `True` | Whether to try to capture token usage |\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 19, "total_chunks": null}}
{"id": "a2450c6e-f348-42b0-b4fb-09537de54ad3", "content": "### Example\n\n```python\nfrom fluxloop import prompt\nimport openai\n\n@prompt(model=\"gpt-4o\", name=\"generate_summary\")\ndef generate_summary(text: str) -> str:\n    \"\"\"Generate text summary using LLM.\"\"\"\n    response = openai.ChatCompletion.create(\n        model=\"gpt-4o\",\n        messages=[{\"role\": \"user\", \"content\": f\"Summarize: {text}\"}]\n    )\n    return response.choices[0].message.content\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 20, "total_chunks": null}}
{"id": "d0176063-c95a-4451-9c1a-1b5a0bbbaeb5", "content": "# Async streaming example\n@prompt(model=\"gpt-3.5-turbo\")\nasync def stream_response(prompt: str):\n    \"\"\"Stream LLM response.\"\"\"\n    async for chunk in llm.stream(prompt):\n        yield chunk\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 21, "total_chunks": null}}
{"id": "8441243f-debb-4703-b0b1-6d2a1681ca09", "content": "### When to Use\n\n- LLM completion calls\n- Prompt execution functions\n- Generation wrapper functions\n- Streaming LLM responses\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 22, "total_chunks": null}}
{"id": "0e07f60d-cfa5-43f2-9fee-18aa7c358353", "content": "## @fluxloop.tool()\n\nDecorator for tool/function calls. Creates observations with `ObservationType.TOOL`.\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 23, "total_chunks": null}}
{"id": "12525fff-2bec-4c6a-8fd4-5e6291eb60d8", "content": "### Signature\n\n```python\ndef tool(\n    name: Optional[str] = None,\n    description: Optional[str] = None,\n) -> Callable\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 24, "total_chunks": null}}
{"id": "755a0382-b3a8-48d0-a73b-1830dd4dd997", "content": "### Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `name` | `str \\| None` | Function name | Name for the tool |\n| `description` | `str \\| None` | `None` | Description of what the tool does |\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 25, "total_chunks": null}}
{"id": "183d5d4d-77df-45b9-91c3-991b9d27608e", "content": "### Example\n\n```python\nfrom fluxloop import tool\n\n@tool(description=\"Search the web for information\")\ndef web_search(query: str) -> list:\n    \"\"\"Search the web and return results.\"\"\"\n    return search_engine.search(query)\n\n@tool(name=\"calculator\")\ndef calculate(expression: str) -> float:\n    \"\"\"Evaluate mathematical expression.\"\"\"\n    return eval(expression)  # Use safely in production!\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 26, "total_chunks": null}}
{"id": "43bd1cdf-ac59-403c-99e0-fd36065a713a", "content": "# Async tool\n@tool(description=\"Fetch user data from API\")\nasync def get_user_data(user_id: str) -> dict:\n    \"\"\"Async tool for fetching user data.\"\"\"\n    return await api_client.get_user(user_id)\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 27, "total_chunks": null}}
{"id": "91bce8dc-facf-4893-a36e-bd08f38a0866", "content": "### When to Use\n\n- Agent tool functions\n- External API calls\n- Database queries\n- File operations\n- Any function called by an agent as a \"tool\"\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 28, "total_chunks": null}}
{"id": "9ecbbab5-4098-41e9-832d-accc5cc13899", "content": "## fluxloop.instrument()\n\nContext manager for creating instrumented scopes without decorators.\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 29, "total_chunks": null}}
{"id": "1cfc6d35-b8e4-428c-8574-c20feed5490d", "content": "### Signature\n\n```python\ndef instrument(\n    name: str,\n    session_id: Optional[UUID] = None,\n    user_id: Optional[str] = None,\n    metadata: Optional[Dict[str, Any]] = None,\n    tags: Optional[List[str]] = None,\n    trace_id: Optional[UUID] = None,\n) -> Iterator[FluxLoopContext]\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 30, "total_chunks": null}}
{"id": "5502507b-08b2-4581-8b56-4502eb54e337", "content": "### Parameters\n\n| Parameter | Type | Default | Description |\n|-----------|------|---------|-------------|\n| `name` | `str` | Required | Name for the instrumented scope |\n| `session_id` | `UUID \\| None` | Auto-generated | Session identifier |\n| `user_id` | `str \\| None` | `None` | User identifier |\n| `metadata` | `dict \\| None` | `None` | Metadata for the trace |\n| `tags` | `list \\| None` | `None` | Tags for categorization |\n| `trace_id` | `UUID \\| None` | Auto-generated | Trace identifier |\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 31, "total_chunks": null}}
{"id": "e61d61d5-df7a-48fd-83a6-ae93063e2145", "content": "### Example\n\n```python\nfrom fluxloop import instrument\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 32, "total_chunks": null}}
{"id": "79f4913c-7cb5-4bb3-a44f-9d83c09d87ee", "content": "# Basic usage\nwith instrument(\"my_operation\"):\n    result = perform_work()\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 33, "total_chunks": null}}
{"id": "629cb059-3802-4572-8a47-5c25936c738c", "content": "# With metadata\nwith instrument(\n    name=\"user_request\",\n    user_id=\"user_123\",\n    metadata={\"request_type\": \"query\"},\n    tags=[\"production\", \"api\"]\n):\n    response = handle_request()\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 34, "total_chunks": null}}
{"id": "1f760b9b-6d7b-446f-8986-b1836bb05d21", "content": "# In test/experiment harness\nfrom uuid import uuid4\n\nwith instrument(\n    name=\"experiment_run\",\n    trace_id=uuid4(),\n    metadata={\"experiment\": \"baseline_v1\"}\n):\n    agent_result = my_agent(input_data)\n```\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 35, "total_chunks": null}}
{"id": "c1ca2737-a278-4e41-ad02-8eb2a3c4f363", "content": "### When to Use\n\n- Experiment/test harnesses\n- Creating trace boundaries\n- When you can't use decorators\n- Wrapping third-party code\n- Dynamic instrumentation\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 36, "total_chunks": null}}
{"id": "61752bac-783e-49bc-abe2-710c855cee98", "content": "## Async Support\n\nAll decorators support async functions automatically:\n\n```python\nimport fluxloop\n\n@fluxloop.agent()\nasync def async_agent(input: str) -> dict:\n    # Automatically traced\n    result = await process_async(input)\n    return result\n\n@fluxloop.tool()\nasync def async_tool(query: str) -> list:\n    # Tool call traced\n    return await database.query(query)\n```\n\nAsync generators (streaming) are also supported:\n\n```python\n@fluxloop.prompt(model=\"gpt-4o\")\nasync def stream_chat(messages: list):\n    \"\"\"Stream chat completion.\"\"\"", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 37, "total_chunks": null}}
{"id": "4e3c7bc3-8784-44f1-baec-71680b3667ab", "content": "    async for chunk in llm.stream(messages):\n        yield chunk  # Each chunk traced\n```\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 38, "total_chunks": null}}
{"id": "ca48a83b-b579-4094-a41e-59c00c9a1902", "content": "## Error Handling\n\nAll decorators automatically capture exceptions:\n\n```python\n@fluxloop.tool()\ndef risky_operation(data: str) -> dict:\n    if not data:\n        raise ValueError(\"Data cannot be empty\")\n    return process(data)\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 39, "total_chunks": null}}
{"id": "6c9082b0-0aff-463c-b3ba-d293edf3f028", "content": "# When exception occurs:", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 40, "total_chunks": null}}
{"id": "1a14ada5-0799-4a6c-8609-19c00bedbbbe", "content": "# - observation.error = \"Data cannot be empty\"", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 41, "total_chunks": null}}
{"id": "1238ac05-fe09-4c52-a5f7-d5675e020263", "content": "# - observation.metadata[\"error_type\"] = \"ValueError\"", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 42, "total_chunks": null}}
{"id": "d4875e3e-49ac-47d3-9110-eb7b7204c8b3", "content": "# - observation.metadata[\"traceback\"] = <full traceback>", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 43, "total_chunks": null}}
{"id": "37cf75d0-2989-41db-9b89-5526f35a9c33", "content": "# - Exception is re-raised\n```\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 44, "total_chunks": null}}
{"id": "4ffad854-48f6-4606-8e70-d4b14167774a", "content": "## Decorator Ordering\n\nWhen using FluxLoop with other frameworks, **order matters**. See [Custom Framework Integration](/sdk/frameworks/custom) for detailed guidance.\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 45, "total_chunks": null}}
{"id": "4616fe48-8acf-43ea-8547-5f1ba5608c27", "content": "### Quick Rule\n\n**Framework decorator MUST be outermost:**\n\n```python", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 46, "total_chunks": null}}
{"id": "55dd3584-ac55-4766-95ec-f36398eb7a19", "content": "# ✅ CORRECT\n@framework_tool_decorator(...)\n@fluxloop.tool(...)\nasync def my_tool(...):\n    ...\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 47, "total_chunks": null}}
{"id": "36027e75-59f9-48bd-aafb-de9997172344", "content": "# ❌ WRONG - Breaks framework type system\n@fluxloop.tool(...)\n@framework_tool_decorator(...)\nasync def my_tool(...):\n    ...\n```\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 48, "total_chunks": null}}
{"id": "b84451bd-a68e-4209-8e9f-41c21f2d6287", "content": "## Manual Instrumentation\n\nFor advanced use cases, you can manually create observations:\n\n```python\nfrom fluxloop import get_current_context\nfrom fluxloop.models import ObservationData, ObservationType\nfrom uuid import uuid4\nfrom datetime import datetime, timezone\n\ndef custom_operation(param: str) -> dict:\n    \"\"\"Manually instrumented function.\"\"\"\n    fl_ctx = get_current_context()\n    obs = None\n    \n    if fl_ctx and fl_ctx.is_enabled():\n        obs = ObservationData(\n            id=uuid4(),\n            type=ObservationType.TOOL,", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 49, "total_chunks": null}}
{"id": "b433a535-9350-42b6-bf53-9f25d795623f", "content": "            name=\"custom_operation\",\n            start_time=datetime.now(timezone.utc),\n            input={\"args\": {\"param\": param}},\n        )\n        fl_ctx.push_observation(obs)\n    \n    try:\n        result = {\"output\": process(param)}\n        if obs:\n            obs.output = result\n        return result\n    except Exception as e:\n        if obs:\n            obs.error = str(e)\n        raise\n    finally:\n        if obs:\n            obs.end_time = datetime.now(timezone.utc)\n        if fl_ctx and obs:\n            fl_ctx.pop_observation()", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 50, "total_chunks": null}}
{"id": "79cbcf39-59a8-469e-9428-8eb5f30459f7", "content": "```\n\nThis pattern is useful when:\n- You need fine-grained control\n- Working with framework decorators\n- Avoiding decorator conflicts\n\n---\n", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 51, "total_chunks": null}}
{"id": "0fa2a9ad-c1ed-4dea-8b23-0fd8370d505e", "content": "## See Also\n\n- [Custom Framework Integration](/sdk/frameworks/custom) — Decorator ordering and safe instrumentation\n- [Context API](/sdk/api/context) — FluxLoopContext and get_current_context()\n- [Basic Usage](/sdk/getting-started/basic-usage) — Quick start guide\n- [Models](/sdk/api/models) — ObservationType, ObservationData schemas", "metadata": {"source": "packages/website/docs-sdk/api/decorators.md", "chunk_index": 52, "total_chunks": null}}
{"id": "0b3baa82-f3b9-4c48-8557-1d3dfdc4226e", "content": "---\nsidebar_position: 4\n---\n\n# Models API\n\nData models and schemas.\n\n## Coming Soon\n\nModels documentation is in development.\n\n", "metadata": {"source": "packages/website/docs-sdk/api/models.md", "chunk_index": 0, "total_chunks": null}}
{"id": "6bde478b-4aa1-476b-8995-0ccb1936675f", "content": "---\nsidebar_position: 1\n---\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 0, "total_chunks": null}}
{"id": "63b73565-7703-4fca-9f34-b90b22a10f99", "content": "# Client Configuration\n\nConfigure the FluxLoop client to control trace collection, storage, and behavior.\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 1, "total_chunks": null}}
{"id": "05939c87-5474-400d-a791-b94674ae804a", "content": "## Default Configuration\n\nBy default, FluxLoop uses sensible defaults:\n\n```python\nimport fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 2, "total_chunks": null}}
{"id": "fe5907ea-3f9f-4bbe-8b0b-b58178498f0d", "content": "# Uses default configuration:", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 3, "total_chunks": null}}
{"id": "d5e11b28-8d74-4602-a6c9-fa6d9e36b8be", "content": "# - File storage in ./traces/", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 4, "total_chunks": null}}
{"id": "91f2c215-ce46-4281-80b0-557d62125b08", "content": "# - Auto-flush enabled", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 5, "total_chunks": null}}
{"id": "c12b2e35-44c4-45e4-af66-2aa0f25d085f", "content": "# - JSON serialization\n@fluxloop.agent()\ndef my_agent(prompt: str) -> str:\n    return f\"Response: {prompt}\"\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 6, "total_chunks": null}}
{"id": "abe34bf3-9dad-4c51-9db6-51dfa7079c5b", "content": "## Explicit Client Configuration\n\nInitialize the client explicitly for custom settings:\n\n```python\nfrom fluxloop import FluxLoopClient\n\nclient = FluxLoopClient(\n    storage=\"file\",              # Storage backend type\n    base_path=\"./my_traces\",     # Where to save traces\n    auto_flush=True,             # Auto-save after each trace\n    flush_interval=10,           # Flush every 10 seconds\n    buffer_size=100,             # Buffer up to 100 traces\n    project_name=\"my-agent\",     # Project identifier\n    enabled=True,                # Enable/disable tracing", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 7, "total_chunks": null}}
{"id": "38f3a4e9-9b3c-445e-bcbe-24070b9c7c05", "content": ")\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 8, "total_chunks": null}}
{"id": "a2b64274-d2c8-44b5-b446-93e5f443eda6", "content": "## Configuration Options\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 9, "total_chunks": null}}
{"id": "16d2a5a3-db2a-4ef1-82e3-cfbf26a73f57", "content": "### storage\n\nType of storage backend to use.\n\n**Options:**\n- `\"file\"` (default) - Save to local JSONL files\n- `\"http\"` - Send to FluxLoop collector service\n- `\"memory\"` - Store in memory (for testing)\n\n```python", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 10, "total_chunks": null}}
{"id": "0df6ceba-453d-44b5-8d2b-75ae983e918c", "content": "# File storage\nclient = FluxLoopClient(storage=\"file\")\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 11, "total_chunks": null}}
{"id": "e40ee331-0c1b-42df-81f5-6cb6a35a169e", "content": "# HTTP storage\nclient = FluxLoopClient(\n    storage=\"http\",\n    collector_url=\"http://localhost:8000\"\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 12, "total_chunks": null}}
{"id": "4f591102-d9b1-48f9-8fe6-a9e810c72973", "content": "### base_path\n\nDirectory for file storage (when `storage=\"file\"`).\n\n**Default:** `\"./traces\"`\n\n```python\nclient = FluxLoopClient(\n    storage=\"file\",\n    base_path=\"/var/log/fluxloop/traces\"\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 13, "total_chunks": null}}
{"id": "48d44728-d1e6-44bd-9c47-230af9e6fadc", "content": "### auto_flush\n\nAutomatically flush traces to storage after each function call.\n\n**Default:** `True`\n\n```python", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 14, "total_chunks": null}}
{"id": "04a53cdf-7830-4410-acf7-651b5ce6fa3a", "content": "# Disable auto-flush for better performance\nclient = FluxLoopClient(auto_flush=False)\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 15, "total_chunks": null}}
{"id": "487ad62e-8721-4d5e-b5ab-7ca6aaf0f1bb", "content": "# Manually flush when needed\nclient.flush()\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 16, "total_chunks": null}}
{"id": "0f6aab42-20e6-48fb-8f9f-a721a61c2c27", "content": "### flush_interval\n\nSeconds between automatic flushes (when `auto_flush=False`).\n\n**Default:** `10`\n\n```python\nclient = FluxLoopClient(\n    auto_flush=False,\n    flush_interval=30  # Flush every 30 seconds\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 17, "total_chunks": null}}
{"id": "1170acd1-4884-4cd4-8abe-582a37880197", "content": "### buffer_size\n\nMaximum number of traces to buffer before forced flush.\n\n**Default:** `100`\n\n```python\nclient = FluxLoopClient(\n    buffer_size=500  # Buffer up to 500 traces\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 18, "total_chunks": null}}
{"id": "cac0b992-fb93-4b70-a9be-1e129828bb4f", "content": "### project_name\n\nIdentifier for your project (included in all traces).\n\n**Default:** `None`\n\n```python\nclient = FluxLoopClient(\n    project_name=\"my-chatbot-v2\"\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 19, "total_chunks": null}}
{"id": "600494f0-4346-49d8-b6c4-c0c5db7fcfb7", "content": "### enabled\n\nEnable or disable tracing globally.\n\n**Default:** `True`\n\n```python", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 20, "total_chunks": null}}
{"id": "bc3adca5-3215-4fe6-9eb7-0d55a1407a46", "content": "# Disable tracing (useful for production)\nclient = FluxLoopClient(enabled=False)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 21, "total_chunks": null}}
{"id": "afcab680-ba60-45e2-89f3-3b4e213fd700", "content": "### collector_url\n\nURL for HTTP collector (when `storage=\"http\"`).\n\n**Default:** `\"http://localhost:8000\"`\n\n```python\nclient = FluxLoopClient(\n    storage=\"http\",\n    collector_url=\"https://collector.fluxloop.dev\"\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 22, "total_chunks": null}}
{"id": "e6957747-7da7-4c25-b1cd-544ba798ec1c", "content": "### api_key\n\nAPI key for HTTP collector authentication.\n\n**Default:** `None`\n\n```python\nclient = FluxLoopClient(\n    storage=\"http\",\n    collector_url=\"https://collector.fluxloop.dev\",\n    api_key=\"your-api-key-here\"\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 23, "total_chunks": null}}
{"id": "3a600610-b6d2-4c95-b789-b0cccd5b304e", "content": "## Environment Variables\n\nYou can configure FluxLoop using environment variables:\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 24, "total_chunks": null}}
{"id": "1d9a4f85-aa76-4859-8b5f-6336c7fe481e", "content": "# Storage configuration\nexport FLUXLOOP_STORAGE=file\nexport FLUXLOOP_BASE_PATH=./traces\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 25, "total_chunks": null}}
{"id": "448e9a01-7c5f-4e08-b831-af9d7fc83c45", "content": "# HTTP collector\nexport FLUXLOOP_COLLECTOR_URL=http://localhost:8000\nexport FLUXLOOP_API_KEY=your-api-key\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 26, "total_chunks": null}}
{"id": "442879a1-308d-4652-abde-f3c30288693c", "content": "# Project settings\nexport FLUXLOOP_PROJECT_NAME=my-agent\nexport FLUXLOOP_ENABLED=true\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 27, "total_chunks": null}}
{"id": "9ea16119-8dd7-4cdd-bc79-5a5c67f8dd64", "content": "# Buffer settings\nexport FLUXLOOP_AUTO_FLUSH=true\nexport FLUXLOOP_BUFFER_SIZE=100\n```\n\nEnvironment variables take precedence over code configuration.\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 28, "total_chunks": null}}
{"id": "d1811dd7-19e2-4dc9-bc1b-b0fa54df3a87", "content": "## Per-Environment Configuration\n\nDifferent settings for dev/staging/prod:\n\n```python\nimport os\nfrom fluxloop import FluxLoopClient\n\nenv = os.getenv(\"ENVIRONMENT\", \"dev\")\n\nif env == \"production\":\n    client = FluxLoopClient(\n        storage=\"http\",\n        collector_url=\"https://prod-collector.fluxloop.dev\",\n        api_key=os.getenv(\"FLUXLOOP_API_KEY\"),\n        enabled=True,\n    )\nelif env == \"staging\":\n    client = FluxLoopClient(\n        storage=\"http\",\n        collector_url=\"https://staging-collector.fluxloop.dev\",\n        enabled=True,", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 29, "total_chunks": null}}
{"id": "a8aadf03-3de9-4e56-947e-581e9dc5968a", "content": "    )\nelse:  # development\n    client = FluxLoopClient(\n        storage=\"file\",\n        base_path=\"./traces\",\n        enabled=True,\n    )\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 30, "total_chunks": null}}
{"id": "c2f0200d-23a4-4e50-805d-5749b0c52189", "content": "## Global vs Local Configuration\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 31, "total_chunks": null}}
{"id": "6ede4fcd-0cc2-45fb-872a-c989ae4595a5", "content": "### Global Configuration\n\nSet once for your entire application:\n\n```python", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 32, "total_chunks": null}}
{"id": "1278fd70-edea-4071-ac00-d97b3604aaf3", "content": "# app/__init__.py\nfrom fluxloop import FluxLoopClient\n\nclient = FluxLoopClient(project_name=\"my-app\")\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 33, "total_chunks": null}}
{"id": "36d8ade1-96d9-4d92-b203-4a3f40d6ae3a", "content": "### Local Override\n\nOverride for specific functions:\n\n```python\nfrom fluxloop import agent\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 34, "total_chunks": null}}
{"id": "08adf004-ce60-4f83-8e62-5decc29d7a3c", "content": "# Uses global client settings\n@agent()\ndef agent_1(prompt: str) -> str:\n    return f\"A1: {prompt}\"\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 35, "total_chunks": null}}
{"id": "e783a08c-28dd-4fe1-8215-4b88a617e4ae", "content": "# Override storage for this function\n@agent(storage=\"memory\")\ndef agent_2(prompt: str) -> str:\n    return f\"A2: {prompt}\"\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 36, "total_chunks": null}}
{"id": "c66b1b37-7335-4fd8-8a1e-21730991a827", "content": "## Performance Tuning\n\nFor high-throughput scenarios:\n\n```python\nclient = FluxLoopClient(\n    auto_flush=False,       # Disable immediate writes\n    buffer_size=1000,       # Large buffer\n    flush_interval=60,      # Flush every minute\n    storage=\"http\",         # Async HTTP is faster\n)\n```\n\nFor low-latency scenarios:\n\n```python\nclient = FluxLoopClient(\n    auto_flush=True,        # Immediate writes\n    buffer_size=10,         # Small buffer\n    storage=\"file\",         # Fast local writes\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 37, "total_chunks": null}}
{"id": "c5c56661-7a66-48c4-9d97-3f5cfa84d3f6", "content": "## Debugging Configuration\n\nEnable verbose logging:\n\n```python\nimport logging\nfrom fluxloop import FluxLoopClient\n\nlogging.basicConfig(level=logging.DEBUG)\n\nclient = FluxLoopClient(\n    project_name=\"debug-session\",\n    enabled=True,\n)\n```\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 38, "total_chunks": null}}
{"id": "db19bb99-14cd-4b50-9641-9ba56739ad6a", "content": "## Next Steps\n\n- [Storage Backends](./storage-backends) - Detailed storage options\n- [Environment Variables](./environment-variables) - Full env var reference\n- [API Reference](../api/client) - FluxLoopClient API docs\n", "metadata": {"source": "packages/website/docs-sdk/configuration/client-config.md", "chunk_index": 39, "total_chunks": null}}
{"id": "e41477dc-d319-4fb2-a961-7a831a6a6aa1", "content": "---\nsidebar_position: 3\n---\n\n# Environment Variables\n\nSDK environment variable reference.\n\n## Available Variables\n\n- `FLUXLOOP_STORAGE` - Storage backend (file or http)\n- `FLUXLOOP_BASE_PATH` - Base path for file storage\n- `FLUXLOOP_COLLECTOR_URL` - URL for HTTP collector\n\n## Coming Soon\n\nComplete environment variable documentation is in progress.\n\n", "metadata": {"source": "packages/website/docs-sdk/configuration/environment-variables.md", "chunk_index": 0, "total_chunks": null}}
{"id": "7c70d9cb-7983-45fb-80e8-c290ca79d321", "content": "---\ntitle: Runner Integration\nsidebar_position: 15\n---\n\nThe SDK works with the CLI runner by instrumenting your functions/classes. To connect code to simulations, set the `runner` in `configs/simulation.yaml`.\n\nCommon patterns (details in CLI docs → configuration/runner-targets):\n\n- Module + function: `runner.target: \"app.agent:run\"`\n- Class.method (zero-arg ctor): `runner.target: \"app.agent:Handler.handle\"`\n- Module-scoped instance method: `runner.target: \"app.main:support_server.respond\"`\n- Factory-backed class.method: add `runner.factory` (returns instance)", "metadata": {"source": "packages/website/docs-sdk/configuration/runner-integration.md", "chunk_index": 0, "total_chunks": null}}
{"id": "fef294c1-32fe-486a-be1a-18cab8588436", "content": "- Async generators: CLI consumes streamed events via `runner.stream_output_path` (default `message.delta`).\n\nRecording/replay can be combined using `replay_args` for complex kwargs.\n\n", "metadata": {"source": "packages/website/docs-sdk/configuration/runner-integration.md", "chunk_index": 1, "total_chunks": null}}
{"id": "0e109be9-dd24-41c7-aea3-1cce0e7ab6a6", "content": "---\nsidebar_position: 2\n---\n\n# Storage Backends\n\nConfigure storage for traces and observations.\n\n## File Storage\n\n```python\nclient = FluxLoopClient(storage=\"file\")\n```\n\n## HTTP Storage\n\n```python\nclient = FluxLoopClient(\n    storage=\"http\",\n    collector_url=\"http://localhost:8000\"\n)\n```\n\n## Coming Soon\n\nDetailed documentation coming soon.\n\n", "metadata": {"source": "packages/website/docs-sdk/configuration/storage-backends.md", "chunk_index": 0, "total_chunks": null}}
{"id": "ce4d7bcf-2e4d-4f0d-8aaa-8858891d760d", "content": "---\nsidebar_position: 3\n---\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 0, "total_chunks": null}}
{"id": "b13899c2-54c4-4e3e-a4ca-0ba4aac797ca", "content": "# Custom Framework Integration\n\nIntegrate FluxLoop with any agent framework safely and reliably.\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 1, "total_chunks": null}}
{"id": "7207bf35-5555-4aa5-a4ab-3dbff8ea9972", "content": "## Decorator Ordering and Safe Instrumentation\n\nWhen integrating FluxLoop with external agent frameworks (e.g., ChatKit, custom tools, LangChain), follow these rules to avoid type conflicts and ensure observations are captured reliably.\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 2, "total_chunks": null}}
{"id": "88fc0cb1-4a33-4b1a-ba5b-281d89852126", "content": "### Core Principle\n\n**Framework decorator MUST be outermost, FluxLoop instrumentation inside or within function body.**\n\n- If a framework provides its own decorator/wrapper that transforms a plain function into a framework-specific object (e.g., a Tool), that decorator must remain the outermost (top) decorator.\n- FluxLoop decorators should be placed inside (below) the framework decorator, or instrument from within the function body using the SDK context APIs.\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 3, "total_chunks": null}}
{"id": "ba2e28ce-b64c-4031-af8f-8313047bd4e4", "content": "### Two Safe Patterns\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 4, "total_chunks": null}}
{"id": "77c8632f-6bbb-4a33-849b-0dbe15b39dbb", "content": "#### Pattern A: Manual Instrumentation (Safest, Framework-Agnostic)\n\nUse `get_current_context()` and manually push/pop an `ObservationData` inside the function body. This keeps signatures and framework typing unchanged.\n\n**Example: Tool Function**\n\n```python\nfrom fluxloop import get_current_context\nfrom fluxloop.models import ObservationData, ObservationType\n\nasync def my_tool(param: str) -> dict:\n    \"\"\"Tool function with manual FluxLoop instrumentation.\"\"\"\n    fl_ctx = get_current_context()\n    obs = None\n    if fl_ctx and fl_ctx.is_enabled():", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 5, "total_chunks": null}}
{"id": "6dce44a7-16ab-418c-8673-d00ce9e32315", "content": "        obs = ObservationData(\n            type=ObservationType.TOOL,\n            name=\"tool.my_tool\",\n            input={\"args\": {\"param\": param}},\n        )\n        fl_ctx.push_observation(obs)\n\n    try:\n        result = {\"result\": do_work(param)}\n        if obs:\n            obs.output = result\n        return result\n    except Exception as e:\n        if obs:\n            obs.error = str(e)\n        raise\n    finally:\n        if fl_ctx and obs:\n            fl_ctx.pop_observation()\n```\n\n**Why this works:**\n- No decorator conflicts", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 6, "total_chunks": null}}
{"id": "e79da8c9-8012-457a-9c70-2b16b3488f13", "content": "- Framework type system untouched\n- Works with any framework\n- Complete control over observation lifecycle\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 7, "total_chunks": null}}
{"id": "945624c4-34ca-44b1-85ba-7bb015070fcf", "content": "#### Pattern B: Stacked Decorators (Framework Outermost)\n\nIf you prefer decorator syntax, stack them with the framework decorator on top.\n\n**Example: Framework Tool with FluxLoop**\n\n```python\n@framework_tool_decorator(description=\"My tool\")\n@fluxloop.tool(name=\"tool.my_tool\")\nasync def my_tool(param: str) -> dict:\n    \"\"\"Tool with stacked decorators.\"\"\"\n    return {\"result\": do_work(param)}\n```\n\n**Important:** Order matters!\n\n```python", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 8, "total_chunks": null}}
{"id": "879382fe-bf5a-451e-a30a-cb0d8f238015", "content": "# ✅ CORRECT - Framework outermost\n@framework_tool_decorator(...)\n@fluxloop.tool(...)\nasync def my_tool(...):\n    ...\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 9, "total_chunks": null}}
{"id": "a501b5b7-494c-4059-8d25-0c99b98a5713", "content": "# ❌ WRONG - FluxLoop outermost breaks framework type\n@fluxloop.tool(...)\n@framework_tool_decorator(...)\nasync def my_tool(...):\n    ...  # Framework sees plain function, raises \"Unknown tool type\"\n```\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 10, "total_chunks": null}}
{"id": "0c79e82c-a363-49a1-a2c1-72a399272522", "content": "### LLM and Streaming Calls\n\nFor LLM calls (including async generators/streams), use one of these approaches:\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 11, "total_chunks": null}}
{"id": "f1127def-c7d8-4646-b10d-5f82abe6267e", "content": "#### Approach 1: Helper Function with Decorator\n\n```python\n@fluxloop.prompt(name=\"prompt.agent\", model=\"gpt-4\")\nasync def _run_llm_prompt(agent, prompt, context):\n    \"\"\"Instrumented LLM call.\"\"\"\n    return await agent.generate(prompt, context=context)\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 12, "total_chunks": null}}
{"id": "879cff75-f717-4a9c-8bbc-e05508075b60", "content": "# Use in your code\nasync def handle_request(request):\n    result = await _run_llm_prompt(my_agent, request, ctx)\n    async for chunk in result:\n        yield chunk\n```\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 13, "total_chunks": null}}
{"id": "03a27fd3-e7e2-4552-8cb7-9ffdfc1092fa", "content": "#### Approach 2: Context Manager\n\n```python\nasync def handle_request(request):\n    \"\"\"Handle request with instrumented LLM call.\"\"\"\n    with fluxloop.instrument(\"prompt.agent\"):\n        result = await agent.generate(request)\n        async for chunk in result:\n            yield chunk\n```\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 14, "total_chunks": null}}
{"id": "8b7584f0-4730-4355-adf3-582abd3bf46e", "content": "### Real-World Example: ChatKit Integration\n\nHere's a complete example integrating FluxLoop with OpenAI's ChatKit framework:\n\n```python\nfrom agents import function_tool, RunContextWrapper\nfrom chatkit.agents import AgentContext\nfrom fluxloop import get_current_context\nfrom fluxloop.models import ObservationData, ObservationType\n\n@function_tool(\n    description_override=\"Cancel the traveller's upcoming trip and note the refund.\",\n)\nasync def cancel_trip(ctx: RunContextWrapper[AgentContext]) -> dict:\n    \"\"\"ChatKit tool with FluxLoop instrumentation.\"\"\"", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 15, "total_chunks": null}}
{"id": "9fc4d342-4f68-470c-a491-b0efada63fc8", "content": "    fl_ctx = get_current_context()\n    obs = None\n    if fl_ctx and fl_ctx.is_enabled():\n        obs = ObservationData(\n            type=ObservationType.TOOL,\n            name=\"tool.cancel_trip\",\n            input={\"args\": {}},\n        )\n        fl_ctx.push_observation(obs)\n\n    try:\n        message = state_manager.cancel_trip(get_thread_id(ctx))\n        result = {\"result\": message}\n        if obs:\n            obs.output = result\n        return result\n    except Exception as e:\n        if obs:\n            obs.error = str(e)", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 16, "total_chunks": null}}
{"id": "c80c0475-e556-4d50-9ed5-67ce3856140a", "content": "        raise\n    finally:\n        if fl_ctx and obs:\n            fl_ctx.pop_observation()\n```\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 17, "total_chunks": null}}
{"id": "a87d9786-a501-436c-bc93-e48b17495afb", "content": "### Common Errors and Solutions\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 18, "total_chunks": null}}
{"id": "dfefa469-3db8-49e1-ac54-0429b01361e0", "content": "#### Error: \"Unknown tool type: &lt;class 'function'&gt;\"\n\n**Cause:** FluxLoop decorator placed outside framework decorator.\n\n**Solution:** Reverse decorator order or use Pattern A (manual instrumentation).\n\n```python", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 19, "total_chunks": null}}
{"id": "7b0e37c8-c8b9-4ed4-913a-03546e400928", "content": "# ❌ Wrong\n@fluxloop.tool(...)\n@framework_tool(...)\nasync def my_tool(...):\n    ...\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 20, "total_chunks": null}}
{"id": "c9b0a568-83a6-4a81-a843-36d8db5dcf8e", "content": "# ✅ Correct\n@framework_tool(...)\n@fluxloop.tool(...)\nasync def my_tool(...):\n    ...\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 21, "total_chunks": null}}
{"id": "8fdc3967-01fc-4b0d-8826-d0658ac9e071", "content": "# ✅ Also correct (safest)\n@framework_tool(...)\nasync def my_tool(...):\n    fl_ctx = get_current_context()\n    # manual instrumentation...\n```\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 22, "total_chunks": null}}
{"id": "64371b0c-2115-4669-b2ee-0b5cf918feba", "content": "#### Error: Observations Not Captured\n\n**Cause:** No FluxLoop context active when observation is created.\n\n**Solution:** Ensure the parent function is wrapped with `fluxloop.instrument()` or `@fluxloop.agent()`.\n\n```python", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 23, "total_chunks": null}}
{"id": "dd4e8e7a-339f-48dd-852e-2bdb6b53451e", "content": "# In experiment runner or test harness\nwith fluxloop.instrument(\"my_agent_run\"):\n    result = await agent.run(input_data)  # Tools inside will be captured\n```\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 24, "total_chunks": null}}
{"id": "27176d6b-66a2-43be-bf83-bdafc1389913", "content": "### Best Practices\n\n1. **Default to Pattern A** for framework integrations unless you control both decorators.\n2. **Test decorator order** if using Pattern B—verify the framework still recognizes the function type.\n3. **Always check context** before creating observations: `if fl_ctx and fl_ctx.is_enabled():`\n4. **Use try/finally** to ensure observations are popped even on errors.\n5. **Capture errors** in `obs.error` for failed operations.\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 25, "total_chunks": null}}
{"id": "535ec862-53b0-4fed-aee2-5ef57e156991", "content": "### Observation Types\n\nChoose the appropriate observation type:\n\n- `ObservationType.TOOL` — Function/tool calls\n- `ObservationType.GENERATION` — LLM completions\n- `ObservationType.AGENT` — High-level agent operations\n- `ObservationType.SPAN` — Generic timing spans\n- `ObservationType.EVENT` — Point-in-time events\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 26, "total_chunks": null}}
{"id": "1f9793f3-d9c8-473f-a7a1-56d672ee0fc7", "content": "### Verification\n\nAfter integration, verify observations are captured:\n\n1. Run your agent with FluxLoop enabled\n2. Check offline store: `<output_dir>/artifacts/observations.jsonl`\n3. Confirm tool/generation observations appear with correct `trace_id`\n4. Use `fluxloop parse experiment` to verify structured output\n\n```bash\nfluxloop run experiment --config config.yaml", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 27, "total_chunks": null}}
{"id": "dead43e1-63f5-4925-92ea-ba460bace614", "content": "# Check artifacts directory\nls experiments/<experiment_name>/artifacts/", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 28, "total_chunks": null}}
{"id": "94a738bf-6708-471a-b519-6f11bb57ab41", "content": "# Should see observations.jsonl\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 29, "total_chunks": null}}
{"id": "7740d87c-79f9-443a-8fdb-a8200ffc26be", "content": "# Parse and analyze\nfluxloop parse experiment experiments/<experiment_name>\n```\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 30, "total_chunks": null}}
{"id": "2a68b9d8-bc42-4c5f-9e1b-68a6837381b7", "content": "## Need Help?\n\nIf you encounter integration issues:\n\n1. Check decorator ordering\n2. Verify parent context exists\n3. Enable debug mode: `fluxloop.configure(debug=True)`\n4. Review observation capture in logs\n5. Open an issue with framework details and error messages\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/custom.md", "chunk_index": 31, "total_chunks": null}}
{"id": "53cfb61c-8340-4597-9b24-b2efd3f67ad5", "content": "---\nsidebar_position: 1\n---\n\n# LangChain Integration\n\nUse FluxLoop with LangChain.\n\n## Example\n\n```python\nimport fluxloop\nfrom langchain.chains import LLMChain\n\n@fluxloop.agent()\ndef run_chain(prompt: str):\n    chain = LLMChain(...)\n    return chain.run(prompt)\n```\n\n## Coming Soon\n\nFull LangChain integration guide is in development.\n\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/langchain.md", "chunk_index": 0, "total_chunks": null}}
{"id": "4e3d7a69-5272-4e4e-b55a-1b200a3f03a0", "content": "---\nsidebar_position: 2\n---\n\n# LangGraph Integration\n\nUse FluxLoop with LangGraph.\n\n## Coming Soon\n\nLangGraph integration documentation is in development.\n\n", "metadata": {"source": "packages/website/docs-sdk/frameworks/langgraph.md", "chunk_index": 0, "total_chunks": null}}
{"id": "7a30771c-5966-4107-b00e-8235a568e6b5", "content": "---\nsidebar_position: 3\n---\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 0, "total_chunks": null}}
{"id": "e0d091b5-599f-48b4-9559-c6d1489f4b93", "content": "# Async Support\n\nFluxLoop SDK has first-class support for async/await patterns commonly used in modern Python agents.\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 1, "total_chunks": null}}
{"id": "7d1f3c2b-d1ea-47b4-a362-7e89f4156967", "content": "## Basic Async Function\n\nTrace async functions the same way as sync functions:\n\n```python\nimport asyncio\nimport fluxloop\n\n@fluxloop.agent()\nasync def async_agent(prompt: str) -> str:\n    await asyncio.sleep(0.1)  # Simulate async work\n    return f\"Async response: {prompt}\"\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 2, "total_chunks": null}}
{"id": "198fdd7e-4c98-4a39-b06c-28455e61dce9", "content": "# Run it\nresult = asyncio.run(async_agent(\"Hello\"))\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 3, "total_chunks": null}}
{"id": "690c2313-d97b-4a83-9c64-886944ac9b21", "content": "## Async Function Chains\n\nTrace multiple async functions in a workflow:\n\n```python\nimport asyncio\nimport fluxloop\n\n@fluxloop.trace()\nasync def fetch_context(query: str) -> str:\n    await asyncio.sleep(0.05)  # Simulate API call\n    return f\"Context for: {query}\"\n\n@fluxloop.trace()\nasync def generate_response(context: str) -> str:\n    await asyncio.sleep(0.1)  # Simulate LLM call\n    return f\"Generated from {context}\"\n\n@fluxloop.agent()\nasync def async_agent(query: str) -> str:\n    context = await fetch_context(query)\n    response = await generate_response(context)", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 4, "total_chunks": null}}
{"id": "e73e9021-58da-41a3-8f35-2514f5d7881b", "content": "    return response\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 5, "total_chunks": null}}
{"id": "15c3b1a3-6d1b-43da-90a6-6aa0edff8ee5", "content": "# All async calls are traced\nresult = asyncio.run(async_agent(\"What is AI?\"))\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 6, "total_chunks": null}}
{"id": "6201505d-ec73-4b12-b17d-85c37298589f", "content": "## Concurrent Async Calls\n\nFluxLoop correctly handles concurrent async operations:\n\n```python\nimport asyncio\nimport fluxloop\n\n@fluxloop.trace()\nasync def call_api_1(query: str) -> str:\n    await asyncio.sleep(0.1)\n    return f\"API1: {query}\"\n\n@fluxloop.trace()\nasync def call_api_2(query: str) -> str:\n    await asyncio.sleep(0.1)\n    return f\"API2: {query}\"\n\n@fluxloop.agent()\nasync def parallel_agent(query: str) -> str:\n    # Call both APIs concurrently\n    results = await asyncio.gather(\n        call_api_1(query),\n        call_api_2(query)", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 7, "total_chunks": null}}
{"id": "3b9dd0c4-7fbd-494c-bebf-f8f823fdbbaa", "content": "    )\n    return \" | \".join(results)\n\nresult = asyncio.run(parallel_agent(\"test\"))\n```\n\nEach concurrent call gets its own trace with correct timing information.\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 8, "total_chunks": null}}
{"id": "774d4f4f-4ab4-4828-a541-2ab28c6dabfb", "content": "## Async Context Managers\n\nFluxLoop works with async context managers:\n\n```python\nimport asyncio\nimport fluxloop\nfrom contextlib import asynccontextmanager\n\n@asynccontextmanager\nasync def database_connection():\n    # Setup\n    conn = await connect_to_db()\n    try:\n        yield conn\n    finally:\n        # Cleanup\n        await conn.close()\n\n@fluxloop.agent()\nasync def query_agent(query: str) -> str:\n    async with database_connection() as conn:\n        result = await conn.execute(query)\n        return result\n\nresult = asyncio.run(query_agent(\"SELECT * FROM users\"))", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 9, "total_chunks": null}}
{"id": "f65e238f-c77a-442e-b94c-51ee1da638d4", "content": "```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 10, "total_chunks": null}}
{"id": "6e9dc7a6-bcb1-4822-adee-721378c4306d", "content": "## Async Generators\n\nTrace async generators for streaming responses:\n\n```python\nimport asyncio\nimport fluxloop\n\n@fluxloop.agent()\nasync def streaming_agent(prompt: str):\n    \"\"\"Async generator that yields tokens\"\"\"\n    for i in range(5):\n        await asyncio.sleep(0.1)\n        yield f\"Token {i}: {prompt}\"\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 11, "total_chunks": null}}
{"id": "16149589-8862-46bf-b7ad-89dc1ccdf1e6", "content": "# Consume the async generator\nasync def main():\n    async for token in streaming_agent(\"Hello\"):\n        print(token)\n\nasyncio.run(main())\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 12, "total_chunks": null}}
{"id": "48d526a2-6985-4301-b245-11cb28968a44", "content": "## FastAPI Integration\n\nFluxLoop integrates seamlessly with FastAPI:\n\n```python\nfrom fastapi import FastAPI\nimport fluxloop\n\napp = FastAPI()\n\n@app.post(\"/agent\")\n@fluxloop.agent()\nasync def agent_endpoint(prompt: str):\n    \"\"\"Traced FastAPI endpoint\"\"\"\n    await asyncio.sleep(0.1)\n    return {\"response\": f\"Processed: {prompt}\"}\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 13, "total_chunks": null}}
{"id": "7f20f310-0788-4345-9b37-f5970a4c3135", "content": "# All requests are automatically traced\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 14, "total_chunks": null}}
{"id": "2b0b8171-57e8-4096-a9ca-c273f3495a68", "content": "## Error Handling in Async\n\nErrors in async functions are properly captured:\n\n```python\nimport asyncio\nimport fluxloop\n\n@fluxloop.agent()\nasync def async_agent_with_error(prompt: str) -> str:\n    try:\n        if not prompt:\n            raise ValueError(\"Prompt cannot be empty\")\n        await asyncio.sleep(0.1)\n        return f\"Response: {prompt}\"\n    except ValueError as e:\n        # Error is captured in trace\n        return f\"Error: {e}\"\n\nresult = asyncio.run(async_agent_with_error(\"\"))\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 15, "total_chunks": null}}
{"id": "3e64a2f2-7985-4c7a-b1d0-a1d29e5a5507", "content": "## Performance Considerations\n\nFluxLoop's async tracing is designed to be minimal-overhead:\n\n- ✅ Non-blocking observation collection\n- ✅ Async-safe trace storage\n- ✅ Parallel trace writing\n- ✅ No interference with your async event loop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 16, "total_chunks": null}}
{"id": "f8eb7e34-29a5-41e1-9cf2-5c46a36effba", "content": "## Best Practices\n\n1. **Use `@agent()` on your main entry point**\n   - Mark your top-level async function with `@agent()`\n   - Use `@trace()` for helper functions\n\n2. **Don't block the event loop**\n   - FluxLoop won't block, but make sure your code doesn't either\n   - Use `asyncio.sleep()` instead of `time.sleep()`\n\n3. **Configure async storage**\n   - Use async-compatible storage backends for best performance\n   ```python\n   client = FluxLoopClient(storage=\"http\", async_mode=True)\n   ```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 17, "total_chunks": null}}
{"id": "b20beb08-0c45-4ee8-8324-48368d3ff877", "content": "## Next Steps\n\n- [Client Configuration](../configuration/client-config) - Configure async options\n- [Storage Backends](../configuration/storage-backends) - Async storage options\n- [API Reference](../api/decorators) - Full async decorator API\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/async-support.md", "chunk_index": 18, "total_chunks": null}}
{"id": "172f3015-7bed-474c-8d43-372ed7c1403f", "content": "---\nsidebar_position: 2\n---\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 0, "total_chunks": null}}
{"id": "2b51fd78-6de9-4ab6-991f-f878ee4e325e", "content": "# Basic Usage\n\nGet started with the FluxLoop SDK in minutes.\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 1, "total_chunks": null}}
{"id": "5e7d10a6-0801-4321-92ec-f1fee214562b", "content": "## Minimal Example\n\nThe simplest way to start tracing your agent:\n\n```python\nimport fluxloop\n\n@fluxloop.agent()\ndef my_agent(prompt: str) -> str:\n    \"\"\"Simple agent that processes prompts.\"\"\"\n    response = f\"Response to: {prompt}\"\n    return response\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 2, "total_chunks": null}}
{"id": "d7d637f2-97e7-4984-add6-014d54de36d5", "content": "# Run it - traces are automatically collected\nresult = my_agent(\"Hello, world!\")\nprint(result)\n```\n\nThat's it! FluxLoop is now tracing your function calls and saving traces to `./traces/`.\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 3, "total_chunks": null}}
{"id": "a96363f0-3500-4408-8942-4eff15dc91d1", "content": "## With Configuration\n\nFor more control, configure the client explicitly:\n\n```python\nimport fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 4, "total_chunks": null}}
{"id": "4ccc4c68-04fc-4994-ba29-03211c280338", "content": "# Configure once at application startup\nfluxloop.configure(\n    enabled=True,\n    storage=\"file\",\n    base_path=\"./traces\",\n    debug=False\n)\n\n@fluxloop.agent(name=\"MyAgent\", metadata={\"version\": \"1.0\"})\ndef my_agent(prompt: str) -> str:\n    \"\"\"Agent with custom name and metadata.\"\"\"\n    return f\"Processed: {prompt}\"\n\nresult = my_agent(\"Hello\")\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 5, "total_chunks": null}}
{"id": "d76bad89-3495-4985-9f62-a27acf7d3bba", "content": "## Understanding Traces\n\nEach time you call a decorated function, FluxLoop creates a **trace** containing:\n\n| Field | Description |\n|-------|-------------|\n| `trace_id` | Unique identifier for this execution |\n| `session_id` | Groups related traces (auto-generated) |\n| `start_time` | When execution started (UTC) |\n| `end_time` | When execution completed (UTC) |\n| `duration_ms` | Execution time in milliseconds |\n| `input` | Function input parameters |\n| `output` | Function return value |\n| `status` | `success` or `error` |", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 6, "total_chunks": null}}
{"id": "c533bb48-35a8-47dd-86ae-f388872f1f1c", "content": "| `metadata` | Custom metadata attached to trace |\n| `observations` | Nested observations (child function calls) |\n\nTraces are automatically saved to your configured storage backend.\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 7, "total_chunks": null}}
{"id": "b9533687-7ef1-4bf0-bee1-6c2bec528add", "content": "## Multiple Function Tracing\n\nTrace multiple functions in your agent workflow to create a hierarchical observation tree:\n\n```python\nimport fluxloop\n\n@fluxloop.trace(name=\"preprocess\")\ndef preprocess(text: str) -> str:\n    \"\"\"Preprocessing step.\"\"\"\n    return text.strip().lower()\n\n@fluxloop.tool(name=\"search_tool\")\ndef search_knowledge_base(query: str) -> list:\n    \"\"\"Tool for searching knowledge base.\"\"\"\n    return [\"result1\", \"result2\"]\n\n@fluxloop.prompt(model=\"gpt-4o\", name=\"generate\")\ndef generate_response(context: list, query: str) -> str:", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 8, "total_chunks": null}}
{"id": "3d387e79-09d7-4729-bc7f-435224b41388", "content": "    \"\"\"LLM generation step.\"\"\"\n    # Your LLM call here\n    return f\"AI response based on {context}\"\n\n@fluxloop.agent(name=\"RAG_Agent\")\ndef rag_agent(user_input: str) -> str:\n    \"\"\"Main agent orchestration.\"\"\"\n    # Step 1: Preprocess\n    cleaned = preprocess(user_input)\n    \n    # Step 2: Retrieve\n    docs = search_knowledge_base(cleaned)\n    \n    # Step 3: Generate\n    response = generate_response(docs, cleaned)\n    \n    return response\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 9, "total_chunks": null}}
{"id": "d002ee8b-1b74-46a8-859c-5070218984b9", "content": "# All functions are traced with proper parent-child relationships\nresult = rag_agent(\"  What is Python?  \")\n```\n\n**Observation hierarchy created:**\n```\nAGENT: RAG_Agent\n├── SPAN: preprocess\n├── TOOL: search_tool\n└── GENERATION: generate\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 10, "total_chunks": null}}
{"id": "3454c8e5-3442-4f43-bbae-aa9486572727", "content": "## Async Support\n\nFluxLoop works seamlessly with async functions:\n\n```python\nimport asyncio\nimport fluxloop\n\n@fluxloop.agent(name=\"AsyncAgent\")\nasync def async_agent(prompt: str) -> str:\n    \"\"\"Async agent example.\"\"\"\n    await asyncio.sleep(0.1)  # Simulate async work\n    return f\"Async response: {prompt}\"\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 11, "total_chunks": null}}
{"id": "160ebbdd-16b9-419f-b5fb-6847c6021388", "content": "# Run it\nasync def main():\n    result = await async_agent(\"Hello async world!\")\n    print(result)\n\nasyncio.run(main())\n```\n\n**Async generators (streaming) also supported:**\n\n```python\n@fluxloop.prompt(model=\"gpt-4o\", name=\"stream_chat\")\nasync def stream_chat(messages: list):\n    \"\"\"Stream LLM response chunks.\"\"\"\n    for i in range(5):\n        await asyncio.sleep(0.1)\n        yield f\"chunk_{i}\"\n\nasync def main():\n    async for chunk in stream_chat([]):\n        print(chunk)\n\nasyncio.run(main())\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 12, "total_chunks": null}}
{"id": "0de73ef1-197b-4636-ae3c-d47d522d2ebb", "content": "## Adding Custom Metadata\n\nAttach custom metadata to traces for filtering and analysis:\n\n```python\nfrom fluxloop import agent, get_current_context\n\n@agent(name=\"UserAgent\")\ndef user_agent(prompt: str, user_id: str, session_id: str) -> str:\n    \"\"\"Agent with custom metadata.\"\"\"\n    # Get current context\n    ctx = get_current_context()\n    \n    # Add custom metadata\n    if ctx:\n        ctx.metadata[\"user_id\"] = user_id\n        ctx.metadata[\"session_id\"] = session_id\n        ctx.metadata[\"app_version\"] = \"2.0\"\n        ctx.tags.extend([\"production\", \"api\"])", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 13, "total_chunks": null}}
{"id": "f182132b-53c5-43fb-ab5b-3beef59791ef", "content": "    \n    return f\"Response for {user_id}\"\n\nresult = user_agent(\"Hello\", user_id=\"user_123\", session_id=\"sess_456\")\n```\n\n**Metadata appears in trace:**\n```json\n{\n  \"trace_id\": \"...\",\n  \"metadata\": {\n    \"user_id\": \"user_123\",\n    \"session_id\": \"sess_456\",\n    \"app_version\": \"2.0\"\n  },\n  \"tags\": [\"production\", \"api\"]\n}\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 14, "total_chunks": null}}
{"id": "d3789030-f049-4497-883e-a857f831df41", "content": "## Accessing Trace Data\n\nAfter running your agent, you can access trace data programmatically:\n\n```python\nfrom fluxloop import get_current_trace\n\n@fluxloop.agent()\ndef my_agent(prompt: str) -> str:\n    # Get current trace metadata\n    trace = get_current_trace()\n    \n    if trace:\n        print(f\"Trace ID: {trace.trace_id}\")\n        print(f\"Session ID: {trace.session_id}\")\n        print(f\"Started at: {trace.start_time}\")\n    \n    return \"response\"\n\nresult = my_agent(\"test\")\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 15, "total_chunks": null}}
{"id": "957a6ec9-c119-42a5-8baa-a3d748371fbf", "content": "## Viewing Trace Files\n\nBy default, traces are saved to `./traces/` directory as JSONL files:\n\n```bash\nls -la ./traces/\n```\n\n**Output:**\n```\ntraces_20250117.jsonl        # Trace metadata\nobservations_20250117.jsonl  # Observation stream\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 16, "total_chunks": null}}
{"id": "40d50be7-f5c8-459a-a15d-df05cd896fac", "content": "### Trace File Format\n\n**`traces_YYYYMMDD.jsonl`** - One JSON object per line:\n\n```json\n{\n  \"trace_id\": \"f47ac10b-58cc-4372-a567-0e02b2c3d479\",\n  \"session_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n  \"start_time\": \"2025-01-17T14:30:22.123456Z\",\n  \"end_time\": \"2025-01-17T14:30:22.456789Z\",\n  \"duration_ms\": 333.333,\n  \"status\": \"success\",\n  \"metadata\": {\n    \"user_id\": \"user_123\",\n    \"version\": \"1.0\"\n  },\n  \"tags\": [\"production\"]\n}\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 17, "total_chunks": null}}
{"id": "d0aa32a2-62c9-4f04-8c77-a6105048ff0e", "content": "### Observation File Format\n\n**`observations_YYYYMMDD.jsonl`** - Hierarchical observations:\n\n```json\n{\n  \"id\": \"obs_001\",\n  \"trace_id\": \"f47ac10b-58cc-4372-a567-0e02b2c3d479\",\n  \"type\": \"AGENT\",\n  \"name\": \"MyAgent\",\n  \"parent_id\": null,\n  \"start_time\": \"2025-01-17T14:30:22.123456Z\",\n  \"end_time\": \"2025-01-17T14:30:22.456789Z\",\n  \"input\": {\"prompt\": \"Hello\"},\n  \"output\": \"Response: Hello\",\n  \"metadata\": {}\n}\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 18, "total_chunks": null}}
{"id": "306aca50-3c7a-484e-90d0-e837b5f48b0c", "content": "### Reading Traces Programmatically\n\n```python\nimport json\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 19, "total_chunks": null}}
{"id": "2772c069-a6a2-43c0-9a33-7b9f2e9ebe4a", "content": "# Read traces\nwith open(\"./traces/traces_20250117.jsonl\") as f:\n    for line in f:\n        trace = json.loads(line)\n        print(f\"Trace {trace['trace_id']}: {trace['duration_ms']}ms\")\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 20, "total_chunks": null}}
{"id": "17d51a5d-8656-4cbd-bf40-2f7eee74531f", "content": "# Read observations\nwith open(\"./traces/observations_20250117.jsonl\") as f:\n    for line in f:\n        obs = json.loads(line)\n        print(f\"{obs['type']}: {obs['name']}\")\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 21, "total_chunks": null}}
{"id": "6c6c075a-6da1-420e-8ef0-50325d54cec7", "content": "## Context Manager Usage\n\nUse the `instrument()` context manager for non-decorator scenarios:\n\n```python\nfrom fluxloop import instrument\n\ndef run_experiment(inputs: list):\n    \"\"\"Run experiment with manual instrumentation.\"\"\"\n    for inp in inputs:\n        with instrument(\n            name=\"experiment_iteration\",\n            metadata={\"input_id\": inp[\"id\"]},\n            tags=[\"experiment\"]\n        ):\n            result = process_input(inp)\n            print(f\"Result: {result}\")\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 22, "total_chunks": null}}
{"id": "141d7fd1-3972-4b42-a560-f565e2e77804", "content": "# Each iteration creates a separate trace\nrun_experiment([\n    {\"id\": \"001\", \"data\": \"test1\"},\n    {\"id\": \"002\", \"data\": \"test2\"},\n])\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 23, "total_chunks": null}}
{"id": "ee6562da-edcb-446c-b598-7b115b0ce8e8", "content": "## Error Handling\n\nFluxLoop automatically captures exceptions:\n\n```python\n@fluxloop.tool(name=\"risky_operation\")\ndef risky_operation(data: str) -> dict:\n    \"\"\"Operation that might fail.\"\"\"\n    if not data:\n        raise ValueError(\"Data cannot be empty\")\n    return {\"result\": process(data)}\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 24, "total_chunks": null}}
{"id": "593de4a4-7b83-4e69-aa2c-9807bebb5c3d", "content": "# When exception occurs:\ntry:\n    result = risky_operation(\"\")\nexcept ValueError as e:\n    print(f\"Caught: {e}\")\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 25, "total_chunks": null}}
{"id": "9ca9b541-b2dd-47b3-8619-f042990fd2ba", "content": "# Trace contains:", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 26, "total_chunks": null}}
{"id": "38c2f128-e65a-428e-bf25-ffeb1e03cdb8", "content": "# - observation.error = \"Data cannot be empty\"", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 27, "total_chunks": null}}
{"id": "59f1de22-55da-4c9f-9d2d-ce15f7088f80", "content": "# - observation.metadata[\"error_type\"] = \"ValueError\"", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 28, "total_chunks": null}}
{"id": "179ab5b9-eac3-4947-ae80-0e0821b00c8e", "content": "# - observation.status = \"error\"", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 29, "total_chunks": null}}
{"id": "2537a83b-7bd8-48d9-981d-7a61891c0b8f", "content": "# - Full traceback captured\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 30, "total_chunks": null}}
{"id": "7aab10b7-6ed3-4931-9bbe-460d464199d4", "content": "## Integration with FluxLoop CLI\n\nYour instrumented agents work seamlessly with FluxLoop CLI for experiments:\n\n**1. Define your agent:**\n\n```python", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 31, "total_chunks": null}}
{"id": "9c87a6ef-7889-44af-b7ac-e925d0208f38", "content": "# my_agent.py\nimport fluxloop\n\n@fluxloop.agent(name=\"ChatBot\")\ndef run(input_text: str) -> str:\n    \"\"\"Agent entry point for CLI.\"\"\"\n    return f\"Response: {input_text}\"\n```\n\n**2. Configure CLI runner:**\n\n```yaml", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 32, "total_chunks": null}}
{"id": "75e31e65-8a85-4dc0-9826-d86251606879", "content": "# configs/simulation.yaml\nrunner:\n  target: \"my_agent:run\"\n  iterations: 10\n```\n\n**3. Run experiment:**\n\n```bash\nfluxloop run experiment\n```\n\nSee [Runner Integration](/sdk/configuration/runner-integration) for detailed patterns.\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 33, "total_chunks": null}}
{"id": "08f7d00d-27f8-4af1-a484-3e5cb9ec5d57", "content": "## Best Practices\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 34, "total_chunks": null}}
{"id": "dd9c99cb-1a7f-49a2-b426-b48f963d889a", "content": "### 1. Use Specific Decorators\n\nChoose the right decorator for each function:\n\n```python\n@fluxloop.agent()       # Agent entry points\ndef orchestrator(...): ...\n\n@fluxloop.tool()        # External tools\ndef api_call(...): ...\n\n@fluxloop.prompt()      # LLM completions\ndef llm_generate(...): ...\n\n@fluxloop.trace()       # Everything else\ndef helper(...): ...\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 35, "total_chunks": null}}
{"id": "ba5571c2-cdd3-4208-bc1e-3fcfa78d8f21", "content": "### 2. Add Meaningful Names\n\n```python", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 36, "total_chunks": null}}
{"id": "bd202459-3c7c-4634-97af-658da9e16c56", "content": "# ✅ Good: Descriptive names\n@fluxloop.agent(name=\"CustomerSupportAgent\")\ndef handle_support(...): ...\n\n@fluxloop.tool(name=\"knowledge_base_search\")\ndef search(...): ...\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 37, "total_chunks": null}}
{"id": "1bca7c0f-70e6-4b57-b3ca-6286ffd8e698", "content": "# ❌ Bad: Generic names\n@fluxloop.agent()  # Uses function name \"func\"\ndef func(...): ...\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 38, "total_chunks": null}}
{"id": "46b6cc4e-c38f-4307-bc1a-409a3971509f", "content": "### 3. Use Metadata for Context\n\n```python\n@fluxloop.agent(metadata={\n    \"version\": \"2.0\",\n    \"model\": \"gpt-4o\",\n    \"environment\": \"production\"\n})\ndef my_agent(...): ...\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 39, "total_chunks": null}}
{"id": "c3e32be9-4d3e-4984-892d-e10aa2bfc540", "content": "### 4. Structure Observations Hierarchically\n\n```python\n@fluxloop.agent()\ndef main_agent(...):\n    # Parent observation\n    result1 = preprocess(...)   # Child observation\n    result2 = process(...)       # Child observation\n    return combine(result1, result2)\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 40, "total_chunks": null}}
{"id": "3b6e2ad4-fa16-4e3e-8882-a6fa3d00a575", "content": "### 5. Handle Async Properly\n\n```python", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 41, "total_chunks": null}}
{"id": "b9270911-9acd-42f7-aa17-bb876ab7f911", "content": "# ✅ Async function with async decorator\n@fluxloop.agent()\nasync def async_agent(...):\n    return await async_work()\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 42, "total_chunks": null}}
{"id": "b2e6a76f-141c-46a0-af2a-9e45ac13fb83", "content": "# ❌ Don't mix sync decorator with async function", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 43, "total_chunks": null}}
{"id": "dc995fc7-05fa-4ce0-abef-25d86825aac9", "content": "# (FluxLoop handles this, but be aware)\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 44, "total_chunks": null}}
{"id": "bb2bc846-6bdc-4294-98cf-e2620a543b26", "content": "## Common Patterns\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 45, "total_chunks": null}}
{"id": "378eb2b8-12ad-4fe2-a309-36ad10b0bcff", "content": "### Pattern: RAG Agent\n\n```python\n@fluxloop.agent(name=\"RAG_Agent\")\ndef rag_agent(question: str) -> str:\n    # Retrieve\n    docs = retrieve_documents(question)\n    \n    # Generate\n    answer = generate_answer(docs, question)\n    \n    return answer\n\n@fluxloop.tool(name=\"retrieve\")\ndef retrieve_documents(query: str) -> list:\n    return vector_db.search(query)\n\n@fluxloop.prompt(model=\"gpt-4o\")\ndef generate_answer(context: list, question: str) -> str:\n    return llm.generate(context, question)\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 46, "total_chunks": null}}
{"id": "63e4bbbd-79d1-446c-9830-9f4b567525c8", "content": "### Pattern: Multi-Tool Agent\n\n```python\n@fluxloop.agent(name=\"ToolAgent\")\ndef tool_agent(task: str) -> str:\n    # Decide which tool to use\n    tool_name = decide_tool(task)\n    \n    if tool_name == \"search\":\n        result = search_web(task)\n    elif tool_name == \"calculate\":\n        result = calculate(task)\n    else:\n        result = \"Unknown tool\"\n    \n    return result\n\n@fluxloop.tool(name=\"web_search\")\ndef search_web(query: str) -> dict:\n    return search_engine.search(query)\n\n@fluxloop.tool(name=\"calculator\")\ndef calculate(expression: str) -> float:", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 47, "total_chunks": null}}
{"id": "decd5558-4cd4-42cf-8516-70d4ad499bc4", "content": "    return eval(expression)\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 48, "total_chunks": null}}
{"id": "ef94e47c-933a-45b0-821d-b425de616489", "content": "### Pattern: Streaming Response\n\n```python\n@fluxloop.prompt(model=\"gpt-4o\", name=\"stream_response\")\nasync def stream_response(prompt: str):\n    \"\"\"Stream LLM response in chunks.\"\"\"\n    async for chunk in llm.stream(prompt):\n        # Each chunk is captured\n        yield chunk\n\nasync def main():\n    async for chunk in stream_response(\"Tell me a story\"):\n        print(chunk, end=\"\", flush=True)\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 49, "total_chunks": null}}
{"id": "2b51c4e6-c2fb-46f1-b222-af0667816c2a", "content": "## Next Steps\n\n- **[Async Support](/sdk/getting-started/async-support)** - Deep dive into async patterns\n- **[Client Configuration](/sdk/configuration/client-config)** - Configure storage and options\n- **[Framework Integration](/sdk/frameworks/langchain)** - Use with LangChain, LangGraph\n- **[API Reference](/sdk/api/decorators)** - Full decorator API documentation\n- **[Runner Integration](/sdk/configuration/runner-integration)** - CLI integration patterns\n\n---\n\nQuestions? Check the [API Reference](/sdk/api/decorators) or [GitHub Issues](https://github.com/chuckgu/fluxloop/issues).", "metadata": {"source": "packages/website/docs-sdk/getting-started/basic-usage.md", "chunk_index": 50, "total_chunks": null}}
{"id": "9cd33378-8faf-4a56-a313-2fae709e47fe", "content": "---\nsidebar_position: 1\n---\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 0, "total_chunks": null}}
{"id": "1028872c-f5e2-429f-ac3e-3666eefd00ae", "content": "# SDK Installation\n\nInstall the FluxLoop SDK for Python agent instrumentation.\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 1, "total_chunks": null}}
{"id": "2a51c1fc-e1e1-46ff-a2fb-951fdea7ccba", "content": "## Requirements\n\n- **Python 3.11 or higher**\n- pip\n\n:::info Python Version Requirement\nThe FluxLoop SDK requires Python 3.11+ due to advanced type hints and protocol features used for tracing context management.\n:::\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 2, "total_chunks": null}}
{"id": "95c2a297-92fe-4920-9c1d-1d9a025ef87c", "content": "## Install via pip\n\n```bash\npip install fluxloop\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 3, "total_chunks": null}}
{"id": "9df76af5-7831-47d7-a043-5d89acc11540", "content": "### With Optional Dependencies\n\nInstall with framework-specific extras:\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 4, "total_chunks": null}}
{"id": "027df7b4-3fe5-4832-82c1-4546c472ade2", "content": "# For LangChain integration\npip install fluxloop[langchain]\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 5, "total_chunks": null}}
{"id": "0c3ed964-8092-4df6-afce-a838a169d80e", "content": "# For LangGraph integration\npip install fluxloop[langgraph]\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 6, "total_chunks": null}}
{"id": "d410a6a0-f033-47dc-9c0b-b570a8905154", "content": "# For development (includes test tools)\npip install fluxloop[dev]\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 7, "total_chunks": null}}
{"id": "dbec3d1a-3f18-41f7-a9ac-24246e781c38", "content": "# Multiple extras\npip install fluxloop[langchain,langgraph]\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 8, "total_chunks": null}}
{"id": "21978fc0-4d8d-4b19-9496-8cf7b61927cb", "content": "## Verify Installation\n\nCheck that the SDK is installed correctly:\n\n```python\nimport fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 9, "total_chunks": null}}
{"id": "cf04dbed-1e0e-4bfe-9059-d90e8473b336", "content": "# Check version\nprint(fluxloop.__version__)  # Should print: 0.1.7\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 10, "total_chunks": null}}
{"id": "b6504da4-99ee-4786-8d92-9355136e3969", "content": "# Test basic functionality\nfluxloop.configure(enabled=True, debug=True)\nprint(\"FluxLoop SDK ready!\")\n```\n\n**Expected output:**\n```\n0.1.7\nFluxLoop SDK ready!\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 11, "total_chunks": null}}
{"id": "6fa15b4d-b642-418f-9ff5-29a719e2ce98", "content": "## Quick Test\n\nCreate a simple test file to verify tracing works:\n\n```python", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 12, "total_chunks": null}}
{"id": "11252de9-3689-40cd-997b-6dc7dcf0fd8d", "content": "# test_fluxloop.py\nimport fluxloop\n\n@fluxloop.agent(name=\"TestAgent\")\ndef test_agent(message: str) -> str:\n    return f\"Echo: {message}\"\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 13, "total_chunks": null}}
{"id": "5d19af0f-b5f9-435c-94d0-265248d444d3", "content": "# Run the agent\nresult = test_agent(\"Hello, FluxLoop!\")\nprint(result)\n```\n\nRun it:\n```bash\npython test_fluxloop.py\n```\n\n**Expected:**\n- Prints: `Echo: Hello, FluxLoop!`\n- Creates `./traces/` directory with JSONL files\n- Check `./traces/traces_YYYYMMDD.jsonl` for trace data\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 14, "total_chunks": null}}
{"id": "259ec74e-8f80-4d32-af89-e9096ace91a6", "content": "## Troubleshooting\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 15, "total_chunks": null}}
{"id": "f3594d02-8ad5-4bf1-811c-82f9c132b1c1", "content": "### \"Python version 3.11 required\"\n\n**Issue:** SDK requires Python 3.11+\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 16, "total_chunks": null}}
{"id": "83d89272-a8f3-4552-8dee-710d0ca9ad66", "content": "# Check Python version\npython --version\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 17, "total_chunks": null}}
{"id": "409f88fb-1cbe-4c81-9f4d-79d9ca3723c3", "content": "# Install Python 3.11+ if needed", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 18, "total_chunks": null}}
{"id": "5e74508a-983e-4c4a-b0b3-10b49e14f601", "content": "# macOS (Homebrew):\nbrew install python@3.11\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 19, "total_chunks": null}}
{"id": "28b052fa-9761-4cab-be82-9f898784cb36", "content": "# Ubuntu/Debian:\nsudo apt install python3.11\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 20, "total_chunks": null}}
{"id": "4382801c-4f29-411a-9c9e-ed3a63caf77a", "content": "# Then create venv with correct version\npython3.11 -m venv .venv\nsource .venv/bin/activate\npip install fluxloop\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 21, "total_chunks": null}}
{"id": "920429c3-d7d6-4f2e-87e1-23fd5a977c3e", "content": "### \"ModuleNotFoundError: No module named 'fluxloop'\"\n\n**Issue:** SDK not installed or wrong Python environment\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 22, "total_chunks": null}}
{"id": "ed11973f-e284-4738-a3e2-3d9261ce6b30", "content": "# Verify installation\npip list | grep fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 23, "total_chunks": null}}
{"id": "0a460da3-e7bf-401a-b83d-2c8f48b5ed22", "content": "# Reinstall if missing\npip install --force-reinstall fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 24, "total_chunks": null}}
{"id": "f0c831f7-6ade-47fb-9ac0-34afebe1aba5", "content": "# Check Python environment\nwhich python\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 25, "total_chunks": null}}
{"id": "5eb11794-f684-4835-9c70-f04701ede7e2", "content": "### Import Errors for Optional Dependencies\n\n**Issue:** Using LangChain/LangGraph without installing extras\n\n**Solution:**\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 26, "total_chunks": null}}
{"id": "0384e41a-5660-4cb7-a3c3-0fdad545b80e", "content": "# Install with extras\npip install fluxloop[langchain]", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 27, "total_chunks": null}}
{"id": "bec7ad77-ce9b-42dc-857f-07e70996cf39", "content": "# or\npip install fluxloop[langgraph]\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 28, "total_chunks": null}}
{"id": "dd4a032f-b4e9-4dd9-856d-422ea1c4c2a1", "content": "## Virtual Environment Setup\n\nIt's recommended to use a virtual environment:\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 29, "total_chunks": null}}
{"id": "12088ec8-0096-4dbe-9a37-2cd37abe27ce", "content": "### Using venv\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 30, "total_chunks": null}}
{"id": "ae04566d-f513-4ccb-8bae-68e7493c55cd", "content": "# Create virtual environment\npython3.11 -m venv .venv\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 31, "total_chunks": null}}
{"id": "7ac688a8-38c5-4b98-9582-9bc3ac8d702f", "content": "# Activate (macOS/Linux)\nsource .venv/bin/activate\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 32, "total_chunks": null}}
{"id": "8e293153-92b0-4a99-8eaf-9444d260f582", "content": "# Activate (Windows)\n.venv\\Scripts\\activate\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 33, "total_chunks": null}}
{"id": "c435f509-87fd-43fa-b9df-6273fbf9ffca", "content": "# Install FluxLoop\npip install fluxloop\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 34, "total_chunks": null}}
{"id": "7cfee7ff-0ec4-4d30-98bb-340102098433", "content": "### Using Poetry\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 35, "total_chunks": null}}
{"id": "3873fecf-f774-4bd8-88e5-b3663b67ec60", "content": "# Initialize project\npoetry init\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 36, "total_chunks": null}}
{"id": "a277eaa1-016d-47ee-9a05-90367fe30a47", "content": "# Add FluxLoop\npoetry add fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 37, "total_chunks": null}}
{"id": "11d6955a-c2d9-4811-b2c2-f95ffed5753f", "content": "# With extras\npoetry add fluxloop[langchain,langgraph]\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 38, "total_chunks": null}}
{"id": "75713a00-ae8c-413c-8549-0a53d317e86f", "content": "### Using pipenv\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 39, "total_chunks": null}}
{"id": "2f92c9e9-cf85-4832-a982-25d12823e401", "content": "# Install with pipenv\npipenv install fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 40, "total_chunks": null}}
{"id": "ddfebdac-2898-43d8-bada-eb8242aacaca", "content": "# With extras\npipenv install fluxloop[langchain]\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 41, "total_chunks": null}}
{"id": "e3fe92ae-b208-4f82-af1f-d19334abd98b", "content": "## Upgrading\n\nUpgrade to the latest version:\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 42, "total_chunks": null}}
{"id": "80a9d38d-74b7-4893-afce-66d15df625c7", "content": "# Upgrade via pip\npip install --upgrade fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 43, "total_chunks": null}}
{"id": "e58f12e4-efaf-4f79-82e4-ea29381df343", "content": "# Check new version\npython -c \"import fluxloop; print(fluxloop.__version__)\"\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 44, "total_chunks": null}}
{"id": "1c101fd9-e4b0-42b8-a68b-43fb33ac56b1", "content": "## Development Installation\n\nFor contributing or local development:\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 45, "total_chunks": null}}
{"id": "a4b3321d-dbea-4bf4-a478-45fac5e1e653", "content": "# Clone repository\ngit clone https://github.com/chuckgu/fluxloop.git\ncd fluxloop/packages/sdk\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 46, "total_chunks": null}}
{"id": "5c0687a4-781b-476d-b9e5-87d81c3836f3", "content": "# Install in editable mode with dev dependencies\npip install -e \".[dev]\"\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 47, "total_chunks": null}}
{"id": "d41f2cd0-9901-4574-8e4c-084300307772", "content": "# Run tests\npytest\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 48, "total_chunks": null}}
{"id": "771a4808-5191-4a27-884a-f5a1f0e2dcbc", "content": "# Run type checking\nmypy fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 49, "total_chunks": null}}
{"id": "3723f159-3e67-40cb-b30b-731c7cb882ef", "content": "# Run linter\nruff check fluxloop\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 50, "total_chunks": null}}
{"id": "e3b186b9-4f62-4eac-97bd-ce0cf78492ed", "content": "## Platform-Specific Notes\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 51, "total_chunks": null}}
{"id": "c308eda5-fbc6-4b37-a37d-f716164b7e74", "content": "### macOS\n\nWorks out of the box with Homebrew Python:\n\n```bash\nbrew install python@3.11\npip3 install fluxloop\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 52, "total_chunks": null}}
{"id": "ec209335-3167-4066-a426-97e0838022f7", "content": "### Linux (Ubuntu/Debian)\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 53, "total_chunks": null}}
{"id": "98d3ccfd-6693-410c-919d-27dc5489d10c", "content": "# Install Python 3.11\nsudo apt update\nsudo apt install python3.11 python3.11-venv python3-pip\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 54, "total_chunks": null}}
{"id": "8780722a-4ed2-42f7-befd-9e1bb69db486", "content": "# Install FluxLoop\npython3.11 -m pip install fluxloop\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 55, "total_chunks": null}}
{"id": "4be886e9-b44d-4f4e-960a-c86ae36134c1", "content": "### Windows\n\n```powershell", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 56, "total_chunks": null}}
{"id": "12f8da35-9f01-48b0-9c36-7dbfa051990a", "content": "# Install Python 3.11 from python.org\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 57, "total_chunks": null}}
{"id": "a55d7606-2d33-4ca9-bcee-782d0fbce4dd", "content": "# Install FluxLoop\npip install fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 58, "total_chunks": null}}
{"id": "03045a11-861a-4134-9a1d-5d155d858018", "content": "# Note: Use `python` instead of `python3`\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 59, "total_chunks": null}}
{"id": "cbf7fc9a-f0fc-44cf-88c9-fb97fe071343", "content": "## Docker Installation\n\nInclude FluxLoop in your Docker image:\n\n```dockerfile\nFROM python:3.11-slim\n\nWORKDIR /app\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 60, "total_chunks": null}}
{"id": "5889569d-ffdf-44f1-b3f5-b63ed7feb5fd", "content": "# Install FluxLoop\nRUN pip install --no-cache-dir fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 61, "total_chunks": null}}
{"id": "702dd953-5410-49d1-af89-be23be914abb", "content": "# Copy your agent code\nCOPY . .\n\nCMD [\"python\", \"my_agent.py\"]\n```\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 62, "total_chunks": null}}
{"id": "28da0b80-47b5-4c5a-8ef3-163474c143a3", "content": "## Configuration After Installation\n\nAfter installing, configure the SDK:\n\n```python\nimport fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 63, "total_chunks": null}}
{"id": "ca0226a3-cce7-4c6a-bad9-9aea32d6efc1", "content": "# Basic configuration\nfluxloop.configure(\n    enabled=True,\n    storage=\"file\",\n    base_path=\"./traces\",\n    debug=False\n)\n```\n\nOr use environment variables:\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 64, "total_chunks": null}}
{"id": "ae7fdf47-d607-4b73-bd7e-7d7c4fcba806", "content": "# .env\nFLUXLOOP_ENABLED=true\nFLUXLOOP_STORAGE=file\nFLUXLOOP_BASE_PATH=./traces\nFLUXLOOP_DEBUG=false\n```\n\nLoad with:\n\n```python\nfluxloop.load_env(\".env\")\n```\n\nSee [Client Configuration](/sdk/configuration/client-config) for all options.\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 65, "total_chunks": null}}
{"id": "0b955385-b44f-4f2f-85d8-59a42b937b5f", "content": "## Next Steps\n\n- **[Basic Usage](/sdk/getting-started/basic-usage)** - Your first traced agent\n- **[Async Support](/sdk/getting-started/async-support)** - Async patterns\n- **[Client Configuration](/sdk/configuration/client-config)** - Configure storage and options\n- **[API Reference](/sdk/api/decorators)** - Full decorator API\n\n---\n\nHaving issues? Check [GitHub Issues](https://github.com/chuckgu/fluxloop/issues) or the [Troubleshooting Guide](/sdk/configuration/client-config#troubleshooting).\n", "metadata": {"source": "packages/website/docs-sdk/getting-started/installation.md", "chunk_index": 66, "total_chunks": null}}
{"id": "dd90dc18-d91c-49f3-a996-663184eac9fc", "content": "---\nsidebar_position: 1\nslug: /\n---\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 0, "total_chunks": null}}
{"id": "618e35fb-e5ac-4728-b34b-57b2a438352c", "content": "# FluxLoop SDK\n\nThe FluxLoop SDK provides Python decorators and utilities for instrumenting AI agents with automatic tracing and observation collection.\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 1, "total_chunks": null}}
{"id": "9a7cef43-3bc9-4c07-b746-99f0337abdf4", "content": "## Version\n\nCurrent version: **0.1.7**\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 2, "total_chunks": null}}
{"id": "fffdcbf8-ae0f-4280-bfaa-d91faa86b60e", "content": "## Installation\n\n```bash\npip install fluxloop\n```\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 3, "total_chunks": null}}
{"id": "ee166c26-3403-4b88-a0ce-db443498c52f", "content": "## Requirements\n\n- **Python 3.11 or higher**\n- pip\n\n:::info Python Version Requirement\nThe FluxLoop SDK requires Python 3.11+ due to advanced type hints and protocol features.\n:::\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 4, "total_chunks": null}}
{"id": "f59f1902-35d5-48ce-b1aa-5719e9e46059", "content": "## Features\n\n- 🔍 **Automatic Tracing**: Instrument your agent code with simple decorators\n- 📊 **Rich Context**: Capture inputs, outputs, metadata, and nested observations\n- 🔄 **Async Support**: First-class support for both sync and async functions\n- 🎯 **Framework Integration**: Built-in support for LangChain, LangGraph, and custom frameworks\n- 📝 **Observation Streaming**: Real-time event collection with hierarchical structure\n- 💾 **Flexible Storage**: File-based (JSONL) or HTTP collector backends\n- 🔧 **Recording Mode**: Capture and replay complex function arguments", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 5, "total_chunks": null}}
{"id": "bf90b98d-c0cf-41d2-ae06-9ae1a84d3f08", "content": "- 🧪 **Test Integration**: Seamless pytest integration for agent testing\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 6, "total_chunks": null}}
{"id": "40adbfa6-3c47-4322-b95e-cf15fc7b08d2", "content": "## Quick Example\n\n```python\nimport fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 7, "total_chunks": null}}
{"id": "15da6022-b08a-4565-a661-4b10a4418d1a", "content": "# Initialize (optional - uses sensible defaults)\nfluxloop.configure(\n    storage=\"file\",\n    base_path=\"./traces\"\n)\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 8, "total_chunks": null}}
{"id": "94b1ef8f-f678-4827-a348-5d117a009193", "content": "# Decorate your agent function\n@fluxloop.agent(name=\"ChatAgent\")\ndef my_agent(prompt: str) -> str:\n    \"\"\"Your agent logic here.\"\"\"\n    # Agent implementation\n    result = process_prompt(prompt)\n    return result\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 9, "total_chunks": null}}
{"id": "d59abb92-040a-4b24-8bcc-83b70eb00a63", "content": "# Run it - traces are automatically collected\nresponse = my_agent(\"Hello, world!\")\n```\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 10, "total_chunks": null}}
{"id": "26c0ff92-dbf1-4c6a-b66a-ce90ef41d87a", "content": "## Core Components\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 11, "total_chunks": null}}
{"id": "19f2d121-032b-4d4a-aa28-c95e8eb85ad3", "content": "### Decorators\n\nFluxLoop provides specialized decorators for different observation types:\n\n| Decorator | Purpose | Observation Type |\n|-----------|---------|------------------|\n| `@fluxloop.agent()` | Agent entry points | `AGENT` |\n| `@fluxloop.trace()` | General function tracing | `SPAN` (configurable) |\n| `@fluxloop.tool()` | Tool/function calls | `TOOL` |\n| `@fluxloop.prompt()` | LLM completions | `GENERATION` |\n| `@fluxloop.instrument()` | Context manager for scopes | Configurable |\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 12, "total_chunks": null}}
{"id": "44ed3ced-10e4-4f3a-a363-5d15db412d02", "content": "### Client & Configuration\n\n- `fluxloop.configure()` - Global configuration (storage, debug, recording)\n- `fluxloop.FluxLoopClient()` - Advanced client for custom setups\n- `fluxloop.load_env()` - Load configuration from `.env` files\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 13, "total_chunks": null}}
{"id": "4174b3d3-7031-4909-9fd2-9a0ad02157e8", "content": "### Context Management\n\n- `get_current_context()` - Access current trace context\n- `get_current_trace()` - Get current trace metadata\n- Manual observation push/pop for fine-grained control\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 14, "total_chunks": null}}
{"id": "cdbdaf26-749f-429a-8907-e025c597d19a", "content": "### Storage Backends\n\n- **FileStorage** - Local JSONL files (default)\n  - `traces_YYYYMMDD.jsonl` - Trace metadata\n  - `observations_YYYYMMDD.jsonl` - Observation stream\n- **HTTPStorage** - Remote collector service\n  - Real-time streaming to FluxLoop collector\n  - Buffered batch uploads\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 15, "total_chunks": null}}
{"id": "56125967-1d52-44c0-8697-ece41be8eecc", "content": "## Advanced Features\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 16, "total_chunks": null}}
{"id": "24519433-fd6c-4c4c-aa57-bdc3810bad94", "content": "### Recording Mode\n\nCapture complex function arguments for replay in experiments:\n\n```python\nimport fluxloop\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 17, "total_chunks": null}}
{"id": "aed23ed5-70b0-4fe6-88eb-345f12540141", "content": "# Enable recording\nfluxloop.configure(\n    record_args=True,\n    recording_file=\"recordings/args.jsonl\"\n)\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 18, "total_chunks": null}}
{"id": "e3478c58-067c-4313-8ae3-278c2d3dd2a0", "content": "# Arguments are automatically captured\n@fluxloop.agent()\ndef my_handler(request: ComplexRequest):\n    return process(request)\n```\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 19, "total_chunks": null}}
{"id": "a710dd4e-cf6c-40a0-beb2-9613e737560c", "content": "### Async & Streaming Support\n\nFull support for async functions and async generators:\n\n```python\n@fluxloop.agent()\nasync def async_agent(prompt: str) -> str:\n    result = await process_async(prompt)\n    return result\n\n@fluxloop.prompt(model=\"gpt-4o\")\nasync def stream_response(messages: list):\n    \"\"\"Stream LLM chunks.\"\"\"\n    async for chunk in llm.stream(messages):\n        yield chunk  # Each chunk traced\n```\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 20, "total_chunks": null}}
{"id": "cab5dbb8-ece5-42a9-b300-965be1be4e7c", "content": "### Framework Integration\n\nSafe integration with external frameworks (LangChain, LangGraph, custom agents):\n\n```python", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 21, "total_chunks": null}}
{"id": "c2a18405-2a73-41fb-b66c-6f8c6d800a6e", "content": "# Pattern A: Manual instrumentation (safest)\nfrom fluxloop import get_current_context\nfrom fluxloop.models import ObservationData, ObservationType\n\nasync def my_tool(param: str) -> dict:\n    fl_ctx = get_current_context()\n    obs = None\n    \n    if fl_ctx and fl_ctx.is_enabled():\n        obs = ObservationData(\n            type=ObservationType.TOOL,\n            name=\"my_tool\",\n            input={\"args\": {\"param\": param}},\n        )\n        fl_ctx.push_observation(obs)\n    \n    try:\n        result = process(param)\n        if obs:", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 22, "total_chunks": null}}
{"id": "d16bdb9f-f6b4-4f8c-9f53-d065bc757c32", "content": "            obs.output = result\n        return result\n    finally:\n        if fl_ctx and obs:\n            fl_ctx.pop_observation()\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 23, "total_chunks": null}}
{"id": "251a864e-8e68-4c35-9c5c-cd260f0817f1", "content": "# Pattern B: Decorator stacking (framework outermost)\n@framework_tool_decorator(...)\n@fluxloop.tool(name=\"my_tool\")\nasync def my_tool(...):\n    ...\n```\n\nSee [Custom Framework Integration](/sdk/frameworks/custom) for detailed guidance.\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 24, "total_chunks": null}}
{"id": "55caae18-b931-45c9-a717-66c0c1b01f78", "content": "## Observation Types\n\nFluxLoop captures different types of observations:\n\n| Type | Description | Use Case |\n|------|-------------|----------|\n| `AGENT` | Agent-level operation | Top-level agent entry points |\n| `SPAN` | Generic timing span | General function tracing |\n| `TOOL` | Tool/function call | External tools, APIs, functions |\n| `GENERATION` | LLM completion | Model inference, prompts |\n| `RETRIEVAL` | Document retrieval | RAG, database queries |\n| `EMBEDDING` | Embedding generation | Vector generation |\n| `EVENT` | Point-in-time event | Logging, milestones |", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 25, "total_chunks": null}}
{"id": "64d60775-96c9-4f0f-a117-a431bb826827", "content": "## Output Structure\n\nTraces and observations are saved in JSONL format:\n\n```\n./traces/\n├── traces_20250117.jsonl         # Trace metadata\n└── observations_20250117.jsonl    # Observation stream\n```\n\nEach trace contains:\n- `trace_id`: Unique identifier\n- `session_id`: Session grouping\n- `start_time`, `end_time`: Timestamps\n- `metadata`: Custom metadata\n- `tags`: Categorization tags\n- `status`: Success/error status\n\nEach observation contains:\n- `id`, `trace_id`: Identifiers\n- `type`: Observation type (AGENT, TOOL, etc.)\n- `name`: Human-readable name", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 27, "total_chunks": null}}
{"id": "6e6abfa0-383f-49f5-97b2-270889b67c0d", "content": "- `input`, `output`: Captured data\n- `start_time`, `end_time`: Timing\n- `parent_id`: For nested observations\n- `metadata`: Additional context\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 28, "total_chunks": null}}
{"id": "06bb46b1-60b4-465b-bfbf-afc9ffbf2e0f", "content": "## Integration with FluxLoop CLI\n\nThe SDK works seamlessly with FluxLoop CLI for experiments:\n\n```yaml", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 29, "total_chunks": null}}
{"id": "417d8aa2-9584-4ec6-a477-c75e663134e1", "content": "# configs/simulation.yaml\nrunner:\n  target: \"my_module:my_agent\"  # Your decorated function\n  iterations: 10\n```\n\n```bash", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 30, "total_chunks": null}}
{"id": "65f4fdd0-ce37-4667-9b68-01bc17bab7b0", "content": "# Run experiments with your instrumented agent\nfluxloop run experiment\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 31, "total_chunks": null}}
{"id": "91cca46a-3c8e-44c4-aad3-389081487fb2", "content": "# Parse and evaluate results\nfluxloop parse experiment experiments/latest_*/\nfluxloop evaluate experiment experiments/latest_*/\n```\n\nSee [CLI Integration](/sdk/configuration/runner-integration) for details.\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 32, "total_chunks": null}}
{"id": "1b37564c-7c92-41b1-a8e1-648730302c6c", "content": "## What's Next?\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 33, "total_chunks": null}}
{"id": "6734cc11-dae6-4245-82a5-a5dc24072762", "content": "### Getting Started\n- **[Installation & Setup](/sdk/getting-started/installation)** - Install and verify the SDK\n- **[Basic Usage](/sdk/getting-started/basic-usage)** - Your first traced agent\n- **[Async Support](/sdk/getting-started/async-support)** - Async patterns and streaming\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 34, "total_chunks": null}}
{"id": "12d9f1f5-df6c-4331-ac18-23877a8ca292", "content": "### Configuration\n- **[Client Configuration](/sdk/configuration/client-config)** - Configure storage and behavior\n- **[Environment Variables](/sdk/configuration/environment-variables)** - Environment-based config\n- **[Storage Backends](/sdk/configuration/storage-backends)** - File vs HTTP storage\n- **[Runner Integration](/sdk/configuration/runner-integration)** - CLI integration patterns\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 35, "total_chunks": null}}
{"id": "91bf7b64-fee1-47a8-8003-e5df2f307381", "content": "### API Reference\n- **[Decorators](/sdk/api/decorators)** - Full decorator API\n- **[Client](/sdk/api/client)** - FluxLoopClient API\n- **[Context](/sdk/api/context)** - Context management API\n- **[Models](/sdk/api/models)** - Data models and schemas\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 36, "total_chunks": null}}
{"id": "1827c21d-f171-4fd3-90fd-6442fc2ea9b5", "content": "### Framework Integration\n- **[LangChain](/sdk/frameworks/langchain)** - LangChain integration guide\n- **[LangGraph](/sdk/frameworks/langgraph)** - LangGraph integration guide\n- **[Custom Frameworks](/sdk/frameworks/custom)** - Safe integration patterns\n\n---\n\nNeed help? Check the [API Reference](/sdk/api/decorators) or [GitHub Issues](https://github.com/chuckgu/fluxloop/issues).\n", "metadata": {"source": "packages/website/docs-sdk/intro.md", "chunk_index": 37, "total_chunks": null}}
{"id": "d4bed891-0908-462e-9288-f1a8dd54d91a", "content": "# pytest cache directory #\n\nThis directory contains data from the pytest's cache plugin,\nwhich provides the `--lf` and `--ff` options, as well as the `cache` fixture.\n\n**Do not** commit this to version control.\n\nSee [the docs](https://docs.pytest.org/en/stable/how-to/cache.html) for more information.\n", "metadata": {"source": "packages/sdk/.pytest_cache/README.md", "chunk_index": 0, "total_chunks": null}}
{"id": "afc496da-893e-4ebf-89d3-7b4faf132c08", "content": "# FluxLoop SDK\n\nFluxLoop SDK for agent instrumentation and tracing.\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 0, "total_chunks": null}}
{"id": "707a6fc6-5a3b-434a-bb0c-e21076630c5f", "content": "## Installation\n\n```bash\npip install fluxloop\n```\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 1, "total_chunks": null}}
{"id": "d4f4de10-5ab0-4d34-9e0f-cbfcb79b3240", "content": "## Quick Start\n\n```python\nfrom fluxloop import trace, FluxLoopClient\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 2, "total_chunks": null}}
{"id": "584bc739-7df2-4362-96ed-0c771d8f1470", "content": "# Initialize the client\nclient = FluxLoopClient()\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 3, "total_chunks": null}}
{"id": "2ea7fa6e-05e0-4c28-8a2b-cf419406cc2a", "content": "# Use the trace decorator\n@trace()\ndef my_agent_function(prompt: str):\n    # Your agent logic here\n    return result\n```\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 4, "total_chunks": null}}
{"id": "6d2ac061-e106-4513-a265-81848b380c82", "content": "## Features\n\n- 🔍 **Automatic Tracing**: Instrument your agent code with simple decorators\n- 📊 **Rich Context**: Capture inputs, outputs, and metadata\n- 🔄 **Async Support**: Works with both sync and async functions\n- 🎯 **Framework Integration**: Built-in support for LangChain and LangGraph\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 5, "total_chunks": null}}
{"id": "ddc725ac-1a1c-4f66-abba-6b6b83e0a488", "content": "## Documentation\n\nFor detailed documentation, visit [https://docs.fluxloop.dev](https://docs.fluxloop.dev)\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 6, "total_chunks": null}}
{"id": "1ac3ee1b-80d1-4442-a1a2-160fcec4334b", "content": "## License\n\nApache License 2.0 - see LICENSE file for details\n\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 7, "total_chunks": null}}
{"id": "624b7e56-720c-4d0a-9ff4-302cfefe38da", "content": "## Framework Integration: Decorator Ordering and Safe Instrumentation\n\nWhen integrating FluxLoop with external agent frameworks (e.g., ChatKit, LangChain), follow these rules to avoid type conflicts and ensure observations are captured reliably.\n\n- Outermost framework wrapper: If a framework provides its own decorator/wrapper that transforms a plain function into a framework-specific object (e.g., a Tool), that decorator MUST be the outermost (top) decorator. This preserves the type the framework expects.\n- FluxLoop instrumentation inside: Place FluxLoop decorators inside (below) the framework decorator, or instrument from within the function body using the SDK context APIs.", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 8, "total_chunks": null}}
{"id": "fd59ace9-c223-4587-894d-6673ec1e21f8", "content": "\nTwo safe patterns:\n\n- Pattern A (safest, framework-agnostic): instrument inside the function body\n  - Use `get_current_context()` and push/pop an `ObservationData` manually around your logic. This keeps signatures and framework typing unchanged.\n  - Example (tool function):\n\n    ```python\n    from fluxloop import get_current_context\n    from fluxloop.models import ObservationData, ObservationType\n\n    async def my_tool(param: str) -> dict:\n        fl_ctx = get_current_context()\n        obs = None\n        if fl_ctx and fl_ctx.is_enabled():", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 9, "total_chunks": null}}
{"id": "8602b463-42f8-4206-955e-9cfdff9430e8", "content": "            obs = ObservationData(\n                type=ObservationType.TOOL,\n                name=\"tool.my_tool\",\n                input={\"args\": {\"param\": param}},\n            )\n            fl_ctx.push_observation(obs)\n\n        try:\n            result = {\"result\": do_work(param)}\n            if obs:\n                obs.output = result\n            return result\n        except Exception as e:\n            if obs:\n                obs.error = str(e)\n            raise\n        finally:\n            if fl_ctx and obs:\n                fl_ctx.pop_observation()", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 10, "total_chunks": null}}
{"id": "f34109a2-665c-4c95-9f09-3507dd24cae4", "content": "    ```\n\n- Pattern B (stacking decorators): framework outermost, FluxLoop inside\n  - Example with a framework tool decorator:\n\n    ```python\n    @framework_tool_decorator(...)\n    @fluxloop.tool(name=\"tool.my_tool\")\n    async def my_tool(...):\n        ...\n    ```\n\n  - Important: If you reverse the order (FluxLoop outside), the framework may see a plain function instead of its expected type and raise errors like \"Unknown tool type\".\n\nLLM/streaming calls:\n\n- For LLM calls (including async generators/streams), either:\n  - Wrap the call site in a small helper decorated with `@fluxloop.prompt(...)`, or", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 11, "total_chunks": null}}
{"id": "abadfea4-f59d-43d6-bb89-4bb297c7703c", "content": "  - Use `with fluxloop.instrument(\"prompt.name\"):` around the portion that produces model output, ensuring it runs inside the current FluxLoop context.\n\nThese patterns guarantee observations are captured (`tool`, `generation`) while keeping the external framework’s type system intact.\n", "metadata": {"source": "packages/sdk/README.md", "chunk_index": 12, "total_chunks": null}}
